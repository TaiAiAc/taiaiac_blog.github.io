<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Z.A.M.">





<title>nuxtjsåŸºç¡€ | Z. A. M.â€™s Blog</title>



    <link rel="icon" href="/taiaiac.gitee.io/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/taiaiac.gitee.io/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/taiaiac.gitee.io/js/script.js"></script>
    
    <script src="/taiaiac.gitee.io/js/tocbot.min.js"></script>
    



    
    
        
    


  <meta name="generator" content="Hexo 5.3.0"></head>
  <body>
    <div class="wrapper">
      <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/taiaiac.gitee.io/">TaiAiAc&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/taiaiac.gitee.io/archives">æ–‡æ¡£</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/category">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/about">å…³äº</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/taiaiac.gitee.io/">TaiAiAc&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/taiaiac.gitee.io/archives">æ–‡æ¡£</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/category">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/about">å…³äº</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
      <div class="main"><div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">nuxtjsåŸºç¡€</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Z.A.M.</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 16, 2021&nbsp;&nbsp;15:13:35</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/taiaiac.gitee.io/categories/nuxtjs/">nuxtjs</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Nuxt-js-æ˜¯ä»€ä¹ˆ"><a href="#Nuxt-js-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Nuxt.js æ˜¯ä»€ä¹ˆ"></a>Nuxt.js æ˜¯ä»€ä¹ˆ</h1><p>Nuxt.js å®˜æ–¹ä»‹ç»ï¼š</p>
<blockquote>
<p>Nuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„é€šç”¨åº”ç”¨æ¡†æ¶ã€‚ é€šè¿‡å¯¹å®¢æˆ·ç«¯/æœåŠ¡ç«¯åŸºç¡€æ¶æ„çš„æŠ½è±¡ç»„ç»‡ï¼ŒNuxt.js ä¸»è¦å…³æ³¨çš„æ˜¯åº”ç”¨çš„ UIæ¸²æŸ“ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªçµæ´»çš„åº”ç”¨æ¡†æ¶ï¼Œä½ å¯ä»¥åŸºäºå®ƒåˆå§‹åŒ–æ–°é¡¹ç›®çš„åŸºç¡€ç»“æ„ä»£ç ï¼Œæˆ–è€…åœ¨å·²æœ‰ Node.js é¡¹ç›®ä¸­ä½¿ç”¨ Nuxt.jsã€‚ Nuxt.js é¢„è®¾äº†åˆ©ç”¨ Vue.js å¼€å‘æœåŠ¡ç«¯æ¸²æŸ“çš„åº”ç”¨æ‰€éœ€è¦çš„å„ç§é…ç½®ã€‚</p>
</blockquote>
<h2 id="Nuxt-js-è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#Nuxt-js-è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="Nuxt.js è§£å†³ä»€ä¹ˆé—®é¢˜"></a>Nuxt.js è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p>ç°åœ¨ <code>Vue.js</code> å¤§å¤šæ•°ç”¨äºå•é¡µé¢åº”ç”¨ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œå•é¡µé¢åº”ç”¨å·²ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚å¹¶ä¸”ä¸€äº›ç¼ºç‚¹ä¹Ÿæˆä¸ºå•é¡µé¢åº”ç”¨çš„é€šç—…ï¼Œå•é¡µé¢åº”ç”¨åœ¨è®¿é—®æ—¶ä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶è¿›è¡ŒåŠ è½½ï¼Œé¦–å±è®¿é—®éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ç™½å±ï¼Œå¦å¤–ä¸€ç‚¹æ˜¯æ€»æ‰€å‘¨çŸ¥çš„ <code>SEO</code> ä¼˜åŒ–é—®é¢˜ã€‚</p>
<p><code>Nuxt.js</code> çš„å‡ºç°æ­£å¥½æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä½ çš„ç½‘ç«™æ˜¯åå‘ç¤¾åŒºéœ€è¦æœç´¢å¼•æ“æä¾›æµé‡çš„é¡¹ç›®ï¼Œé‚£å°±å†åˆé€‚ä¸è¿‡äº†ã€‚</p>
<h1 id="åŸºç¡€åº”ç”¨ä¸é…ç½®"><a href="#åŸºç¡€åº”ç”¨ä¸é…ç½®" class="headerlink" title="åŸºç¡€åº”ç”¨ä¸é…ç½®"></a>åŸºç¡€åº”ç”¨ä¸é…ç½®</h1><blockquote>
<p><code>npx create nuxt-app &lt;proName&gt;</code></p>
</blockquote>
<p>é¡¹ç›®é…ç½®ï¼š</p>
<ul>
<li><p>è¯­è¨€: JavaScript</p>
</li>
<li><p>åŒ…ç®¡ç† : yarn</p>
</li>
<li><p>UIæ¡†æ¶ï¼šElement</p>
</li>
<li><p>ä½¿ç”¨é›†æˆçš„ :  Axios -  Promise based HTTP client</p>
</li>
<li><p>ä»£ç æ£€æµ‹ : Prettier</p>
</li>
<li><p>æµ‹è¯•æ¡†æ¶ï¼šNone</p>
</li>
<li><p>Nuxtæ¨¡å¼ï¼šUniversal (æœåŠ¡ç«¯æ¸²æŸ“)</p>
</li>
<li><p>éƒ¨ç½²ç›®æ ‡ :  æœåŠ¡å™¨ or é™æ€æ‰˜ç®¡</p>
</li>
<li><p>å¼€å‘å·¥å…· : jsconfig.json(vs code)</p>
</li>
<li><p>ç‰ˆæœ¬æ§åˆ¶ : git</p>
</li>
</ul>
<h1 id="middlewareå®šä¹‰ï¼ˆnuxt-config-layout-pagesï¼‰"><a href="#middlewareå®šä¹‰ï¼ˆnuxt-config-layout-pagesï¼‰" class="headerlink" title="middlewareå®šä¹‰ï¼ˆnuxt.config, layout, pagesï¼‰"></a>middlewareå®šä¹‰ï¼ˆnuxt.config, layout, pagesï¼‰</h1><p>middlewareé¡¾åæ€ä¹‰å°±æ˜¯ä¸­é—´ä»¶çš„æ„æ€ï¼Œåœ¨ä¸­é—´ä»·å¯ä»¥åšè·¯ç”±æ‹¦æˆªï¼Œå‚æ•°è¿‡æ»¤ç­‰ç­‰â€¦middlewareæœ‰ä»¥ä¸‹ä¸‰ç§å®šä¹‰æ–¹å¼ã€‚</p>
<ul>
<li>nuxt.config é…ç½®æ–‡ä»¶å®šä¹‰</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line"> router:&#123;</span><br><span class="line">     middleware: [<span class="string">&#x27;xxxx&#x27;</span>] <span class="comment">//ç›´æ¥å†™ä¸­é—´ä»¶æ–‡ä»¶åï¼Œæ¯”å¦‚middleware/auth.jsï¼Œç›´æ¥å†™authå°±ojbk</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">ç‰¹åˆ«æé†’â° ï¼šå®šä¹‰åœ¨nuxt.configä¸­çš„ä¸­é—´ä»¶è¦åœ¨æ ¹ç›®å½•çš„middlewareæ–‡ä»¶ä¸‹ï¼Œå®šä¹‰å¯¹åº”çš„jsæ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ªå‡½æ•°ã€‚</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<ul>
<li>layouté¡µé¢å®šä¹‰</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  middleware:<span class="function">(<span class="params">&#123;route,params,query&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(route,params,query, <span class="string">&#x27;layout&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<ul>
<li>pagesé¡µé¢å®šä¹‰</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  middleware:<span class="function">(<span class="params">&#123;route,params,query&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(route,params,query, <span class="string">&#x27;page&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>middlewareçš„ç¬¬ä¸€å‚æ•°æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å‚æ•°ï¼Œèƒ½å¤Ÿè§£æ„å‡ºroute,params,queryç­‰ç­‰â€¦å‚æ•°ï¼Œè¶³å¤Ÿæˆ‘ä»¬åšå„ç§éªšæ“ä½œã€‚æ—¢ç„¶å®ƒä»¬èƒ½å¤Ÿå®šä¹‰åœ¨ä¸åŒä½ç½®ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œé¡ºåºå°±æœ‰å‰æœ‰åğŸ‘‡ã€‚</p>
<p><strong>æ‰§è¡Œé¡ºåºï¼šnuxt.config =&gt; layout =&gt; page</strong></p>
<h1 id="validate-å‚æ•°éªŒè¯-pages"><a href="#validate-å‚æ•°éªŒè¯-pages" class="headerlink" title="validate å‚æ•°éªŒè¯ (pages)"></a>validate å‚æ•°éªŒè¯ (pages)</h1><p>validateé’©å­ä¸»è¦æ˜¯åšé¡µé¢çº§åˆ«ï¼ˆpagesï¼‰çš„å‚æ•°éªŒè¯æ“ä½œ,åœ¨å®ƒçš„ä¸Šä¸‹æ–‡èƒ½å¤Ÿè§£æ„å‡ºparams,queryâ€¦å‚æ•°ï¼Œæœ€å<code>return true</code>ä»£è¡¨éªŒè¯é€šè¿‡ï¼Œ<code>return false</code>è¡¨ç¤ºéªŒè¯å¤±è´¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">validate</span>(<span class="params">&#123;params,query&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(params,query,<span class="string">&#x27;validate&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="asyncData-æœåŠ¡ç«¯è¯·æ±‚å¼‚æ­¥æ•°æ®-pages"><a href="#asyncData-æœåŠ¡ç«¯è¯·æ±‚å¼‚æ­¥æ•°æ®-pages" class="headerlink" title="asyncData æœåŠ¡ç«¯è¯·æ±‚å¼‚æ­¥æ•°æ® (pages)"></a>asyncData æœåŠ¡ç«¯è¯·æ±‚å¼‚æ­¥æ•°æ® (pages)</h1><p>asyncData ä¸»è¦åšæœåŠ¡ç«¯æ•°æ®è¯·æ±‚æ¸²æŸ“,åœ¨å®ƒä¸Šä¸‹æ–‡èƒ½å¤Ÿè§£æ„å‡ºaxios,route,paramsâ€¦å‚æ•°ï¼Œè¦è§£æ„å‡º<em>a<strong>x</strong>i<strong>o</strong>s</em>,<em>r<strong>o</strong>u<strong>t</strong>e</em>,<em>p<strong>a</strong>r<strong>a</strong>m**s</em>â€¦å‚æ•°ï¼Œè¦è§£æ„å‡ºaxiosï¼Œè¿˜éœ€è¦åšä¸€äº›é¢å¤–é…ç½®ï¼Œå¾€ä¸‹æ‹‰æœ‰è®²åˆ°ã€‚è§£æ„å‡º$axiosï¼Œå°±å¯ä»¥åšajaxè¯·æ±‚ï¼Œæœ€åæŠŠè¦æ¸²æŸ“çš„æ•°æ®returnå‡ºå»å°±è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">asyncData</span>(<span class="params">&#123;$axios,route&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> $axios(<span class="string">&#x27;xxx/xxx/xx&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    	data</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ‰©å±•è·¯ç”±ï¼ˆnuxt-configï¼‰"><a href="#æ‰©å±•è·¯ç”±ï¼ˆnuxt-configï¼‰" class="headerlink" title="æ‰©å±•è·¯ç”±ï¼ˆnuxt.configï¼‰"></a>æ‰©å±•è·¯ç”±ï¼ˆnuxt.configï¼‰</h1><p>åœ¨nuxté»˜è®¤ä¸ºçº¦å®šå¼è·¯ç”±ï¼Œå°±æ˜¯åœ¨pagesåœ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ä¸€ä¸ªæ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„è·¯ç”±ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ä»€ä¹ˆï¼Œæ–¹ä¾¿æäº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´ï¼Œè¿™é‡Œåªè¦è¯´ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬è¦å¯¹æŸä¸ªåœ°å€åšä¸€ä¸ªç‰¹æ®Šæ“ä½œçš„æ—¶å€™ï¼Œæˆ–è€…å…¨é¢æ¥ç®¡çº¦å®šå¼è·¯ç”±çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨æ‰©å±•è·¯ç”±äº†ã€‚</p>
<p>å‡å¦‚æƒ³è®©ä¸€ä¸ªå«<code>/hahaha/:id</code>çš„è·¯ç”±ä¹Ÿè·³åˆ°è¯¦æƒ…ï¼Œä¹Ÿè¿™æ ·åšğŸ‘‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  router:&#123;</span><br><span class="line">    extendRoutes:<span class="function">(<span class="params">routes,resolve</span>)=&gt;</span>&#123;</span><br><span class="line">      routes.push(&#123;</span><br><span class="line">        name:<span class="string">&quot;hahaha&quot;</span>,</span><br><span class="line">        path:<span class="string">&#x27;/hahaha/:id&#x27;</span>,</span><br><span class="line">        component:resolve(__dirname,<span class="string">&#x27;pages/detail/_id.vue&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å‡å¦‚è¦å…¨é¢æ¥ç®¡çº¦å®šå¼è·¯ç”±ï¼Œå¯ä»¥è¿™æ ·åšğŸ‘‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  router:&#123;</span><br><span class="line">    <span class="function"><span class="title">extendRoutes</span>(<span class="params">routes, resolve</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> [</span><br><span class="line">       &#123;</span><br><span class="line">         name:<span class="string">&quot;home&quot;</span>,</span><br><span class="line">         path:<span class="string">&quot;/&quot;</span>,</span><br><span class="line">         component:resolve(__dirname,<span class="string">&#x27;pages/index&#x27;</span>),</span><br><span class="line">         meta:&#123;</span><br><span class="line">           title:<span class="string">&quot;home&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       ...è¿™é‡Œè¿˜å¯ä»¥ç»§ç»­å†™ï¼Œä¸€èˆ¬å¦‚æœè¦æ¥ç®¡çº¦å®šå¼è·¯ç”±çš„è¯ï¼Œéƒ½ä¼šæŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å†å¼•å…¥</span><br><span class="line">     ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="å®šåˆ¶é”™è¯¯é¡µé¢-ï¼ˆlayoutï¼‰"><a href="#å®šåˆ¶é”™è¯¯é¡µé¢-ï¼ˆlayoutï¼‰" class="headerlink" title="å®šåˆ¶é”™è¯¯é¡µé¢ ï¼ˆlayoutï¼‰"></a>å®šåˆ¶é”™è¯¯é¡µé¢ ï¼ˆlayoutï¼‰</h1><p>å¤„ç†é”™è¯¯é¡µé¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œnuxtæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼Œå¦‚æœä½ å«Œå®ƒé”™çš„å“‡ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šåˆ¶ä¸€ä¸ªé£éªšçš„é”™è¯¯é¡µé¢ï¼Œç›´æ¥ä¸‹<code>layoutç›®å½•ä¸‹å®šä¹‰ä¸€ä¸ªerror.vueæ–‡ä»¶</code>å°±å¯ä»¥å®šåˆ¶è‡ªå·±å–œæ¬¢çš„é”™è¯¯é¡µé¢äº†ï¼Œå®ƒä¼šä»£æ›¿é»˜è®¤çš„é”™è¯¯é¡µé¢ï¼Œåœ¨<code>error.vueçš„propæœ‰ä¸ªerrorå±äºæ˜¯åŒ…å«é”™è¯¯ä¿¡æ¯çš„</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">      é”™è¯¯é¡µé¢&#123;&#123; error &#125;&#125;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">   props:[&#39;error&#39;]</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="åŠ¨ç”»å®šåˆ¶-ï¼ˆcss-pages-nuxt-configï¼‰"><a href="#åŠ¨ç”»å®šåˆ¶-ï¼ˆcss-pages-nuxt-configï¼‰" class="headerlink" title="åŠ¨ç”»å®šåˆ¶ ï¼ˆcss,pages, nuxt.configï¼‰"></a>åŠ¨ç”»å®šåˆ¶ ï¼ˆcss,pages, nuxt.configï¼‰</h1><h2 id="å…¨å±€"><a href="#å…¨å±€" class="headerlink" title="å…¨å±€"></a>å…¨å±€</h2><p>å‡å¦‚æƒ³è¦å…¨å±€å®ç°ä¸€ä¸ªè·¯ç”±åˆ‡æ¢åŠ¨ç”»ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ ¹ç›®å½•çš„<code>assets/cssç›®å½•(å…¨å±€cssæ ·å¼å¯ä»¥éšä¾¿ä½ æ”¾ï¼Œä¸€èˆ¬éƒ½ä¼šæ”¾åœ¨assetsä¸‹,ä½ ä¹Ÿå¯ä»¥æ”¾åœ¨æŸä¸ªè§’è½)</code>å®šä¹‰ä¸€ä¸ªå…¨å±€æ–‡ä»¶ï¼Œå®ç°ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªç±»ğŸ‘‡</p>
<ul>
<li>page-enter-active</li>
<li>page-leave-active</li>
<li>page-enter</li>
<li>page-leave</li>
</ul>
<p>ğŸŒ°</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page-enter-active</span>, <span class="selector-class">.page-leave-active</span>&#123;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">1.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.page-enter</span>, <span class="selector-class">.page-leave-active</span>&#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æœ€ååœ¨nuxt.configå¼•ç”¨è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥å®ç°ä¸€ä¸ªè·¯ç”±åˆ‡æ¢çš„æ·¡å…¥æ·¡å‡ºæ•ˆæœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  css: [</span><br><span class="line">    <span class="string">&quot;assets/css/xxx.css&quot;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="å±€éƒ¨"><a href="#å±€éƒ¨" class="headerlink" title="å±€éƒ¨"></a>å±€éƒ¨</h2><p>å‡å¦‚æƒ³åœ¨æŸä¸ªè·¯ç”±é¡µé¢æœ‰ä¸ªä¸€ç§ç‹¬ä¸€æ— äºŒçš„å…¥åœºå‡ºåœºæ–¹å¼çš„è¯ï¼Œä¹Ÿå¯ä»¥ä¸ºå®ƒå•ç‹¬å®ç°ç‹¬æœ‰çš„æ•ˆæœï¼Œåªéœ€è¦ç»™ä¸ª<code>transition:&#39;xxxx&#39;(xxxæ˜¯è‡ªå·±èµ·çš„åå­—ï¼Œéšä¾¿ä½ èµ·)</code>,ç„¶åå®ç°å¯¹åº”çš„ç±»å°±å¯ä»¥å®ç°è¯¥æœ‰çš„åŠ¨ç”»ã€‚</p>
<ul>
<li>xxx-enter-active</li>
<li>xxx-leave-active</li>
<li>xxx-enter</li>
<li>xxx-leave</li>
</ul>
<p>é¡µé¢ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  transition: <span class="string">&quot;test&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* test */</span></span><br><span class="line"><span class="selector-class">.test-enter-active</span>,</span><br><span class="line"><span class="selector-class">.test-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.5s</span> ease all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.test-enter</span>,</span><br><span class="line"><span class="selector-class">.test-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1000px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="è·¯ç”±å®ˆå«"><a href="#è·¯ç”±å®ˆå«" class="headerlink" title="è·¯ç”±å®ˆå«"></a>è·¯ç”±å®ˆå«</h1><h2 id="å…¨å±€å®ˆå«"><a href="#å…¨å±€å®ˆå«" class="headerlink" title="å…¨å±€å®ˆå«"></a>å…¨å±€å®ˆå«</h2><ul>
<li>å®šä¹‰çš„åœ¨nuxt.configçš„middleware</li>
<li>å®šä¹‰åœ¨layoutçš„middleware</li>
<li>å®šä¹‰åœ¨plugins</li>
</ul>
<h2 id="ç»„ä»¶å±€éƒ¨å®ˆå«"><a href="#ç»„ä»¶å±€éƒ¨å®ˆå«" class="headerlink" title="ç»„ä»¶å±€éƒ¨å®ˆå«"></a>ç»„ä»¶å±€éƒ¨å®ˆå«</h2><ul>
<li>å®šä¹‰åœ¨ç»„ä»¶çš„middleware</li>
</ul>
<h2 id="æ’ä»¶å…¨å±€å®ˆå«"><a href="#æ’ä»¶å…¨å±€å®ˆå«" class="headerlink" title="æ’ä»¶å…¨å±€å®ˆå«"></a>æ’ä»¶å…¨å±€å®ˆå«</h2><h2 id="å±€éƒ¨åç½®å®ˆå«"><a href="#å±€éƒ¨åç½®å®ˆå«" class="headerlink" title="å±€éƒ¨åç½®å®ˆå«"></a>å±€éƒ¨åç½®å®ˆå«</h2><ul>
<li>ç»„ä»¶beforeRouteLeaveé’©å­</li>
</ul>
<h2 id="è·¯ç”±ä¼ å€¼"><a href="#è·¯ç”±ä¼ å€¼" class="headerlink" title="è·¯ç”±ä¼ å€¼"></a>è·¯ç”±ä¼ å€¼</h2><p>ä½¿ç”¨asyncDataæ¥å—åˆ°çš„å€¼å¯ä»¥ç›´æ¥ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">asyncData</span>(<span class="params">&#123; params, query &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      params,</span><br><span class="line">      query</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h1 id="æ•°æ®è¯·æ±‚-nuxt-config"><a href="#æ•°æ®è¯·æ±‚-nuxt-config" class="headerlink" title="æ•°æ®è¯·æ±‚ (nuxt.config)"></a>æ•°æ®è¯·æ±‚ (nuxt.config)</h1><p>è¦åšæ•°æ®è¯·æ±‚ï¼Œå°±è¦ç”¨åˆ°axiosäº†ï¼Œnuxtæœ‰ä¸ºæˆ‘ä»¬é›†æˆï¼Œåªéœ€è¦å®‰è£…ï¼Œå¼•ç”¨å°±å¯ä»¥ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ <code>npm i -D @nuxtjs/axois</code></li>
<li>ç¬¬äºŒæ­¥åœ¨nuxt.configå¼•å…¥å°±å¯ä»¥</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line"> modules: [</span><br><span class="line">  <span class="string">&#x27;@nuxtjs/axios&#x27;</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯ï¼Œå°±å¯ä»¥åœ¨plugin,aysncDataâ€¦çš„ä¸Šä¸‹æ–‡è§£æ„åˆ°<code>$axios</code>å‚æ•°</p>
<blockquote>
<p>é‡è¦æé†’â° ï¼š nuxté›†æˆçš„åº“å¤§å¤šæ•°éƒ½è¦åœ¨modulesä¸­å¼•å…¥ã€‚</p>
</blockquote>
<h1 id="å¼€å¯ä»£ç†"><a href="#å¼€å¯ä»£ç†" class="headerlink" title="å¼€å¯ä»£ç†"></a>å¼€å¯ä»£ç†</h1><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„æ¥å£å‡ºç°äº†è·¨åŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ä»£ç†äº†ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ <code>npm i -D @nuxtjs/proxy</code></li>
<li>ç¬¬äºŒæ­¥ nuxt.config ä¸‹é…ç½®</li>
<li>@nuxtjs/proxy</li>
<li>nuxt.config ä¸‹é…ç½® axioså’Œproxy</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  axios:&#123;</span><br><span class="line">     proxy:<span class="literal">true</span></span><br><span class="line">   &#125;ï¼Œ</span><br><span class="line">   proxy:&#123;</span><br><span class="line">     <span class="string">&#x27;api/&#x27;</span>:&#123;</span><br><span class="line">       target:<span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="axiosæ‹¦æˆª"><a href="#axiosæ‹¦æˆª" class="headerlink" title="axiosæ‹¦æˆª"></a>axiosæ‹¦æˆª</h1><p>åœ¨å¹³æ—¶å¼€å‘ä¸­è¯·æ±‚å¼‚æ­¥æ•°æ®ï¼Œå°‘ä¸äº†è¯·æ±‚å‰ï¼Œè¯·æ±‚ååšä¸€äº›æ‹¦æˆªï¼Œåœ¨nuxtä¸­ä¹Ÿå¾ˆå®¹æ˜“å®ç°ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ª<code>axiosæ‹¦æˆªplugin</code>ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ åœ¨<code>pluginsç›®å½•</code>ï¼Œèµ·ä¸€ä¸ªæ€§æ„Ÿçš„æ’ä»¶åï¼Œæ¯”å¦‚å«<code>axios.js</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>(&#123;$axios&#125;)=&gt;&#123;</span><br><span class="line">  <span class="comment">// è¯·æ±‚æ‹¦æˆª</span></span><br><span class="line">  $axios.onRequest(<span class="function"><span class="params">req</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// doing something...</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// å“åº”æ‹¦æˆª</span></span><br><span class="line">  $axios.onResponse(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// doing something...</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// é”™è¯¯æ‹¦æˆª</span></span><br><span class="line">  $axios.onError(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// doing something...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬äºŒæ­¥ åœ¨<code>nuxt.config</code>ä¸­å¼•å…¥æ’ä»¶</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      src:<span class="string">&#x27;~/plugins/axios&#x27;</span>,</span><br><span class="line">      ssr:<span class="literal">true</span> <span class="comment">// é»˜è®¤ä¸ºtrueï¼Œä¼šåŒæ—¶åœ¨æœåŠ¡ç«¯ï¼ˆasyncDataï¼ˆ&#123;$axios&#125;ï¼‰ï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆthis.$axiosï¼‰åŒæ—¶æ‹¦æˆªaxiosè¯·æ±‚ï¼Œè®¾ä¸ºfalseå°±åªä¼šæ‹¦æˆªå®¢æˆ·ç«¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="é…ç½®loading-ï¼ˆnuxt-configï¼‰"><a href="#é…ç½®loading-ï¼ˆnuxt-configï¼‰" class="headerlink" title="é…ç½®loading ï¼ˆnuxt.configï¼‰"></a>é…ç½®loading ï¼ˆnuxt.configï¼‰</h1><p>é…ç½®loadingæœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ç§åœ¨ï¼Œ</p>
<ul>
<li>ç›´æ¥åœ¨é»˜è®¤çš„loadingä¸Šè°ƒæ ·å¼</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  loading: &#123;</span><br><span class="line">    color: <span class="string">&#x27;blue&#x27;</span>,</span><br><span class="line">    height: <span class="string">&#x27;5px&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><strong><a target="_blank" rel="noopener" href="https://zh.nuxtjs.org/docs/2.x/features/loading/">å®ƒè¿˜æœ‰è¿™æ ·å±æ€§å¯ä»¥è°ƒ</a></strong></p>
<ul>
<li>å®šåˆ¶loading</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  loading: <span class="string">&#x27;æŒ‡å‘ä¸€ä¸ªç»„ä»¶çš„è·¯å¾„&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><strong>è¿™ä¸ªè¢«æŒ‡å‘çš„ç»„ä»¶ä¼šæœ‰ä¸¤ä¸ªç‰¹æ®Šé’©å­start, finishé’©å­ï¼Œä»£è¡¨å¼€å§‹åŠ è½½çš„æ—¶å€™ï¼Œå’ŒåŠ è½½ç»“æŸçš„æ—¶å€™åšäº›ä»€ä¹ˆ</strong></p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>é…ç½®vuexç›´æ¥ä¸‹æ ¹ç›®å½•ä¸‹çš„<code>storeç›®å½•</code>ä¸‹å®šä¹‰å°±å¯ä»¥äº†ï¼Œæ³¨æ„çš„æ˜¯ï¼Œé™¤äº†<code>indexæ–‡ä»¶</code>ä¸æ˜¯å…·åæ–‡ä»¶ï¼Œå…¶ä»–çš„æ–‡ä»¶éƒ½æ˜¯å…·åçš„,å…·åçš„åœ¨è°ƒç”¨ä½¿éœ€è¦åŠ ä¸Šè¿™ä¸ªåå­—ï¼Œæ¯”å¦‚ï¼ˆthis.$store.commit(â€˜xxx/handleâ€™)ï¼‰ã€‚</p>
<p>vuexçš„æ–‡ä»¶å†™æ³•æ ¼å¼å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> state =&gt; ï¼ˆ&#123;&#125;ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getters = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations = &#123;&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="é…ç½®UIåº“"><a href="#é…ç½®UIåº“" class="headerlink" title="é…ç½®UIåº“"></a>é…ç½®UIåº“</h1><p>ç¬¬ä¸‰æ–¹UIåº“é…ç½®ï¼Œè¿™é‡Œä»¥element-uiä¸ºä¾‹ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ <code>npm i -D element-ui</code></li>
<li>ç¬¬äºŒæ­¥ åœ¨<code>pluginsç›®å½•å»ºè®®xxx.js</code>ç„¶åå¼•å…¥element-uiæ³¨å†Œ</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ElementUi <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(ElementUi)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸‰æ­¥ åœ¨nuxt.config é…ç½®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  css: [</span><br><span class="line">    &quot;element-ui&#x2F;lib&#x2F;theme.chalk&#x2F;index.css&quot; &#x2F;&#x2F;å¼•å…¥element-uiçš„æ ·å¼</span><br><span class="line">  ],</span><br><span class="line">  plugins: [</span><br><span class="line">    &#39;~&#x2F;plugins&#x2F;xxx&#39; &#x2F;&#x2F; å¼•å…¥åˆšåˆšå®šä¹‰çš„plugin</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="å®šåˆ¶metaï¼ˆnuxt-config-pagesï¼‰"><a href="#å®šåˆ¶metaï¼ˆnuxt-config-pagesï¼‰" class="headerlink" title="å®šåˆ¶metaï¼ˆnuxt.config,pagesï¼‰"></a>å®šåˆ¶metaï¼ˆnuxt.config,pagesï¼‰</h1><p>å®šåˆ¶å¯ä»¥åœ¨nuxt.configä¸­å®šä¹‰å…¨å±€ï¼Œä¹Ÿå¯ä»¥åœ¨pagesä¸‹å®šåˆ¶å•ç‹¬çš„ã€‚</p>
<p><strong>nuxt</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  head: &#123;</span><br><span class="line">    title: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">    meta: [</span><br><span class="line">      &#123; <span class="attr">charset</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;viewport&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;width=device-width, initial-scale=1&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">hid</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    link: [</span><br><span class="line">      &#123; <span class="attr">rel</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;image/x-icon&#x27;</span>, <span class="attr">href</span>: <span class="string">&#x27;/favicon.ico&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><strong>pages</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  head:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">    title: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">    meta: [</span><br><span class="line">      &#123; <span class="attr">charset</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;viewport&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;width=device-width, initial-scale=1&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">hid</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;description&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    link: [</span><br><span class="line">      &#123; <span class="attr">rel</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;image/x-icon&#x27;</span>, <span class="attr">href</span>: <span class="string">&#x27;/favicon.ico&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><ul>
<li>è·¯å¾„åˆ«å:~ æˆ– @ srcDir , ~~ æˆ– @@ rootDir (<a target="_blank" rel="noopener" href="https://zh.nuxtjs.org/docs/2.x/configuration-glossary/configuration-srcdir/">é»˜è®¤æƒ…å†µä¸‹ï¼ŒsrcDir å’Œ rootDir ç›¸åŒ</a>)</li>
<li>nuxt-link é€‰ä¸­æ ·å¼ ä¿®æ”¹ active-class=â€™xxxâ€™</li>
<li>@nuxtjs/style-resources é…ç½®less,scsså…¨å±€å˜é‡</li>
<li>[æ›´å¤šç‰¹æ€§,è‡ªå·±çœ‹å®˜ç½‘](</li>
</ul>
<h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><blockquote>
<p>context æ˜¯ä» Nuxt é¢å¤–æä¾›çš„å¯¹è±¡ï¼Œåœ¨â€asyncDataâ€ã€â€pluginsâ€ã€â€middlewaresâ€ã€â€modulesâ€ å’Œ â€œstore/nuxtServerInitâ€ ç­‰ç‰¹æ®Šçš„ Nuxt ç”Ÿå‘½å‘¨æœŸåŒºåŸŸä¸­éƒ½ä¼šä½¿ç”¨åˆ° contextã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œæƒ³è¦ä½¿ç”¨ <code>Nuxt.js</code>ï¼Œæˆ‘ä»¬å¿…é¡»è¦ç†ŸçŸ¥è¯¥å¯¹è±¡çš„æœ‰å“ªäº›å¯ç”¨å±æ€§ã€‚</p>
<p><code>context</code> å®˜æ–¹æ–‡æ¡£æè¿°æˆ³è¿™é‡Œ <a target="_blank" rel="noopener" href="https://www.nuxtjs.cn/api/context">www.nuxtjs.cn/api/context</a></p>
<p>ä¸‹é¢æˆ‘åˆ—ä¸¾å‡ ä¸ªåœ¨å®é™…åº”ç”¨ä¸­æ¯”è¾ƒé‡è¦ä¸”å¸¸ç”¨çš„å±æ€§ï¼š</p>
<h3 id="app"><a href="#app" class="headerlink" title="app"></a>app</h3><p><code>app</code> æ˜¯ <code>context</code> ä¸­æœ€é‡è¦çš„å±æ€§ï¼Œå°±åƒæˆ‘ä»¬ <code>Vue</code> ä¸­çš„ <code>this</code>ï¼Œå…¨å±€æ–¹æ³•å’Œå±æ€§éƒ½ä¼šæŒ‚è½½åˆ°å®ƒé‡Œé¢ã€‚å› ä¸ºæœåŠ¡ç«¯æ¸²æŸ“çš„ç‰¹æ®Šæ€§ï¼Œå¾ˆå¤š<code>Nuxt</code>æä¾›çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¼šå…ˆäº <code>Vue</code> å®ä¾‹çš„åˆ›å»ºã€‚å› æ­¤åœ¨è¿™äº›ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ <code>this</code> å»è·å–å®ä¾‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ã€‚ä½¿ç”¨ <code>app</code> å¯ä»¥æ¥å¼¥è¡¥è¿™ç‚¹ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠå…¨å±€çš„æ–¹æ³•åŒæ—¶æ³¨å…¥åˆ° <code>this</code> å’Œ <code>app</code> ä¸­ï¼Œåœ¨æœåŠ¡ç«¯çš„ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ <code>app</code> å»è®¿é—®è¯¥æ–¹æ³•ï¼Œè€Œåœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ <code>this</code>ï¼Œä¿è¯æ–¹æ³•çš„å…±ç”¨ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>å‡è®¾ <code>$axios</code> å·²è¢«åŒæ—¶æ³¨å…¥ï¼Œä¸€èˆ¬ä¸»è¦æ•°æ®é€šè¿‡ <code>asyncData</code> (è¯¥ç”Ÿå‘½å‘¨æœŸå‘èµ·è¯·æ±‚ï¼Œå°†è·å–åˆ°çš„æ•°æ®äº¤ç»™æœåŠ¡ç«¯æ‹¼æ¥æˆhtmlè¿”å›) å»æå‰è¯·æ±‚åšæœåŠ¡ç«¯æ¸²æŸ“ï¼Œè€Œæ¬¡è¦æ•°æ®é€šè¿‡å®¢æˆ·ç«¯çš„ <code>mounted</code> å»è¯·æ±‚ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">asyncData</span>(<span class="params">&#123; app &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ—è¡¨æ•°æ®</span></span><br><span class="line">    <span class="keyword">let</span> list = <span class="keyword">await</span> app.$axios.getIndexList(&#123;</span><br><span class="line">      pageNum: <span class="number">1</span>,</span><br><span class="line">      pageSize: <span class="number">20</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.s === <span class="number">1</span> ? res.d : [])</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      categories: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="built_in">this</span>.$axios.getCategories()</span><br><span class="line">    <span class="keyword">if</span> (res.s  === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.categories = res.d</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="store"><a href="#store" class="headerlink" title="store"></a>store</h3><p><code>store</code> æ˜¯ <code>Vuex.Store</code> å®ä¾‹ï¼Œåœ¨è¿è¡Œæ—¶ <code>Nuxt.js</code> ä¼šå°è¯•æ‰¾åˆ°æ˜¯åº”ç”¨æ ¹ç›®å½•ä¸‹çš„ <code>store</code> ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•å­˜åœ¨ï¼Œå®ƒä¼šå°†æ¨¡å—æ–‡ä»¶åŠ åˆ°æ„å»ºé…ç½®ä¸­ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨æ ¹ç›®å½•çš„ <code>store</code> åˆ›å»ºæ¨¡å—jsæ–‡ä»¶ï¼Œå³å¯ä½¿ç”¨ã€‚</p>
<p><code>/store/index.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export const state &#x3D; () &#x3D;&gt; (&#123;</span><br><span class="line">  list: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const mutations &#x3D; &#123;</span><br><span class="line">  updateList(state, payload)&#123;</span><br><span class="line">    state.list &#x3D; payload</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è€Œä¸” <code>Nuxt.js</code> ä¼šå¾ˆè´´å¿ƒçš„å¸®æˆ‘ä»¬å°† <code>store</code> åŒæ—¶æ³¨å…¥ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶è¿™æ ·ä½¿ç”¨ï¼šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; app, store &#125;) &#123;</span><br><span class="line">    let list &#x3D; await app.$axios.getIndexList(&#123;</span><br><span class="line">      pageNum: 1,</span><br><span class="line">      pageSize: 20</span><br><span class="line">    &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D;&#x3D; 1 ? res.d : [])</span><br><span class="line">    &#x2F;&#x2F; æœåŠ¡ç«¯ä½¿ç”¨</span><br><span class="line">    store.commit(&#39;updateList&#39;, list)</span><br><span class="line">    return &#123;</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    updateList(list) &#123;</span><br><span class="line">      &#x2F;&#x2F; å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¾…åŠ©å‡½æ•° mapMutations æ¥å®Œæˆ</span><br><span class="line">      this.$store.commit(&#39;updateList&#39;, list)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ˜ç™½ <code>store</code> æ³¨å…¥çš„è¿‡ç¨‹ï¼Œæˆ‘ç¿»é˜… <code>.nuxt/index.js</code> æºç ï¼ˆ<code>.nuxt</code> ç›®å½•æ˜¯ <code>Nuxt.js</code> åœ¨æ„å»ºè¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰ï¼Œå¤§æ¦‚çŸ¥é“äº†æµç¨‹ã€‚é¦–å…ˆåœ¨ <code>.nuxt/store.js</code> ä¸­ï¼Œå¯¹ <code>store</code> æ¨¡å—æ–‡ä»¶åšå‡ºä¸€ç³»åˆ—çš„å¤„ç†ï¼Œå¹¶æš´éœ² <code>createStore</code> æ–¹æ³•ã€‚ç„¶ååœ¨ <code>.nuxt/index.js</code> ä¸­ï¼Œ<code>createApp</code>æ–¹æ³•ä¼šå¯¹å…¶åŒæ—¶æ³¨å…¥:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &#39;.&#x2F;store.js&#39;</span><br><span class="line"></span><br><span class="line">async function createApp (ssrContext) &#123;</span><br><span class="line">  const store &#x3D; createStore(ssrContext)</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  &#x2F;&#x2F; here we inject the router and store to all child components,</span><br><span class="line">  &#x2F;&#x2F; making them available everywhere as &#96;this.$router&#96; and &#96;this.$store&#96;.</span><br><span class="line">  &#x2F;&#x2F; æ³¨å…¥åˆ°this</span><br><span class="line">  const app &#x3D; &#123;</span><br><span class="line">    store</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  &#x2F;&#x2F; Set context to app.context</span><br><span class="line">  &#x2F;&#x2F; æ³¨å…¥åˆ°context</span><br><span class="line">  await setContext(app, &#123;</span><br><span class="line">    store</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">  &#125;)</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  return &#123;</span><br><span class="line">    store,</span><br><span class="line">    app,</span><br><span class="line">    router</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å‘ç° <code>Nuxt.js</code> ä¼šé€šè¿‡ <code>inject</code> æ–¹æ³•ä¸ºå…¶æŒ‚è½½ä¸Š <code>plugin</code>ï¼ˆ<code>plugin</code> æ˜¯æŒ‚è½½å…¨å±€æ–¹æ³•çš„ä¸»è¦é€”å¾„ï¼Œåé¢ä¼šè®²åˆ°ï¼Œä¸çŸ¥é“å¯ä»¥å…ˆå¿½ç•¥ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ <code>store</code> é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>this</code> è®¿é—®åˆ°å…¨å±€æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export const mutations &#x3D; &#123;</span><br><span class="line">  updateList(state, payload)&#123;</span><br><span class="line">    console.log(this.$axios)</span><br><span class="line">    state.list &#x3D; payload</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="paramsã€query"><a href="#paramsã€query" class="headerlink" title="paramsã€query"></a>paramsã€query</h3><p><code>params</code> å’Œ <code>query</code> åˆ†åˆ«æ˜¯ <code>route.params</code> å’Œ <code>route.query</code> çš„åˆ«åã€‚å®ƒä»¬éƒ½å¸¦æœ‰è·¯ç”±å‚æ•°çš„å¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨å°±å®Œäº‹äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; app, params &#125;) &#123;</span><br><span class="line">    let list &#x3D; await app.$axios.getIndexList(&#123;</span><br><span class="line">      id: params.id,</span><br><span class="line">      pageNum: 1,</span><br><span class="line">      pageSize: 20</span><br><span class="line">    &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D;&#x3D; 1 ? res.d : [])</span><br><span class="line">    return &#123;</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h3><p>è¯¥æ–¹æ³•é‡å®šå‘ç”¨æˆ·è¯·æ±‚åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé€šå¸¸ä¼šç”¨åœ¨æƒé™éªŒè¯ã€‚ç”¨æ³•ï¼š<code>redirect(params)</code>ï¼Œ<code>params</code> å‚æ•°åŒ…å« <code>status</code>(çŠ¶æ€ç ï¼Œé»˜è®¤ä¸º302)ã€<code>path</code>(è·¯ç”±è·¯å¾„)ã€<code>query</code>(å‚æ•°)ï¼Œå…¶ä¸­ <code>status</code> å’Œ <code>query</code> æ˜¯å¯é€‰çš„ã€‚å½“ç„¶å¦‚æœä½ åªæ˜¯å•çº¯çš„é‡å®šå‘è·¯ç”±ï¼Œå¯ä»¥ä¼ å…¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œå°±åƒ <code>redirect(&#39;/index&#39;)</code>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œç”¨äºéªŒè¯ç™»å½•èº«ä»½ï¼Œé€»è¾‘æ˜¯èº«ä»½æ²¡è¿‡æœŸåˆ™ä¸åšä»»ä½•äº‹æƒ…ï¼Œè‹¥èº«ä»½è¿‡æœŸé‡å®šå‘åˆ°ç™»å½•é¡µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default function (&#123; redirect &#125;) &#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  if (!token) &#123;</span><br><span class="line">    redirect(&#123;</span><br><span class="line">      path: &#39;&#x2F;login&#39;,</span><br><span class="line">      query: &#123;</span><br><span class="line">        isExpires: 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>è¯¥æ–¹æ³•è·³è½¬åˆ°é”™è¯¯é¡µã€‚ç”¨æ³•ï¼š<code>error(params)</code> ï¼Œ<code>params</code> å‚æ•°åº”è¯¥åŒ…å« <code>statusCode</code> å’Œ <code>message</code> å­—æ®µã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ€»æœ‰ä¸€äº›ä¸æŒ‰å¸¸ç†çš„æ“ä½œï¼Œé¡µé¢å› æ­¤æ— æ³•å±•ç¤ºçœŸæ­£æƒ³è¦çš„æ•ˆæœï¼Œä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œé”™è¯¯æç¤ºè¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>æ ‡ç­¾è¯¦æƒ…é¡µé¢è¯·æ±‚æ•°æ®ä¾èµ–äº <code>query.name</code>ï¼Œå½“ <code>query.name</code> ä¸å­˜åœ¨æ—¶ï¼Œè¯·æ±‚æ— æ³•è¿”å›å¯ç”¨çš„æ•°æ®ï¼Œæ­¤æ—¶è·³è½¬åˆ°é”™è¯¯é¡µ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; app, query, error &#125;) &#123;</span><br><span class="line">    const tagInfo &#x3D; await app.$api.getTagDetail(&#123;</span><br><span class="line">      tagName: encodeURIComponent(query.name)</span><br><span class="line">    &#125;).then(res &#x3D;&gt; &#123;</span><br><span class="line">      if (res.s &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">        return res.d</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        error(&#123;</span><br><span class="line">          statusCode: 404,</span><br><span class="line">          message: &#39;æ ‡ç­¾ä¸å­˜åœ¨&#39;</span><br><span class="line">        &#125;)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      tagInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="Nuxtå¸¸ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸ"><a href="#Nuxtå¸¸ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Nuxtå¸¸ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸ"></a>Nuxtå¸¸ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="asyncData"><a href="#asyncData" class="headerlink" title="asyncData"></a>asyncData</h3><blockquote>
<p>ä½ å¯èƒ½æƒ³è¦åœ¨æœåŠ¡å™¨ç«¯è·å–å¹¶æ¸²æŸ“æ•°æ®ã€‚Nuxt.jsæ·»åŠ äº†asyncDataæ–¹æ³•ä½¿å¾—ä½ èƒ½å¤Ÿåœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰å¼‚æ­¥è·å–æ•°æ®ã€‚</p>
</blockquote>
<p><code>asyncData</code> æ˜¯æœ€å¸¸ç”¨æœ€é‡è¦çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„å…³é”®ç‚¹ã€‚è¯¥ç”Ÿå‘½å‘¨æœŸåªé™äºé¡µé¢ç»„ä»¶è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º <code>context</code>ã€‚å®ƒè°ƒç”¨çš„æ—¶æœºåœ¨ç»„ä»¶åˆå§‹åŒ–ä¹‹å‰ï¼Œè¿ä½œåœ¨æœåŠ¡ç«¯ç¯å¢ƒã€‚æ‰€ä»¥åœ¨ <code>asyncData</code> ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ <code>this</code> å¼•ç”¨å½“å‰çš„ <code>Vue</code> å®ä¾‹ï¼Œä¹Ÿæ²¡æœ‰ <code>window</code> å¯¹è±¡å’Œ <code>document</code> å¯¹è±¡ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ã€‚</p>
<p>ä¸€èˆ¬åœ¨ <code>asyncData</code> ä¼šå¯¹ä¸»è¦é¡µé¢æ•°æ®è¿›è¡Œé¢„å…ˆè¯·æ±‚ï¼Œè·å–åˆ°çš„æ•°æ®ä¼šäº¤ç”±æœåŠ¡ç«¯æ‹¼æ¥æˆ <code>html</code> è¿”å›å‰ç«¯æ¸²æŸ“ï¼Œä»¥æ­¤æé«˜é¦–å±åŠ è½½é€Ÿåº¦å’Œè¿›è¡Œ <code>seo</code> ä¼˜åŒ–ã€‚</p>
<p>çœ‹ä¸‹å›¾ï¼Œåœ¨è°·æ­Œè°ƒè¯•å·¥å…·ä¸­ï¼Œçœ‹ä¸åˆ°ä¸»è¦æ•°æ®æ¥å£å‘èµ·è¯·æ±‚ï¼Œåªæœ‰è¿”å›çš„ <code>html</code> æ–‡æ¡£ï¼Œè¯æ˜æ•°æ®åœ¨æœåŠ¡ç«¯è¢«æ¸²æŸ“ã€‚</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="350"></svg>)</p>
<p>æœ€åï¼Œéœ€è¦å°†æ¥å£è·å–åˆ°çš„æ•°æ®è¿”å›ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; app &#125;) &#123;</span><br><span class="line">    let list &#x3D; await app.$axios.getIndexList(&#123;</span><br><span class="line">      pageNum: 1,</span><br><span class="line">      pageSize: 20</span><br><span class="line">    &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D;&#x3D; 1 ? res.d : [])</span><br><span class="line">    &#x2F;&#x2F; è¿”å›æ•°æ®</span><br><span class="line">    return &#123;</span><br><span class="line">      list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>asyncData</code> åªåœ¨é¦–å±è¢«æ‰§è¡Œï¼Œå…¶å®ƒæ—¶å€™ç›¸å½“äº <code>created</code> æˆ– <code>mounted</code> åœ¨å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ã€‚</p>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªé¡µé¢ï¼Œåˆ†åˆ«æ˜¯é¦–é¡µå’Œè¯¦æƒ…é¡µï¼Œå®ƒä»¬éƒ½æœ‰è®¾ç½® <code>asyncData</code>ã€‚è¿›å…¥é¦–é¡µæ—¶ï¼Œ<code>asyncData</code> è¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚æ¸²æŸ“å®Œæˆåï¼Œç‚¹å‡»æ–‡ç« è¿›å…¥è¯¦æƒ…é¡µï¼Œæ­¤æ—¶è¯¦æƒ…é¡µçš„ <code>asyncData</code> å¹¶ä¸ä¼šè¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚è·å–æ•°æ®æ¸²æŸ“ï¼Œå› ä¸ºè¯¦æƒ…é¡µå·²ç»ä¸æ˜¯é¦–å±ã€‚å½“æˆ‘ä»¬åˆ·æ–°è¯¦æƒ…é¡µï¼Œè¿™æ—¶å€™è¯¦æƒ…é¡µçš„ <code>asyncData</code> æ‰ä¼šè¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚æ‰€ä»¥ï¼Œä¸è¦èµ°è¿›è¿™ä¸ªè¯¯åŒºï¼ˆè¯¶ï¼Œä¸æ˜¯è¯´æœåŠ¡ç«¯æ¸²æŸ“å—ï¼Œæ€ä¹ˆè¿˜ä¼šå‘èµ·è¯·æ±‚ï¼Ÿï¼‰ã€‚</p>
<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><blockquote>
<p>fetch æ–¹æ³•ç”¨äºåœ¨æ¸²æŸ“é¡µé¢å‰å¡«å……åº”ç”¨çš„çŠ¶æ€æ ‘ï¼ˆstoreï¼‰æ•°æ®ï¼Œ ä¸ asyncData æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒä¸ä¼šè®¾ç½®ç»„ä»¶çš„æ•°æ®ã€‚</p>
</blockquote>
<p>æŸ¥çœ‹å®˜æ–¹çš„è¯´æ˜ï¼Œå¯ä»¥å¾—çŸ¥è¯¥ç”Ÿå‘½å‘¨æœŸç”¨äºå¡«å…… <code>Vuex</code> çŠ¶æ€æ ‘ï¼Œä¸ <code>asyncData</code> åŒæ ·ï¼Œå®ƒåœ¨ç»„ä»¶åˆå§‹åŒ–å‰è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º <code>context</code>ã€‚</p>
<p>ä¸ºäº†è®©è·å–è¿‡ç¨‹å¯ä»¥å¼‚æ­¥ï¼Œä½ éœ€è¦è¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œ<code>Nuxt.js</code> ä¼šç­‰è¿™ä¸ª <code>promise</code> å®Œæˆåå†æ¸²æŸ“ç»„ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  fetch (&#123; store, params &#125;) &#123;</span><br><span class="line">    return axios.get(&#39;http:&#x2F;&#x2F;my-api&#x2F;stars&#39;)</span><br><span class="line">    .then((res) &#x3D;&gt; &#123;</span><br><span class="line">      store.commit(&#39;setStars&#39;, res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ async æˆ– await çš„æ¨¡å¼ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async fetch (&#123; store, params &#125;) &#123;</span><br><span class="line">    let &#123; data &#125; &#x3D; await axios.get(&#39;http:&#x2F;&#x2F;my-api&#x2F;stars&#39;)</span><br><span class="line">    store.commit(&#39;setStars&#39;, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä½†è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬åªèƒ½åœ¨ <code>fetch</code> ä¸­å¡«å……çŠ¶æ€æ ‘ï¼Œåœ¨ <code>asyncData</code> ä¸­åŒæ ·å¯ä»¥ã€‚</p>
<h3 id="validate"><a href="#validate" class="headerlink" title="validate"></a>validate</h3><blockquote>
<p>Nuxt.js å¯ä»¥è®©ä½ åœ¨åŠ¨æ€è·¯ç”±å¯¹åº”çš„é¡µé¢ç»„ä»¶ä¸­é…ç½®ä¸€ä¸ªæ ¡éªŒæ–¹æ³•ç”¨äºæ ¡éªŒåŠ¨æ€è·¯ç”±å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚</p>
</blockquote>
<p>åœ¨éªŒè¯è·¯ç”±å‚æ•°åˆæ³•æ€§æ—¶ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º <code>context</code>ã€‚ä¸ä¸Šé¢æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¿é—®å®ä¾‹ä¸Šçš„æ–¹æ³• <code>this.methods.xxx</code>ã€‚</p>
<p>æ‰“å° <code>this</code> å¦‚ä¸‹:</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1201" height="652"></svg>)</p>
<p>ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¿”å›ä¸€ä¸ª <code>Boolean</code>ï¼Œä¸ºçœŸåˆ™è¿›å…¥è·¯ç”±ï¼Œä¸ºå‡åˆ™åœæ­¢æ¸²æŸ“å½“å‰é¡µé¢å¹¶æ˜¾ç¤ºé”™è¯¯é¡µé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  validate(&#123; params, query &#125;) &#123;</span><br><span class="line">    return this.methods.validateParam(params.type)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    validateParam(type)&#123;</span><br><span class="line">      let typeWhiteList &#x3D; [&#39;backend&#39;, &#39;frontend&#39;, &#39;android&#39;]</span><br><span class="line">      return typeWhiteList.includes(type)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿”å›ä¸€ä¸ªPromise:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  validate(&#123; params, query, store &#125;) &#123;</span><br><span class="line">    return new Promise((resolve) &#x3D;&gt; setTimeout(() &#x3D;&gt; resolve()))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥åœ¨éªŒè¯å‡½æ•°æ‰§è¡ŒæœŸé—´æŠ›å‡ºé¢„æœŸæˆ–æ„å¤–é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async validate (&#123; params, store &#125;) &#123;</span><br><span class="line">    &#x2F;&#x2F; ä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯è§¦å‘å†…éƒ¨æœåŠ¡å™¨500é”™è¯¯</span><br><span class="line">    throw new Error(&#39;Under Construction!&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="watchQuery"><a href="#watchQuery" class="headerlink" title="watchQuery"></a>watchQuery</h3><blockquote>
<p>ç›‘å¬å‚æ•°å­—ç¬¦ä¸²æ›´æ”¹å¹¶åœ¨æ›´æ”¹æ—¶æ‰§è¡Œç»„ä»¶æ–¹æ³• (asyncData, fetch, validate, layout, â€¦)</p>
</blockquote>
<p><code>watchQuery</code> å¯è®¾ç½® <code>Boolean</code> æˆ– <code>Array</code> (é»˜è®¤: [])ã€‚ä½¿ç”¨ <code>watchQuery</code> å±æ€§å¯ä»¥ç›‘å¬å‚æ•°å­—ç¬¦ä¸²çš„æ›´æ”¹ã€‚ å¦‚æœå®šä¹‰çš„å­—ç¬¦ä¸²å‘ç”Ÿå˜åŒ–ï¼Œå°†è°ƒç”¨æ‰€æœ‰ç»„ä»¶æ–¹æ³•(<code>asyncData</code>, <code>fetch</code>, <code>validate</code>, <code>layout</code>, â€¦)ã€‚ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ã€‚</p>
<p>åœ¨ <code>nuxt-juejin-project</code> é¡¹ç›®çš„æœç´¢é¡µä¸­ï¼Œæˆ‘ä¹Ÿç”¨åˆ°äº†è¿™ä¸ªé…ç½®ï¼š</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="479"></svg>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;search-container&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;list__header&quot;&gt;</span><br><span class="line">      &lt;ul class&#x3D;&quot;list__types&quot;&gt;</span><br><span class="line">        &lt;li v-for&#x3D;&quot;item in types&quot; :key&#x3D;&quot;item.title&quot; @click&#x3D;&quot;search(&#123;type: item.type&#125;)&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">      &lt;&#x2F;ul&gt;</span><br><span class="line">      &lt;ul class&#x3D;&quot;list__periods&quot;&gt;</span><br><span class="line">        &lt;li v-for&#x3D;&quot;item in periods&quot; :key&#x3D;&quot;item.title&quot; @click&#x3D;&quot;search(&#123;period: item.period&#125;)&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">      &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">export default &#123;</span><br><span class="line">  async asyncData(&#123; app, query &#125;) &#123;</span><br><span class="line">    let res &#x3D; await app.$api.searchList(&#123;</span><br><span class="line">      after: 0,</span><br><span class="line">      first: 20,</span><br><span class="line">      type: query.type ? query.type.toUpperCase() : &#39;ALL&#39;,</span><br><span class="line">      keyword: query.keyword,</span><br><span class="line">      period: query.period ? query.period.toUpperCase() : &#39;ALL&#39;</span><br><span class="line">    &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D; 1 ? res.d : &#123;&#125;)</span><br><span class="line">    return &#123;</span><br><span class="line">      pageInfo: res.pageInfo || &#123;&#125;,</span><br><span class="line">      searchList: res.edges || []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watchQuery: [&#39;keyword&#39;, &#39;type&#39;, &#39;period&#39;],</span><br><span class="line">  methods: &#123;</span><br><span class="line">    search(item) &#123;</span><br><span class="line">      &#x2F;&#x2F; æ›´æ–°è·¯ç”±å‚æ•°ï¼Œè§¦å‘ watchQueryï¼Œæ‰§è¡Œ asyncData é‡æ–°è·å–æ•°æ®</span><br><span class="line">      this.$router.push(&#123;</span><br><span class="line">        name: &#39;search&#39;,</span><br><span class="line">        query: &#123;</span><br><span class="line">          type: item.type || this.type,</span><br><span class="line">          keyword: this.keyword,</span><br><span class="line">          period: item.period || this.period</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>watchQuery</code>æœ‰ç‚¹å¥½å¤„å°±æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨åé€€æŒ‰é’®æˆ–å‰è¿›æŒ‰é’®æ—¶ï¼Œé¡µé¢æ•°æ®ä¼šåˆ·æ–°ï¼Œå› ä¸ºå‚æ•°å­—ç¬¦ä¸²å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><blockquote>
<p>Nuxt.js ä½¿ç”¨äº† vue-meta æ›´æ–°åº”ç”¨çš„ å¤´éƒ¨æ ‡ç­¾(Head) å’Œ html å±æ€§ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ <code>head</code> æ–¹æ³•è®¾ç½®å½“å‰é¡µé¢çš„å¤´éƒ¨æ ‡ç­¾ï¼Œè¯¥æ–¹æ³•é‡Œèƒ½é€šè¿‡ <code>this</code> è·å–ç»„ä»¶çš„æ•°æ®ã€‚é™¤äº†å¥½çœ‹ä»¥å¤–ï¼Œæ­£ç¡®çš„è®¾ç½® <code>meta</code> æ ‡ç­¾ï¼Œè¿˜èƒ½æœ‰åˆ©äºé¡µé¢è¢«æœç´¢å¼•æ“æŸ¥æ‰¾ï¼Œè¿›è¡Œ <code>seo</code> ä¼˜åŒ–ã€‚ä¸€èˆ¬éƒ½ä¼šè®¾ç½® <code>description</code>(ç®€ä»‹) å’Œ <code>keyword</code>(å…³é”®è¯)ã€‚</p>
<p>title:</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="97"></svg>)</p>
<p>meta:</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="271"></svg>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  head () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: this.articInfo.title,</span><br><span class="line">      meta: [</span><br><span class="line">        &#123; hid: &#39;description&#39;, name: &#39;description&#39;, content: this.articInfo.content &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†é¿å…å­ç»„ä»¶ä¸­çš„ <code>meta</code> æ ‡ç­¾ä¸èƒ½æ­£ç¡®è¦†ç›–çˆ¶ç»„ä»¶ä¸­ç›¸åŒçš„æ ‡ç­¾è€Œäº§ç”Ÿé‡å¤çš„ç°è±¡ï¼Œå»ºè®®åˆ©ç”¨ <code>hid</code> é”®ä¸º <code>meta</code> æ ‡ç­¾é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¼–å·ã€‚</p>
<p>åœ¨ <code>nuxt.config.js</code> ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®å…¨å±€çš„ <code>head</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  head: &#123;</span><br><span class="line">    title: &#39;æ˜é‡‘&#39;,</span><br><span class="line">    meta: [</span><br><span class="line">      &#123; charset: &#39;utf-8&#39; &#125;,</span><br><span class="line">      &#123; name: &#39;viewport&#39;, content: &#39;width&#x3D;device-width,initial-scale&#x3D;1,user-scalable&#x3D;no,viewport-fit&#x3D;cover&#39; &#125;,</span><br><span class="line">      &#123; name: &#39;referrer&#39;, content: &#39;never&#39;&#125;,</span><br><span class="line">      &#123; hid: &#39;keywords&#39;, name: &#39;keywords&#39;, content: &#39;æ˜é‡‘,ç¨€åœŸ,Vue.js,å¾®ä¿¡å°ç¨‹åº,Kotlin,RxJava,React Native,Wireshark,æ•æ·å¼€å‘,Bootstrap,OKHttp,æ­£åˆ™è¡¨è¾¾å¼,WebGL,Webpack,Docker,MVVM&#39;&#125;,</span><br><span class="line">      &#123; hid: &#39;description&#39;, name: &#39;description&#39;, content: &#39;æ˜é‡‘æ˜¯ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒºï¼Œæ˜¯ç»™å¼€å‘è€…ç”¨çš„ Hacker Newsï¼Œç»™è®¾è®¡å¸ˆç”¨çš„ Designer Newsï¼Œå’Œç»™äº§å“ç»ç†ç”¨çš„ Mediumã€‚æ˜é‡‘çš„æŠ€æœ¯æ–‡ç« ç”±ç¨€åœŸä¸Šèšé›†çš„æŠ€æœ¯å¤§ç‰›å’Œæå®¢å…±åŒç¼–è¾‘ä¸ºä½ ç­›é€‰å‡ºæœ€ä¼˜è´¨çš„å¹²è´§ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šAndroidã€iOSã€å‰ç«¯ã€åç«¯ç­‰æ–¹é¢çš„å†…å®¹ã€‚ç”¨æˆ·æ¯å¤©éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æŠ€æœ¯ä¸–ç•Œçš„å¤´æ¡å†…å®¹ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ˜é‡‘å†…è¿˜æœ‰æ²¸ç‚¹ã€æ˜é‡‘ç¿»è¯‘è®¡åˆ’ã€çº¿ä¸‹æ´»åŠ¨ã€ä¸“æ æ–‡ç« ç­‰å†…å®¹ã€‚å³ä½¿ä½ æ˜¯ GitHubã€StackOverflowã€å¼€æºä¸­å›½çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬ç›¸ä¿¡ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæœ‰æ‰€æ”¶è·ã€‚&#39;&#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>ä¸‹é¢æ˜¯è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„è°ƒç”¨é¡ºåºï¼ŒæŸäº›æ—¶å€™å¯èƒ½ä¼šå¯¹æˆ‘ä»¬æœ‰å¸®åŠ©ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">validate  &#x3D;&gt;  asyncData  &#x3D;&gt;  fetch  &#x3D;&gt;  head</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®å¯åŠ¨ç«¯å£"><a href="#é…ç½®å¯åŠ¨ç«¯å£" class="headerlink" title="é…ç½®å¯åŠ¨ç«¯å£"></a>é…ç½®å¯åŠ¨ç«¯å£</h2><p>ä»¥ä¸‹ä¸¤è€…éƒ½å¯ä»¥é…ç½®å¯åŠ¨ç«¯å£ï¼Œä½†æˆ‘ä¸ªäººæ›´å–œæ¬¢ç¬¬ä¸€ç§åœ¨ <code>nuxt.config.js</code> é…ç½®ï¼Œè¿™æ¯”è¾ƒç¬¦åˆæ­£å¸¸çš„é€»è¾‘ã€‚</p>
<h3 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h3><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: 8000,</span><br><span class="line">    host: &#39;127.0.0.1&#39;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h3><p><code>package.json</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;config&quot;: &#123;</span><br><span class="line">  &quot;nuxt&quot;: &#123;</span><br><span class="line">    &quot;port&quot;: &quot;8000&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;127.0.0.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="åŠ è½½å¤–éƒ¨èµ„æº"><a href="#åŠ è½½å¤–éƒ¨èµ„æº" class="headerlink" title="åŠ è½½å¤–éƒ¨èµ„æº"></a>åŠ è½½å¤–éƒ¨èµ„æº</h2><h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  head: &#123;</span><br><span class="line">    link: [</span><br><span class="line">      &#123; rel: &#39;stylesheet&#39;, href: &#39;&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;highlightjs&#x2F;cdn-release@9.18.1&#x2F;build&#x2F;styles&#x2F;atom-one-light.min.css&#39; &#125;,</span><br><span class="line">    ],</span><br><span class="line">    script: [</span><br><span class="line">      &#123; src: &#39;&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;highlightjs&#x2F;cdn-release@9.18.1&#x2F;build&#x2F;highlight.min.js&#39; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ç»„ä»¶é…ç½®"><a href="#ç»„ä»¶é…ç½®" class="headerlink" title="ç»„ä»¶é…ç½®"></a>ç»„ä»¶é…ç½®</h3><p>ç»„ä»¶å†…å¯åœ¨ <code>head</code> é…ç½®ï¼Œ<code>head</code> å¯ä»¥æ¥å— <code>object</code> æˆ– <code>function</code>ã€‚å®˜æ–¹ä¾‹å­ä½¿ç”¨çš„æ˜¯ <code>object</code> ç±»å‹ï¼Œä½¿ç”¨ <code>function</code> ç±»å‹åŒæ ·ç”Ÿæ•ˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  head () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      link: [</span><br><span class="line">        &#123; rel: &#39;stylesheet&#39;, href: &#39;&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;highlightjs&#x2F;cdn-release@9.18.1&#x2F;build&#x2F;styles&#x2F;atom-one-light.min.css&#39; &#125;,</span><br><span class="line">      ],</span><br><span class="line">      script: [</span><br><span class="line">        &#123; src: &#39;&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;highlightjs&#x2F;cdn-release@9.18.1&#x2F;build&#x2F;highlight.min.js&#39; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p><code>nuxt.config.js</code>æä¾›<code>env</code>é€‰é¡¹è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ã€‚ä½†æ­¤å‰æˆ‘å°è¯•è¿‡æ ¹ç›®å½•åˆ›å»º .env æ–‡ä»¶ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œå‘ç°æ˜¯æ— æ•ˆçš„ã€‚</p>
<h3 id="åˆ›å»ºç¯å¢ƒå˜é‡"><a href="#åˆ›å»ºç¯å¢ƒå˜é‡" class="headerlink" title="åˆ›å»ºç¯å¢ƒå˜é‡"></a>åˆ›å»ºç¯å¢ƒå˜é‡</h3><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    baseUrl: process.env.NODE_ENV &#x3D;&#x3D;&#x3D; &#39;production&#39; ? &#39;http:&#x2F;&#x2F;test.com&#39; : &#39;http:&#x2F;&#x2F;127.0.0.1:8000&#39;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šé…ç½®æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>baseUrl</code> ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡ <code>process.env.NODE_ENV</code> åˆ¤æ–­ç¯å¢ƒæ¥åŒ¹é…å¯¹åº”çš„åœ°å€</p>
<h3 id="ä½¿ç”¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨ç¯å¢ƒå˜é‡</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨ <code>baseUrl</code> å˜é‡ï¼š</p>
<ol>
<li>é€šè¿‡ <code>process.env.baseUrl</code></li>
<li>é€šè¿‡ <code>context.env.baseUrl</code></li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥é…ç½® <code>axios</code> çš„è‡ªå®šä¹‰å®ä¾‹ã€‚</p>
<p><code>/plugins/axios.js</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default function (context) &#123;</span><br><span class="line">	$axios.defaults.baseURL &#x3D; process.env.baseUrl</span><br><span class="line">	&#x2F;&#x2F; æˆ–è€… $axios.defaults.baseURL &#x3D; context.env.baseUrl</span><br><span class="line">	$axios.defaults.timeout &#x3D; 30000</span><br><span class="line">	$axios.interceptors.request.use(config &#x3D;&gt; &#123;</span><br><span class="line">		return config</span><br><span class="line">	&#125;)</span><br><span class="line">	$axios.interceptors.response.use(response &#x3D;&gt; &#123;</span><br><span class="line">		return response.data</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h2><p><code>plugins</code> ä½œä¸ºå…¨å±€æ³¨å…¥çš„ä¸»è¦é€”å¾„ï¼Œå…³äºä¸€äº›ä½¿ç”¨çš„æ–¹å¼æ˜¯å¿…é¡»è¦æŒæ¡çš„ã€‚æœ‰æ—¶ä½ å¸Œæœ›åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æŸä¸ªå‡½æ•°æˆ–å±æ€§å€¼ï¼Œæ­¤æ—¶ï¼Œä½ éœ€è¦å°†å®ƒä»¬æ³¨å…¥åˆ° <code>Vue</code> å®ä¾‹ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼Œ <code>context</code> ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ç”šè‡³ <code>store(Vuex)</code> ã€‚</p>
<h3 id="plugin-å‡½æ•°å‚æ•°"><a href="#plugin-å‡½æ•°å‚æ•°" class="headerlink" title="plugin å‡½æ•°å‚æ•°"></a>plugin å‡½æ•°å‚æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin&#96; ä¸€èˆ¬å‘å¤–æš´éœ²ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ &#96;context&#96; å’Œ &#96;inject</span><br></pre></td></tr></table></figure>
<p><strong>contextï¼š</strong> ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜å‚¨å¾ˆå¤šæœ‰ç”¨çš„å±æ€§ã€‚æ¯”å¦‚å¸¸ç”¨çš„ <code>app</code> å±æ€§ï¼ŒåŒ…å«æ‰€æœ‰æ’ä»¶çš„ <code>Vue</code> æ ¹å®ä¾‹ã€‚ä¾‹å¦‚ï¼šåœ¨ä½¿ç”¨ <code>axios</code> çš„æ—¶å€™ï¼Œä½ æƒ³è·å– <code>$axios</code> å¯ä»¥ç›´æ¥é€šè¿‡ <code>context.app.$axios</code> æ¥è·å–ã€‚</p>
<p><strong>injectï¼š</strong> è¯¥æ–¹æ³•å¯ä»¥å°† <code>plugin</code> åŒæ—¶æ³¨å…¥åˆ° <code>context</code>ï¼Œ <code>Vue</code> å®ä¾‹ï¼Œ <code>Vuex</code> ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export default function (context, inject) &#123;&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å…¥-Vue-å®ä¾‹"><a href="#æ³¨å…¥-Vue-å®ä¾‹" class="headerlink" title="æ³¨å…¥ Vue å®ä¾‹"></a>æ³¨å…¥ Vue å®ä¾‹</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>plugins/vue-inject.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line"></span><br><span class="line">Vue.prototype.$myInjectedFunction &#x3D; string &#x3D;&gt; console.log(&#39;This is an example&#39;, string)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  plugins: [&#39;~&#x2F;plugins&#x2F;vue-inject.js&#39;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨æ‰€æœ‰ <code>Vue</code> ç»„ä»¶ä¸­éƒ½å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">      this.$myInjectedFunction(&#39;test&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å…¥-context"><a href="#æ³¨å…¥-context" class="headerlink" title="æ³¨å…¥ context"></a>æ³¨å…¥ context</h3><p><code>context</code> æ³¨å…¥æ–¹å¼å’Œåœ¨å…¶å®ƒ <code>vue</code> åº”ç”¨ç¨‹åºä¸­æ³¨å…¥ç±»ä¼¼ã€‚</p>
<h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>plugins/ctx-inject.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default (&#123; app &#125;) &#x3D;&gt; &#123;</span><br><span class="line">  app.myInjectedFunction &#x3D; string &#x3D;&gt; console.log(&#39;Okay, another function&#39;, string)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  plugins: [&#39;~&#x2F;plugins&#x2F;ctx-inject.js&#39;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œåªè¦ä½ è·å¾— <code>context</code> ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼ˆä¾‹å¦‚åœ¨ <code>asyncData</code> å’Œ <code>fetch</code> ä¸­ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  asyncData(context) &#123;</span><br><span class="line">    context.app.myInjectedFunction(&#39;ctx!&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="åŒæ—¶æ³¨å…¥"><a href="#åŒæ—¶æ³¨å…¥" class="headerlink" title="åŒæ—¶æ³¨å…¥"></a>åŒæ—¶æ³¨å…¥</h3><p>å¦‚æœéœ€è¦åŒæ—¶åœ¨ <code>context</code> ï¼Œ <code>Vue</code> å®ä¾‹ï¼Œç”šè‡³ <code>Vuex</code> ä¸­åŒæ—¶æ³¨å…¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>inject</code> æ–¹æ³•ï¼Œå®ƒæ˜¯ <code>plugin</code> å¯¼å‡ºå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ç³»ç»Ÿä¼šé»˜è®¤å°† <code>$</code> ä½œä¸ºæ–¹æ³•åçš„å‰ç¼€ã€‚</p>
<h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>plugins/combined-inject.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default (&#123; app &#125;, inject) &#x3D;&gt; &#123;</span><br><span class="line">  inject(&#39;myInjectedFunction&#39;, string &#x3D;&gt; console.log(&#39;That was easy!&#39;, string))</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  plugins: [&#39;~&#x2F;plugins&#x2F;combined-inject.js&#39;]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä½ å°±å¯ä»¥åœ¨ <code>context</code> ï¼Œæˆ–è€… <code>Vue</code> å®ä¾‹ä¸­çš„ <code>this</code> ï¼Œæˆ–è€… <code>Vuex</code> çš„ <code>actions</code> / <code>mutations</code> æ–¹æ³•ä¸­çš„ <code>this</code> æ¥è°ƒç”¨ <code>myInjectedFunction</code> æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    this.$myInjectedFunction(&#39;works in mounted&#39;)</span><br><span class="line">  &#125;,</span><br><span class="line">  asyncData(context) &#123;</span><br><span class="line">    context.app.$myInjectedFunction(&#39;works with context&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>store/index.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export const state &#x3D; () &#x3D;&gt; (&#123;</span><br><span class="line">  someValue: &#39;&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export const mutations &#x3D; &#123;</span><br><span class="line">  changeSomeValue(state, newValue) &#123;</span><br><span class="line">    this.$myInjectedFunction(&#39;accessible in mutations&#39;)</span><br><span class="line">    state.someValue &#x3D; newValue</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const actions &#x3D; &#123;</span><br><span class="line">  setSomeValueToWhatever(&#123; commit &#125;) &#123;</span><br><span class="line">    this.$myInjectedFunction(&#39;accessible in actions&#39;)</span><br><span class="line">    const newValue &#x3D; &#39;whatever&#39;</span><br><span class="line">    commit(&#39;changeSomeValue&#39;, newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="pluginç›¸äº’è°ƒç”¨"><a href="#pluginç›¸äº’è°ƒç”¨" class="headerlink" title="pluginç›¸äº’è°ƒç”¨"></a>pluginç›¸äº’è°ƒç”¨</h3><p>å½“ <code>plugin</code> ä¾èµ–äºå…¶ä»–çš„ <code>plugin</code> è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—® <code>context</code> æ¥è·å–ï¼Œå‰ææ˜¯ <code>plugin</code> éœ€è¦ä½¿ç”¨ <code>context</code> æ³¨å…¥ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨å·²å­˜åœ¨ <code>request</code> è¯·æ±‚çš„ <code>plugin</code> ï¼Œæœ‰å¦ä¸€ä¸ª <code>plugin</code> éœ€è¦è°ƒç”¨ <code>request</code></p>
<p><code>plugins/request.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default (&#123; app: &#123; $axios &#125; &#125;, inject) &#x3D;&gt; &#123;</span><br><span class="line">  inject(&#39;request&#39;, &#123;</span><br><span class="line">    get (url, params) &#123;</span><br><span class="line">      return $axios(&#123;</span><br><span class="line">        method: &#39;get&#39;,</span><br><span class="line">        url,</span><br><span class="line">        params</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>plugins/api.js</code> ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export default (&#123; app: &#123; $request &#125; &#125;, inject) &#x3D;&gt; &#123;</span><br><span class="line">  inject(&#39;api&#39;, &#123;</span><br><span class="line">    getIndexList(params) &#123;</span><br><span class="line">      return $request.get(&#39;&#x2F;list&#x2F;indexList&#39;, params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æ³¨å…¥ <code>plugin</code> æ—¶è¦æ³¨æ„é¡ºåºï¼Œå°±ä¸Šé¢çš„ä¾‹å­æ¥çœ‹ï¼Œ <code>request</code> çš„æ³¨å…¥é¡ºåºè¦åœ¨ <code>api</code> ä¹‹å‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    &#39;.&#x2F;plugins&#x2F;axios.js&#39;,</span><br><span class="line">    &#39;.&#x2F;plugins&#x2F;request.js&#39;,</span><br><span class="line">    &#39;.&#x2F;plugins&#x2F;api.js&#39;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="è·¯ç”±é…ç½®"><a href="#è·¯ç”±é…ç½®" class="headerlink" title="è·¯ç”±é…ç½®"></a>è·¯ç”±é…ç½®</h2><p>åœ¨<code>Nuxt.js</code>ä¸­ï¼Œè·¯ç”±æ˜¯åŸºäºæ–‡ä»¶ç»“æ„è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€é…ç½®ã€‚è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¯åœ¨ <code>.nuxt/router.js</code> ä¸­æŸ¥çœ‹ã€‚</p>
<h3 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h3><p>åœ¨ <code>Vue</code> ä¸­æ˜¯è¿™æ ·é…ç½®åŠ¨æ€è·¯ç”±çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const router &#x3D; new VueRouter(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: &#39;&#x2F;users&#x2F;:id&#39;,</span><br><span class="line">      name: &#39;user&#39;,</span><br><span class="line">      component: User</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>Nuxt.js</code> ä¸­éœ€è¦åˆ›å»ºå¯¹åº”çš„ä»¥ä¸‹åˆ’çº¿ä½œä¸ºå‰ç¼€çš„ <code>Vue</code> æ–‡ä»¶ æˆ– ç›®å½•</p>
<p>ä»¥ä¸‹é¢ç›®å½•ä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pages&#x2F;</span><br><span class="line">--| users&#x2F;</span><br><span class="line">-----| _id.vue</span><br><span class="line">--| index.vue</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router:&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#39;index&#39;,</span><br><span class="line">      path: &#39;&#x2F;&#39;,</span><br><span class="line">      component: &#39;pages&#x2F;index.vue&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#39;users-id&#39;,</span><br><span class="line">      path: &#39;&#x2F;users&#x2F;:id?&#39;,</span><br><span class="line">      component: &#39;pages&#x2F;users&#x2F;_id.vue&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="åµŒå¥—è·¯ç”±"><a href="#åµŒå¥—è·¯ç”±" class="headerlink" title="åµŒå¥—è·¯ç”±"></a>åµŒå¥—è·¯ç”±</h3><p>ä»¥ä¸‹é¢ç›®å½•ä¸ºä¾‹ï¼Œ æˆ‘ä»¬éœ€è¦ä¸€çº§é¡µé¢çš„ <code>vue</code> æ–‡ä»¶ï¼Œä»¥åŠå’Œè¯¥æ–‡ä»¶åŒåçš„æ–‡ä»¶å¤¹ï¼ˆç”¨äºå­˜æ”¾å­é¡µé¢ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pages&#x2F;</span><br><span class="line">--| users&#x2F;</span><br><span class="line">-----| _id.vue</span><br><span class="line">-----| index.vue</span><br><span class="line">--| users.vue</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router: &#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: &#39;&#x2F;users&#39;,</span><br><span class="line">      component: &#39;pages&#x2F;users.vue&#39;,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: &#39;&#39;,</span><br><span class="line">          component: &#39;pages&#x2F;users&#x2F;index.vue&#39;,</span><br><span class="line">          name: &#39;users&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: &#39;:id&#39;,</span><br><span class="line">          component: &#39;pages&#x2F;users&#x2F;_id.vue&#39;,</span><br><span class="line">          name: &#39;users-id&#39;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ä¸€çº§é¡µé¢ä¸­ä½¿ç”¨ <code>nuxt-child</code> æ¥æ˜¾ç¤ºå­é¡µé¢ï¼Œå°±åƒä½¿ç”¨ <code>router-view</code> ä¸€æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;nuxt-child&gt;&lt;&#x2F;nuxt-child&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰é…ç½®"><a href="#è‡ªå®šä¹‰é…ç½®" class="headerlink" title="è‡ªå®šä¹‰é…ç½®"></a>è‡ªå®šä¹‰é…ç½®</h3><p>é™¤äº†åŸºäºæ–‡ä»¶ç»“æ„ç”Ÿæˆè·¯ç”±å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>nuxt.config.js</code> æ–‡ä»¶çš„ <code>router</code> é€‰é¡¹æ¥è‡ªå®šä¹‰ï¼Œè¿™äº›é…ç½®ä¼šè¢«æ·»åŠ åˆ° <code>Nuxt.js</code> çš„è·¯ç”±é…ç½®ä¸­ã€‚</p>
<p>ä¸‹é¢ä¾‹å­æ˜¯å¯¹è·¯ç”±æ·»åŠ é‡å®šå‘çš„é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  router: &#123;</span><br><span class="line">    extendRoutes (routes, resolve) &#123;</span><br><span class="line">      routes.push(&#123;</span><br><span class="line">        path: &#39;&#x2F;&#39;,</span><br><span class="line">        redirect: &#123;</span><br><span class="line">          name: &#39;timeline-title&#39;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><code>Nuxt</code> å·²ä¸ºæˆ‘ä»¬é›†æˆå¥½ <code>@nuxtjs/axios</code>ï¼Œå¦‚æœä½ åœ¨åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©äº† <code>axios</code>ï¼Œè¿™æ­¥å¯ä»¥å¿½ç•¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @nuxtjs&#x2F;axios --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  modules: [</span><br><span class="line">    &#39;@nuxtjs&#x2F;axios&#39;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="SSRä½¿ç”¨Axios"><a href="#SSRä½¿ç”¨Axios" class="headerlink" title="SSRä½¿ç”¨Axios"></a>SSRä½¿ç”¨Axios</h3><p>æœåŠ¡å™¨ç«¯è·å–å¹¶æ¸²æŸ“æ•°æ®ï¼Œ <code>asyncData</code> æ–¹æ³•å¯ä»¥åœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰å¼‚æ­¥è·å–æ•°æ®ï¼Œå¹¶æŠŠè·å–çš„æ•°æ®è¿”å›ç»™å½“å‰ç»„ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  async asyncData(context) &#123;</span><br><span class="line">    let data &#x3D; await context.app.$axios.get(&quot;&#x2F;test&quot;)</span><br><span class="line">    return &#123;</span><br><span class="line">      list: data</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="éSSRä½¿ç”¨Axios"><a href="#éSSRä½¿ç”¨Axios" class="headerlink" title="éSSRä½¿ç”¨Axios"></a>éSSRä½¿ç”¨Axios</h3><p>è¿™ç§ä½¿ç”¨æ–¹å¼å°±å’Œæˆ‘ä»¬å¹³å¸¸ä¸€æ ·ï¼Œè®¿é—® <code>this</code> è¿›è¡Œè°ƒç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  async created() &#123;</span><br><span class="line">    let data &#x3D; await this.$axios.get(&quot;&#x2F;test&quot;)</span><br><span class="line">    this.list &#x3D; data</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰é…ç½®Axios"><a href="#è‡ªå®šä¹‰é…ç½®Axios" class="headerlink" title="è‡ªå®šä¹‰é…ç½®Axios"></a>è‡ªå®šä¹‰é…ç½®Axios</h3><p>å¤§å¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹ <code>axios</code> åšè‡ªå®šä¹‰é…ç½®ï¼ˆbaseUrlã€æ‹¦æˆªå™¨ï¼‰ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡é…ç½® <code>plugins</code> æ¥å¼•å…¥ã€‚</p>
<h4 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>/plugins/axios.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default function(&#123; app: &#123; $axios &#125; &#125;) &#123;</span><br><span class="line">  $axios.defaults.baseURL &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;&#39;</span><br><span class="line">  $axios.interceptors.request.use(config &#x3D;&gt; &#123;</span><br><span class="line">    return config</span><br><span class="line">  &#125;)</span><br><span class="line">  $axios.interceptors.response.use(response &#x3D;&gt; &#123;</span><br><span class="line">    if (&#x2F;^[4|5]&#x2F;.test(response.status)) &#123;</span><br><span class="line">      return Promise.reject(response.statusText)</span><br><span class="line">    &#125;</span><br><span class="line">    return response.data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-3"><a href="#ä½¿ç”¨-3" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    &#39;.&#x2F;plugins&#x2F;axios.js&#39;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å®Œæˆåï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿå’Œä¸Šé¢çš„ä¸€æ ·ã€‚</p>
<h2 id="cssé¢„å¤„ç†å™¨"><a href="#cssé¢„å¤„ç†å™¨" class="headerlink" title="cssé¢„å¤„ç†å™¨"></a>cssé¢„å¤„ç†å™¨</h2><p>ä»¥ <code>scss</code> ä¸ºä¾‹å­</p>
<h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i node-sass sass-loader scss-loader --save--dev</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-4"><a href="#ä½¿ç”¨-4" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ— éœ€é…ç½®ï¼Œæ¨¡æ¿å†…ç›´æ¥ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">.box&#123;</span><br><span class="line">    color: $theme;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="å…¨å±€æ ·å¼"><a href="#å…¨å±€æ ·å¼" class="headerlink" title="å…¨å±€æ ·å¼"></a>å…¨å±€æ ·å¼</h3><p>åœ¨ç¼–å†™å¸ƒå±€æ ·å¼æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šç›¸åŒå…±ç”¨çš„æ ·å¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ ·å¼æå–å‡ºæ¥ï¼Œéœ€è¦ç”¨åˆ°æ—¶åªéœ€è¦æ·»åŠ ä¸€ä¸ªç±»åå³å¯ã€‚</p>
<h4 id="å®šä¹‰-4"><a href="#å®šä¹‰-4" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>global.scss</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.shadow&#123;</span><br><span class="line">  box-shadow: 0 1px 2px 0 rgba(0,0,0,.05);</span><br><span class="line">&#125;</span><br><span class="line">.ellipsis&#123;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.main&#123;</span><br><span class="line">  width: 960px;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-5"><a href="#ä½¿ç”¨-5" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  css: [</span><br><span class="line">    &#39;~&#x2F;assets&#x2F;scss&#x2F;global.scss&#39;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h3><p>ä¸ºé¡µé¢æ³¨å…¥ å˜é‡ å’Œ <code>mixin</code> è€Œä¸”ä¸ç”¨æ¯æ¬¡éƒ½å»å¯¼å…¥ä»–ä»¬ï¼Œå¯ä»¥ä½¿ç”¨ <code>@nuxtjs/style-resources</code> æ¥å®ç°ã€‚</p>
<h4 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @nuxtjs&#x2F;style-resources --save--dev</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰-5"><a href="#å®šä¹‰-5" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>/assets/scss/variable.scss</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$theme: #007fff;</span><br><span class="line">$success: #6cbd45;</span><br><span class="line">$success-2: #74ca46;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-6"><a href="#ä½¿ç”¨-6" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  modules: [</span><br><span class="line">    &#39;@nuxtjs&#x2F;style-resources&#39;</span><br><span class="line">  ],</span><br><span class="line">  styleResources: &#123;</span><br><span class="line">    scss: [</span><br><span class="line">      &#39;.&#x2F;assets&#x2F;scss&#x2F;variable.scss&#39;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="element-ui-è‡ªå®šä¹‰ä¸»é¢˜"><a href="#element-ui-è‡ªå®šä¹‰ä¸»é¢˜" class="headerlink" title="element-ui è‡ªå®šä¹‰ä¸»é¢˜"></a>element-ui è‡ªå®šä¹‰ä¸»é¢˜</h3><h4 id="å®šä¹‰-6"><a href="#å®šä¹‰-6" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>/assets/scss/element-variables.scss</code> ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* æ”¹å˜ä¸»é¢˜è‰²å˜é‡ *&#x2F;</span><br><span class="line">&#x2F;* $theme åœ¨ä¸Šé¢çš„ scss æ–‡ä»¶ä¸­å®šä¹‰å¹¶ä½¿ç”¨ *&#x2F;</span><br><span class="line">$--color-primary: $theme;</span><br><span class="line"></span><br><span class="line">&#x2F;* æ”¹å˜ icon å­—ä½“è·¯å¾„å˜é‡ï¼Œå¿…éœ€ *&#x2F;</span><br><span class="line">$--font-path: &#39;~element-ui&#x2F;lib&#x2F;theme-chalk&#x2F;fonts&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;* ç»„ä»¶æ ·å¼æŒ‰éœ€å¼•å…¥ *&#x2F;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;select&quot;;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;option&quot;;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;input&quot;;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;button&quot;;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;notification&quot;;</span><br><span class="line">@import &quot;~element-ui&#x2F;packages&#x2F;theme-chalk&#x2F;src&#x2F;message&quot;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-7"><a href="#ä½¿ç”¨-7" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>nuxt.config.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  modules: [</span><br><span class="line">    &#39;@nuxtjs&#x2F;style-resources&#39;</span><br><span class="line">  ],</span><br><span class="line">  styleResources: &#123;</span><br><span class="line">    scss: [</span><br><span class="line">      &#x2F;*</span><br><span class="line">      * è¿™é‡Œéœ€è¦æ³¨æ„ä½¿ç”¨çš„é¡ºåºï¼Œå› ä¸º element-variables.scss é‡Œç”¨åˆ° variable.scss é‡Œå®šä¹‰çš„å˜é‡</span><br><span class="line">      * å¦‚æœé¡ºåºåè¿‡æ¥ï¼Œåœ¨å¯åŠ¨ç¼–è¯‘æ—¶ä¼šå¯¼è‡´å˜é‡æ‰¾ä¸åˆ°æŠ¥é”™</span><br><span class="line">      *&#x2F;</span><br><span class="line">      &#39;~&#x2F;assets&#x2F;scss&#x2F;variable.scss&#39;,</span><br><span class="line">      &#39;~&#x2F;assets&#x2F;scss&#x2F;element-variables.scss&#39;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œé‚£å°±æ˜¯ <code>plugin</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line">import myComponentsInstall from &#39;~&#x2F;components&#x2F;myComponentsInstall&#39;</span><br><span class="line">import eleComponentsInstall from &#39;~&#x2F;components&#x2F;eleComponentsInstall&#39;</span><br><span class="line">import &#39;~&#x2F;assets&#x2F;scss&#x2F;element-variables.scss&#39; &#x2F;&#x2F; elementUI è‡ªå®šä¹‰ä¸»é¢˜è‰²</span><br><span class="line"></span><br><span class="line">Vue.use(myComponentsInstall)</span><br><span class="line">Vue.use(eleComponentsInstall)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h1 id="å‰ç«¯æŠ€æœ¯ç‚¹"><a href="#å‰ç«¯æŠ€æœ¯ç‚¹" class="headerlink" title="å‰ç«¯æŠ€æœ¯ç‚¹"></a>å‰ç«¯æŠ€æœ¯ç‚¹</h1><h2 id="asyncDataè¯·æ±‚å¹¶è¡Œ"><a href="#asyncDataè¯·æ±‚å¹¶è¡Œ" class="headerlink" title="asyncDataè¯·æ±‚å¹¶è¡Œ"></a>asyncDataè¯·æ±‚å¹¶è¡Œ</h2><p>çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥èƒ½æ„Ÿè§‰åˆ° <code>asyncData</code> çš„é‡è¦æ€§ï¼Œå¯¹äºè¿™ç§ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€äº›ç»†èŠ‚ä¸Šçš„ä¿®æ”¹å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚é€šå¸¸ï¼Œ <code>asyncData</code> ä¸­ä¸åªå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå¯èƒ½æ˜¯å¾ˆå¤šä¸ªï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">asyncData</span>(<span class="params">&#123; app &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// æ–‡ç« åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">let</span> indexData = <span class="keyword">await</span> app.$api.getIndexList(&#123;</span><br><span class="line">      first: <span class="number">20</span>,</span><br><span class="line">      order: <span class="string">&#x27;POPULAR&#x27;</span>,</span><br><span class="line">      category: <span class="number">1</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.s == <span class="number">1</span> ? res.d : &#123;&#125;)</span><br><span class="line">    <span class="comment">// æ¨èä½œè€…</span></span><br><span class="line">    <span class="keyword">let</span> recommendAuthors = <span class="keyword">await</span> app.$api.getRecommendAuthor(&#123; </span><br><span class="line">      limit: <span class="number">5</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.s == <span class="number">1</span> ? res.d : [])</span><br><span class="line">    <span class="comment">// æ¨èå°å†Œ</span></span><br><span class="line">    <span class="keyword">let</span> recommendBooks = <span class="keyword">await</span> app.$api.getRecommendBook().then(<span class="function"><span class="params">res</span> =&gt;</span> res.s === <span class="number">1</span> ? res.d.data : [])</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      indexData,</span><br><span class="line">      recommendAuthors,</span><br><span class="line">      recommendBooks</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ“ä½œçœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…¶å®æœ‰ä¸ªç»†èŠ‚å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ã€‚ç°åœ¨æ¥ç›˜ä¸€ç›˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ <code>async/await</code> ä¼šå°†å¼‚æ­¥ä»»åŠ¡å»åŒæ­¥åŒ–æ‰§è¡Œï¼Œä¸Šä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ²¡ç»“æŸä¹‹å‰ï¼Œä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¤„äºç­‰å¾…çŠ¶æ€ä¸­ã€‚è¿™æ ·éœ€è¦ç­‰å¾…3ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå‡è®¾è¿™äº›è¯·æ±‚å‡è€—æ—¶1ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´é¡µé¢è‡³å°‘è¦ç­‰å¾…3ç§’åæ‰ä¼šå‡ºç°å†…å®¹ã€‚åŸæœ¬æˆ‘ä»¬æƒ³åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“æ¥ä¼˜åŒ–é¦–å±ï¼Œç°åœ¨å´å› ä¸ºç­‰å¾…è¯·æ±‚è€Œæ‹–æ…¢é¡µé¢æ¸²æŸ“ï¼Œå²‚ä¸æ˜¯å¾—ä¸å¿å¤±ã€‚</p>
<p>æœ€å¥½çš„æ–¹æ¡ˆåº”è¯¥æ˜¯å¤šä¸ªè¯·æ±‚åŒæ—¶å‘é€ï¼Œå¯èƒ½èªæ˜çš„å°ä¼™ä¼´å·²ç»æƒ³åˆ° <code>Promise.all</code>ã€‚æ²¡é”™ï¼Œåˆ©ç”¨ <code>Promise.all</code> å°†è¿™äº›è¯·æ±‚å¹¶è¡Œå‘é€ï¼Œå°±èƒ½è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚<code>Promise.all</code> æ¥å—ä¸€ä¸ª <code>Promise</code> æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå½“å…¨éƒ¨ <code>Promise</code> æˆåŠŸæ—¶ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ã€‚æœ€ç»ˆçš„è€—æ—¶ä¼šä»¥æœ€ä¹…çš„ <code>Promise</code> ä¸ºå‡†ï¼Œæ‰€ä»¥è¯´åŸæœ¬3ç§’çš„è€—æ—¶å¯ä»¥é™ä½åˆ°1ç§’ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªè¯·æ±‚å¤±è´¥äº†ï¼Œä¼šè¿”å›æœ€å…ˆè¢« <code>reject</code> å¤±è´¥çŠ¶æ€çš„å€¼ï¼Œå¯¼è‡´è·å–ä¸åˆ°æ•°æ®ã€‚åœ¨é¡¹ç›®å°è£…åŸºç¡€è¯·æ±‚æ—¶æˆ‘å·²ç»åšäº† <code>catch</code> é”™è¯¯çš„å¤„ç†ï¼Œæ‰€ä»¥ç¡®ä¿è¯·æ±‚éƒ½ä¸ä¼šè¢« <code>reject</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  asyncData() &#123;</span><br><span class="line">    &#x2F;&#x2F; æ•°ç»„è§£æ„è·å¾—å¯¹åº”è¯·æ±‚çš„æ•°æ®</span><br><span class="line">    let [indexData, recommendAuthors, recommendBooks] &#x3D; await Promise.all([</span><br><span class="line">      &#x2F;&#x2F; æ–‡ç« åˆ—è¡¨</span><br><span class="line">      app.$api.getIndexList(&#123;</span><br><span class="line">        first: 20,</span><br><span class="line">        order: &#39;POPULAR&#39;,</span><br><span class="line">        category: 1</span><br><span class="line">      &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D; 1 ? res.d : &#123;&#125;),</span><br><span class="line">      &#x2F;&#x2F; æ¨èä½œè€…</span><br><span class="line">      app.$api.getRecommendAuthor(&#123; </span><br><span class="line">        limit: 5</span><br><span class="line">      &#125;).then(res &#x3D;&gt; res.s &#x3D;&#x3D; 1 ? res.d : []),</span><br><span class="line">      &#x2F;&#x2F; æ¨èå°å†Œ</span><br><span class="line">      app.$api.getRecommendBook().then(res &#x3D;&gt; res.s &#x3D;&#x3D;&#x3D; 1 ? res.d.data : []),</span><br><span class="line">    ])</span><br><span class="line">    return &#123;</span><br><span class="line">      indexData,</span><br><span class="line">      recommendAuthors,</span><br><span class="line">      recommendBooks</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="tokençš„è®¾ç½®ä¸å­˜å‚¨"><a href="#tokençš„è®¾ç½®ä¸å­˜å‚¨" class="headerlink" title="tokençš„è®¾ç½®ä¸å­˜å‚¨"></a>tokençš„è®¾ç½®ä¸å­˜å‚¨</h2><p>ä¸€ä¸ªåº”ç”¨å¿…ä¸å¯å°‘çš„åŠŸèƒ½å°±æ˜¯ <code>token</code> éªŒè¯ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ç™»å½•åæŠŠè¿”å›çš„éªŒè¯ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œä¹‹åè¯·æ±‚å¸¦ä¸Š <code>token</code> ä¾›åç«¯éªŒè¯çŠ¶æ€ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šå­˜æ”¾åˆ°æœ¬åœ°å­˜å‚¨ä¸­ã€‚ä½† <code>Nuxt.js</code> ä¸åŒï¼Œç”±äºæœåŠ¡ç«¯æ¸²æŸ“çš„ç‰¹ç‚¹ï¼Œéƒ¨åˆ†è¯·æ±‚åœ¨æœåŠ¡ç«¯å‘èµ·ï¼Œæˆ‘ä»¬æ— æ³•è·å– <code>localStorage</code> æˆ– <code>sessionStorage</code>ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œ<code>cookie</code> å°±æ´¾ä¸Šäº†ç”¨åœºã€‚<code>cookie</code> ä¸ä»…èƒ½åœ¨å®¢æˆ·ç«¯ä¾›æˆ‘ä»¬æ“ä½œï¼Œåœ¨è¯·æ±‚æ—¶ä¹Ÿä¼šå¸¦ä¸Šå‘å›ç»™æœåŠ¡ç«¯ã€‚ä½¿ç”¨åŸç”Ÿæ“ä½œ <code>cooike</code> æ˜¯éå¸¸éº»çƒ¦çš„ï¼Œå€ŸåŠ© <code>cookie-universal-nuxt</code> æ¨¡å—ï¼ˆè¯¥æ¨¡å—åªæ˜¯å¸®åŠ©æˆ‘ä»¬æ³¨å…¥ï¼Œä¸»è¦å®ç°ä¾èµ– <code>cookie-universal</code>ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ä½¿ç”¨ <code>cookie</code>ã€‚ä¸ç®¡åœ¨æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œ<code>cookie-universal-nuxt</code> éƒ½ä¸ºæˆ‘ä»¬æä¾›ä¸€è‡´çš„ <code>api</code>ï¼Œå®ƒå†…éƒ¨ä¼šå¸®æˆ‘ä»¬å»é€‚é…å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<h3 id="å®‰è£…-3"><a href="#å®‰è£…-3" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®‰è£… <code>cookie-universal-nuxt</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run cookie-universal-nuxt --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>nuxt.config.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  modules: [</span><br><span class="line">    <span class="string">&#x27;cookie-universal-nuxt&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h3><p>åŒæ ·çš„ï¼Œ <code>cookie-universal-nuxt</code> ä¼šåŒæ—¶æ³¨å…¥ï¼Œè®¿é—® <code>$cookies</code> è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–</span></span><br><span class="line">app.$cookies.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®</span></span><br><span class="line">app.$cookies.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line">app.$cookies.remove(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–</span></span><br><span class="line"><span class="built_in">this</span>.$cookies.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®</span></span><br><span class="line"><span class="built_in">this</span>.$cookies.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line"><span class="built_in">this</span>.$cookies.remove(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä½¿ç”¨æ–¹æ³•æˆ³è¿™é‡Œ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/cookie-universal-nuxt">www.npmjs.com/package/cooâ€¦</a></p>
<h3 id="å®é™…åº”ç”¨æµç¨‹"><a href="#å®é™…åº”ç”¨æµç¨‹" class="headerlink" title="å®é™…åº”ç”¨æµç¨‹"></a>å®é™…åº”ç”¨æµç¨‹</h3><p>åƒæ˜é‡‘çš„ç™»å½•ï¼Œæˆ‘ä»¬åœ¨ç™»å½•åéªŒè¯ä¿¡æ¯ä¼šè¢«é•¿æœŸå­˜å‚¨èµ·æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ä½¿ç”¨éƒ½è¦è¿›è¡Œç™»å½•ã€‚ä½† <code>cookie</code> ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨äºæµè§ˆå™¨ï¼Œå½“æµè§ˆå™¨å…³é—­åä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºå…¶è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<p>åœ¨é¡¹ç›®ä¸­æˆ‘å°†è®¾ç½®èº«ä»½ä¿¡æ¯å°è£…æˆå·¥å…·æ–¹æ³•ï¼Œåœ¨ç™»å½•æˆåŠŸåä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼š</p>
<p><code>/utils/utils.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setAuthInfo</span>(<span class="params">ctx, res</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> $cookies, $store</span><br><span class="line">  <span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line">  <span class="keyword">if</span> (process.client) &#123;</span><br><span class="line">    $cookies = ctx.$cookies</span><br><span class="line">    $store = ctx.$store</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœåŠ¡ç«¯</span></span><br><span class="line">  <span class="keyword">if</span> (process.server) &#123;</span><br><span class="line">    $cookies = ctx.app.$cookies</span><br><span class="line">    $store = ctx.store</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ($cookies &amp;&amp; $store) &#123;</span><br><span class="line">    <span class="comment">// è¿‡æœŸæ—¶é•¿ new Date(Date.now() + 8.64e7 * 365 * 10)</span></span><br><span class="line">    <span class="keyword">const</span> expires = $store.state.auth.cookieMaxExpires</span><br><span class="line">    <span class="comment">// è®¾ç½®cookie</span></span><br><span class="line">    $cookies.set(<span class="string">&#x27;userId&#x27;</span>, res.userId, &#123; expires &#125;)</span><br><span class="line">    $cookies.set(<span class="string">&#x27;clientId&#x27;</span>, res.clientId, &#123; expires &#125;)</span><br><span class="line">    $cookies.set(<span class="string">&#x27;token&#x27;</span>, res.token, &#123; expires &#125;)</span><br><span class="line">    $cookies.set(<span class="string">&#x27;userInfo&#x27;</span>, res.user, &#123; expires &#125;)</span><br><span class="line">    <span class="comment">// è®¾ç½®vuex</span></span><br><span class="line">    $store.commit(<span class="string">&#x27;auth/UPDATE_USERINFO&#x27;</span>, res.user)</span><br><span class="line">    $store.commit(<span class="string">&#x27;auth/UPDATE_CLIENTID&#x27;</span>, res.clientId)</span><br><span class="line">    $store.commit(<span class="string">&#x27;auth/UPDATE_TOKEN&#x27;</span>, res.token)</span><br><span class="line">    $store.commit(<span class="string">&#x27;auth/UPDATE_USERID&#x27;</span>, res.userId)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¹‹åéœ€è¦æ”¹é€ ä¸‹ <code>axios</code>ï¼Œè®©å®ƒåœ¨è¯·æ±‚æ—¶å¸¦ä¸ŠéªŒè¯ä¿¡æ¯ï¼š</p>
<p><code>/plugins/axios.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">&#123; app: &#123; $axios, $cookies &#125; &#125;</span>) </span>&#123;</span><br><span class="line">  $axios.defaults.baseURL = process.env.baseUrl</span><br><span class="line">  $axios.defaults.timeout = <span class="number">30000</span></span><br><span class="line">  $axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¤´éƒ¨å¸¦ä¸ŠéªŒè¯ä¿¡æ¯</span></span><br><span class="line">    config.headers[<span class="string">&#x27;X-Token&#x27;</span>] = $cookies.get(<span class="string">&#x27;token&#x27;</span>) || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    config.headers[<span class="string">&#x27;X-Device-Id&#x27;</span>] = $cookies.get(<span class="string">&#x27;clientId&#x27;</span>) || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    config.headers[<span class="string">&#x27;X-Uid&#x27;</span>] = $cookies.get(<span class="string">&#x27;userId&#x27;</span>) || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;)</span><br><span class="line">  $axios.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[4|5]/</span>.test(response.status)) &#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="built_in">Promise</span>.reject(response.statusText)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response.data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="æƒé™éªŒè¯ä¸­é—´ä»¶"><a href="#æƒé™éªŒè¯ä¸­é—´ä»¶" class="headerlink" title="æƒé™éªŒè¯ä¸­é—´ä»¶"></a>æƒé™éªŒè¯ä¸­é—´ä»¶</h2><p>ä¸Šé¢æåˆ°èº«ä»½ä¿¡æ¯ä¼šè®¾ç½®ä¸€ä¸ªé•¿æœŸçš„æ—¶é—´ï¼Œæ¥ä¸‹æ¥å½“ç„¶å°±éœ€è¦éªŒè¯èº«ä»½æ˜¯å¦è¿‡æœŸå•¦ã€‚è¿™é‡Œæˆ‘ä¼šä½¿ç”¨è·¯ç”±ä¸­é—´ä»¶æ¥å®ŒæˆéªŒè¯åŠŸèƒ½ï¼Œä¸­é—´ä»¶è¿è¡Œåœ¨ä¸€ä¸ªé¡µé¢æˆ–ä¸€ç»„é¡µé¢æ¸²æŸ“ä¹‹å‰ï¼Œå°±åƒè·¯ç”±å®ˆå«ä¸€æ ·ã€‚è€Œæ¯ä¸€ä¸ªä¸­é—´ä»¶åº”æ”¾ç½®åœ¨ <code>middleware</code> ç›®å½•ï¼Œæ–‡ä»¶åçš„åç§°å°†æˆä¸ºä¸­é—´ä»¶åç§°ã€‚ä¸­é—´ä»¶å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œåªéœ€è¦è¿”å› <code>Promise</code> å³å¯ã€‚</p>
<h3 id="å®šä¹‰-7"><a href="#å®šä¹‰-7" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><code>/middleware/auth.js</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; app, store &#125; = context</span><br><span class="line">  <span class="keyword">const</span> cookiesToken = app.$cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (cookiesToken) &#123;</span><br><span class="line">    <span class="comment">// æ¯æ¬¡è·³è½¬è·¯ç”± éªŒè¯ç™»å½•çŠ¶æ€æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">return</span> app.$api.isAuth().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.s === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.d.isExpired) &#123;   <span class="comment">// è¿‡æœŸ ç§»é™¤ç™»é™†éªŒè¯ä¿¡æ¯</span></span><br><span class="line">          app.$utils.removeAuthInfo(context)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;                 <span class="comment">// æœªè¿‡æœŸ é‡æ–°è®¾ç½®å­˜å‚¨</span></span><br><span class="line">          <span class="keyword">const</span> stateToken = store.state.auth.token</span><br><span class="line">          <span class="keyword">if</span> (cookiesToken &amp;&amp; stateToken === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            store.commit(<span class="string">&#x27;auth/UPDATE_USERINFO&#x27;</span>, app.$cookies.get(<span class="string">&#x27;userInfo&#x27;</span>))</span><br><span class="line">            store.commit(<span class="string">&#x27;auth/UPDATE_USERID&#x27;</span>, app.$cookies.get(<span class="string">&#x27;userId&#x27;</span>))</span><br><span class="line">            store.commit(<span class="string">&#x27;auth/UPDATE_CLIENTID&#x27;</span>, app.$cookies.get(<span class="string">&#x27;clientId&#x27;</span>))</span><br><span class="line">            store.commit(<span class="string">&#x27;auth/UPDATE_TOKEN&#x27;</span>, app.$cookies.get(<span class="string">&#x27;token&#x27;</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ <code>if (cookiesToken &amp;&amp; stateToken === &#39;&#39;)</code> ä¸­çš„å¤„ç†ï¼Œæ˜¯å› ä¸ºä¸€äº›é¡µé¢ä¼šæ–°å¼€æ ‡ç­¾é¡µï¼Œå¯¼è‡´ <code>vuex</code> ä¸­çš„ä¿¡æ¯ä¸¢å¤±ï¼Œè¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹é‡æ–°è®¾ç½®çŠ¶æ€æ ‘ã€‚</p>
<h3 id="ä½¿ç”¨-8"><a href="#ä½¿ç”¨-8" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><code>nuxt.config.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  router: &#123;</span><br><span class="line">    middleware: [<span class="string">&#x27;auth&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿™ç§ä¸­é—´ä»¶ä½¿ç”¨æ˜¯æ³¨å…¥åˆ°å…¨å±€çš„æ¯ä¸ªé¡µé¢ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›ä¸­é—´ä»¶åªè¿è¡ŒäºæŸä¸ªé¡µé¢ï¼Œå¯ä»¥é…ç½®é¡µé¢çš„ <code>middleware</code> é€‰é¡¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  middleware: <span class="string">&#x27;auth&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è·¯ç”±ä¸­é—´ä»¶æ–‡æ¡£æˆ³è¿™é‡Œ <a target="_blank" rel="noopener" href="https://www.nuxtjs.cn/guide/routing#%E4%B8%AD%E9%97%B4%E4%BB%B6">www.nuxtjs.cn/guide/routiâ€¦</a></p>
<h2 id="ç»„ä»¶æ³¨å†Œç®¡ç†"><a href="#ç»„ä»¶æ³¨å†Œç®¡ç†" class="headerlink" title="ç»„ä»¶æ³¨å†Œç®¡ç†"></a>ç»„ä»¶æ³¨å†Œç®¡ç†</h2><p>å…ˆæ¥ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œåœ¨ <code>plugins</code> æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>vue-global.js</code> ç”¨äºç®¡ç†å…¨å±€éœ€è¦ä½¿ç”¨çš„ç»„ä»¶æˆ–æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">&#x27;~/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> myComponent <span class="keyword">from</span> <span class="string">&#x27;~/components/myComponent.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$utils = utils</span><br><span class="line"></span><br><span class="line">Vue.use(myComponent)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>nuxt.config.js</code> ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">&#x27;~/plugins/vue-global.js&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰ç»„ä»¶"><a href="#è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="è‡ªå®šä¹‰ç»„ä»¶"></a>è‡ªå®šä¹‰ç»„ä»¶</h3><p>å¯¹äºä¸€äº›è‡ªå®šä¹‰å…¨å±€å…±ç”¨ç»„ä»¶ï¼Œæˆ‘çš„åšæ³•æ˜¯å°†å®ƒä»¬æ”¾å…¥ <code>/components/common</code> æ–‡ä»¶å¤¹ç»Ÿä¸€ç®¡ç†ã€‚è¿™æ ·å¯ä»¥ä½¿ç”¨ <code>require.context</code> æ¥è‡ªåŠ¨åŒ–çš„å¼•å…¥ç»„ä»¶ï¼Œè¯¥æ–¹æ³•æ˜¯ç”± <code>webpack</code> æä¾›çš„ï¼Œå®ƒèƒ½å¤Ÿè¯»å–æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶ã€‚å¦‚æœä½ ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•ï¼ŒçœŸçš„å¾ˆå¼ºçƒˆä½ å»äº†è§£å¹¶ä½¿ç”¨ä¸€ä¸‹ï¼Œå®ƒèƒ½å¤§å¤§æé«˜ä½ çš„ç¼–ç¨‹æ•ˆç‡ã€‚</p>
<h4 id="å®šä¹‰-8"><a href="#å®šä¹‰-8" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><code>/components/myComponentsInstall.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> components = <span class="built_in">require</span>.context(<span class="string">&#x27;~/components/common&#x27;</span>, <span class="literal">false</span>, <span class="regexp">/\.vue$/</span>)</span><br><span class="line">    <span class="comment">// components.keys() è·å–æ–‡ä»¶åæ•°ç»„</span></span><br><span class="line">    components.keys().map(<span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è·å–ç»„ä»¶æ–‡ä»¶å</span></span><br><span class="line">      <span class="keyword">const</span> fileName = path.replace(<span class="regexp">/(.*\/)*([^.]+).*/ig</span>, <span class="string">&quot;$2&quot;</span>)</span><br><span class="line">      <span class="comment">// components(path).default è·å– ES6 è§„èŒƒæš´éœ²çš„å†…å®¹ï¼Œcomponents(path) è·å– Common.js è§„èŒƒæš´éœ²çš„å†…å®¹</span></span><br><span class="line">      Vue.component(fileName, components(path).default || components(path))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-9"><a href="#ä½¿ç”¨-9" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>/plugins/vue-global.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> myComponentsInstall <span class="keyword">from</span> <span class="string">&#x27;~/components/myComponentsInstall&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(myComponentsInstall)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ç»è¿‡ä¸Šé¢çš„æ“ä½œåï¼Œç»„ä»¶å·²åœ¨å…¨å±€è¢«æ³¨å†Œï¼Œæˆ‘ä»¬åªè¦æŒ‰çŸ­æ¨ªçº¿å‘½åä½¿ç”¨å³å¯ã€‚è€Œä¸”æ¯æ–°å»ºä¸€ä¸ªç»„ä»¶éƒ½æ— éœ€å†å»å¼•å…¥ï¼ŒçœŸçš„æ˜¯ä¸€åŠ³æ°¸é€¸ã€‚åŒæ ·åœ¨å…¶ä»–å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœ <code>api</code> æ–‡ä»¶æ˜¯æŒ‰åŠŸèƒ½åˆ†æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å»è‡ªåŠ¨åŒ–å¼•å…¥æ¥å£æ–‡ä»¶ã€‚</p>
<h3 id="ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼ˆelement-UIï¼‰"><a href="#ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼ˆelement-UIï¼‰" class="headerlink" title="ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼ˆelement-UIï¼‰"></a>ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼ˆelement-UIï¼‰</h3><h4 id="å…¨éƒ¨å¼•å…¥"><a href="#å…¨éƒ¨å¼•å…¥" class="headerlink" title="å…¨éƒ¨å¼•å…¥"></a>å…¨éƒ¨å¼•å…¥</h4><p><code>/plugins/vue-global.js</code> ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> elementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(elementUI)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>nuxt.config.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: [</span><br><span class="line">    <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="æŒ‰éœ€å¼•å…¥"><a href="#æŒ‰éœ€å¼•å…¥" class="headerlink" title="æŒ‰éœ€å¼•å…¥"></a>æŒ‰éœ€å¼•å…¥</h4><p>å€ŸåŠ© <code>babel-plugin-component</code>ï¼Œæˆ‘ä»¬å¯ä»¥åªå¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œä»¥è¾¾åˆ°å‡å°é¡¹ç›®ä½“ç§¯çš„ç›®çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-component -D</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>nuxt.config.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  build: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;component&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;libraryName&quot;</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">          <span class="string">&quot;styleLibraryName&quot;</span>: <span class="string">&quot;theme-chalk&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å¼•å…¥æˆ‘ä»¬éœ€è¦çš„éƒ¨åˆ†ç»„ä»¶ï¼ŒåŒæ ·åˆ›å»ºä¸€ä¸ª <code>eleComponentsInstall.js</code> ç®¡ç† elementUI çš„ç»„ä»¶ï¼š</p>
<p><code>/components/eleComponentsInstall.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Input, Button, Select, Option, Notification, Message &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> &#123;</span><br><span class="line">    Vue.use(Input)</span><br><span class="line">    Vue.use(Select)</span><br><span class="line">    Vue.use(Option)</span><br><span class="line">    Vue.use(Button)</span><br><span class="line">    Vue.prototype.$message = Message</span><br><span class="line">    Vue.prototype.$notify  = Notification</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>/plugins/vue-global.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> eleComponentsInstall <span class="keyword">from</span> <span class="string">&#x27;~/components/eleComponentsInstall&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(eleComponentsInstall)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="é¡µé¢å¸ƒå±€åˆ‡æ¢"><a href="#é¡µé¢å¸ƒå±€åˆ‡æ¢" class="headerlink" title="é¡µé¢å¸ƒå±€åˆ‡æ¢"></a>é¡µé¢å¸ƒå±€åˆ‡æ¢</h2><p>åœ¨æˆ‘ä»¬æ„å»ºç½‘ç«™åº”ç”¨æ—¶ï¼Œå¤§å¤šæ•°é¡µé¢çš„å¸ƒå±€éƒ½ä¼šä¿æŒä¸€è‡´ã€‚ä½†åœ¨æŸäº›éœ€æ±‚ä¸­ï¼Œå¯èƒ½éœ€è¦æ›´æ¢å¦ä¸€ç§å¸ƒå±€æ–¹å¼ï¼Œè¿™æ—¶é¡µé¢ <code>layout</code> é…ç½®é€‰é¡¹å°±èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®Œæˆã€‚è€Œæ¯ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶åº”æ”¾ç½®åœ¨ <code>layouts</code> ç›®å½•ï¼Œæ–‡ä»¶åçš„åç§°å°†æˆä¸ºå¸ƒå±€åç§°ï¼Œé»˜è®¤å¸ƒå±€æ˜¯ <code>default</code>ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯æ›´æ¢é¡µé¢å¸ƒå±€çš„èƒŒæ™¯è‰²ã€‚å…¶å®æŒ‰ç…§ä½¿ç”¨ <code>Vue</code> çš„ç†è§£ï¼Œæ„Ÿè§‰å°±åƒåˆ‡æ¢ <code>App.vue</code>ã€‚</p>
<h3 id="å®šä¹‰-9"><a href="#å®šä¹‰-9" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><code>/layouts/default.vue</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=<span class="string">&quot;background-color: #f4f4f4;min-height: 100vh;&quot;</span>&gt;</span><br><span class="line">    &lt;top-bar&gt;&lt;/top-bar&gt;</span><br><span class="line">    &lt;main <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;main&quot;</span>&gt;</span><br><span class="line">      &lt;nuxt /&gt;</span><br><span class="line">    &lt;/main&gt;</span><br><span class="line">    &lt;back-top&gt;&lt;/back-top&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>/layouts/default-white.vue</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=<span class="string">&quot;background-color: #ffffff;min-height: 100vh;&quot;</span>&gt;</span><br><span class="line">    &lt;top-bar&gt;&lt;/top-bar&gt;</span><br><span class="line">    &lt;main <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;main&quot;</span>&gt;</span><br><span class="line">      &lt;nuxt /&gt;</span><br><span class="line">    &lt;/main&gt;</span><br><span class="line">    &lt;back-top&gt;&lt;/back-top&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-10"><a href="#ä½¿ç”¨-10" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é¡µé¢ç»„ä»¶æ–‡ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  layout: <span class="string">&#x27;default-white&#x27;</span>,</span><br><span class="line">  <span class="comment">// æˆ–</span></span><br><span class="line">  <span class="function"><span class="title">layout</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;default-white&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="è‡ªå®šä¹‰é”™è¯¯é¡µ"><a href="#è‡ªå®šä¹‰é”™è¯¯é¡µ" class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯é¡µ"></a>è‡ªå®šä¹‰é”™è¯¯é¡µ</h2><p>è‡ªå®šä¹‰çš„é”™è¯¯é¡µéœ€è¦æ”¾åœ¨ <code>layouts</code> ç›®å½•ä¸­ï¼Œä¸”æ–‡ä»¶åä¸º <code>error</code>ã€‚è™½ç„¶æ­¤æ–‡ä»¶æ”¾åœ¨ <code>layouts</code> ç›®å½•ä¸­, ä½†åº”è¯¥å°†å®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªé¡µé¢(page)ã€‚è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ä¸éœ€è¦åŒ…å« <code>&lt;nuxt/&gt;</code> æ ‡ç­¾ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªå¸ƒå±€æ–‡ä»¶å½“æˆæ˜¯æ˜¾ç¤ºåº”ç”¨é”™è¯¯ï¼ˆ404ï¼Œ500ç­‰ï¼‰çš„ç»„ä»¶ã€‚</p>
<h3 id="å®šä¹‰-10"><a href="#å®šä¹‰-10" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;error-page&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;error&quot;</span>&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;where-is-panfish&quot;</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;elem bg&quot;</span> src=<span class="string">&quot;https://b-gold-cdn.xitu.io/v3/static/img/bg.1f516b3.png&quot;</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;elem panfish&quot;</span> src=<span class="string">&quot;https://b-gold-cdn.xitu.io/v3/static/img/panfish.9be67f5.png&quot;</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;elem sea&quot;</span> src=<span class="string">&quot;https://b-gold-cdn.xitu.io/v3/static/img/sea.892cf5d.png&quot;</span>&gt;</span><br><span class="line">        &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;elem spray&quot;</span> src=<span class="string">&quot;https://b-gold-cdn.xitu.io/v3/static/img/spray.bc638d2.png&quot;</span>&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;title&quot;</span>&gt;&#123;&#123;statusCode&#125;&#125; - &#123;&#123; message &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;nuxt-link <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;error-link&quot;</span> to=<span class="string">&quot;/&quot;</span>&gt;å›åˆ°é¦–é¡µ&lt;/nuxt-link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    error: &#123;</span><br><span class="line">      type: <span class="built_in">Object</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    statusCode () &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="built_in">this</span>.error &amp;&amp; <span class="built_in">this</span>.error.statusCode) || <span class="number">500</span></span><br><span class="line">    &#125;,</span><br><span class="line">    message () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.error.message || <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  head () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title: <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.statusCode === <span class="number">404</span> ? <span class="string">&#x27;æ‰¾ä¸åˆ°é¡µé¢&#x27;</span> : <span class="string">&#x27;å‘ˆç°é¡µé¢å‡ºé”™&#x27;</span>&#125;</span> - æ˜é‡‘`</span>,</span><br><span class="line">      meta: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">&#x27;viewport&#x27;</span>,</span><br><span class="line">          content: <span class="string">&#x27;width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="errorå¯¹è±¡"><a href="#errorå¯¹è±¡" class="headerlink" title="errorå¯¹è±¡"></a>errorå¯¹è±¡</h3><p>é”™è¯¯é¡µé¢ä¸­ <code>props</code> æ¥å—ä¸€ä¸ª <code>error</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è‡³å°‘åŒ…å«ä¸¤ä¸ªå±æ€§ <code>statusCode</code> å’Œ <code>message</code>ã€‚</p>
<p>é™¤äº†è¿™ä¸¤ä¸ªå±æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¼ è¿‡å»å…¶ä»–çš„å±æ€§ï¼Œè¿™é‡Œåˆè¦è¯´èµ·ä¸Šé¢æåˆ°çš„ <code>error</code> æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">asyncData</span>(<span class="params">&#123; app, query, error &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tagInfo = <span class="keyword">await</span> app.$api.getTagDetail(&#123;</span><br><span class="line">      tagName: <span class="built_in">encodeURIComponent</span>(query.name)</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.s === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.d</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™æ ·æˆ‘ä»¬åœ¨ error å¯¹è±¡ä¸­åˆå¤šäº† query å±æ€§</span></span><br><span class="line">        error(&#123;</span><br><span class="line">          statusCode: <span class="number">404</span>,</span><br><span class="line">          message: <span class="string">&#x27;æ ‡ç­¾ä¸å­˜åœ¨&#x27;</span>,</span><br><span class="line">          query </span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      tagInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰é¡µé¢çš„ <code>validate</code> ç”Ÿå‘½å‘¨æœŸï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> validate (&#123; params, store &#125;) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;é¡µé¢å‚æ•°ä¸æ­£ç¡®&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¼ è¿‡å»çš„ <code>statusCode</code> ä¸º 500ï¼Œ<code>message</code> å°±æ˜¯ <code>new Error</code> ä¸­çš„å†…å®¹ã€‚å¦‚æœæƒ³ä¼ å¯¹è±¡è¿‡å»çš„è¯ï¼Œ<code>message</code> ä¼šè½¬ä¸ºå­—ç¬¦ä¸² <code>[object Object]</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>JSON.stringify</code> ä¼ è¿‡å»ï¼Œé”™è¯¯é¡µé¢å†å¤„ç†è§£æå‡ºæ¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> validate (&#123; params, store &#125;) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="built_in">JSON</span>.stringify(&#123; </span><br><span class="line">      message: <span class="string">&#x27;validateé”™è¯¯&#x27;</span>,</span><br><span class="line">      params</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h2 id="å°è£…è§¦åº•äº‹ä»¶"><a href="#å°è£…è§¦åº•äº‹ä»¶" class="headerlink" title="å°è£…è§¦åº•äº‹ä»¶"></a>å°è£…è§¦åº•äº‹ä»¶</h2><p>é¡¹ç›®ä¸­åŸºæœ¬æ¯ä¸ªé¡µé¢çš„éƒ½ä¼šæœ‰è§¦åº•äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘å°†è¿™å—é€»è¾‘æŠ½ç¦»æˆ <code>mixin</code>ï¼Œéœ€è¦çš„é¡µé¢å¼•å…¥ä½¿ç”¨å³å¯ã€‚</p>
<p><code>/mixins/reachBottom.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      _scrollingElement: <span class="literal">null</span>,</span><br><span class="line">      _isReachBottom: <span class="literal">false</span>,  <span class="comment">// é˜²æ­¢è¿›å…¥æ‰§è¡ŒåŒºåŸŸæ—¶ é‡å¤è§¦å‘</span></span><br><span class="line">      reachBottomDistance: <span class="number">80</span> <span class="comment">// è·ç¦»åº•éƒ¨å¤šè¿œè§¦å‘</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._scrollingElement = <span class="built_in">document</span>.scrollingElement</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;scroll&#x27;</span>, <span class="built_in">this</span>._windowScrollHandler)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">beforeDestroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;scroll&#x27;</span>, <span class="built_in">this</span>._windowScrollHandler)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">_windowScrollHandler</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> scrollHeight = <span class="built_in">this</span>._scrollingElement.scrollHeight</span><br><span class="line">      <span class="keyword">let</span> currentHeight = <span class="built_in">this</span>._scrollingElement.scrollTop + <span class="built_in">this</span>._scrollingElement.clientHeight + <span class="built_in">this</span>.reachBottomDistance</span><br><span class="line">      <span class="keyword">if</span> (currentHeight &lt; scrollHeight &amp;&amp; <span class="built_in">this</span>._isReachBottom) &#123;</span><br><span class="line">        <span class="built_in">this</span>._isReachBottom = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._isReachBottom) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// è§¦åº•äº‹ä»¶è§¦å‘</span></span><br><span class="line">      <span class="keyword">if</span> (currentHeight &gt;= scrollHeight) &#123;</span><br><span class="line">        <span class="built_in">this</span>._isReachBottom = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">typeof</span> <span class="built_in">this</span>.reachBottom === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="built_in">this</span>.reachBottom()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å®ç°çš„æ ¸å¿ƒå½“ç„¶æ˜¯è§¦å‘æ—¶æœº: <code>scrollTop</code>ï¼ˆé¡µé¢æ»šåŠ¨è·ç¦»ï¼‰+ <code>clientHeight</code>ï¼ˆé¡µé¢å¯è§†é«˜åº¦ï¼‰&gt;=  <code>scrollHeight</code>ï¼ˆé¡µé¢æ€»é«˜åº¦ï¼ŒåŒ…æ‹¬æ»šåŠ¨åŒºåŸŸï¼‰ã€‚ä½†è¿™ç§éœ€è¦å®Œå…¨è§¦åº•æ‰èƒ½è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘æ·»åŠ  <code>reachBottomDistance</code> ç”¨äºæ§åˆ¶è§¦å‘äº‹ä»¶çš„è·ç¦»ã€‚æœ€ç»ˆï¼Œè§¦å‘äº‹ä»¶ä¼šè°ƒç”¨é¡µé¢ <code>methods</code> çš„ <code>reachBottom</code> æ–¹æ³•ã€‚</p>
<h2 id="å‘½ä»¤å¼å¼¹çª—ç»„ä»¶"><a href="#å‘½ä»¤å¼å¼¹çª—ç»„ä»¶" class="headerlink" title="å‘½ä»¤å¼å¼¹çª—ç»„ä»¶"></a>å‘½ä»¤å¼å¼¹çª—ç»„ä»¶</h2><p>å‘½ä»¤å¼ç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ<code>element-UI</code> çš„ <code>Message</code> ç»„ä»¶å°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬éœ€è¦å¼¹çª—æç¤ºæ—¶ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸‹ <code>this.message()</code>ï¼Œè€Œä¸æ˜¯é€šè¿‡ <code>v-if</code> åˆ‡æ¢ç»„ä»¶ã€‚è¿™ç§çš„å¥½å¤„å°±æ˜¯ä¸ç”¨å¼•å…¥ç»„ä»¶ï¼Œä½¿ç”¨èµ·æ¥ä¾¿æ·ï¼Œå“ªé‡Œéœ€è¦è°ƒå“ªé‡Œã€‚</p>
<p><code>nuxt-juejin-project</code> é¡¹ç›®ä¸­æˆ‘ä¹Ÿå°è£…äº†ä¸¤ä¸ªå…¬ç”¨çš„å¼¹çª—ç»„ä»¶ï¼Œç™»å½•å¼¹çª—å’Œé¢„è§ˆå¤§å›¾å¼¹çª—ï¼ŒæŠ€æœ¯ç‚¹æ˜¯æ‰‹åŠ¨æŒ‚è½½ç»„ä»¶ã€‚å®ç°ä»£ç å¹¶ä¸å¤šï¼Œå‡ è¡Œè¶³çŸ£ã€‚</p>
<h3 id="å®šä¹‰-11"><a href="#å®šä¹‰-11" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><code>/components/common/picturesModal/picturesModal.vue</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      url: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// å½“å‰å›¾ç‰‡é“¾æ¥</span></span><br><span class="line">      urls: <span class="string">&#x27;&#x27;</span>  <span class="comment">// å›¾ç‰‡é“¾æ¥æ•°ç»„</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">show</span>(<span class="params">cb</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.cb = cb</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.body.style.overflow = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">        <span class="built_in">this</span>.resolve = resolve</span><br><span class="line">        <span class="built_in">this</span>.reject = reject</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é”€æ¯å¼¹çª—</span></span><br><span class="line">    <span class="function"><span class="title">hideModal</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">typeof</span> <span class="built_in">this</span>.cb === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="built_in">this</span>.cb()</span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(<span class="built_in">this</span>.$el)</span><br><span class="line">      <span class="built_in">document</span>.body.style.overflow = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="comment">// é”€æ¯ç»„ä»¶å®ä¾‹</span></span><br><span class="line">      <span class="built_in">this</span>.$destroy()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å…³é—­å¼¹çª—</span></span><br><span class="line">    <span class="function"><span class="title">cancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.reject()</span><br><span class="line">      <span class="built_in">this</span>.hideModal()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">/components/common/picturesModal/index.js</span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> picturesModal <span class="keyword">from</span> <span class="string">&#x27;./picturesModal&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> componentInstance = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å­ç±»</span></span><br><span class="line"><span class="keyword">let</span> ModalConstructor = Vue.extend(picturesModal)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createModal</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–ç»„ä»¶</span></span><br><span class="line">  componentInstance = <span class="keyword">new</span> ModalConstructor()</span><br><span class="line">  <span class="comment">// åˆå¹¶é€‰é¡¹</span></span><br><span class="line">  <span class="built_in">Object</span>.assign(componentInstance, options)</span><br><span class="line">  <span class="comment">// $mountå¯ä»¥ä¼ å…¥é€‰æ‹©å™¨å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŒ‚è½½åˆ°è¯¥é€‰æ‹©å™¨</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸ä¼ å…¥é€‰æ‹©å™¨ï¼Œå°†æ¸²æŸ“ä¸ºæ–‡æ¡£ä¹‹å¤–çš„çš„å…ƒç´ ï¼Œä½ å¯ä»¥æƒ³è±¡æˆ document.createElement()åœ¨å†…å­˜ä¸­ç”Ÿæˆdom</span></span><br><span class="line">  <span class="comment">// $elè·å–çš„æ˜¯domå…ƒç´ </span></span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(componentInstance.$mount().$el)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">caller</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å•ä¾‹ å…¨å±€åªå­˜åœ¨ä¸€ä¸ªå¼¹çª—</span></span><br><span class="line">  <span class="keyword">if</span> (!componentInstance) &#123;</span><br><span class="line">    createModal(options)</span><br><span class="line">    <span class="comment">// è°ƒç”¨ç»„ä»¶å†…çš„showæ–¹æ³• ä¼ å…¥çš„callbackåœ¨ç»„ä»¶é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> componentInstance.show(<span class="function">() =&gt;</span> &#123; componentInstance = <span class="literal">null</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">Vue</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œè°ƒèµ·å¼¹çª—æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›Promise  thenä¸ºç™»å½•æˆåŠŸ  catchä¸ºå…³é—­å¼¹çª—</span></span><br><span class="line">    Vue.prototype.$picturesModal = caller</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-11"><a href="#ä½¿ç”¨-11" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><code>/plugins/vue-global.js</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> picturesModal <span class="keyword">from</span> <span class="string">&#x27;~/components/common/picturesModal&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(picturesModal)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¼ å…¥çš„å¯¹è±¡ï¼Œå°±æ˜¯ä¸Šé¢ <code>createModal</code> æ¥æ”¶åˆ°çš„ <code>options</code> å‚æ•°ï¼Œæœ€ååˆå¹¶è¦†ç›–åˆ°ç»„ä»¶çš„ <code>data</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$picturesModal(&#123;</span><br><span class="line">  url: <span class="string">&#x27;b.jpg&#x27;</span></span><br><span class="line">  urls: [<span class="string">&#x27;a.jpg&#x27;</span>, <span class="string">&#x27;b.jpg&#x27;</span>, <span class="string">&#x27;c.jpg&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>


<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="801"></svg>)</p>
<h1 id="ä¸­é—´å±‚æŠ€æœ¯ç‚¹"><a href="#ä¸­é—´å±‚æŠ€æœ¯ç‚¹" class="headerlink" title="ä¸­é—´å±‚æŠ€æœ¯ç‚¹"></a>ä¸­é—´å±‚æŠ€æœ¯ç‚¹</h1><p>ä¸­é—´å±‚å·¥ä½œçš„å¤§æ¦‚æµç¨‹æ˜¯åœ¨å‰ç«¯å‘é€è¯·æ±‚åˆ°ä¸­é—´å±‚ï¼Œä¸­é—´å±‚åœ¨å‘é€è¯·æ±‚åˆ°åç«¯è·å–æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åœ¨å‰ç«¯åˆ°åç«¯çš„äº¤äº’è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç›¸å½“äºè·å¾—äº†ä»£ç†çš„æ§åˆ¶æƒã€‚åˆ©ç”¨è¿™ä¸€æƒåˆ©ï¼Œæˆ‘ä»¬èƒ½åšçš„äº‹æƒ…å°±æ›´å¤šã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ä»£ç†ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»£ç†æ¥ï¼Œè§£å†³æœ€å¸¸è§çš„è·¨åŸŸé—®é¢˜ï¼›åœ¨çº¿ä¸Šç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»£ç†ï¼Œè½¬å‘è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡ç«¯ã€‚</li>
<li>ç¼“å­˜ï¼šç¼“å­˜å…¶å®æ˜¯æ›´é è¿‘å‰ç«¯çš„éœ€æ±‚ï¼Œç”¨æˆ·çš„åŠ¨ä½œè§¦å‘æ•°æ®çš„æ›´æ–°ï¼Œnodeä¸­é—´å±‚å¯ä»¥ç›´æ¥å¤„ç†ä¸€éƒ¨åˆ†ç¼“å­˜éœ€æ±‚ã€‚</li>
<li>æ—¥å¿—ï¼šç›¸æ¯”å…¶ä»–æœåŠ¡ç«¯è¯­è¨€ï¼Œnodeä¸­é—´å±‚çš„æ—¥å¿—è®°å½•ï¼Œèƒ½æ›´æ–¹ä¾¿å¿«æ·çš„å®šä½é—®é¢˜ã€‚</li>
<li>ç›‘æ§ï¼šæ“…é•¿é«˜å¹¶å‘çš„è¯·æ±‚å¤„ç†ï¼Œåšç›‘æ§ä¹Ÿæ˜¯åˆé€‚çš„é€‰é¡¹ã€‚</li>
<li>æ•°æ®å¤„ç†ï¼šè¿”å›æ‰€éœ€çš„æ•°æ®ï¼Œæ•°æ®å­—æ®µåˆ«åï¼Œæ•°æ®èšåˆã€‚</li>
</ul>
<p>ä¸­é—´å±‚çš„å­˜åœ¨ä¹Ÿè®©å‰åç«¯èŒè´£åˆ†ç¦»çš„æ›´åŠ å½»åº•ï¼Œåç«¯åªéœ€è¦ç®¡ç†æ•°æ®å’Œç¼–å†™æ¥å£ï¼Œéœ€è¦å“ªäº›æ•°æ®éƒ½äº¤ç»™ä¸­é—´å±‚å»å¤„ç†ã€‚</p>
<p><code>nuxt-juejin-project</code> é¡¹ç›®ä¸­é—´å±‚ä½¿ç”¨çš„æ˜¯ <code>koa</code> æ¡†æ¶ï¼Œä¸­é—´å±‚çš„ <code>http</code> è¯·æ±‚æ–¹æ³•æ˜¯åŸºäº <code>request</code> åº“ç®€å•å°è£…ä¸€ä¸‹ï¼Œä»£ç å®ç°åœ¨ <code>/server/request/index.js</code>ã€‚å› ä¸ºåé¢éœ€è¦ç”¨åˆ°ï¼Œè¿™é‡Œå°±æä¸€ä¸‹ã€‚</p>
<h2 id="è¯·æ±‚è½¬å‘"><a href="#è¯·æ±‚è½¬å‘" class="headerlink" title="è¯·æ±‚è½¬å‘"></a>è¯·æ±‚è½¬å‘</h2><h3 id="å®‰è£…ç›¸å…³ä¸­é—´ä»¶"><a href="#å®‰è£…ç›¸å…³ä¸­é—´ä»¶" class="headerlink" title="å®‰è£…ç›¸å…³ä¸­é—´ä»¶"></a>å®‰è£…ç›¸å…³ä¸­é—´ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i koa-router koa-bodyparser --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><strong>koa-router</strong>: è·¯ç”±å™¨ä¸­é—´ä»¶ï¼Œèƒ½å¿«é€Ÿçš„å®šä¹‰è·¯ç”±ä»¥åŠç®¡ç†è·¯ç”±</p>
<p><strong>koa-bodyparser</strong>: å‚æ•°è§£æä¸­é—´ä»¶ï¼Œæ”¯æŒè§£æ jsonã€è¡¨å•ç±»å‹ï¼Œå¸¸ç”¨äºè§£æ POST è¯·æ±‚</p>
<p>ç›¸å…³ä¸­é—´ä»¶çš„ä½¿ç”¨æ–¹æ³•åœ¨ <code>npm</code> ä¸Šæœç´¢ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°æ€ä¹ˆä½¿ç”¨äº†</p>
<h3 id="è·¯ç”±è®¾è®¡"><a href="#è·¯ç”±è®¾è®¡" class="headerlink" title="è·¯ç”±è®¾è®¡"></a>è·¯ç”±è®¾è®¡</h3><p>æ­£æ‰€è°“æ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œè·¯ç”±è®¾è®¡çš„è§„èŒƒï¼Œæˆ‘å‚è€ƒçš„æ˜¯é˜®ä¸€å³°è€å¸ˆçš„ <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html">RESTful API è®¾è®¡æŒ‡å—</a>ã€‚</p>
<h4 id="è·¯ç”±ç›®å½•"><a href="#è·¯ç”±ç›®å½•" class="headerlink" title="è·¯ç”±ç›®å½•"></a>è·¯ç”±ç›®å½•</h4><p>è·¯ç”±æ–‡ä»¶æˆ‘ä¼šå­˜æ”¾åœ¨ <code>/server/routes</code> ç›®å½•ä¸­ï¼ŒæŒ‰ç…§è§„èŒƒè¿˜éœ€è¦ä¸€ä¸ªè§„å®š <code>api</code> ç‰ˆæœ¬å·çš„æ–‡ä»¶å¤¹ã€‚æœ€ç»ˆè·¯ç”±æ–‡ä»¶å­˜æ”¾åœ¨ <code>/server/routes/v1</code> ä¸­ã€‚</p>
<h4 id="è·¯ç”±è·¯å¾„"><a href="#è·¯ç”±è·¯å¾„" class="headerlink" title="è·¯ç”±è·¯å¾„"></a>è·¯ç”±è·¯å¾„</h4><blockquote>
<p>åœ¨ RESTful æ¶æ„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„â€é›†åˆâ€ï¼ˆcollectionï¼‰ï¼Œæ‰€ä»¥ API ä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ–‡ç« ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º <code>articles</code></li>
<li>æ ‡ç­¾ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º <code>tag</code></li>
<li>æ²¸ç‚¹ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º <code>pins</code></li>
</ul>
<h4 id="è·¯ç”±ç±»å‹"><a href="#è·¯ç”±ç±»å‹" class="headerlink" title="è·¯ç”±ç±»å‹"></a>è·¯ç”±ç±»å‹</h4><p>è·¯ç”±æ“ä½œèµ„æºçš„å…·ä½“ç±»å‹ï¼Œç”± <code>HTTP</code> åŠ¨è¯è¡¨ç¤º</p>
<ul>
<li>GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰ã€‚</li>
<li>POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚</li>
<li>PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚</li>
<li>DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚</li>
</ul>
<h3 id="è·¯ç”±é€»è¾‘"><a href="#è·¯ç”±é€»è¾‘" class="headerlink" title="è·¯ç”±é€»è¾‘"></a>è·¯ç”±é€»è¾‘</h3><p>ä¸‹é¢æ˜¯ç”¨æˆ·ä¸“æ åˆ—è¡¨æ¥å£çš„ä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/server/routes/articles.js</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;../../request&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; toObject &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç”¨æˆ·ä¸“æ æ–‡ç« </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">targetUid</span></span> - ç”¨æˆ·id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">before</span></span> - æœ€åä¸€æ¡çš„createdAtï¼Œä¸‹ä¸€é¡µä¼ å…¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">limit</span></span> - æ¡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">order</span></span> - rankIndexï¼šçƒ­é—¨ã€createdAtï¼šæœ€æ–°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">router.get(<span class="string">&#x27;/userPost&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// å¤´éƒ¨ä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">const</span> headers = ctx.headers</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    url: <span class="string">&#x27;https://timeline-merger-ms.juejin.im/v1/get_entry_by_self&#x27;</span>,</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">      src: <span class="string">&quot;web&quot;</span>,</span><br><span class="line">      uid: headers[<span class="string">&#x27;x-uid&#x27;</span>],</span><br><span class="line">      device_id: headers[<span class="string">&#x27;x-device-id&#x27;</span>],</span><br><span class="line">      token: headers[<span class="string">&#x27;x-token&#x27;</span>],</span><br><span class="line">      targetUid: ctx.query.targetUid,</span><br><span class="line">      type: ctx.query.type || <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      limit: ctx.query.limit || <span class="number">20</span>,</span><br><span class="line">      before: ctx.query.before,</span><br><span class="line">      order: ctx.query.order || <span class="string">&#x27;createdAt&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// å‘èµ·è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">let</span> &#123; body &#125; = <span class="keyword">await</span> request(options)</span><br><span class="line">  <span class="comment">// è¯·æ±‚åè·å–åˆ°çš„æ•°æ®ä¸º jsonï¼Œéœ€è¦è½¬ä¸º object è¿›è¡Œæ“ä½œ</span></span><br><span class="line">  body = toObject(body)</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    s: body.s,</span><br><span class="line">    d: body.d.entrylist || []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="æ³¨å†Œè·¯ç”±"><a href="#æ³¨å†Œè·¯ç”±" class="headerlink" title="æ³¨å†Œè·¯ç”±"></a>æ³¨å†Œè·¯ç”±</h3><p><code>/server/index.js</code> æ˜¯ <code>Nuxt.js</code> ä¸ºæˆ‘ä»¬ç”Ÿæˆå¥½çš„æœåŠ¡ç«¯çš„å…¥å£æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„ä¸­é—´ä»¶ä½¿ç”¨å’Œè·¯ç”±æ³¨å†Œéƒ½éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶å†…ç¼–å†™ã€‚ä¸‹é¢çš„åº”ç”¨ä¼šå¿½ç•¥éƒ¨åˆ†ä»£ç ï¼Œåªå±•ç¤ºä¸»è¦çš„é€»è¾‘ã€‚</p>
<p><code>/server/index.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMiddleware</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  app.use(bodyParser())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œè·¯ç”±</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRouter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">module</span> = <span class="built_in">require</span>(<span class="string">&#x27;./routes/articles&#x27;</span>)</span><br><span class="line">  router.use(<span class="string">&#x27;/v1/articles&#x27;</span>, <span class="built_in">module</span>.routes())</span><br><span class="line">  app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  useMiddleware()</span><br><span class="line">  useRouter()</span><br><span class="line">  app.listen(<span class="number">8000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start()</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>æœ€åæ¥å£çš„è°ƒç”¨åœ°å€æ˜¯ï¼š <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/v1/articles/userPost">http://127.0.0.1:8000/v1/articles/userPost</a></p>
<h2 id="è·¯ç”±è‡ªåŠ¨åŒ–æ³¨å†Œ"><a href="#è·¯ç”±è‡ªåŠ¨åŒ–æ³¨å†Œ" class="headerlink" title="è·¯ç”±è‡ªåŠ¨åŒ–æ³¨å†Œ"></a>è·¯ç”±è‡ªåŠ¨åŒ–æ³¨å†Œ</h2><p>æ²¡é”™ï¼Œå®ƒåˆæ¥äº†ã€‚è‡ªåŠ¨åŒ–å°±æ˜¯é¦™ï¼Œä¸€åŠ³æ°¸é€¸èƒ½ä¸é¦™å—ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œè·¯ç”±</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useRouter</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">  path = path || __dirname + <span class="string">&#x27;/routes&#x27;</span></span><br><span class="line">  <span class="comment">// è·å– routes ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼Œurlsä¸ºæ–‡ä»¶åæ•°ç»„</span></span><br><span class="line">  <span class="keyword">let</span> urls = fs.readdirSync(path)</span><br><span class="line">  urls.forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> elementPath = path + <span class="string">&#x27;/&#x27;</span> + element</span><br><span class="line">    <span class="keyword">const</span> stat = fs.lstatSync(elementPath);</span><br><span class="line">    <span class="comment">// æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">const</span> isDir = stat.isDirectory();</span><br><span class="line">    <span class="comment">// æ–‡ä»¶å¤¹é€’å½’æ³¨å†Œè·¯ç”±</span></span><br><span class="line">    <span class="keyword">if</span> (isDir) &#123;</span><br><span class="line">      useRouter(elementPath)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="built_in">module</span> = <span class="built_in">require</span>(elementPath)</span><br><span class="line">      <span class="keyword">let</span> routeRrefix = path.split(<span class="string">&#x27;/routes&#x27;</span>)[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="comment">//routesé‡Œçš„æ–‡ä»¶åä½œä¸º è·¯ç”±å</span></span><br><span class="line">      router.use(routeRrefix + <span class="string">&#x27;/&#x27;</span> + element.replace(<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;&#x27;</span>), <span class="built_in">module</span>.routes())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//ä½¿ç”¨è·¯ç”±</span></span><br><span class="line">  app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  useMiddleware()</span><br><span class="line">  useRouter()</span><br><span class="line">  app.listen(<span class="number">8000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start()</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ä»¥ <code>routes</code> ä½œä¸ºè·¯ç”±çš„ä¸»ç›®å½•ï¼Œå‘ä¸‹å¯»æ‰¾ <code>js</code> æ–‡ä»¶æ³¨å†Œè·¯ç”±ï¼Œæœ€ç»ˆä»¥ <code>js</code> æ–‡ä»¶è·¯å¾„ä½œä¸ºè·¯ç”±åã€‚ä¾‹å¦‚ï¼Œ<code>/server/routes/v1/articles.js</code> ä¸­æœ‰ä¸ªæœç´¢æ¥å£ <code>/search</code>ï¼Œé‚£ä¹ˆè¯¥æ¥å£çš„è°ƒç”¨åœ°å€ä¸º <code>localhost:8000/v1/articles/search</code>ã€‚</p>
<h2 id="è·¯ç”±å‚æ•°éªŒè¯"><a href="#è·¯ç”±å‚æ•°éªŒè¯" class="headerlink" title="è·¯ç”±å‚æ•°éªŒè¯"></a>è·¯ç”±å‚æ•°éªŒè¯</h2><p>å‚æ•°éªŒè¯æ˜¯æ¥å£ä¸­ä¸€å®šä¼šæœ‰çš„åŠŸèƒ½ï¼Œä¸æ­£ç¡®çš„å‚æ•°ä¼šå¯¼è‡´ç¨‹åºæ„å¤–é”™è¯¯ã€‚æˆ‘ä»¬åº”è¯¥æå‰å¯¹å‚æ•°éªŒè¯ï¼Œä¸­æ­¢é”™è¯¯çš„æŸ¥è¯¢å¹¶å‘ŠçŸ¥ä½¿ç”¨è€…ã€‚é¡¹ç›®ä¸­æˆ‘åŸºäº <code>async-validator</code> å°è£…äº†ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶æ¥éªŒè¯å‚æ•°ã€‚å¦‚æœä½ ä¸çŸ¥é“ <code>koa</code> ä¸­é—´ä»¶çš„å·¥ä½œæµç¨‹ï¼Œé‚£æœ‰å¿…è¦å»äº†è§£ä¸‹æ´‹è‘±æ¨¡å‹ã€‚</p>
<h3 id="å®šä¹‰-12"><a href="#å®šä¹‰-12" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p><code>/server/middleware/validator/js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">default</span>: Schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;async-validator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> validator = <span class="keyword">new</span> Schema(descriptor)</span><br><span class="line">    <span class="keyword">let</span> params = &#123;&#125;</span><br><span class="line">    <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(descriptor).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (ctx.method === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        params[key] = ctx.query[key]</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">        ctx.method === <span class="string">&#x27;POST&#x27;</span> ||</span><br><span class="line">        ctx.method === <span class="string">&#x27;PUT&#x27;</span> ||</span><br><span class="line">        ctx.method === <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        params[key] = ctx.request.body[key]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// éªŒè¯å‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> errors = <span class="keyword">await</span> validator.validate(params)</span><br><span class="line">      .then(<span class="function">() =&gt;</span> <span class="literal">null</span>)</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> err.errors)</span><br><span class="line">    <span class="comment">// å¦‚æœéªŒè¯ä¸é€šè¿‡ åˆ™è¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span> (errors) &#123;</span><br><span class="line">      ctx.body = &#123;</span><br><span class="line">        s: <span class="number">0</span>,</span><br><span class="line">        errors</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-12"><a href="#ä½¿ç”¨-12" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/async-validator">async-validator</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;../../request&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> validator = <span class="built_in">require</span>(<span class="string">&#x27;../../middleware/validator&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; toObject &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../../../utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç”¨æˆ·ä¸“æ æ–‡ç« </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">targetUid</span></span> - ç”¨æˆ·id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">before</span></span> - æœ€åä¸€æ¡çš„createdAtï¼Œä¸‹ä¸€é¡µä¼ å…¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">limit</span></span> - æ¡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">order</span></span> - rankIndexï¼šçƒ­é—¨ã€createdAtï¼šæœ€æ–°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">router.get(<span class="string">&#x27;/userPost&#x27;</span>, validator(&#123;</span><br><span class="line">  targetUid: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  before: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">  limit: &#123; </span><br><span class="line">    type: <span class="string">&#x27;string&#x27;</span>, </span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">    validator: <span class="function">(<span class="params">rule, value</span>) =&gt;</span> <span class="built_in">Number</span>(value) &gt; <span class="number">0</span>,</span><br><span class="line">    message: <span class="string">&#x27;limit éœ€ä¼ å…¥æ­£æ•´æ•°&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  order: &#123; <span class="attr">type</span>: <span class="string">&#x27;enum&#x27;</span>, <span class="attr">enum</span>: [<span class="string">&#x27;rankIndex&#x27;</span>, <span class="string">&#x27;createdAt&#x27;</span>] &#125;</span><br><span class="line">&#125;), <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> headers = ctx.headers</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    url: <span class="string">&#x27;https://timeline-merger-ms.juejin.im/v1/get_entry_by_self&#x27;</span>,</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">      src: <span class="string">&quot;web&quot;</span>,</span><br><span class="line">      uid: headers[<span class="string">&#x27;x-uid&#x27;</span>],</span><br><span class="line">      device_id: headers[<span class="string">&#x27;x-device-id&#x27;</span>],</span><br><span class="line">      token: headers[<span class="string">&#x27;x-token&#x27;</span>],</span><br><span class="line">      targetUid: ctx.query.targetUid,</span><br><span class="line">      type: ctx.query.type || <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      limit: ctx.query.limit || <span class="number">20</span>,</span><br><span class="line">      before: ctx.query.before,</span><br><span class="line">      order: ctx.query.order || <span class="string">&#x27;createdAt&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> &#123; body &#125; = <span class="keyword">await</span> request(options)</span><br><span class="line">  body = toObject(body)</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    s: body.s,</span><br><span class="line">    d: body.d.entrylist || []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p><code>type</code>ä»£è¡¨å‚æ•°ç±»å‹ï¼Œ<code>required</code>ä»£è¡¨æ˜¯å¦å¿…å¡«ã€‚å½“ <code>type</code> ä¸º <code>enum</code>ï¼ˆæšä¸¾ï¼‰ç±»å‹æ—¶ï¼Œå‚æ•°å€¼åªèƒ½ä¸º <code>enum</code> æ•°ç»„ä¸­çš„æŸä¸€é¡¹ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>number</code> ç±»å‹åœ¨è¿™é‡Œæ˜¯æ— æ³•éªŒè¯çš„ï¼Œå› ä¸ºå‚æ•°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šè¢«è½¬å˜ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ä½†æ˜¯æˆ‘ä»¬èƒ½é€šè¿‡ <code>validator</code> æ–¹æ³•è‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼Œå°±åƒä¸Šé¢çš„ <code>limit</code> å‚æ•°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å½“ <code>limit</code> å‚æ•°é”™è¯¯æ—¶æ¥å£è¿”å›çš„å†…å®¹ï¼š</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="697" height="201"></svg>)</p>
<h2 id="ç½‘ç«™å®‰å…¨æ€§"><a href="#ç½‘ç«™å®‰å…¨æ€§" class="headerlink" title="ç½‘ç«™å®‰å…¨æ€§"></a>ç½‘ç«™å®‰å…¨æ€§</h2><h3 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h3><p>è®¾ç½® <code>cors</code> æ¥éªŒè¯è¯·æ±‚çš„å®‰å…¨åˆæ³•æ€§ï¼Œå¯ä»¥è®©ä½ çš„ç½‘ç«™æé«˜å®‰å…¨æ€§ã€‚å€ŸåŠ© <code>koa2-cors</code> èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´ä¾¿æ·çš„åšåˆ°è¿™äº›ã€‚<code>koa2-cors</code> çš„æºç ä¹Ÿä¸å¤šï¼Œå»ºè®®å»çœ‹çœ‹ï¼Œåªè¦ä½ æœ‰ç‚¹åŸºç¡€éƒ½èƒ½çœ‹æ‡‚ï¼Œä¸ä»…è¦æ‡‚å¾—ç”¨ä¹Ÿè¦çŸ¥é“å®ç°è¿‡ç¨‹ã€‚</p>
<h4 id="å®‰è£…-4"><a href="#å®‰è£…-4" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install koa2-cors --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-13"><a href="#ä½¿ç”¨-13" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p><code>/server/index.js</code> :</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;koa2-cors&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMiddleware</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  app.use(helmet())</span><br><span class="line">  app.use(bodyParser())</span><br><span class="line">  <span class="comment">//è®¾ç½®å…¨å±€è¿”å›å¤´</span></span><br><span class="line">  app.use(cors(&#123;</span><br><span class="line">    <span class="comment">// å…è®¸è·¨åŸŸçš„åŸŸå</span></span><br><span class="line">    origin: <span class="function"><span class="keyword">function</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;http://localhost:8000&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    exposeHeaders: [<span class="string">&#x27;WWW-Authenticate&#x27;</span>, <span class="string">&#x27;Server-Authorization&#x27;</span>],</span><br><span class="line">    maxAge: <span class="number">86400</span>,</span><br><span class="line">    <span class="comment">// å…è®¸æºå¸¦å¤´éƒ¨éªŒè¯ä¿¡æ¯</span></span><br><span class="line">    credentials: <span class="literal">true</span>,  </span><br><span class="line">    <span class="comment">// å…è®¸çš„æ–¹æ³•</span></span><br><span class="line">    allowMethods: [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;HEAD&#x27;</span>, <span class="string">&#x27;OPTIONS&#x27;</span>],</span><br><span class="line">    <span class="comment">// å…è®¸çš„æ ‡å¤´</span></span><br><span class="line">    allowHeaders: [<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;Authorization&#x27;</span>, <span class="string">&#x27;Accept&#x27;</span>, <span class="string">&#x27;X-Token&#x27;</span>, <span class="string">&#x27;X-Device-Id&#x27;</span>, <span class="string">&#x27;X-Uid&#x27;</span>],</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸ç¬¦åˆè¯·æ±‚çš„æ–¹å¼ï¼Œæˆ–å¸¦æœ‰æœªå…è®¸çš„æ ‡å¤´ã€‚å‘é€è¯·æ±‚æ—¶ä¼šç›´æ¥å¤±è´¥ï¼Œæµè§ˆå™¨æŠ›å‡º <code>cors</code> ç­–ç•¥é™åˆ¶çš„é”™è¯¯ã€‚ä¸‹é¢æ˜¯å¸¦æœ‰æœªå…è®¸æ ‡å¤´é”™è¯¯çš„ä¾‹å­ï¼š</p>
<p>![img](data:image/svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="108"></svg>)</p>
<h3 id="koa-helmet"><a href="#koa-helmet" class="headerlink" title="koa-helmet"></a>koa-helmet</h3><p><code>koa-helmet</code> æä¾›é‡è¦çš„å®‰å…¨æ ‡å¤´ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºåœ¨é»˜è®¤æƒ…å†µä¸‹æ›´åŠ å®‰å…¨ã€‚</p>
<h4 id="å®‰è£…-5"><a href="#å®‰è£…-5" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-helmet --save</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨-14"><a href="#ä½¿ç”¨-14" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">&#x27;koa-helmet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMiddleware</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  app.use(helmet())</span><br><span class="line">  <span class="comment">// .....</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ä¸ºæˆ‘ä»¬åšäº†ä»¥ä¸‹å®‰å…¨è®¾ç½®ï¼š</p>
<ul>
<li>X-DNS-Prefetch-Control: ç¦ç”¨æµè§ˆå™¨çš„ <code>DNS</code> é¢„å–ã€‚</li>
<li>X-Frame-Options: ç¼“è§£ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚</li>
<li>X-Powered-Byï¼šåˆ é™¤äº† <code>X-Powered-By</code> æ ‡å¤´ï¼Œä½¿æ”»å‡»è€…æ›´éš¾äºæŸ¥çœ‹ä½¿ç½‘ç«™å—åˆ°æ½œåœ¨å¨èƒçš„æŠ€æœ¯ã€‚</li>
<li>Strict-Transport-Securityï¼šä½¿æ‚¨çš„ç”¨æˆ·ä½¿ç”¨ <code>HTTPS</code>ã€‚</li>
<li>X-Download-Optionsï¼šé˜²æ­¢ <code>Internet Explorer</code> åœ¨æ‚¨çš„ç«™ç‚¹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¸‹è½½ã€‚</li>
<li>X-Content-Type-Optionsï¼š è®¾ç½®ä¸º <code>nosniff</code>ï¼Œæœ‰åŠ©äºé˜²æ­¢æµè§ˆå™¨è¯•å›¾çŒœæµ‹ï¼ˆâ€œå—…æ¢â€ï¼‰<code>MIME</code> ç±»å‹ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨éšæ‚£ã€‚</li>
<li>X-XSS-Protectionï¼šé˜²æ­¢åå°„çš„ <code>XSS</code> æ”»å‡»ã€‚</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2020/5/16/1721b7f33543ffe5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>æ›´å¤šè¯´æ˜å’Œé…ç½®æˆ³è¿™é‡Œ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/koa-helmet">www.npmjs.com/package/koaâ€¦</a></p>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>æ„Ÿè§‰ä¸­é—´å±‚çš„ç›¸å…³çŸ¥è¯†ç‚¹è¿˜æ˜¯ä¸å¤Ÿå…¨ï¼Œèƒ½åšçš„è¿˜æœ‰å¾ˆå¤šï¼Œè¿˜æ˜¯å¾—ç»§ç»­å­¦ä¹ ã€‚é¡¹ç›®åç»­è¿˜ä¼šæ›´æ–°ä¸€æ®µæ—¶é—´ã€‚</p>
<p>å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®æˆ–æ”¹è¿›ï¼Œè¯·å‘Šè¯‰æˆ‘~</p>
<p>ğŸ˜„çœ‹åˆ°è¿™é‡Œè¿˜ä¸æ¥ä¸ªå°æ˜Ÿæ˜Ÿå—ï¼Ÿ <a target="_blank" rel="noopener" href="https://github.com/ChanWahFung/nuxt-juejin-project">github.com/ChanWahFungâ€¦</a></p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li>å…¶å®ƒå¸¸è§é—®é¢˜ï¼š<a target="_blank" rel="noopener" href="https://www.nuxtjs.cn/faq">www.nuxtjs.cn/faq</a></li>
<li>å®˜æ–¹githubæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/nuxt/docs/tree/master/zh">github.com/nuxt/docs/tâ€¦</a>ï¼ˆé‡Œé¢æœ‰å…¨é¢é…ç½®å’Œä¾‹å­ä½¿ç”¨ï¼Œéƒ¨åˆ†åœ¨ Nuxt.js æ–‡æ¡£ä¸­æ²¡æœ‰æåŠï¼Œå¾ˆå»ºè®®çœ‹ä¸‹ï¼‰</li>
</ul>
<p>ä½œè€…ï¼šWahFung<br>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904160324747278">https://juejin.cn/post/6844904160324747278</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zh.nuxtjs.org/">https://zh.nuxtjs.org/</a>)</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="#">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/taiaiac.gitee.io/tags/nuxtjs/"># nuxtjs</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/taiaiac.gitee.io/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/taiaiac.gitee.io/2021/03/15/apline/alpine%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3/">alpineå®˜æ–¹æ–‡æ¡£</a>
            
        </section>


    </article>
</div>
</div>
      <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Z.A.M. | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
    <script
      type="text/javascript"
      color="96,98,102"
      opacity="0.7"
      zIndex="-2"
      count="99"
      src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"
    ></script>
  <script src="/taiaiac.gitee.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/taiaiac.gitee.io/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":200,"height":434},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
