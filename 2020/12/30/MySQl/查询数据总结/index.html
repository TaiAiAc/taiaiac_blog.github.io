<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Z.A.M.">
  <!-- Open Graph Data -->
  <meta property="og:title" content="查询数据总结"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="Z. A. M. 的个人博客"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://gitee.com/aidemin/taiaiac.gitee.io.git"/>
  
  
    <link rel="icon" href="/favicon.ico">
  

  <!-- Site Title -->
  <title>Z. A. M. 的个人博客</title>

  <!-- Bootstrap CSS -->
  
<link rel="stylesheet" href="/taiaiac.gitee.io/css/bootstrap.min.css">

  <!-- Custom CSS -->
  
  
<link rel="stylesheet" href="/taiaiac.gitee.io/css/style.light.css">


  <!-- Google Analytics -->
  

<meta name="generator" content="Hexo 5.3.0"></head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/taiaiac.gitee.io//img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">查询数据总结</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/taiaiac.gitee.io/">
                  
                  文档
                  
                </a>
              </li>
            
              <li>
                <a href="/taiaiac.gitee.io/archives">
                  
                  分类
                  
                </a>
              </li>
            
              <li>
                <a href="https://gitee.com/aidemin">
                  
                  码云
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Z.A.M.</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2020-12-30</span>
            <span class="time">15:28:20</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/taiaiac.gitee.io/categories/MySQl/">MySQl</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/taiaiac.gitee.io/tags/MySQl/">#MySQl</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h1 id="1、服务端"><a href="#1、服务端" class="headerlink" title="1、服务端"></a>1、服务端</h1><ul>
<li><h2 id="1、创建项目"><a href="#1、创建项目" class="headerlink" title="1、创建项目"></a>1、创建项目</h2><ul>
<li><p>```css<br>express –view==ejs projectname</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ## 2、安装依赖</span><br><span class="line">  - &#96;&#96;&#96;css</span><br><span class="line">    cd projectname</span><br></pre></td></tr></table></figure></li>
<li><p>```css<br>cnpm i mysql -S</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- &#96;&#96;&#96;css</span><br><span class="line">  cnpm i md5 -S</span><br></pre></td></tr></table></figure></li>
<li><p>```css<br>cnpm i body-parser -S</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- ## 3、创建数据库连接模块 mysqlbd.js</span><br><span class="line">  - 引入 mysql 模块</span><br><span class="line">  - 创建链接函数 getConnetion()返回数据连接对象</span><br><span class="line">  - 读取配置文件中 数据库连接参数</span><br><span class="line">  - &#96;&#96;&#96;css</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;user&quot;:&quot;root&quot;,</span><br><span class="line">        &quot;password&quot;:&quot;root&quot;,</span><br><span class="line">        &quot;host&quot;:&quot;127.0.0.1&quot;,</span><br><span class="line">        &quot;port&quot;:&quot;3306&quot;,</span><br><span class="line">        &quot;database&quot;:&quot;这里填密码&quot;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>导出 getConnetion 函数</p>
<ul>
<li>```css<br>exports.getConnetion=getConnetion<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- ## 4、在 users.js 中创建&#x2F;login 路由</span><br><span class="line">  - &#96;&#96;&#96;css</span><br><span class="line">    router.post(&quot;&#x2F;login&quot;,urlencodedParser,function(req,res)&#123;</span><br><span class="line">    			&#x2F;&#x2F;执行的数据库操作和返回数据操作</span><br><span class="line">    		&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><h2 id="5、在-users-js-中引入模块-mysqlbd-js-用于创建连接"><a href="#5、在-users-js-中引入模块-mysqlbd-js-用于创建连接" class="headerlink" title="5、在 users.js 中引入模块 mysqlbd.js,用于创建连接"></a>5、在 users.js 中引入模块 mysqlbd.js,用于创建连接</h2><ul>
<li>```css<br>let mysql = reuqire(“../utils/mysqlbd.js”)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- ## 6、根据用户名和密码查询用户</span><br><span class="line">  - 获得数据库连接对象</span><br><span class="line">  - &#96;&#96;&#96;js</span><br><span class="line">    let cnt &#x3D; await mysql.getConnetion()</span><br></pre></td></tr></table></figure></li>
<li>建立连接</li>
<li>```css<br>cnt.connect()<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 编写 sql 语句</span><br><span class="line">- &#96;&#96;&#96;js</span><br><span class="line">  let sql &#x3D; &#96;select u.*,r.rolename from smbms_user u ,smbms_role r </span><br><span class="line">  			where userName&#x3D;? and userPassword &#x3D;? and r.id &#x3D; u.userRole&#96;</span><br></pre></td></tr></table></figure></li>
<li>准备参数</li>
<li>```js<br>let arr = [params.userName, md5(params.userPassword, ‘utf-8’)]<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- 执行查询操作</span><br><span class="line">- &#96;&#96;&#96;js</span><br><span class="line">  cnt.query(sql,arr,function(err,results,fields)&#123;</span><br><span class="line">  				&#x2F;&#x2F;err:查询错误时的对象</span><br><span class="line">  				&#x2F;&#x2F;results 查询结果集&#x3D;[&#123;&#125;,&#123;&#125;....]</span><br><span class="line">  				&#x2F;&#x2F;fields 查询的字段名称</span><br><span class="line">  				6)返回查询结果</span><br><span class="line">  					res.send(results)</span><br><span class="line">  				7)关闭连接</span><br><span class="line">  					cnt.end()</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h2 id="7、在服务端-app-js-添加跨域"><a href="#7、在服务端-app-js-添加跨域" class="headerlink" title="7、在服务端 app.js 添加跨域"></a>7、在服务端 app.js 添加跨域</h2></li>
<li><p>```js<br>app.all(‘<em>‘, function (req, res, next) {<br>  res.header(‘Access-Control-Allow-Origin’, ‘</em>‘)<br>  res.header(‘Access-Control-Allow-Headers’, ‘*’)<br>  next()<br>})</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- ## 8、启动服务</span><br><span class="line">  - &#96;&#96;&#96;css</span><br><span class="line">    npm start</span><br><span class="line">    cd bin ---&gt; node www</span><br></pre></td></tr></table></figure></li>
<li><h2 id="9、监听客户端请求"><a href="#9、监听客户端请求" class="headerlink" title="9、监听客户端请求"></a>9、监听客户端请求</h2><ul>
<li>在客户端发起请求</li>
<li>```css<br>url=”<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/users/login&quot;">http://127.0.0.1:3000/users/login&quot;</a><br>method=”post”<br>data={usernName:”root123”,userPassword:”root123”}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 2、客户端</span><br><span class="line"></span><br><span class="line">- ## 1、创建项目 node-express-client</span><br><span class="line">- ## 2、img、 html、css、js 等文件夹和文件</span><br><span class="line">- ## 3、在 login.html 中添加 axios.js 依赖</span><br><span class="line">- &#96;&#96;&#96;html</span><br><span class="line">  &lt;script src&#x3D;&quot;..&#x2F;js&#x2F;axios.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h2 id="4、发起登录请求"><a href="#4、发起登录请求" class="headerlink" title="4、发起登录请求"></a>4、发起登录请求</h2><ul>
<li><p>​ 1)在用户名和密码框输入值</p>
</li>
<li><p>​ 2)点击登录按钮触发表单提交事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">form.onsubmit = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>​ 3)阻止表单的默认提交事件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">e</span><span class="selector-class">.preventDefault</span>()</span><br><span class="line">e.returnValue  = false</span><br></pre></td></tr></table></figure></li>
<li><p>​ 4)获得表单数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userName = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#user&#x27;</span>).value</span><br><span class="line"><span class="keyword">let</span> userPassword = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#mima&#x27;</span>).value</span><br></pre></td></tr></table></figure></li>
<li><p>​ 5)使用 axios 发起登录请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:3000/users/login&#x27;</span></span><br><span class="line"><span class="keyword">let</span> data = &#123; usernName, userPassword &#125;</span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">data</span>: res &#125; = axios.post(url, data)</span><br></pre></td></tr></table></figure></li>
<li><p>​ 6)解析服务器返回的数据<br>​ res 判断空<br>​ res.length===0 —&gt;提示错误信息(错误的用户名或密码)</p>
</li>
<li><p>​ 7)根据数据执行页面跳转<br>​</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.length!==0</span><br><span class="line"><span class="selector-tag">location</span><span class="selector-class">.replace</span>(&quot;<span class="selector-tag">welcome</span><span class="selector-class">.html</span>&quot;)</span><br><span class="line"><span class="selector-tag">sessionStorage</span><span class="selector-class">.setItem</span>(&quot;<span class="selector-tag">USER_LOGIN</span>&quot;,<span class="selector-tag">JSON</span><span class="selector-class">.stringify</span>(<span class="selector-tag">res</span><span class="selector-attr">[0]</span>))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h2 id="5、在-welcome-html-界面"><a href="#5、在-welcome-html-界面" class="headerlink" title="5、在 welcome.html 界面"></a>5、在 welcome.html 界面</h2><ul>
<li><p>​ 1)把 sessionStorage 中取出缓存数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = sessionStorage.getItem(<span class="string">&#x27;USER_LOGIN&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> user = <span class="built_in">JSON</span>.parse(str)</span><br></pre></td></tr></table></figure></li>
<li><p>​ 2) 把用户信息写到页面中<br>​</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users.innerHTML = user.userName</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h2 id="6、点击用户管理按钮跳转到用户列表页面"><a href="#6、点击用户管理按钮跳转到用户列表页面" class="headerlink" title="6、点击用户管理按钮跳转到用户列表页面"></a>6、点击用户管理按钮跳转到用户列表页面</h2></li>
</ul>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->

<script src="/taiaiac.gitee.io/js/highlight.pack.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

