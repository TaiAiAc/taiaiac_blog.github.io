<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Z.A.M.">





<title>NodeJS学习 | Z. A. M.’s Blog</title>



    <link rel="icon" href="/taiaiac.gitee.io/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/taiaiac.gitee.io/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/taiaiac.gitee.io/js/script.js"></script>
    
    <script src="/taiaiac.gitee.io/js/tocbot.min.js"></script>
    



    
    
        
    


  <meta name="generator" content="Hexo 5.3.0"></head>
  <body>
    <div class="wrapper">
      <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/taiaiac.gitee.io/">TaiAiAc&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/taiaiac.gitee.io/archives">文档</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/category">分类</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/tag">标签</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/taiaiac.gitee.io/">TaiAiAc&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/taiaiac.gitee.io/archives">文档</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/category">分类</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/tag">标签</a>
                
                    <a class="menu-item" href="/taiaiac.gitee.io/about">关于</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
      <div class="main"><div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">NodeJS学习</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Z.A.M.</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">December 30, 2020&nbsp;&nbsp;14:56:03</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/taiaiac.gitee.io/categories/NodeJS/">NodeJS</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Node-js-安装配置"><a href="#Node-js-安装配置" class="headerlink" title="Node.js 安装配置"></a>Node.js 安装配置</h1><p>本文将向大家介绍在 Windows 和 Linux 上安装 Node.js 的方法。</p>
<p>本安装教程以 Node.js v12.15.0 LTS(长期支持版本)版本为例。</p>
<p>Node.js 安装包及源码下载地址为：<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">点击这里</a>。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Node.js 安装包及源码下载"></p>
<p>根据不同平台系统选择你需要的 Node.js 安装包。</p>
<p>Node.js 历史版本下载地址：<a target="_blank" rel="noopener" href="https://nodejs.org/dist/">点击这里</a></p>
<blockquote>
<p>注意：Linux 上安装 Node.js 需要安装 Python 2.6 或 2.7 ，不建议安装 Python 3.0 以上版本。</p>
</blockquote>
<h2 id="Windows-上安装-Node-js"><a href="#Windows-上安装-Node-js" class="headerlink" title="Windows 上安装 Node.js"></a>Windows 上安装 Node.js</h2><p>你可以采用以下两种方式来安装。</p>
<h3 id="1、Windows-安装包-msi"><a href="#1、Windows-安装包-msi" class="headerlink" title="1、Windows 安装包(.msi)"></a>1、Windows 安装包(.msi)</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Windows 安装包(.msi)"></p>
<p>本文实例以 v0.10.26 版本为例，其他版本类似， 安装步骤：</p>
<p>步骤 1 : 双击下载后的安装包 <strong>v0.10.26</strong>，如下所示：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="双击下载后的安装包"></p>
<p>步骤 2 : 点击以上的Run(运行)，将出现如下界面：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="点击以上的Run(运行)"></p>
<p>步骤 3 : 勾选接受协议选项，点击 next（下一步） 按钮 :</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="勾选接受协议选项，点击 next（下一步）"><br>步骤 4 : Node.js默认安装目录为 “C:\Program Files\nodejs\” , 你可以修改目录，并点击 next（下一步）：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=" Node.js默认安装目录">步骤 5 : 点击树形图标来选择你需要的安装模式 , 然后点击下一步 next（下一步）<br><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="点击树形图标来选择你需要的安装模式"></p>
<p>步骤 6 :点击 Install（安装） 开始安装Node.js。你也可以点击 Back（返回）来修改先前的配置。 然后并点击 next（下一步）：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="点击 Install（安装） 开始安装Node.js"></p>
<p>安装过程：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="安装过程："></p>
<p>点击 Finish（完成）按钮退出安装向导。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="点击 Finish（完成）按钮退出安装向导。"></p>
<p>检测PATH环境变量是否配置了Node.js，点击开始=》运行=》输入”cmd” =&gt; 输入命令”path”，输出如下结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PATH=C:\oraclexe\app\oracle\product\<span class="number">10.2</span><span class="number">.0</span>\server\bin;C:\Windows\system32;</span><br><span class="line">C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1<span class="number">.0</span>\;</span><br><span class="line">c:\python32\python;C:\MinGW\bin;C:\Program Files\GTK2-Runtime\lib;</span><br><span class="line">C:\Program Files\MySQL\MySQL Server <span class="number">5.5</span>\bin;C:\Program Files\nodejs\;</span><br><span class="line">C:\Users\rg\AppData\Roaming\npm</span><br></pre></td></tr></table></figure>
<p>我们可以看到环境变量中已经包含了C:\Program Files\nodejs\</p>
<p>检查Node.js版本</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="检查Node.js版本"></p>
<h3 id="2、Windows-二进制文件-exe-安装"><a href="#2、Windows-二进制文件-exe-安装" class="headerlink" title="2、Windows 二进制文件 (.exe)安装"></a>2、Windows 二进制文件 (.exe)安装</h3><p>32 位安装包下载地址 : <a target="_blank" rel="noopener" href="http://nodejs.org/dist/v0.10.26/node.exe">nodejs/dist/v0.10.26/node.exe</a></p>
<p>64 位安装包下载地址 : <a target="_blank" rel="noopener" href="http://nodejs.org/dist/v0.10.26/x64/node.exe">nodejs/dist/v0.10.26/x64/node.exe</a></p>
<p><strong>安装步骤</strong></p>
<p>步骤 1 : 双击下载的安装包 Node.exe ，将出现如下界面 :</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="双击下载的安装包 Node.exe"></p>
<p>点击 Run（运行）按钮将出现命令行窗口：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="点击 Run（运行）按钮将出现命令行窗口："></p>
<h3 id="版本测试"><a href="#版本测试" class="headerlink" title="版本测试"></a>版本测试</h3><p>进入 node.exe 所在的目录，如下所示：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="进入 node.exe 所在的目录"></p>
<p>如果你获得以上输出结果，说明你已经成功安装了Node.js。</p>
<h2 id="Linux-上安装-Node-js"><a href="#Linux-上安装-Node-js" class="headerlink" title="Linux 上安装 Node.js"></a>Linux 上安装 Node.js</h2><h3 id="直接使用已编译好的包"><a href="#直接使用已编译好的包" class="headerlink" title="直接使用已编译好的包"></a>直接使用已编译好的包</h3><p>Node 官网已经把 linux 下载版本更改为已编译好的版本了，我们可以直接下载解压后使用：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">wget</span> <span class="selector-tag">https</span>://<span class="selector-tag">nodejs</span><span class="selector-class">.org</span>/<span class="selector-tag">dist</span>/<span class="selector-tag">v10</span>.9.0/<span class="selector-tag">node-v10</span>.9.0<span class="selector-tag">-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.xz</span>    // 下载</span><br><span class="line"># <span class="selector-tag">tar</span> <span class="selector-tag">xf</span>  <span class="selector-tag">node-v10</span>.9.0<span class="selector-tag">-linux-x64</span><span class="selector-class">.tar</span><span class="selector-class">.xz</span>       // 解压</span><br><span class="line"># <span class="selector-tag">cd</span> <span class="selector-tag">node-v10</span>.9.0<span class="selector-tag">-linux-x64</span>/                  // 进入解压目录</span><br><span class="line"># ./<span class="selector-tag">bin</span>/<span class="selector-tag">node</span> <span class="selector-tag">-v</span>                               // 执行<span class="selector-tag">node</span>命令 查看版本</span><br><span class="line"><span class="selector-tag">v10</span>.9.0</span><br></pre></td></tr></table></figure>
<p>解压文件的 bin 目录底下包含了 node、npm 等命令，我们可以使用 ln 命令来设置软连接：、</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ln</span> <span class="selector-tag">-s</span> /<span class="selector-tag">usr</span>/<span class="selector-tag">software</span>/<span class="selector-tag">nodejs</span>/<span class="selector-tag">bin</span>/<span class="selector-tag">npm</span>   /<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">bin</span>/ </span><br><span class="line"><span class="selector-tag">ln</span> <span class="selector-tag">-s</span> /<span class="selector-tag">usr</span>/<span class="selector-tag">software</span>/<span class="selector-tag">nodejs</span>/<span class="selector-tag">bin</span>/<span class="selector-tag">node</span>   /<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">bin</span>/</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu-源码安装-Node-js"><a href="#Ubuntu-源码安装-Node-js" class="headerlink" title="Ubuntu 源码安装 Node.js"></a>Ubuntu 源码安装 Node.js</h3><p>以下部分我们将介绍在 Ubuntu Linux 下使用源码安装 Node.js 。 其他的 Linux 系统，如 Centos 等类似如下安装步骤。</p>
<p>在 Github 上获取 Node.js 源码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">git</span> <span class="selector-tag">clone</span> <span class="selector-tag">https</span>://<span class="selector-tag">github</span><span class="selector-class">.com</span>/<span class="selector-tag">nodejs</span>/<span class="selector-tag">node</span><span class="selector-class">.git</span></span><br><span class="line">Cloning into &#x27;node&#x27;...</span><br></pre></td></tr></table></figure>
<p>修改目录权限：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chmod</span> <span class="selector-tag">-R</span> 755 <span class="selector-tag">node</span></span><br></pre></td></tr></table></figure>
<p>使用 <strong>./configure</strong> 创建编译文件，并按照：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">node</span></span><br><span class="line"><span class="selector-tag">sudo</span> ./<span class="selector-tag">configure</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">make</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">make</span> <span class="selector-tag">install</span></span><br></pre></td></tr></table></figure>
<p>查看 node 版本：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">--version</span></span><br><span class="line"><span class="selector-tag">v0</span>.10.25</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu-apt-get命令安装"><a href="#Ubuntu-apt-get命令安装" class="headerlink" title="Ubuntu apt-get命令安装"></a>Ubuntu apt-get命令安装</h3><p>命令格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">apt-get</span> <span class="selector-tag">install</span> <span class="selector-tag">nodejs</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">apt-get</span> <span class="selector-tag">install</span> <span class="selector-tag">npm</span></span><br></pre></td></tr></table></figure>
<h3 id="CentOS-下源码安装-Node-js"><a href="#CentOS-下源码安装-Node-js" class="headerlink" title="CentOS 下源码安装 Node.js"></a>CentOS 下源码安装 Node.js</h3><p>1、下载源码，你需要在<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">node官网</a>下载最新的Nodejs版本，本文以v0.10.24为例:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cd</span> /<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">src</span>/</span><br><span class="line"><span class="selector-tag">wget</span> <span class="selector-tag">http</span>://<span class="selector-tag">nodejs</span><span class="selector-class">.org</span>/<span class="selector-tag">dist</span>/<span class="selector-tag">v0</span>.10.24/<span class="selector-tag">node-v0</span>.10.24<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<p>2、解压源码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">zxvf</span> <span class="selector-tag">node-v0</span>.10.24<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<p>3、 编译安装</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">node-v0</span>.10.24</span><br><span class="line">./configure --prefix=/usr/local/node/0.10.24</span><br><span class="line"><span class="selector-tag">make</span></span><br><span class="line"><span class="selector-tag">make</span> <span class="selector-tag">install</span></span><br></pre></td></tr></table></figure>
<p>4、 配置NODE_HOME，进入profile编辑环境变量</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">vim</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">profile</span></span><br></pre></td></tr></table></figure>
<p>设置 nodejs 环境变量，在 <code>export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL</code> 一行的上面添加如下内容:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#set</span> <span class="selector-tag">for</span> <span class="selector-tag">nodejs</span></span><br><span class="line">export NODE_HOME=/usr/local/node/0.10.24</span><br><span class="line">export PATH=$NODE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p><code>:wq</code>保存并退出，编译<code>/etc/profile</code> 使配置生效</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">source</span> /<span class="selector-tag">etc</span>/<span class="selector-tag">profile</span></span><br></pre></td></tr></table></figure>
<p>验证是否安装配置成功</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">-v</span></span><br></pre></td></tr></table></figure>
<p>输出 v0.10.24 表示配置成功</p>
<p>npm模块安装路径</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">node</span>/0.10.24/<span class="selector-tag">lib</span>/<span class="selector-tag">node_modules</span>/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：Nodejs 官网提供了编译好的 Linux 二进制包，你也可以下载下来直接应用。</p>
</blockquote>
<h2 id="Mac-OS-上安装"><a href="#Mac-OS-上安装" class="headerlink" title="Mac OS 上安装"></a>Mac OS 上安装</h2><p>你可以通过以下两种方式在 Mac OS 上来安装 node：</p>
<ul>
<li><p>1、在<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">官方下载网站</a>下载 pkg 安装包，直接点击安装即可。</p>
</li>
<li><p>2、使用</p>
</li>
</ul>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">brew</span></span><br></pre></td></tr></table></figure>


<p>  命令来安装</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">brew</span> <span class="selector-tag">install</span> <span class="selector-tag">node</span></span><br></pre></td></tr></table></figure>
<h1 id="Node-js-创建第一个应用"><a href="#Node-js-创建第一个应用" class="headerlink" title="Node.js 创建第一个应用"></a>Node.js 创建第一个应用</h1><p>使用 Node.js 时，我们不仅仅 在实现一个应用，同时还实现了整个 HTTP 服务器。事实上，我们的 Web 应用以及对应的 Web 服务器基本上是一样的。</p>
<p>在我们创建 Node.js 第一个 “Hello, World!” 应用前，让我们先了解下 Node.js 应用是由哪几部分组成的：</p>
<ol>
<li><strong>引入 required 模块：</strong>我们可以使用 <strong>require</strong> 指令来载入 Node.js 模块。</li>
<li><strong>创建服务器：</strong>服务器可以监听客户端的请求，类似于 Apache 、Nginx 等 HTTP 服务器。</li>
<li><strong>接收请求与响应请求</strong> 服务器很容易创建，客户端可以使用浏览器或终端发送 HTTP 请求，服务器接收请求后返回响应数据。</li>
</ol>
<h2 id="创建-Node-js-应用"><a href="#创建-Node-js-应用" class="headerlink" title="创建 Node.js 应用"></a>创建 Node.js 应用</h2><h3 id="步骤一、引入-required-模块"><a href="#步骤一、引入-required-模块" class="headerlink" title="步骤一、引入 required 模块"></a>步骤一、引入 required 模块</h3><p>我们使用 <strong>require</strong> 指令来载入 <code>http</code> 模块，并将实例化的 <code>HTTP</code> 赋值给变量 <code>http</code>，实例如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&quot;http&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="步骤二、创建服务器"><a href="#步骤二、创建服务器" class="headerlink" title="步骤二、创建服务器"></a>步骤二、创建服务器</h3><p>接下来我们使用 <code>http.createServer()</code> 方法创建服务器，并使用 <code>listen</code> 方法绑定 8888 端口。 函数通过 <code>request</code>, <code>response</code> 参数来接收和响应数据。</p>
<p>实例如下，在你项目的根目录下创建一个叫 server.js 的文件，并写入以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送 HTTP 头部 </span></span><br><span class="line">    <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line">    <span class="comment">// 内容类型: text/plain</span></span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送响应数据 &quot;Hello World&quot;</span></span><br><span class="line">    response.end(<span class="string">&#x27;Hello World\n&#x27;</span>);</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终端打印如下信息</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server running at http://127.0.0.1:8888/&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码我们完成了一个可以工作的 HTTP 服务器。</p>
<p>使用 <strong>node</strong> 命令执行以上的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br><span class="line">Server running at http:<span class="comment">//127.0.0.1:8888/</span></span><br></pre></td></tr></table></figure>
<p>接下来，打开浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/%EF%BC%8C%E4%BD%A0%E4%BC%9A%E7%9C%8B%E5%88%B0%E4%B8%80%E4%B8%AA%E5%86%99%E7%9D%80">http://127.0.0.1:8888/，你会看到一个写着</a> “Hello World”的网页。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="可以工作的 HTTP 服务器"></p>
<p><strong>分析Node.js 的 HTTP 服务器：</strong></p>
<ul>
<li>第一行请求（<code>require）Node.js</code> 自带的 <code>http</code> 模块，并且把它赋值给 <code>http</code> 变量。</li>
<li>接下来我们调用 <code>http</code> 模块提供的函数： <code>createServer</code> 。这个函数会返回 一个对象，这个对象有一个叫做 <code>listen</code> 的方法，这个方法有一个数值参数， 指定这个 <code>HTTP</code> 服务器监听的端口号。</li>
</ul>
<h1 id="Node-js-NPM的使用介绍"><a href="#Node-js-NPM的使用介绍" class="headerlink" title="Node.js NPM的使用介绍"></a>Node.js NPM的使用介绍</h1><p>NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：</p>
<ul>
<li>允许用户从NPM服务器下载别人编写的第三方包到本地使用。</li>
<li>允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。</li>
<li>允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。</li>
</ul>
<p>由于新版的nodejs已经集成了npm，所以之前npm也一并安装好了。同样可以通过输入 <strong>“npm -v”</strong> 来测试是否成功安装。命令如下，出现版本提示表示安装成功:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">-v</span></span><br><span class="line"><span class="selector-tag">v12</span>.14.0</span><br></pre></td></tr></table></figure>
<p>如果你安装的是旧版本的 npm，可以很容易得通过 npm 命令来升级，命令如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">npm</span> <span class="selector-tag">-g</span></span><br><span class="line">/<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">bin</span>/<span class="selector-tag">npm</span> <span class="selector-tag">-</span>&gt; /<span class="selector-tag">usr</span>/<span class="selector-tag">local</span>/<span class="selector-tag">lib</span>/<span class="selector-tag">node_modules</span>/<span class="selector-tag">npm</span>/<span class="selector-tag">bin</span>/<span class="selector-tag">npm-cli</span><span class="selector-class">.js</span></span><br><span class="line"><span class="selector-tag">npm</span><span class="keyword">@2</span>.14.2 /usr/local/lib/node_modules/npm</span><br></pre></td></tr></table></figure>
<p>如果是 Window 系统使用以下命令即可：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">npm</span> <span class="selector-tag">-g</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用淘宝镜像的命令：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="使用-npm-命令安装模块"><a href="#使用-npm-命令安装模块" class="headerlink" title="使用 npm 命令安装模块"></a>使用 npm 命令安装模块</h2><p>npm 安装 Node.js 模块语法格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> &lt;<span class="selector-tag">Module</span> <span class="selector-tag">Name</span>&gt;</span><br></pre></td></tr></table></figure>
<p>以下实例，我们使用 <code>npm</code> 命令安装常用的 Node.js web框架模块 <strong>express</strong>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">express</span></span><br></pre></td></tr></table></figure>
<p>安装好之后，<code>express</code> 包就放在了工程目录下的 <code>node_modules</code> 目录中，因此在代码中只需要通过 <code>require(&#39;express&#39;)</code> 的方式就好，无需指定第三方包路径。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="全局安装与本地安装"><a href="#全局安装与本地安装" class="headerlink" title="全局安装与本地安装"></a>全局安装与本地安装</h2><p>npm 的包安装分为本地安装（local）、全局安装（global）两种，从敲的命令行来看，差别只是有没有-g而已，比如</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">express</span>          # 本地安装</span><br><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">express</span> <span class="selector-tag">-g</span>       # 全局安装</span><br></pre></td></tr></table></figure>
<p>如果出现以下错误：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">err</span>! <span class="selector-tag">Error</span>: <span class="selector-tag">connect</span> <span class="selector-tag">ECONNREFUSED</span> 127.0.0.1<span class="selector-pseudo">:8087</span></span><br></pre></td></tr></table></figure>
<p>解决办法为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">config</span> <span class="selector-tag">set</span> <span class="selector-tag">proxy</span> <span class="selector-tag">null</span></span><br></pre></td></tr></table></figure>
<h3 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h3><ul>
<li>\1. 将安装包放在 <code>./node_modules</code> 下（运行 <code>npm</code> 命令时所在的目录），如果没有 <code>node_modules</code> 目录，会在当前执行 <code>npm</code> 命令的目录下生成 <code>node_modules</code> 目录。</li>
<li>\2. 可以通过 <code>require()</code> 来引入本地安装的包。</li>
</ul>
<h3 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h3><ul>
<li>\1. 将安装包放在 <code>/usr/local</code> 下或者你 <code>node</code> 的安装目录。</li>
<li>\2. 可以直接在命令行里使用。</li>
</ul>
<p>如果你希望具备两者功能，则需要在两个地方安装它或使用 <strong>npm link</strong>。</p>
<p>接下来我们使用全局方式安装 <code>express</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">install</span> <span class="selector-tag">express</span> <span class="selector-tag">-g</span></span><br><span class="line">+ <span class="selector-tag">express</span><span class="keyword">@4</span>.17.1</span><br><span class="line">added <span class="number">50</span> packages from <span class="number">37</span> contributors in <span class="number">9.624s</span></span><br></pre></td></tr></table></figure>
<h3 id="查看安装信息"><a href="#查看安装信息" class="headerlink" title="查看安装信息"></a>查看安装信息</h3><p>你可以使用以下命令来查看所有全局安装的模块：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">list</span> <span class="selector-tag">-g</span></span><br><span class="line"></span><br><span class="line">+<span class="selector-tag">--</span> <span class="selector-tag">cnpm</span><span class="keyword">@6</span>.1.1</span><br><span class="line">| +-- auto-correct@<span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">| +-- bagpipe@<span class="number">0.3</span>.<span class="number">5</span></span><br><span class="line">| +-- colors@<span class="number">1.4</span>.<span class="number">0</span></span><br><span class="line">| +-- commander@<span class="number">2.10</span>.<span class="number">0</span></span><br><span class="line">| | `-- graceful-readlink@<span class="number">1.0</span>.<span class="number">1</span></span><br><span class="line">| +-- cross-spawn@<span class="number">0.2</span>.<span class="number">9</span></span><br><span class="line">| | `-- lru-cache@<span class="number">2.7</span>.<span class="number">3</span></span><br><span class="line">| +-- debug@<span class="number">2.6</span>.<span class="number">9</span></span><br><span class="line">| | `-- ms@<span class="number">2.0</span>.<span class="number">0</span></span><br><span class="line">| +-- giturl@<span class="number">1.0</span>.<span class="number">1</span></span><br><span class="line">| +-- ini@<span class="number">1.3</span>.<span class="number">5</span></span><br><span class="line">| +-- npm@<span class="number">6.13</span>.<span class="number">7</span></span><br><span class="line">| | +-- abbrev@<span class="number">1.1</span>.<span class="number">1</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>如果要查看某个模块的版本号，可以使用命令如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">list</span> <span class="selector-tag">grunt</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">projectName</span><span class="keyword">@projectVersion</span> /path/to/project/folder</span><br><span class="line">└── grunt@<span class="number">0.4</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="使用-package-json"><a href="#使用-package-json" class="headerlink" title="使用 package.json"></a>使用 package.json</h2><p>package.json 位于模块的目录下，用于定义包的属性。接下来让我们来看下 <code>express</code> 包的 <code>package.json</code> 文件，位于 <code>node_modules/express/package.json</code> 内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_from&quot;</span>: <span class="string">&quot;express@^4.17.1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;express@4.17.1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_inBundle&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_integrity&quot;</span>: <span class="string">&quot;sha512-mHJ9O79RqluphRrcw2X/GTh3k9tVv8YcoyY4Kkh4WDMUYKRZUq0h1o0w2rrrxBqM7VoeUVqgb27xlEMXTnYt4g==&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_location&quot;</span>: <span class="string">&quot;/express&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_phantomChildren&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;_requested&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;range&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;registry&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;raw&quot;</span>: <span class="string">&quot;express@^4.17.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;express&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;escapedName&quot;</span>: <span class="string">&quot;express&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;rawSpec&quot;</span>: <span class="string">&quot;^4.17.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;saveSpec&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;fetchSpec&quot;</span>: <span class="string">&quot;^4.17.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_requiredBy&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;/webpack-dev-server&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;_resolved&quot;</span>: <span class="string">&quot;https://registry.npmjs.org/express/-/express-4.17.1.tgz&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shasum&quot;</span>: <span class="string">&quot;4491fc38605cf51f8629d39c2b5d026f98a4c134&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_spec&quot;</span>: <span class="string">&quot;express@^4.17.1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_where&quot;</span>: <span class="string">&quot;D:\\myProject\\ReduxDemo\\demo01\\node_modules\\webpack-dev-server&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;TJ Holowaychuk&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;tj@vision-media.ca&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;bugs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/expressjs/express/issues&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;bundleDependencies&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;contributors&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Aaron Heckmann&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;aaron.heckmann+github@gmail.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Ciaran Jessup&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;ciaranj@gmail.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Douglas Christopher Wilson&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;doug@somethingdoug.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Guillermo Rauch&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;rauchg@gmail.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jonathan Ong&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;me@jongleberry.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Roman Shtylman&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;shtylman+expressjs@gmail.com&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Young Jae Sim&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;email&quot;</span>: <span class="string">&quot;hanul@hanul.me&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;accepts&quot;</span>: <span class="string">&quot;~1.3.7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;array-flatten&quot;</span>: <span class="string">&quot;1.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body-parser&quot;</span>: <span class="string">&quot;1.19.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;content-disposition&quot;</span>: <span class="string">&quot;0.5.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;content-type&quot;</span>: <span class="string">&quot;~1.0.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cookie&quot;</span>: <span class="string">&quot;0.4.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cookie-signature&quot;</span>: <span class="string">&quot;1.0.6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;debug&quot;</span>: <span class="string">&quot;2.6.9&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;depd&quot;</span>: <span class="string">&quot;~1.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;encodeurl&quot;</span>: <span class="string">&quot;~1.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;escape-html&quot;</span>: <span class="string">&quot;~1.0.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;etag&quot;</span>: <span class="string">&quot;~1.8.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;finalhandler&quot;</span>: <span class="string">&quot;~1.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fresh&quot;</span>: <span class="string">&quot;0.5.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;merge-descriptors&quot;</span>: <span class="string">&quot;1.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;methods&quot;</span>: <span class="string">&quot;~1.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;on-finished&quot;</span>: <span class="string">&quot;~2.3.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;parseurl&quot;</span>: <span class="string">&quot;~1.3.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path-to-regexp&quot;</span>: <span class="string">&quot;0.1.7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;proxy-addr&quot;</span>: <span class="string">&quot;~2.0.5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;qs&quot;</span>: <span class="string">&quot;6.7.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;range-parser&quot;</span>: <span class="string">&quot;~1.2.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;safe-buffer&quot;</span>: <span class="string">&quot;5.1.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;send&quot;</span>: <span class="string">&quot;0.17.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;serve-static&quot;</span>: <span class="string">&quot;1.14.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;setprototypeof&quot;</span>: <span class="string">&quot;1.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;statuses&quot;</span>: <span class="string">&quot;~1.5.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type-is&quot;</span>: <span class="string">&quot;~1.6.18&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;utils-merge&quot;</span>: <span class="string">&quot;1.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vary&quot;</span>: <span class="string">&quot;~1.1.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;deprecated&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Fast, unopinionated, minimalist web framework&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;after&quot;</span>: <span class="string">&quot;0.8.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;connect-redis&quot;</span>: <span class="string">&quot;3.4.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cookie-parser&quot;</span>: <span class="string">&quot;~1.4.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cookie-session&quot;</span>: <span class="string">&quot;1.3.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ejs&quot;</span>: <span class="string">&quot;2.6.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span>: <span class="string">&quot;2.13.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;express-session&quot;</span>: <span class="string">&quot;1.16.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hbs&quot;</span>: <span class="string">&quot;4.0.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;istanbul&quot;</span>: <span class="string">&quot;0.4.5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;marked&quot;</span>: <span class="string">&quot;0.6.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;method-override&quot;</span>: <span class="string">&quot;3.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mocha&quot;</span>: <span class="string">&quot;5.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;morgan&quot;</span>: <span class="string">&quot;1.9.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;multiparty&quot;</span>: <span class="string">&quot;4.2.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pbkdf2-password&quot;</span>: <span class="string">&quot;1.2.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;should&quot;</span>: <span class="string">&quot;13.2.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;supertest&quot;</span>: <span class="string">&quot;3.3.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vhost&quot;</span>: <span class="string">&quot;~3.0.2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;engines&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;node&quot;</span>: <span class="string">&quot;&gt;= 0.10.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;LICENSE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;History.md&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Readme.md&quot;</span>,</span><br><span class="line">    <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lib/&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;http://expressjs.com/&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;express&quot;</span>,</span><br><span class="line">    <span class="string">&quot;framework&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sinatra&quot;</span>,</span><br><span class="line">    <span class="string">&quot;web&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rest&quot;</span>,</span><br><span class="line">    <span class="string">&quot;restful&quot;</span>,</span><br><span class="line">    <span class="string">&quot;router&quot;</span>,</span><br><span class="line">    <span class="string">&quot;app&quot;</span>,</span><br><span class="line">    <span class="string">&quot;api&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;express&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;git+https://github.com/expressjs/express.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;lint&quot;</span>: <span class="string">&quot;eslint .&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;mocha --require test/support/env --reporter spec --bail --check-leaks test/ test/acceptance/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;test-ci&quot;</span>: <span class="string">&quot;istanbul cover node_modules/mocha/bin/_mocha --report lcovonly -- --require test/support/env --reporter spec --check-leaks test/ test/acceptance/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;test-cov&quot;</span>: <span class="string">&quot;istanbul cover node_modules/mocha/bin/_mocha -- --require test/support/env --reporter dot --check-leaks test/ test/acceptance/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;test-tap&quot;</span>: <span class="string">&quot;mocha --require test/support/env --reporter tap --check-leaks test/ test/acceptance/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;4.17.1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Package-json-属性说明"><a href="#Package-json-属性说明" class="headerlink" title="Package.json 属性说明"></a>Package.json 属性说明</h3><ul>
<li><strong>name</strong> – 包名。</li>
<li><strong>version</strong> – 包的版本号。</li>
<li><strong>description</strong> – 包的描述。</li>
<li><strong>homepage</strong> – 包的官网 url 。</li>
<li><strong>author</strong> – 包的作者姓名。</li>
<li><strong>contributors</strong> – 包的其他贡献者姓名。</li>
<li><strong>dependencies</strong> – 依赖包列表。如果依赖包没有安装，<code>npm</code> 会自动将依赖包安装在 <code>node_module</code> 目录下。</li>
<li><strong>repository</strong> – 包代码存放的地方的类型，可以是 <code>git</code> 或 <code>svn</code>，<code>git</code> 可在 <code>Github</code> 上。</li>
<li><strong>main</strong> – main 字段指定了程序的主入口文件，<code>require(&#39;moduleName&#39;)</code> 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。</li>
<li><strong>keywords</strong> – 关键字</li>
</ul>
<h2 id="卸载模块"><a href="#卸载模块" class="headerlink" title="卸载模块"></a>卸载模块</h2><p>我们可以使用以下命令来卸载 Node.js 模块。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">uninstall</span> <span class="selector-tag">express</span></span><br></pre></td></tr></table></figure>
<p>卸载后，你可以到 <code>/node_modules/</code> 目录下查看包是否还存在，或者使用以下命令查看：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">ls</span></span><br></pre></td></tr></table></figure>
<h2 id="更新模块"><a href="#更新模块" class="headerlink" title="更新模块"></a>更新模块</h2><p>我们可以使用以下命令更新模块：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">update</span> <span class="selector-tag">express</span></span><br></pre></td></tr></table></figure>
<h2 id="搜索模块"><a href="#搜索模块" class="headerlink" title="搜索模块"></a>搜索模块</h2><p>使用以下来搜索模块：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">search</span> <span class="selector-tag">express</span></span><br></pre></td></tr></table></figure>
<h2 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h2><p>创建模块，package.json 文件是必不可少的。我们可以使用 NPM 生成 package.json 文件，生成的文件包含了基本的结果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, and tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help json` for definitive documentation on these fields</span><br><span class="line">and exactly what they do.</span><br><span class="line"></span><br><span class="line">Use `npm install  --save` afterwards to install a package and</span><br><span class="line">save it as a dependency in the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">name: (node_modules) mybj                   # 模块名</span><br><span class="line">version: (1.0.0) </span><br><span class="line">description: Node.js 测试模块(www.mybj123.com)  # 描述</span><br><span class="line">entry point: (index.js) </span><br><span class="line">test command: make test</span><br><span class="line">git repository: https://github.com/mybj/mybj.git  # Github 地址</span><br><span class="line">keywords: </span><br><span class="line">author: </span><br><span class="line">license: (ISC) </span><br><span class="line">About to write to ……/node_modules/package.json:      # 生成地址</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mybj&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Node.js 测试模块(www.mybj123.com)&quot;</span>,</span><br><span class="line">  ……</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this ok? (yes) yes</span><br></pre></td></tr></table></figure>
<p>以上的信息，你需要根据你自己的情况输入。在最后输入 “yes” 后会生成 package.json 文件。</p>
<p>接下来我们可以使用以下命令在 npm 资源库中注册用户（使用邮箱注册）：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">adduser</span></span><br><span class="line"><span class="selector-tag">Username</span>: <span class="selector-tag">mybj</span></span><br><span class="line"><span class="selector-tag">Password</span>:</span><br><span class="line"><span class="selector-tag">Email</span>: (<span class="selector-tag">this</span> <span class="selector-tag">IS</span> <span class="selector-tag">public</span>) <span class="selector-tag">mybj</span><span class="keyword">@gmail</span>.com</span><br></pre></td></tr></table></figure>
<p>接下来我们就用以下命令来发布模块：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">npm</span> <span class="selector-tag">publish</span></span><br></pre></td></tr></table></figure>
<p>如果你以上的步骤都操作正确，你就可以跟其他模块一样使用 npm 来安装。</p>
<h2 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h2><p>使用NPM下载和发布代码时都会接触到版本号。NPM使用语义版本号来管理代码，这里简单介绍一下。</p>
<p>语义版本号分为X.Y.Z三位，分别代表主版本号、次版本号和补丁版本号。当代码变更时，版本号按以下原则更新。</p>
<ul>
<li>如果只是修复bug，需要更新Z位。</li>
<li>如果是新增了功能，但是向下兼容，需要更新Y位。</li>
<li>如果有大变动，向下不兼容，需要更新X位。</li>
</ul>
<p>版本号有了这个保证后，在申明第三方包依赖时，除了可依赖于一个固定版本号外，还可依赖于某个范围的版本号。例如”argv”: “0.0.x”表示依赖于0.0.x系列的最新版argv。</p>
<h2 id="NPM-常用命令"><a href="#NPM-常用命令" class="headerlink" title="NPM 常用命令"></a>NPM 常用命令</h2><p>除了本章介绍的部分外，NPM还提供了很多功能，package.json里也有很多其它有用的字段。</p>
<p>除了可以在<a target="_blank" rel="noopener" href="https://npmjs.org/doc/">npmjs.org/doc/</a>查看官方文档外，这里再介绍一些NPM常用命令。</p>
<p>NPM提供了很多命令，例如install和publish，使用npm help可查看所有命令。</p>
<ul>
<li>NPM提供了很多命令，例如<code>install</code>和<code>publish</code>，使用<code>npm help</code>可查看所有命令。</li>
<li>使用<code>npm help &lt;command&gt;</code>可查看某条命令的详细帮助，例如<code>npm help install</code>。</li>
<li>在<code>package.json</code>所在目录下使用<code>npm install . -g</code>可先在本地安装当前命令行程序，可用于发布前的本地测试。</li>
<li>使用<code>npm update &lt;package&gt;</code>可以把当前目录下<code>node_modules</code>子目录里边的对应模块更新至最新版本。</li>
<li>使用<code>npm update &lt;package&gt; -g</code>可以把全局安装的对应命令行程序更新至最新版。</li>
<li>使用<code>npm cache clear</code>可以清空NPM本地缓存，用于对付使用相同版本号发布新版本代码的人。</li>
<li>使用<code>npm unpublish &lt;package&gt;@&lt;version&gt;</code>可以撤销发布自己发布过的某个版本代码。</li>
</ul>
<h2 id="使用淘宝-NPM-镜像"><a href="#使用淘宝-NPM-镜像" class="headerlink" title="使用淘宝 NPM 镜像"></a>使用淘宝 NPM 镜像</h2><p>大家都知道国内直接使用 npm 的官方镜像是非常慢的，这里推荐使用淘宝 NPM 镜像。</p>
<p>淘宝 NPM 镜像是一个完整 npmjs.org 镜像，你可以用此代替官方版本(只读)，同步频率目前为 10分钟 一次以保证尽量与官方服务同步。</p>
<p>你可以使用淘宝定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<p>这样就可以使用 cnpm 命令来安装模块了：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">install</span> <span class="selector-attr">[name]</span></span><br></pre></td></tr></table></figure>
<h1 id="Node-js-REPL交互式解释器"><a href="#Node-js-REPL交互式解释器" class="headerlink" title="Node.js REPL交互式解释器"></a>Node.js REPL交互式解释器</h1><p>Node.js REPL(Read Eval Print Loop:交互式解释器) 表示一个电脑的环境，类似 Window 系统的终端或 Unix/Linux shell，我们可以在终端中输入命令，并接收系统的响应。</p>
<p>Node 自带了交互式解释器，可以执行以下任务：</p>
<ul>
<li><strong>读取</strong> – 读取用户输入，解析输入的 Javascript 数据结构并存储在内存中。</li>
<li><strong>执行</strong> – 执行输入的数据结构</li>
<li><strong>打印</strong> – 输出结果</li>
<li><strong>循环</strong> – 循环操作以上步骤直到用户两次按下 <strong>ctrl-c</strong> 按钮退出。</li>
</ul>
<p>Node 的交互式解释器可以很好的调试 Javascript 代码。</p>
<p>开始学习 REPL</p>
<p>我们可以输入<code>node</code>命令来启动 Node 的终端：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="输入node命令来启动 Node 的终端"></p>
<p>这时我们就可以在 &gt; 后输入简单的表达式，并按下回车键来计算结果。</p>
<h3 id="简单的表达式运算"><a href="#简单的表达式运算" class="headerlink" title="简单的表达式运算"></a>简单的表达式运算</h3><p>接下来让我们在 Node.js REPL 的命令行窗口中执行简单的数学运算：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span></span><br><span class="line">&gt; 1 +4</span><br><span class="line">5</span><br><span class="line">&gt; 5 / 2</span><br><span class="line">2.5</span><br><span class="line">&gt; 3 * 6</span><br><span class="line">18</span><br><span class="line">&gt; 4 <span class="selector-tag">-</span> 1</span><br><span class="line">3</span><br><span class="line">&gt; 1 + ( 2 * 3 ) <span class="selector-tag">-</span> 4</span><br><span class="line">3</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h3><p>你可以将数据存储在变量中，并在你需要的时候使用它。</p>
<p>变量声明需要使用 <strong>var</strong> 关键字，如果没有使用 <code>var</code> 关键字变量会直接打印出来。</p>
<p>使用 <strong>var</strong> 关键字的变量可以使用 <code>console.log()</code> 来输出变量。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span></span><br><span class="line">&gt; x = 10</span><br><span class="line">10</span><br><span class="line">&gt; var y = 10</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; <span class="selector-tag">x</span> + <span class="selector-tag">y</span></span><br><span class="line">20</span><br><span class="line">&gt; <span class="selector-tag">console</span><span class="selector-class">.log</span>(&quot;<span class="selector-tag">Hello</span> <span class="selector-tag">World</span>&quot;)</span><br><span class="line"><span class="selector-tag">Hello</span> <span class="selector-tag">World</span></span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; <span class="selector-tag">console</span><span class="selector-class">.log</span>(&quot;<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span>&quot;)</span><br><span class="line"><span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br><span class="line"><span class="selector-tag">undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="多行表达式"><a href="#多行表达式" class="headerlink" title="多行表达式"></a>多行表达式</h3><p>Node REPL 支持输入多行表达式，这就有点类似 JavaScript。接下来让我们来执行一个 do…while 循环：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span></span><br><span class="line">&gt; var x = 0</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; <span class="selector-tag">do</span> &#123;</span><br><span class="line">... x++;</span><br><span class="line">... <span class="selector-tag">console</span><span class="selector-class">.log</span>(&quot;<span class="selector-tag">x</span>: &quot; + <span class="selector-tag">x</span>);</span><br><span class="line">... &#125; <span class="selector-tag">while</span> ( <span class="selector-tag">x</span> &lt; 5 ); <span class="selector-tag">x</span>: 1 <span class="selector-tag">x</span>: 2 <span class="selector-tag">x</span>: 3 <span class="selector-tag">x</span>: 4 <span class="selector-tag">x</span>: 5 <span class="selector-tag">undefined</span> &gt;</span><br></pre></td></tr></table></figure>
<p><code>...</code> 三个点的符号是系统自动生成的，你回车换行后即可。Node 会自动检测是否为连续的表达式。</p>
<h3 id="下划线-变量"><a href="#下划线-变量" class="headerlink" title="下划线(_)变量"></a>下划线(_)变量</h3><p>你可以使用下划线( _ )获取上一个表达式的运算结果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span></span><br><span class="line">&gt; var x = 10</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; var y = 20</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; <span class="selector-tag">x</span> + <span class="selector-tag">y</span></span><br><span class="line">30</span><br><span class="line">&gt; var sum = _</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt; <span class="selector-tag">console</span><span class="selector-class">.log</span>(<span class="selector-tag">sum</span>)</span><br><span class="line">30</span><br><span class="line"><span class="selector-tag">undefined</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="REPL-命令"><a href="#REPL-命令" class="headerlink" title="REPL 命令"></a>REPL 命令</h2><ul>
<li><strong>ctrl + c</strong> – 退出当前终端。</li>
<li><strong>ctrl + c 按下两次</strong> – 退出 Node REPL。</li>
<li><strong>ctrl + d</strong> – 退出 Node REPL.</li>
<li><strong>向上/向下 键</strong> – 查看输入的历史命令</li>
<li><strong>tab 键</strong> – 列出当前命令</li>
<li><strong>.help</strong> – 列出使用命令</li>
<li><strong>.break</strong> – 退出多行表达式</li>
<li><strong>.clear</strong> – 退出多行表达式</li>
<li><strong>.save *filename*</strong> – 保存当前的 Node REPL 会话到指定文件</li>
<li><strong>.load *filename*</strong> – 载入当前 Node REPL 会话的文件内容。</li>
</ul>
<h2 id="停止-REPL"><a href="#停止-REPL" class="headerlink" title="停止 REPL"></a>停止 REPL</h2><p>前面我们已经提到按下两次 <strong>ctrl + c</strong> 键就能退出 REPL:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span></span><br><span class="line"><span class="selector-tag">Welcome</span> <span class="selector-tag">to</span> <span class="selector-tag">Node</span><span class="selector-class">.js</span> <span class="selector-tag">v12</span>.14.0.</span><br><span class="line"><span class="selector-tag">Type</span> &quot;<span class="selector-class">.help</span>&quot; <span class="selector-tag">for</span> <span class="selector-tag">more</span> <span class="selector-tag">information</span>.</span><br><span class="line">&gt;</span><br><span class="line">(<span class="selector-tag">To</span> <span class="selector-tag">exit</span>, <span class="selector-tag">press</span> ^<span class="selector-tag">C</span> <span class="selector-tag">again</span> <span class="selector-tag">or</span> ^<span class="selector-tag">D</span> <span class="selector-tag">or</span> <span class="selector-tag">type</span> <span class="selector-class">.exit</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-回调函数"><a href="#Node-js-回调函数" class="headerlink" title="Node.js 回调函数"></a>Node.js 回调函数</h1><p>Node.js 异步编程的直接体现就是回调。</p>
<p>异步编程依托于回调来实现，但不能说使用了回调后程序就异步化了。</p>
<p>回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。</p>
<p>例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。</p>
<p>回调函数一般作为函数的最后一个参数出现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params">name, age, callback</span>) </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span>(<span class="params">value, callback1, callback2</span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="阻塞代码实例"><a href="#阻塞代码实例" class="headerlink" title="阻塞代码实例"></a>阻塞代码实例</h2><p>创建一个文件 input.txt ，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>创建 main.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = fs.readFileSync(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(data.toString());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行结束!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br><span class="line">程序执行结束!</span><br></pre></td></tr></table></figure>
<h2 id="非阻塞代码实例"><a href="#非阻塞代码实例" class="headerlink" title="非阻塞代码实例"></a>非阻塞代码实例</h2><p>创建一个文件 input.txt ，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.comcss</span></span><br></pre></td></tr></table></figure>
<p>创建 main.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">    <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行结束!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">程序执行结束!</span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>以上两个实例我们了解了阻塞与非阻塞调用的不同。第一个实例在文件读取完后才执行程序。 第二个实例我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。</p>
<p>因此，阻塞是按顺序执行的，而非阻塞是不需要按顺序的，所以如果需要处理回调函数的参数，我们就需要写在回调函数内。</p>
<h1 id="Node-js-事件循环机制"><a href="#Node-js-事件循环机制" class="headerlink" title="Node.js 事件循环机制"></a>Node.js 事件循环机制</h1><p>Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。</p>
<p>Node.js 几乎每一个 API 都是支持回调函数的。</p>
<p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现。</p>
<p>Node.js 单线程类似进入一个<code>while(true)</code>的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数.</p>
<h2 id="事件驱动程序"><a href="#事件驱动程序" class="headerlink" title="事件驱动程序"></a>事件驱动程序</h2><p>Node.js 使用事件驱动模型，当<code>web server</code>接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求。</p>
<p>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。</p>
<p>这个模型非常高效可扩展性非常强，因为 <code>webserver</code> 一直接受请求而不等待任何读写操作。（这也称之为非阻塞式IO或者事件驱动IO）</p>
<p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数。</p>
<p>整个事件驱动的流程就是这么实现的，非常简洁。有点类似于观察者模式，事件相当于一个主题(Subject)，而所有注册到这个事件上的处理函数相当于观察者(Observer)。</p>
<p>Node.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件，如下实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 events 模块</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br></pre></td></tr></table></figure>
<p>以下程序绑定事件处理程序：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定事件及事件的处理程序</span></span><br><span class="line">eventEmitter.on(<span class="string">&#x27;eventName&#x27;</span>, eventHandler);</span><br></pre></td></tr></table></figure>
<p>我们可以通过程序触发事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发事件</span></span><br><span class="line">eventEmitter.emit(<span class="string">&#x27;eventName&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>创建 main.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 events 模块</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建事件处理程序</span></span><br><span class="line"><span class="keyword">const</span> connectHandler = <span class="function"><span class="keyword">function</span> <span class="title">connected</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;连接成功。&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// 触发 data_received 事件 </span></span><br><span class="line">   eventEmitter.emit(<span class="string">&#x27;data_received&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 绑定 connection 事件处理程序</span></span><br><span class="line">eventEmitter.on(<span class="string">&#x27;connection&#x27;</span>, connectHandler);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用匿名函数绑定 data_received 事件</span></span><br><span class="line">eventEmitter.on(<span class="string">&#x27;data_received&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;数据接收成功。&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 触发 connection 事件 </span></span><br><span class="line">eventEmitter.emit(<span class="string">&#x27;connection&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕。&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>接下来让我们执行以上代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">连接成功。</span><br><span class="line">数据接收成功。</span><br><span class="line">程序执行完毕。</span><br></pre></td></tr></table></figure>
<h2 id="Node-应用程序是如何工作的？"><a href="#Node-应用程序是如何工作的？" class="headerlink" title="Node 应用程序是如何工作的？"></a>Node 应用程序是如何工作的？</h2><p>在 Node 应用程序中，执行异步操作的函数将回调函数作为最后一个参数， 回调函数接收错误对象作为第一个参数。</p>
<p>接下来让我们来重新看下前面的实例，创建一个 input.txt ,文件内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>创建 main.js 文件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上程序中 <code>fs.readFile()</code> 是异步函数用于读取文件。 如果在读取文件过程中发生错误，错误 <code>err</code> 对象就会输出错误信息。</p>
<p>如果没发生错误，<code>readFile</code> 跳过 <code>err</code> 对象的输出，文件内容就通过回调函数输出。</p>
<p>执行以上代码，执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">程序执行完毕</span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>接下来我们删除 input.txt 文件，执行结果如下所示：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">程序执行完毕\</span><br><span class="line">Error: ENOENT: no such file or directory, open &#x27;D:\myProject\testComet\input.txt&#x27;</span><br></pre></td></tr></table></figure>
<p>因为文件 input.txt 不存在，所以输出了错误信息。</p>
<h1 id="Node-js-EventEmitter类"><a href="#Node-js-EventEmitter类" class="headerlink" title="Node.js EventEmitter类"></a>Node.js EventEmitter类</h1><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p>
<p>Node.js 里面的许多对象都会分发事件：一个 <code>net.Server</code> 对象会在每次有新连接时触发一个事件， 一个 <code>fs.readStream</code> 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 <code>events.EventEmitter</code> 的实例。</p>
<h2 id="EventEmitter-类"><a href="#EventEmitter-类" class="headerlink" title="EventEmitter 类"></a>EventEmitter 类</h2><p><code>events</code> 模块只提供了一个对象： <code>events.EventEmitter</code>。<code>EventEmitter</code> 的核心就是事件触发与事件监听器功能的封装。</p>
<p>你可以通过<code>require(&quot;events&quot;);</code>来访问该模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 events 模块</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br></pre></td></tr></table></figure>
<p>EventEmitter 对象如果在实例化时发生错误，会触发 error 事件。当添加新的监听器时，newListener 事件会触发，当监听器被移除时，<code>removeListener</code> 事件被触发。</p>
<p>下面我们用一个简单的例子说明 <code>EventEmitter</code> 的用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//event.js 文件</span></span><br><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>).EventEmitter; </span><br><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> EventEmitter(); </span><br><span class="line">event.on(<span class="string">&#x27;some_event&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;some_event 事件触发&#x27;</span>); </span><br><span class="line">&#125;); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    event.emit(<span class="string">&#x27;some_event&#x27;</span>); </span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<p>运行这段代码，1 秒后控制台输出了 <strong>‘some_event 事件触发’</strong>。其原理是 <code>event</code> 对象注册了事件 <code>some_event</code> 的一个监听器，然后我们通过 <code>setTimeout</code> 在 1000 毫秒以后向 <code>event</code> 对象发送事件 <code>some_event</code>，此时会调用<code>some_event</code> 的监听器。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">event</span><span class="selector-class">.js</span> </span><br><span class="line"><span class="selector-tag">some_event</span> 事件触发</span><br></pre></td></tr></table></figure>
<p>EventEmitter 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件，EventEmitter 支持 若干个事件监听器。</p>
<p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。</p>
<p>让我们以下面的例子解释这个过程：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//event.js 文件</span></span><br><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter(); </span><br><span class="line">emitter.on(<span class="string">&#x27;someEvent&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listener1&#x27;</span>, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.on(<span class="string">&#x27;someEvent&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listener2&#x27;</span>, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.emit(<span class="string">&#x27;someEvent&#x27;</span>, <span class="string">&#x27;arg1 参数&#x27;</span>, <span class="string">&#x27;arg2 参数&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>执行以上代码，运行的结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">event</span><span class="selector-class">.js</span> </span><br><span class="line"><span class="selector-tag">listener1</span> <span class="selector-tag">arg1</span> 参数 <span class="selector-tag">arg2</span> 参数</span><br><span class="line"><span class="selector-tag">listener2</span> <span class="selector-tag">arg1</span> 参数 <span class="selector-tag">arg2</span> 参数</span><br></pre></td></tr></table></figure>
<p>以上例子中，<code>emitter</code> 为事件 <code>someEvent</code> 注册了两个事件监听器，然后触发了 <code>someEvent</code> 事件。</p>
<p>运行结果中可以看到两个事件监听器回调函数被先后调用。 这就是EventEmitter最简单的用法。</p>
<p>EventEmitter 提供了多个属性，如 <strong>on</strong> 和 <strong>emit</strong>。<strong>on</strong> 函数用于绑定事件函数，<strong>emit</strong> 属性用于触发一个事件。接下来我们来具体看下 EventEmitter 的属性介绍。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>addListener(event, listener)</strong> 为指定事件添加一个监听器到监听器数组的尾部。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>on(event, listener)</strong> 为指定事件注册一个监听器，接受一个字符串 event 和一个回调函数。<code>server.on(&#39;connection&#39;, function (stream) &#123;  console.log(&#39;someone connected!&#39;); &#125;);</code></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>once(event, listener)</strong> 为指定事件注册一个单次监听器，即 监听器最多只会触发一次，触发后立刻解除该监听器。<code>server.once(&#39;connection&#39;, function (stream) &#123;  console.log(&#39;Ah, we have our first user!&#39;); &#125;);</code></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>removeListener(event, listener)</strong> 移除指定事件的某个监听器，监听器必须是该事件已经注册过的监听器。它接受两个参数，第一个是事件名称，第二个是回调函数名称。<code>const callback = function(stream) &#123;  console.log(&#39;someone connected!&#39;); &#125;; server.on(&#39;connection&#39;, callback); // ... server.removeListener(&#39;connection&#39;, callback);</code></td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>removeAllListeners([event])</strong> 移除所有事件的所有监听器， 如果指定事件，则移除指定事件的所有监听器。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>setMaxListeners(n)</strong> 默认情况下， EventEmitters 如果你添加的监听器超过 10 个就会输出警告信息。 setMaxListeners 函数用于提高监听器的默认限制的数量。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>listeners(event)</strong> 返回指定事件的监听器数组。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>emit(event, [arg1], [arg2], […])</strong> 按监听器的顺序执行执行每个监听器，如果事件有注册监听返回 true，否则返回 false。</td>
</tr>
</tbody></table>
<h3 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>listenerCount(emitter, event)</strong> 返回指定事件的监听器数量。</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">events.EventEmitter.listenerCount(emitter, eventName) &#x2F;&#x2F;已废弃，不推荐</span><br><span class="line">events.emitter.listenerCount(eventName) &#x2F;&#x2F;推荐</span><br></pre></td></tr></table></figure>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">事件 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>newListener**</strong>event** – 字符串，事件名称<strong>listener</strong> – 处理事件函数该事件在添加新监听器时被触发。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>removeListener**</strong>event** – 字符串，事件名称<strong>listener</strong> – 处理事件函数从指定监听器数组中删除一个监听器。需要注意的是，此操作将会改变处于被删监听器之后的那些监听器的索引。</td>
</tr>
</tbody></table>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><p>以下实例通过 connection（连接）事件演示了 EventEmitter 类的应用。</p>
<p>创建 main.js 文件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> eventEmitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听器 #1</span></span><br><span class="line"><span class="keyword">const</span> listener1 = <span class="function"><span class="keyword">function</span> <span class="title">listener1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;监听器 listener1 执行。&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听器 #2</span></span><br><span class="line"><span class="keyword">const</span> listener2 = <span class="function"><span class="keyword">function</span> <span class="title">listener2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;监听器 listener2 执行。&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定 connection 事件，处理函数为 listener1 </span></span><br><span class="line">eventEmitter.addListener(<span class="string">&#x27;connection&#x27;</span>, listener1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定 connection 事件，处理函数为 listener2</span></span><br><span class="line">eventEmitter.on(<span class="string">&#x27;connection&#x27;</span>, listener2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> eventListeners = eventEmitter.listenerCount(<span class="string">&#x27;connection&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(eventListeners + <span class="string">&quot; 个监听器监听连接事件。&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 connection 事件 </span></span><br><span class="line">eventEmitter.emit(<span class="string">&#x27;connection&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除监绑定的 listener1 函数</span></span><br><span class="line">eventEmitter.removeListener(<span class="string">&#x27;connection&#x27;</span>, listener1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;listener1 不再受监听。&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发连接事件</span></span><br><span class="line">eventEmitter.emit(<span class="string">&#x27;connection&#x27;</span>);</span><br><span class="line"></span><br><span class="line">eventListeners = eventEmitter.listenerCount(<span class="string">&#x27;connection&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(eventListeners + <span class="string">&quot; 个监听器监听连接事件。&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕。&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码，执行结果如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">2 个监听器监听连接事件。</span><br><span class="line">监听器 <span class="selector-tag">listener1</span> 执行。</span><br><span class="line">监听器 <span class="selector-tag">listener2</span> 执行。</span><br><span class="line"><span class="selector-tag">listener1</span> 不再受监听。</span><br><span class="line">监听器 <span class="selector-tag">listener2</span> 执行。</span><br><span class="line">1 个监听器监听连接事件。</span><br><span class="line">程序执行完毕。</span><br></pre></td></tr></table></figure>
<h2 id="error-事件"><a href="#error-事件" class="headerlink" title="error 事件"></a>error 事件</h2><p>EventEmitter 定义了一个特殊的事件 <code>error</code>，它包含了错误的语义，我们在遇到 异常的时候通常会触发 error 事件。</p>
<p>当 <code>error</code> 被触发时，EventEmitter 规定如果没有响 应的监听器，Node.js 会把它当作异常，退出程序并输出错误信息。</p>
<p>我们一般要为会触发 error 事件的对象设置监听器，避免遇到错误后整个程序崩溃。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>); </span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> events.EventEmitter(); </span><br><span class="line">emitter.emit(<span class="string">&#x27;error&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>运行时会显示以下错误：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">events</span><span class="selector-class">.js</span><span class="selector-pseudo">:201</span></span><br><span class="line">    throw err; // Unhandled &#x27;error&#x27; event</span><br><span class="line">    ^</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">Error</span> <span class="selector-attr">[ERR_UNHANDLED_ERROR]</span>: <span class="selector-tag">Unhandled</span> <span class="selector-tag">error</span>. (<span class="selector-tag">undefined</span>)</span><br><span class="line">[90m    at EventEmitter.emit (events.js:199:17)[39m</span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Object</span>. (<span class="selector-tag">D</span>:\<span class="selector-tag">myProject</span>\<span class="selector-tag">testComet</span>\<span class="selector-tag">main</span><span class="selector-class">.js</span><span class="selector-pseudo">:3</span><span class="selector-pseudo">:9)</span></span><br><span class="line">[90m    at Module._compile (internal/modules/cjs/loader.js:959:30)[39m</span><br><span class="line">[90m    at Object.Module._extensions..js (internal/modules/cjs/loader.js:995:10)[39m</span><br><span class="line">[90m    at Module.load (internal/modules/cjs/loader.js:815:32)[39m</span><br><span class="line">[90m    at Function.Module._load (internal/modules/cjs/loader.js:727:14)[39m</span><br><span class="line">[90m    at Function.Module.runMain (internal/modules/cjs/loader.js:1047:10)[39m</span><br><span class="line">[90m    at internal/main/run_main_module.js:17:11[39m &#123;</span><br><span class="line">  code: [32m&#x27;ERR_UNHANDLED_ERROR&#x27;[39m,</span><br><span class="line">  context: [90mundefined[39m</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="继承-EventEmitter"><a href="#继承-EventEmitter" class="headerlink" title="继承 EventEmitter"></a>继承 EventEmitter</h2><p>大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它。包括 fs、net、 http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类。</p>
<p>为什么要这样做呢？原因有两点：</p>
<p>首先，具有某个实体功能的对象实现事件符合语义， 事件的监听和发生应该是一个对象的方法。</p>
<p>其次 JavaScript 的对象机制是基于原型的，支持 部分多重继承，继承 EventEmitter 不会打乱对象原有的继承关系。</p>
<h1 id="Node-js-Buffer-缓冲区"><a href="#Node-js-Buffer-缓冲区" class="headerlink" title="Node.js Buffer(缓冲区)"></a>Node.js Buffer(缓冲区)</h1><p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p>
<p>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。</p>
<p>在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。</p>
<blockquote>
<p>v6.0之前创建Buffer对象直接使用<code>new Buffer()</code>构造函数来创建对象实例，但是Buffer对内存的权限操作相比很大，可以直接捕获一些敏感信息，所以在v6.0以后，官方文档里面建议使用 <code>Buffer.from()</code> 接口去创建Buffer对象。</p>
</blockquote>
<h2 id="Buffer-与字符编码"><a href="#Buffer-与字符编码" class="headerlink" title="Buffer 与字符编码"></a>Buffer 与字符编码</h2><p>Buffer 实例一般用于表示编码字符的序列，比如 UTF-8 、 UCS2 、 Base64 、或十六进制编码的数据。 通过使用显式的字符编码，就可以在 Buffer 实例与普通的 JavaScript 字符串之间进行相互转换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = Buffer.from(<span class="string">&#x27;mybj&#x27;</span>, <span class="string">&#x27;ascii&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 6d79626a</span></span><br><span class="line"><span class="built_in">console</span>.log(buf.toString(<span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 bXliag==</span></span><br><span class="line"><span class="built_in">console</span>.log(buf.toString(<span class="string">&#x27;base64&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><strong>Node.js 目前支持的字符编码包括：</strong></p>
<ul>
<li><strong>ascii</strong> – 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。</li>
<li><strong>utf8</strong> – 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。</li>
<li><strong>utf16le</strong> – 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。</li>
<li><strong>ucs2</strong> – <strong>utf16le</strong> 的别名。</li>
<li><strong>base64</strong> – Base64 编码。</li>
<li><strong>latin1</strong> – 一种把 <strong>Buffer</strong> 编码成一字节编码的字符串的方式。</li>
<li><strong>binary</strong> – <strong>latin1</strong> 的别名。</li>
<li><strong>hex</strong> – 将每个字节编码为两个十六进制字符。</li>
</ul>
<h2 id="创建-Buffer-类"><a href="#创建-Buffer-类" class="headerlink" title="创建 Buffer 类"></a>创建 Buffer 类</h2><p>Buffer 提供了以下 API 来创建 Buffer 类：</p>
<ul>
<li><strong>Buffer.alloc(size[, fill[, encoding]])：</strong> 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0</li>
<li><strong>Buffer.allocUnsafe(size)：</strong> 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据</li>
<li><strong>Buffer.allocUnsafeSlow(size)</strong></li>
<li><strong>Buffer.from(array)：</strong> 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）</li>
<li><strong>Buffer.from(arrayBuffer[, byteOffset[, length]])：</strong> 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。</li>
<li><strong>Buffer.from(buffer)：</strong> 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例</li>
<li><strong>Buffer.from(string[, encoding])：</strong> 返回一个被 string 的值初始化的新的 Buffer 实例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个长度为 10、且用 0 填充的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf1 = Buffer.alloc(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个长度为 10、且用 0x1 填充的 Buffer。 </span></span><br><span class="line"><span class="keyword">const</span> buf2 = Buffer.alloc(<span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个长度为 10、且未初始化的 Buffer。</span></span><br><span class="line"><span class="comment">// 这个方法比调用 Buffer.alloc() 更快，</span></span><br><span class="line"><span class="comment">// 但返回的 Buffer 实例可能包含旧数据，</span></span><br><span class="line"><span class="comment">// 因此需要使用 fill() 或 write() 重写。</span></span><br><span class="line"><span class="keyword">const</span> buf3 = Buffer.allocUnsafe(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 [0x1, 0x2, 0x3] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf4 = Buffer.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 UTF-8 字节 [0x74, 0xc3, 0xa9, 0x73, 0x74] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf5 = Buffer.from(<span class="string">&#x27;tést&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 Latin-1 字节 [0x74, 0xe9, 0x73, 0x74] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf6 = Buffer.from(<span class="string">&#x27;tést&#x27;</span>, <span class="string">&#x27;latin1&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="写入缓冲区"><a href="#写入缓冲区" class="headerlink" title="写入缓冲区"></a>写入缓冲区</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>写入 Node 缓冲区的语法如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.write(string[, offset[, length]][, encoding])</span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>string</strong> – 写入缓冲区的字符串。</li>
<li><strong>offset</strong> – 缓冲区开始写入的索引值，默认为 0 。</li>
<li><strong>length</strong> – 写入的字节数，默认为 buffer.length</li>
<li><strong>encoding</strong> – 使用的编码。默认为 ‘utf8’ 。</li>
</ul>
<p>根据 encoding 的字符编码写入 string 到 buf 中的 offset 位置。 length 参数是写入的字节数。 如果 buf 没有足够的空间保存整个字符串，则只会写入 string 的一部分。 只部分解码的字符不会被写入。</p>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>返回实际写入的大小。如果 buffer 空间不足， 则只会写入部分字符串。</p>
<h3 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buf = Buffer.alloc(<span class="number">256</span>);</span><br><span class="line">len = buf.write(<span class="string">&quot;www.mybj123.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;写入字节数 : &quot;</span>+  len);</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">写入字节数 : 15</span><br></pre></td></tr></table></figure>
<h2 id="从缓冲区读取数据"><a href="#从缓冲区读取数据" class="headerlink" title="从缓冲区读取数据"></a>从缓冲区读取数据</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><p>读取 Node 缓冲区数据的语法如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.toString</span>(<span class="selector-attr">[encoding[, start[, end]</span>]])</span><br></pre></td></tr></table></figure>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>encoding</strong> – 使用的编码。默认为 ‘utf8’ 。</li>
<li><strong>start</strong> – 指定开始读取的索引位置，默认为 0。</li>
<li><strong>end</strong> – 结束位置，默认为缓冲区的末尾。</li>
</ul>
<h3 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h3><p>解码缓冲区数据并使用指定的编码返回字符串。</p>
<h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buf = Buffer.alloc(<span class="number">26</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++) &#123;</span><br><span class="line">  buf[i] = i + <span class="number">97</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( buf.toString(<span class="string">&#x27;ascii&#x27;</span>));       <span class="comment">// 输出: abcdefghijklmnopqrstuvwxyz</span></span><br><span class="line"><span class="built_in">console</span>.log( buf.toString(<span class="string">&#x27;ascii&#x27;</span>,<span class="number">0</span>,<span class="number">5</span>));   <span class="comment">//使用 &#x27;ascii&#x27; 编码, 并输出: abcde</span></span><br><span class="line"><span class="built_in">console</span>.log( buf.toString(<span class="string">&#x27;utf8&#x27;</span>,<span class="number">0</span>,<span class="number">5</span>));    <span class="comment">// 使用 &#x27;utf8&#x27; 编码, 并输出: abcde</span></span><br><span class="line"><span class="built_in">console</span>.log( buf.toString(<span class="literal">undefined</span>,<span class="number">0</span>,<span class="number">5</span>)); <span class="comment">// 使用默认的 &#x27;utf8&#x27; 编码, 并输出: abcde</span></span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line"><span class="selector-tag">abcdefghijklmnopqrstuvwxyz</span></span><br><span class="line"><span class="selector-tag">abcde</span></span><br><span class="line"><span class="selector-tag">abcde</span></span><br><span class="line"><span class="selector-tag">abcde</span></span><br></pre></td></tr></table></figure>
<h2 id="将-Buffer-转换为-JSON-对象"><a href="#将-Buffer-转换为-JSON-对象" class="headerlink" title="将 Buffer 转换为 JSON 对象"></a>将 Buffer 转换为 JSON 对象</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p>将 Node Buffer 转换为 JSON 对象的函数语法格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.toJSON</span>()</span><br></pre></td></tr></table></figure>
<p>当字符串化一个 Buffer 实例时，<code>JSON.stringify()</code> 会隐式地调用该 <code>toJSON()</code>。</p>
<h3 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h3><p>返回 JSON 对象。</p>
<h3 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = Buffer.from([<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0x5</span>]);</span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(buf);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出: &#123;&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[1,2,3,4,5]&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(json);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copy = <span class="built_in">JSON</span>.parse(json, <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &amp;&amp; value.type === <span class="string">&#x27;Buffer&#x27;</span> ?</span><br><span class="line">    Buffer.from(value.data) :</span><br><span class="line">    value;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出: </span></span><br><span class="line"><span class="built_in">console</span>.log(copy);</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Buffer&quot;</span>,<span class="string">&quot;data&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;</span><br><span class="line">&lt;Buffer <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span>&gt;</span><br></pre></td></tr></table></figure>
<h2 id="缓冲区合并"><a href="#缓冲区合并" class="headerlink" title="缓冲区合并"></a>缓冲区合并</h2><h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><p>Node 缓冲区合并的语法如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Buffer</span><span class="selector-class">.concat</span>(<span class="selector-tag">list</span><span class="selector-attr">[, totalLength]</span>)</span><br></pre></td></tr></table></figure>
<h3 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>list</strong> – 用于合并的 Buffer 对象数组列表。</li>
<li><strong>totalLength</strong> – 指定合并后Buffer对象的总长度。</li>
</ul>
<h3 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h3><p>返回一个多个成员合并的新 Buffer 对象。</p>
<h3 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer1 = Buffer.from((<span class="string">&#x27;码云笔记&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> buffer2 = Buffer.from((<span class="string">&#x27;www.mybj123.com&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> buffer3 = Buffer.concat([buffer1,buffer2]);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;buffer3 内容: &quot;</span> + buffer3.toString());</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buffer3</span> 内容: 码云笔记<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<h2 id="缓冲区比较"><a href="#缓冲区比较" class="headerlink" title="缓冲区比较"></a>缓冲区比较</h2><h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><p>Node Buffer 比较的函数语法如下所示, 该方法在 Node.js v0.12.2 版本引入：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.compare</span>(<span class="selector-tag">otherBuffer</span>);</span><br></pre></td></tr></table></figure>
<h3 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>otherBuffer</strong> – 与 <strong>buf</strong> 对象比较的另外一个 Buffer 对象。</li>
</ul>
<h3 id="返回值-4"><a href="#返回值-4" class="headerlink" title="返回值"></a>返回值</h3><p>返回一个数字，表示 <strong>buf</strong> 在 <strong>otherBuffer</strong> 之前，之后或相同。</p>
<h3 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer1 = Buffer.from(<span class="string">&#x27;ABC&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> buffer2 = Buffer.from(<span class="string">&#x27;ABCD&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> result = buffer1.compare(buffer2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(result &lt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(buffer1 + <span class="string">&quot; 在 &quot;</span> + buffer2 + <span class="string">&quot;之前&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(result == <span class="number">0</span>)&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(buffer1 + <span class="string">&quot; 与 &quot;</span> + buffer2 + <span class="string">&quot;相同&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(buffer1 + <span class="string">&quot; 在 &quot;</span> + buffer2 + <span class="string">&quot;之后&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ABC</span>在<span class="selector-tag">ABCD</span>之前</span><br></pre></td></tr></table></figure>
<h2 id="拷贝缓冲区"><a href="#拷贝缓冲区" class="headerlink" title="拷贝缓冲区"></a>拷贝缓冲区</h2><h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><p>Node 缓冲区拷贝语法如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.copy</span>(<span class="selector-tag">targetBuffer</span><span class="selector-attr">[, targetStart[, sourceStart[, sourceEnd]</span>]])</span><br></pre></td></tr></table></figure>
<h3 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>targetBuffer</strong> – 要拷贝的 Buffer 对象。</li>
<li><strong>targetStart</strong> – 数字, 可选, 默认: 0</li>
<li><strong>sourceStart</strong> – 数字, 可选, 默认: 0</li>
<li><strong>sourceEnd</strong> – 数字, 可选, 默认: buffer.length</li>
</ul>
<h3 id="返回值-5"><a href="#返回值-5" class="headerlink" title="返回值"></a>返回值</h3><p>没有返回值。</p>
<h3 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf1 = Buffer.from(<span class="string">&#x27;abcdefghijkl&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> buf2 = Buffer.from(<span class="string">&#x27;RMYBJ123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将 buf2 插入到 buf1 指定位置上</span></span><br><span class="line">buf2.copy(buf1, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(buf1.toString());</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">abMYBJ123jkl</span></span><br></pre></td></tr></table></figure>
<h2 id="缓冲区裁剪"><a href="#缓冲区裁剪" class="headerlink" title="缓冲区裁剪"></a>缓冲区裁剪</h2><p>Node 缓冲区裁剪语法如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.slice</span>(<span class="selector-attr">[start[, end]</span>])</span><br></pre></td></tr></table></figure>
<h3 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h3><p>参数描述如下：</p>
<ul>
<li><strong>start</strong> – 数字, 可选, 默认: 0</li>
<li><strong>end</strong> – 数字, 可选, 默认: buffer.length</li>
</ul>
<h3 id="返回值-6"><a href="#返回值-6" class="headerlink" title="返回值"></a>返回值</h3><p>返回一个新的缓冲区，它和旧缓冲区指向同一块内存，但是从索引 start 到 end 的位置剪切。</p>
<h3 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer1 = Buffer.from(<span class="string">&#x27;mybj123&#x27;</span>);</span><br><span class="line"><span class="comment">// 剪切缓冲区</span></span><br><span class="line"><span class="keyword">const</span> buffer2 = buffer1.slice(<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;buffer2 content: &quot;</span> + buffer2.toString());</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buffer2</span> <span class="selector-tag">content</span>: <span class="selector-tag">my</span></span><br></pre></td></tr></table></figure>
<h2 id="缓冲区长度"><a href="#缓冲区长度" class="headerlink" title="缓冲区长度"></a>缓冲区长度</h2><h3 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h3><p>Node 缓冲区长度计算语法如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buf</span><span class="selector-class">.length</span>;</span><br></pre></td></tr></table></figure>
<h3 id="返回值-7"><a href="#返回值-7" class="headerlink" title="返回值"></a>返回值</h3><p>返回 Buffer 对象所占据的内存长度。</p>
<h3 id="实例-9"><a href="#实例-9" class="headerlink" title="实例"></a>实例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffer = Buffer.from(<span class="string">&#x27;www.mybj123.com&#x27;</span>);</span><br><span class="line"><span class="comment">//  缓冲区长度</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;buffer length: &quot;</span> + buffer.length);</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">buffer</span> <span class="selector-tag">length</span>: 15</span><br></pre></td></tr></table></figure>
<h2 id="方法参考手册"><a href="#方法参考手册" class="headerlink" title="方法参考手册"></a>方法参考手册</h2><p>以下列出了 Node.js Buffer 模块常用的方法（注意有些方法在旧版本是没有的）：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>new Buffer(size)</strong> 分配一个新的 size 大小单位为8位字节的 buffer。 注意, size 必须小于 kMaxLength，否则，将会抛出异常 RangeError。废弃的: 使用 Buffer.alloc() 代替（或 Buffer.allocUnsafe()）。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>new Buffer(buffer)</strong> 拷贝参数 buffer 的数据到 Buffer 实例。废弃的: 使用 Buffer.from(buffer) 代替。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>new Buffer(str[, encoding])</strong> 分配一个新的 buffer ，其中包含着传入的 str 字符串。 encoding 编码方式默认为 ‘utf8’。 废弃的: 使用 Buffer.from(string[, encoding]) 代替。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>buf.length</strong> 返回这个 buffer 的 bytes 数。注意这未必是 buffer 里面内容的大小。length 是 buffer 对象所分配的内存数，它不会随着这个 buffer 对象内容的改变而改变。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>buf.write(string[, offset[, length]][, encoding])</strong> 根据参数 offset 偏移量和指定的 encoding 编码方式，将参数 string 数据写入buffer。 offset 偏移量默认值是 0, encoding 编码方式默认是 utf8。 length 长度是将要写入的字符串的 bytes 大小。 返回 number 类型，表示写入了多少 8 位字节流。如果 buffer 没有足够的空间来放整个 string，它将只会只写入部分字符串。 length 默认是 buffer.length – offset。 这个方法不会出现写入部分字符。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>buf.writeUIntLE(value, offset, byteLength[, noAssert])</strong> 将 value 写入到 buffer 里， 它由 offset 和 byteLength 决定，最高支持 48 位无符号整数，小端对齐，例如：<code>const buf = Buffer.allocUnsafe(6); buf.writeUIntLE(0x1234567890ab, 0, 6); // 输出:  console.log(buf);</code>noAssert 值为 true 时，不再验证 value 和 offset 的有效性。 默认是 false。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>buf.writeUIntBE(value, offset, byteLength[, noAssert])</strong> 将 value 写入到 buffer 里， 它由 offset 和 byteLength 决定，最高支持 48 位无符号整数，大端对齐。noAssert 值为 true 时，不再验证 value 和 offset 的有效性。 默认是 false。<code>const buf = Buffer.allocUnsafe(6); buf.writeUIntBE(0x1234567890ab, 0, 6); // 输出:  console.log(buf);</code></td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>buf.writeIntLE(value, offset, byteLength[, noAssert])</strong> 将value 写入到 buffer 里， 它由offset 和 byteLength 决定，最高支持48位有符号整数，小端对齐。noAssert 值为 true 时，不再验证 value 和 offset 的有效性。 默认是 false。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>buf.writeIntBE(value, offset, byteLength[, noAssert])</strong> 将value 写入到 buffer 里， 它由offset 和 byteLength 决定，最高支持48位有符号整数，大端对齐。noAssert 值为 true 时，不再验证 value 和 offset 的有效性。 默认是 false。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>buf.readUIntLE(offset, byteLength[, noAssert])</strong> 支持读取 48 位以下的无符号数字，小端对齐。noAssert 值为 true 时， offset 不再验证是否超过 buffer 的长度，默认为 false。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>buf.readUIntBE(offset, byteLength[, noAssert])</strong> 支持读取 48 位以下的无符号数字，大端对齐。noAssert 值为 true 时， offset 不再验证是否超过 buffer 的长度，默认为 false。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>buf.readIntLE(offset, byteLength[, noAssert])</strong> 支持读取 48 位以下的有符号数字，小端对齐。noAssert 值为 true 时， offset 不再验证是否超过 buffer 的长度，默认为 false。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>buf.readIntBE(offset, byteLength[, noAssert])</strong> 支持读取 48 位以下的有符号数字，大端对齐。noAssert 值为 true 时， offset 不再验证是否超过 buffer 的长度，默认为 false。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>buf.toString([encoding[, start[, end]]])</strong> 根据 encoding 参数（默认是 ‘utf8’）返回一个解码过的 string 类型。还会根据传入的参数 start (默认是 0) 和 end (默认是 buffer.length)作为取值范围。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><strong>buf.toJSON()</strong> 将 Buffer 实例转换为 JSON 对象。</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><strong>buf[index]</strong> 获取或设置指定的字节。返回值代表一个字节，所以返回值的合法范围是十六进制0x00到0xFF 或者十进制0至 255。</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><strong>buf.equals(otherBuffer)</strong> 比较两个缓冲区是否相等，如果是返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><strong>buf.compare(otherBuffer)</strong> 比较两个 Buffer 对象，返回一个数字，表示 buf 在 otherBuffer 之前，之后或相同。</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><strong>buf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]])</strong> buffer 拷贝，源和目标可以相同。 targetStart 目标开始偏移和 sourceStart 源开始偏移默认都是 0。 sourceEnd 源结束位置偏移默认是源的长度 buffer.length 。</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><strong>buf.slice([start[, end]])</strong> 剪切 Buffer 对象，根据 start(默认是 0 ) 和 end (默认是 buffer.length ) 偏移和裁剪了索引。 负的索引是从 buffer 尾部开始计算的。</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><strong>buf.readUInt8(offset[, noAssert])</strong> 根据指定的偏移量，读取一个无符号 8 位整数。若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 如果这样 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><strong>buf.readUInt16LE(offset[, noAssert])</strong> 根据指定的偏移量，使用特殊的 endian 字节序格式读取一个无符号 16 位整数。若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出 buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><strong>buf.readUInt16BE(offset[, noAssert])</strong> 根据指定的偏移量，使用特殊的 endian 字节序格式读取一个无符号 16 位整数，大端对齐。若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出 buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><strong>buf.readUInt32LE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个无符号 32 位整数，小端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><strong>buf.readUInt32BE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个无符号 32 位整数，大端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left"><strong>buf.readInt8(offset[, noAssert])</strong> 根据指定的偏移量，读取一个有符号 8 位整数。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出 buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><strong>buf.readInt16LE(offset[, noAssert])</strong> 根据指定的偏移量，使用特殊的 endian 格式读取一个 有符号 16 位整数，小端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出 buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><strong>buf.readInt16BE(offset[, noAssert])</strong> 根据指定的偏移量，使用特殊的 endian 格式读取一个 有符号 16 位整数，大端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出 buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left"><strong>buf.readInt32LE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个有符号 32 位整数，小端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><strong>buf.readInt32BE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个有符号 32 位整数，大端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">31</td>
<td align="left"><strong>buf.readFloatLE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个 32 位双浮点数，小端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">32</td>
<td align="left"><strong>buf.readFloatBE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian 字节序格式读取一个 32 位双浮点数，大端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">33</td>
<td align="left"><strong>buf.readDoubleLE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian字节序格式读取一个 64 位双精度数，小端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">34</td>
<td align="left"><strong>buf.readDoubleBE(offset[, noAssert])</strong> 根据指定的偏移量，使用指定的 endian字节序格式读取一个 64 位双精度数，大端对齐。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 offset 可能会超出buffer 的末尾。默认是 false。</td>
</tr>
<tr>
<td align="left">35</td>
<td align="left"><strong>buf.writeUInt8(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量将 value 写入 buffer。注意：value 必须是一个合法的无符号 8 位整数。 若参数 noAssert 为 true 将不会验证 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">36</td>
<td align="left"><strong>buf.writeUInt16LE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的无符号 16 位整数，小端对齐。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出buffer的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">37</td>
<td align="left"><strong>buf.writeUInt16BE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的无符号 16 位整数，大端对齐。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出buffer的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">38</td>
<td align="left"><strong>buf.writeUInt32LE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式(LITTLE-ENDIAN:小字节序)将 value 写入buffer。注意：value 必须是一个合法的无符号 32 位整数，小端对齐。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着value 可能过大，或者offset可能会超出buffer的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">39</td>
<td align="left"><strong>buf.writeUInt32BE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式(Big-Endian:大字节序)将 value 写入buffer。注意：value 必须是一个合法的有符号 32 位整数。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者offset可能会超出buffer的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left"><strong>buf.writeInt8(value, offset[, noAssert])</strong>&lt;br根据传入的 offset=”” 偏移量将=”” value=”” 写入=”” buffer=”” 。注意：value=”” 必须是一个合法的=”” signed=”” 8=”” 位整数。=”” 若参数=”” noassert=”” 为=”” true=”” 将不会验证=”” 和=”” 偏移量参数。=”” 这意味着=”” 可能过大，或者=”” 可能会超出=”” 的末尾从而造成=”” 被丢弃。=”” 除非你对这个参数非常有把握，否则尽量不要使用。默认是=”” false。&lt;=”” td=””&gt;&lt;/br根据传入的&gt;</td>
</tr>
<tr>
<td align="left">41</td>
<td align="left"><strong>buf.writeInt16LE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的 signed 16 位整数。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false 。</td>
</tr>
<tr>
<td align="left">42</td>
<td align="left"><strong>buf.writeInt16BE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的 signed 16 位整数。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false 。</td>
</tr>
<tr>
<td align="left">43</td>
<td align="left"><strong>buf.writeInt32LE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的 signed 32 位整数。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">44</td>
<td align="left"><strong>buf.writeInt32BE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个合法的 signed 32 位整数。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">45</td>
<td align="left"><strong>buf.writeFloatLE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer 。注意：当 value 不是一个 32 位浮点数类型的值时，结果将是不确定的。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">46</td>
<td align="left"><strong>buf.writeFloatBE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer 。注意：当 value 不是一个 32 位浮点数类型的值时，结果将是不确定的。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value可能过大，或者 offset 可能会超出 buffer 的末尾从而造成 value 被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">47</td>
<td align="left"><strong>buf.writeDoubleLE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个有效的 64 位double 类型的值。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成value被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">48</td>
<td align="left"><strong>buf.writeDoubleBE(value, offset[, noAssert])</strong> 根据传入的 offset 偏移量和指定的 endian 格式将 value 写入 buffer。注意：value 必须是一个有效的 64 位double 类型的值。 若参数 noAssert 为 true 将不会验证 value 和 offset 偏移量参数。 这意味着 value 可能过大，或者 offset 可能会超出 buffer 的末尾从而造成value被丢弃。 除非你对这个参数非常有把握，否则尽量不要使用。默认是 false。</td>
</tr>
<tr>
<td align="left">49</td>
<td align="left"><strong>buf.fill(value[, offset][, end])</strong> 使用指定的 value 来填充这个 buffer。如果没有指定 offset (默认是 0) 并且 end (默认是 buffer.length) ，将会填充整个buffer。</td>
</tr>
</tbody></table>
<h1 id="Node-js-Stream-流"><a href="#Node-js-Stream-流" class="headerlink" title="Node.js Stream(流)"></a>Node.js Stream(流)</h1><p>Stream 是一个抽象接口，Node 中有很多对象实现了这个接口。例如，对http 服务器发起请求的request 对象就是一个 Stream，还有stdout（标准输出）。</p>
<p>Node.js，Stream 有四种流类型：</p>
<ul>
<li><strong>Readable</strong> – 可读操作。</li>
<li><strong>Writable</strong> – 可写操作。</li>
<li><strong>Duplex</strong> – 可读可写操作.</li>
<li><strong>Transform</strong> – 操作被写入数据，然后读出结果。</li>
</ul>
<p>所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有：</p>
<ul>
<li><strong>data</strong> – 当有数据可读时触发。</li>
<li><strong>end</strong> – 没有更多的数据可读时触发。</li>
<li><strong>error</strong> – 在接收和写入过程中发生错误时触发。</li>
<li><strong>finish</strong> – 所有数据已被写入到底层系统时触发。</li>
</ul>
<p>本教程会为大家介绍常用的流操作。</p>
<h2 id="从流中读取数据"><a href="#从流中读取数据" class="headerlink" title="从流中读取数据"></a>从流中读取数据</h2><p>创建 input.txt 文件，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<p>创建 main.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">const</span> readerStream = fs.createReadStream(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置编码为 utf8。</span></span><br><span class="line">readerStream.setEncoding(<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">readerStream.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">   data += chunk;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readerStream.on(<span class="string">&#x27;end&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readerStream.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">程序执行完毕</span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<h2 id="写入流"><a href="#写入流" class="headerlink" title="写入流"></a>写入流</h2><p>创建 main.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="string">&#x27;码云笔记官网地址：www.mybj123.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></span><br><span class="line"><span class="keyword">const</span> writerStream = fs.createWriteStream(<span class="string">&#x27;output.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 utf8 编码写入数据</span></span><br><span class="line">writerStream.write(data,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标记文件末尾</span></span><br><span class="line">writerStream.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; finish、error</span></span><br><span class="line">writerStream.on(<span class="string">&#x27;finish&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入完成。&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">writerStream.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上程序会将 data 变量的数据写入到 output.txt 文件中。代码执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span> </span><br><span class="line">程序执行完毕</span><br><span class="line">写入完成。</span><br></pre></td></tr></table></figure>
<p>查看 output.txt 文件的内容：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">output</span><span class="selector-class">.txt</span> </span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
<h2 id="管道流"><a href="#管道流" class="headerlink" title="管道流"></a>管道流</h2><p>管道提供了一个输出流到输入流的机制。通常我们用于从一个流中获取数据并将数据传递到另外一个流中。</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="管道流"></p>
<p>如上面的图片所示，我们把文件比作装水的桶，而水就是文件里的内容，我们用一根管子(pipe)连接两个桶使得水从一个桶流入另一个桶，这样就慢慢的实现了大文件的复制过程。</p>
<p>以下实例我们通过读取一个文件内容并将内容写入到另外一个文件中。</p>
<p>设置 input.txt 文件内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br><span class="line">管道流操作实例</span><br></pre></td></tr></table></figure>
<p>创建 main.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">const</span> readerStream = fs.createReadStream(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">const</span> writerStream = fs.createWriteStream(<span class="string">&#x27;output.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管道读写操作</span></span><br><span class="line"><span class="comment">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中</span></span><br><span class="line">readerStream.pipe(writerStream);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>代码执行结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">main</span><span class="selector-class">.js</span> </span><br><span class="line">程序执行完毕</span><br></pre></td></tr></table></figure>
<p>查看 output.txt 文件的内容：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">output</span><span class="selector-class">.txt</span> </span><br><span class="line">码云笔记官网地址：<span class="selector-tag">www</span><span class="selector-class">.mybj123</span><span class="selector-class">.com</span></span><br><span class="line">管道流操作实例</span><br></pre></td></tr></table></figure>
<h2 id="链式流"><a href="#链式流" class="headerlink" title="链式流"></a>链式流</h2><p>链式是通过连接输出流到另外一个流并创建多个流操作链的机制。链式流一般用于管道操作。</p>
<p>接下来我们就是用管道和链式来压缩和解压文件。</p>
<p>创建 compress.js 文件, 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class="line">fs.createReadStream(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">  .pipe(zlib.createGzip())</span><br><span class="line">  .pipe(fs.createWriteStream(<span class="string">&#x27;input.txt.gz&#x27;</span>));</span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;文件压缩完成。&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node compress.js </span><br><span class="line">文件压缩完成。</span><br></pre></td></tr></table></figure>
<p>执行完以上操作后，我们可以看到当前目录下生成了 input.txt 的压缩文件 input.txt.gz。</p>
<p>接下来，让我们来解压该文件，创建 decompress.js 文件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class="line">fs.createReadStream(<span class="string">&#x27;input.txt.gz&#x27;</span>)</span><br><span class="line">  .pipe(zlib.createGunzip())</span><br><span class="line">  .pipe(fs.createWriteStream(<span class="string">&#x27;input.txt&#x27;</span>));</span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;文件解压完成。&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node decompress.js </span><br><span class="line">文件解压完成。</span><br></pre></td></tr></table></figure>
<h1 id="Node-js的模块系统"><a href="#Node-js的模块系统" class="headerlink" title="Node.js的模块系统"></a>Node.js的模块系统</h1><p>为了让Node.js的文件可以相互调用，Node.js提供了一个简单的模块系统。</p>
<p>模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个 Node.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p>
<h2 id="创建模块-1"><a href="#创建模块-1" class="headerlink" title="创建模块"></a>创建模块</h2><p>在 Node.js 中，创建一个模块非常简单，如下我们创建一个 main.js 文件，代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hello = <span class="built_in">require</span>(<span class="string">&#x27;./hello&#x27;</span>);</span><br><span class="line">hello.world();</span><br></pre></td></tr></table></figure>
<p>以上实例中，代码 <code>require(&#39;./hello&#39;)</code> 引入了当前目录下的 <code>hello.js</code> 文件（<code>./</code> 为当前目录，node.js 默认后缀为 js）。</p>
<p>Node.js 提供了 <code>exports</code> 和 <code>require</code> 两个对象，其中 <code>exports</code> 是模块公开的接口，<code>require</code> 用于从外部获取一个模块的接口，即所获取模块的 <code>exports</code> 对象。</p>
<p>接下来我们就来创建 hello.js 文件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.world = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以上示例中，hello.js 通过 <code>exports</code> 对象把 <code>world</code> 作为模块的访问接口，在 main.js 中通过 <code>require(&#39;./hello&#39;)</code> 加载这个模块，然后就可以直接访 问 hello.js 中 <code>exports</code> 对象的成员函数了。</p>
<p>有时候我们只是想把一个对象封装到模块中，格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello.js </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> name; </span><br><span class="line">    <span class="built_in">this</span>.setName = <span class="function"><span class="keyword">function</span>(<span class="params">thyName</span>) </span>&#123; </span><br><span class="line">        name = thyName; </span><br><span class="line">    &#125;; </span><br><span class="line">    <span class="built_in">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Hello &#x27;</span> + name); </span><br><span class="line">    &#125;; </span><br><span class="line">&#125;; </span><br><span class="line"><span class="built_in">module</span>.exports = Hello;</span><br></pre></td></tr></table></figure>
<p>这样就可以直接获得这个对象了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.js </span></span><br><span class="line"><span class="keyword">var</span> Hello = <span class="built_in">require</span>(<span class="string">&#x27;./hello&#x27;</span>); </span><br><span class="line">hello = <span class="keyword">new</span> Hello(); </span><br><span class="line">hello.setName(<span class="string">&#x27;BYMybj&#x27;</span>); </span><br><span class="line">hello.sayHello();</span><br></pre></td></tr></table></figure>
<p>模块接口的唯一变化是使用 <code>module.exports = Hello</code> 代替了<code>exports.world = function()&#123;&#125;</code>。 在外部引用该模块时，其接口对象就是要输出的 <code>Hello</code> 对象本身，而不是原先的 <code>exports</code>。</p>
<h2 id="服务端的模块放在哪里"><a href="#服务端的模块放在哪里" class="headerlink" title="服务端的模块放在哪里"></a>服务端的模块放在哪里</h2><p>也许你已经注意到，我们已经在代码中使用了模块了。像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">http.createServer(...);</span><br></pre></td></tr></table></figure>
<p>Node.js 中自带了一个叫做 <strong>http</strong> 的模块，我们在我们的代码中请求它并把返回值赋给一个本地变量。</p>
<p>这把我们的本地变量变成了一个拥有所有 http 模块所提供的公共方法的对象。</p>
<p>Node.js 的 require 方法中的文件查找策略如下：</p>
<p>由于 Node.js 中存在 4 类模块（原生模块和3种文件模块），尽管 require 方法极其简单，但是内部的加载却是十分复杂的，其加载优先级也各自不同。如下图所示：</p>
<p><img src="C:\Users\52862\AppData\Roaming\Typora\typora-user-images\image-20201215172247049.png" alt="image-20201215172247049"></p>
<h3 id="从文件模块缓存中加载"><a href="#从文件模块缓存中加载" class="headerlink" title="从文件模块缓存中加载"></a>从文件模块缓存中加载</h3><p>尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块。</p>
<h3 id="从原生模块加载"><a href="#从原生模块加载" class="headerlink" title="从原生模块加载"></a>从原生模块加载</h3><p>原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个 <code>http/http.js/http.node/http.json</code> 文件，<code>require(&quot;http&quot;)</code> 都不会从这些文件中加载，而是从原生模块中加载。</p>
<p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p>
<h3 id="从文件加载"><a href="#从文件加载" class="headerlink" title="从文件加载"></a>从文件加载</h3><p>当文件模块缓存中不存在，而且不是原生模块的时候，Node.js 会解析 <code>require</code> 方法传入的参数，并从文件系统中加载实际的文件，加载过程中的包装和编译细节在前一节中已经介绍过，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。</p>
<p>require方法接受以下几种参数的传递：</p>
<ul>
<li><code>http</code>、<code>fs</code>、<code>path</code>等，原生模块。</li>
<li><code>./mod</code> 或 <code>../mod</code>，相对路径的文件模块。</li>
<li><code>/pathtomodule/mod</code>，绝对路径的文件模块。</li>
<li><code>mod</code>，非原生模块的文件模块。</li>
</ul>
<p>在路径 <code>Y</code> 下执行 <code>require(X)</code> 语句执行顺序：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1. 如果 <span class="selector-tag">X</span> 是内置模块</span><br><span class="line">   <span class="selector-tag">a</span>. 返回内置模块</span><br><span class="line">   <span class="selector-tag">b</span>. 停止执行</span><br><span class="line">2. 如果 X 以 &#x27;/&#x27; 开头</span><br><span class="line">   <span class="selector-tag">a</span>. 设置 <span class="selector-tag">Y</span> 为文件根路径</span><br><span class="line">3. 如果 X 以 &#x27;./&#x27; 或 &#x27;/&#x27; or &#x27;../&#x27; 开头</span><br><span class="line">   <span class="selector-tag">a</span>. <span class="selector-tag">LOAD_AS_FILE</span>(<span class="selector-tag">Y</span> + <span class="selector-tag">X</span>)</span><br><span class="line">   <span class="selector-tag">b</span>. <span class="selector-tag">LOAD_AS_DIRECTORY</span>(<span class="selector-tag">Y</span> + <span class="selector-tag">X</span>)</span><br><span class="line">4. <span class="selector-tag">LOAD_NODE_MODULES</span>(<span class="selector-tag">X</span>, <span class="selector-tag">dirname</span>(<span class="selector-tag">Y</span>))</span><br><span class="line">5. 抛出异常 &quot;<span class="selector-tag">not</span> <span class="selector-tag">found</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LOAD_AS_FILE</span>(<span class="selector-tag">X</span>)</span><br><span class="line">1. 如果 <span class="selector-tag">X</span> 是一个文件, 将 <span class="selector-tag">X</span> 作为 <span class="selector-tag">JavaScript</span> 文本载入并停止执行。</span><br><span class="line">2. 如果 <span class="selector-tag">X</span><span class="selector-class">.js</span> 是一个文件, 将 <span class="selector-tag">X</span><span class="selector-class">.js</span> 作为 <span class="selector-tag">JavaScript</span> 文本载入并停止执行。</span><br><span class="line">3. 如果 <span class="selector-tag">X</span><span class="selector-class">.json</span> 是一个文件, 解析 <span class="selector-tag">X</span><span class="selector-class">.json</span> 为 <span class="selector-tag">JavaScript</span> 对象并停止执行。</span><br><span class="line">4. 如果 <span class="selector-tag">X</span><span class="selector-class">.node</span> 是一个文件, 将 <span class="selector-tag">X</span><span class="selector-class">.node</span> 作为二进制插件载入并停止执行。</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LOAD_INDEX</span>(<span class="selector-tag">X</span>)</span><br><span class="line">1. 如果 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.js</span> 是一个文件,  将 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.js</span> 作为 <span class="selector-tag">JavaScript</span> 文本载入并停止执行。</span><br><span class="line">2. 如果 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.json</span> 是一个文件, 解析 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.json</span> 为 <span class="selector-tag">JavaScript</span> 对象并停止执行。</span><br><span class="line">3. 如果 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.node</span> 是一个文件,  将 <span class="selector-tag">X</span>/<span class="selector-tag">index</span><span class="selector-class">.node</span> 作为二进制插件载入并停止执行。</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LOAD_AS_DIRECTORY</span>(<span class="selector-tag">X</span>)</span><br><span class="line">1. 如果 <span class="selector-tag">X</span>/<span class="selector-tag">package</span><span class="selector-class">.json</span> 是一个文件,</span><br><span class="line">   <span class="selector-tag">a</span>. 解析 <span class="selector-tag">X</span>/<span class="selector-tag">package</span><span class="selector-class">.json</span>, 并查找 &quot;<span class="selector-tag">main</span>&quot; 字段。</span><br><span class="line">   b. let M = X + (json main 字段)</span><br><span class="line">   <span class="selector-tag">c</span>. <span class="selector-tag">LOAD_AS_FILE</span>(<span class="selector-tag">M</span>)</span><br><span class="line">   <span class="selector-tag">d</span>. <span class="selector-tag">LOAD_INDEX</span>(<span class="selector-tag">M</span>)</span><br><span class="line">2. <span class="selector-tag">LOAD_INDEX</span>(<span class="selector-tag">X</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">LOAD_NODE_MODULES</span>(<span class="selector-tag">X</span>, <span class="selector-tag">START</span>)</span><br><span class="line">1. let DIRS=NODE_MODULES_PATHS(START)</span><br><span class="line">2. <span class="selector-tag">for</span> <span class="selector-tag">each</span> <span class="selector-tag">DIR</span> <span class="selector-tag">in</span> <span class="selector-tag">DIRS</span>:</span><br><span class="line">   <span class="selector-tag">a</span>. <span class="selector-tag">LOAD_AS_FILE</span>(<span class="selector-tag">DIR</span>/<span class="selector-tag">X</span>)</span><br><span class="line">   <span class="selector-tag">b</span>. <span class="selector-tag">LOAD_AS_DIRECTORY</span>(<span class="selector-tag">DIR</span>/<span class="selector-tag">X</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">NODE_MODULES_PATHS</span>(<span class="selector-tag">START</span>)</span><br><span class="line">1. let PARTS = path split(START)</span><br><span class="line">2. let I = count of PARTS - 1</span><br><span class="line">3. let DIRS = []</span><br><span class="line">4. while I &gt;= 0,</span><br><span class="line">   a. if PARTS[I] = &quot;node_modules&quot; CONTINUE</span><br><span class="line">   b. DIR = path join(PARTS[0 .. I] + &quot;node_modules&quot;)</span><br><span class="line">   c. DIRS = DIRS + DIR</span><br><span class="line">   d. let I = I - 1</span><br><span class="line">5. <span class="selector-tag">return</span> <span class="selector-tag">DIRS</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>关于exports 和 module.exports 的使用</p>
<p>如果要对外暴露属性或方法，就用 exports 就行，要暴露对象(类似class，包含了很多属性和方法)，就用 module.exports。</p>
</blockquote>
<h1 id="Node-js-函数的使用"><a href="#Node-js-函数的使用" class="headerlink" title="Node.js 函数的使用"></a>Node.js 函数的使用</h1><p>在 JavaScript中，一个函数可以作为另一个函数的参数。我们可以先定义一个函数，然后传递，也可以在传递参数的地方直接定义函数。</p>
<p>Node.js 中函数的使用与 JavaScript 类似，举例来说，你可以这样做：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(word);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">someFunction, value</span>) </span>&#123;</span><br><span class="line">  someFunction(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(say, <span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码中，我们把 <code>say</code> 函数作为 <code>execute</code> 函数的第一个变量进行了传递。这里传递的不是 <code>say</code> 的返回值，而是 <code>say</code> 本身！</p>
<p>这样一来， <code>say</code> 就变成了<code>execute</code> 中的本地变量 <code>someFunction</code> ，<code>execute</code> 可以通过调用 <code>someFunction()</code> （带括号的形式）来使用 <code>say</code> 函数。</p>
<p>当然，因为 <code>say</code> 有一个变量， <code>execute</code> 在调用 <code>someFunction</code> 时可以传递这样一个变量。</p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>我们可以把一个函数作为变量传递。但是我们不一定要绕这个”<strong>先定义，再传递</strong>“的圈子，我们可以直接在另一个函数的括号中定义和传递这个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function execute(someFunction, value) &#123;</span><br><span class="line">  someFunction(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(function(word)&#123; console.log(word) &#125;, &quot;Hello&quot;);</span><br></pre></td></tr></table></figure>
<p>我们在 <code>execute</code> 接受第一个参数的地方直接定义了我们准备传递给 <code>execute</code> 的函数。</p>
<p>用这种方式，我们甚至不用给这个函数起名字，这也是为什么它被叫做匿名函数 。</p>
<h2 id="函数传递是如何让HTTP服务器工作的"><a href="#函数传递是如何让HTTP服务器工作的" class="headerlink" title="函数传递是如何让HTTP服务器工作的"></a>函数传递是如何让HTTP服务器工作的</h2><p>带着这些知识，我们再来看看我们简约而不简单的HTTP服务器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line">  response.write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>现在它看上去应该清晰了很多：我们向 createServer 函数传递了一个匿名函数。</p>
<p>用这样的代码也可以达到同样的目的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line">  response.write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(onRequest).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-路由"><a href="#Node-js-路由" class="headerlink" title="Node.js 路由"></a>Node.js 路由</h1><p>我们要为路由提供请求的 <code>URL</code> 和其他需要的 <code>GET</code> 及 <code>POST</code> 参数，随后路由需要根据这些数据来执行相应的代码。</p>
<p>因此，我们需要查看 <code>HTTP</code> 请求，从中提取出请求的 <code>URL</code> 以及 <code>GET/POST</code> 参数。这一功能应当属于路由还是服务器（甚至作为一个模块自身的功能）确实值得探讨，但这里暂定其为我们的HTTP服务器的功能。</p>
<p>我们需要的所有数据都会包含在 <code>request</code> 对象中，该对象作为 <code>onRequest()</code> 回调函数的第一个参数传递。但是为了解析这些数据，我们需要额外的 Node.JS 模块，它们分别是 <code>url</code> 和 <code>querystring</code> 模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">                   url.parse(string).query</span><br><span class="line">                                           |</span><br><span class="line">           url.parse(string).pathname      |</span><br><span class="line">                       |                   |</span><br><span class="line">                       |                   |</span><br><span class="line">                     ------ -------------------</span><br><span class="line">http:&#x2F;&#x2F;localhost:8888&#x2F;start?foo&#x3D;bar&amp;hello&#x3D;world</span><br><span class="line">                                ---       -----</span><br><span class="line">                                 |          |</span><br><span class="line">                                 |          |</span><br><span class="line">              querystring.parse(queryString)[&quot;foo&quot;]    |</span><br><span class="line">                                            |</span><br><span class="line">                         querystring.parse(queryString)[&quot;hello&quot;]</span><br></pre></td></tr></table></figure>
<p>当然我们也可以用 <code>querystring</code> 模块来解析 <code>POST</code> 请求体中的参数，稍后会有演示。</p>
<p>现在我们来给 <code>onRequest()</code> 函数加上一些逻辑，用来找出浏览器请求的 <code>URL</code> 路径：</p>
<p>server.js文件代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Request for &quot;</span> + pathname + <span class="string">&quot; received.&quot;</span>);</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line">    response.write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  http.createServer(onRequest).listen(<span class="number">8888</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Server has started.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">exports</span>.start = start;</span><br></pre></td></tr></table></figure>
<p>好了，我们的应用现在可以通过请求的 URL 路径来区别不同请求了–这使我们得以使用路由（还未完成）来将请求以 URL 路径为基准映射到处理程序上。</p>
<p>在我们所要构建的应用中，这意味着来自 /start 和 /upload 的请求可以使用不同的代码来处理。稍后我们将看到这些内容是如何整合到一起的。</p>
<p>现在我们可以来编写路由了，建立一个名为 <strong>router.js</strong> 的文件，添加以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">route</span>(<span class="params">pathname</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;About to route a request for &quot;</span> + pathname);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">exports</span>.route = route;</span><br></pre></td></tr></table></figure>
<p>如你所见，这段代码什么也没干，不过对于现在来说这是应该的。在添加更多的逻辑以前，我们先来看看如何把路由和服务器整合起来。</p>
<p>我们的服务器应当知道路由的存在并加以有效利用。我们当然可以通过硬编码的方式将这一依赖项绑定到服务器上，但是其它语言的编程经验告诉我们这会是一件非常痛苦的事，因此我们将使用依赖注入的方式较松散地添加路由模块。</p>
<p>首先，我们来扩展一下服务器的 <code>start()</code> 函数，以便将路由函数作为参数传递过去，<strong>server.js</strong> 文件代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params">route</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Request for &quot;</span> + pathname + <span class="string">&quot; received.&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    route(pathname);</span><br><span class="line"> </span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;);</span><br><span class="line">    response.write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  http.createServer(onRequest).listen(<span class="number">8888</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Server has started.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">exports</span>.start = start;</span><br></pre></td></tr></table></figure>
<p>同时，我们会相应扩展 index.js，使得路由函数可以被注入到服务器中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">&quot;./server&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&quot;./router&quot;</span>);</span><br><span class="line"> </span><br><span class="line">server.start(router.route);</span><br></pre></td></tr></table></figure>
<p>在这里，我们传递的函数依旧什么也没做。</p>
<p>如果现在启动应用（node index.js，始终记得这个命令行），随后请求一个URL，你将会看到应用输出相应的信息，这表明我们的HTTP服务器已经在使用路由模块了，并会将请求的路径传递给路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br><span class="line">Server has started.</span><br></pre></td></tr></table></figure>
<p>以上输出已经去掉了比较烦人的 /favicon.ico 请求相关的部分。</p>
<p>浏览器访问 **<a target="_blank" rel="noopener" href="http://127.0.0.1:8888/**%EF%BC%8C%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%EF%BC%9A">http://127.0.0.1:8888/**，输出结果如下：</a></p>
<p><img src="C:\Users\52862\AppData\Roaming\Typora\typora-user-images\image-20201214180215351.png" alt="image-20201214180215351"></p>
<h1 id="Node-js-全局对象"><a href="#Node-js-全局对象" class="headerlink" title="Node.js 全局对象"></a>Node.js 全局对象</h1><p>JavaScript 中有一个特殊的对象，称为全局对象（Global Object），它及其所有属性都可以在程序的任何地方访问，即全局变量。</p>
<p>在浏览器 JavaScript 中，通常 window 是全局对象， 而 Node.js 中的全局对象是 global，所有全局变量（除了 global 本身以外）都是 global 对象的属性。</p>
<p>在 Node.js 我们可以直接访问到 global 的属性，而不需要在应用中包含它。</p>
<h2 id="全局对象与全局变量"><a href="#全局对象与全局变量" class="headerlink" title="全局对象与全局变量"></a>全局对象与全局变量</h2><p>global 最根本的作用是作为全局变量的宿主。按照 ECMAScript 的定义，满足以下条 件的变量是全局变量：</p>
<ul>
<li>在最外层定义的变量；</li>
<li>全局对象的属性；</li>
<li>隐式定义的变量（未定义直接赋值的变量）。</li>
</ul>
<p>当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注 意的是，在 Node.js 中你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的， 而模块本身不是最外层上下文。</p>
<blockquote>
<p><strong>注意：</strong> 最好不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。</p>
</blockquote>
<h2 id="filename"><a href="#filename" class="headerlink" title="__filename"></a>__filename</h2><p><strong>__filename</strong> 表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。</p>
<h3 id="实例-10"><a href="#实例-10" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出全局变量 __filename 的值</span></span><br><span class="line"><span class="built_in">console</span>.log( __filename );</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">/web/com/runoob/nodejs/main.js</span><br></pre></td></tr></table></figure>
<h2 id="dirname"><a href="#dirname" class="headerlink" title="__dirname"></a>__dirname</h2><p><strong>__dirname</strong> 表示当前执行脚本所在的目录。</p>
<h3 id="实例-11"><a href="#实例-11" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出全局变量 __dirname 的值</span></span><br><span class="line"><span class="built_in">console</span>.log( __dirname );</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">&#x2F;web&#x2F;com&#x2F;runoob&#x2F;nodejs</span><br></pre></td></tr></table></figure>
<h2 id="setTimeout-cb-ms"><a href="#setTimeout-cb-ms" class="headerlink" title="setTimeout(cb, ms)"></a>setTimeout(cb, ms)</h2><p><strong>setTimeout(cb, ms)</strong> 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。：setTimeout() 只执行一次指定函数。</p>
<p>返回一个代表定时器的句柄值。</p>
<h3 id="实例-12"><a href="#实例-12" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="built_in">setTimeout</span>(printHello, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
<h2 id="clearTimeout-t"><a href="#clearTimeout-t" class="headerlink" title="clearTimeout(t)"></a>clearTimeout(t)</h2><p><strong>clearTimeout( t )</strong> 全局函数用于停止一个之前通过 setTimeout() 创建的定时器。 参数 <strong>t</strong> 是通过 setTimeout() 函数创建的定时器。</p>
<h3 id="实例-13"><a href="#实例-13" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(printHello, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除定时器</span></span><br><span class="line"><span class="built_in">clearTimeout</span>(t);</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br></pre></td></tr></table></figure>
<h2 id="setInterval-cb-ms"><a href="#setInterval-cb-ms" class="headerlink" title="setInterval(cb, ms)"></a>setInterval(cb, ms)</h2><p><strong>setInterval(cb, ms)</strong> 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。</p>
<p>返回一个代表定时器的句柄值。可以使用 <strong>clearInterval(t)</strong> 函数来清除定时器。</p>
<p>setInterval() 方法会不停地调用函数，直到 clearInterval() 被调用或窗口被关闭。</p>
<h3 id="实例-14"><a href="#实例-14" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="built_in">setInterval</span>(printHello, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">Hello, World!</span><br><span class="line">Hello, World!</span><br><span class="line">Hello, World!</span><br><span class="line">Hello, World!</span><br><span class="line">Hello, World!</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="setInterval(cb, ms)"></p>
<p>以上程序每隔两秒就会输出一次”Hello, World!”，且会永久执行下去，直到你按下 <strong>ctrl + c</strong> 按钮。</p>
<h2 id="console"><a href="#console" class="headerlink" title="console"></a>console</h2><p>console 用于提供控制台标准输出，它是由 Internet Explorer 的 JScript 引擎提供的调试工具，后来逐渐成为浏览器的实施标准。</p>
<p>Node.js 沿用了这个标准，提供与习惯行为一致的 console 对象，用于向标准输出流（stdout）或标准错误流（stderr）输出字符。</p>
<h3 id="console-方法"><a href="#console-方法" class="headerlink" title="console 方法"></a>console 方法</h3><p>以下为 console 对象的方法:</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>console.log([data][, …])</strong> 向标准输出流打印字符并以换行符结束。该方法接收若干 个参数，如果只有一个参数，则输出这个参数的字符串形式。如果有多个参数，则 以类似于C 语言 printf() 命令的格式输出。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>console.info([data][, …])</strong> 该命令的作用是返回信息性消息，这个命令与console.log差别并不大，除了在chrome中只会输出文字外，其余的会显示一个蓝色的惊叹号。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>console.error([data][, …])</strong> 输出错误消息的。控制台在出现错误时会显示是红色的叉子。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>console.warn([data][, …])</strong> 输出警告消息。控制台出现有黄色的惊叹号。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>console.dir(obj[, options])</strong> 用来对一个对象进行检查（inspect），并以易于阅读和打印的格式显示。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>console.time(label)</strong> 输出时间，表示计时开始。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>console.timeEnd(label)</strong> 结束时间，表示计时结束。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>console.trace(message[, …])</strong> 当前执行的代码在堆栈中的调用路径，这个测试函数运行很有帮助，只要给想测试的函数里面加入 console.trace 就行了。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>console.assert(value[, message][, …])</strong> 用于判断某个表达式或变量是否为真，接收两个参数，第一个参数是表达式，第二个参数是字符串。只有当第一个参数为false，才会输出第二个参数，否则不会有任何结果。</td>
</tr>
</tbody></table>
<p>console.log()：向标准输出流打印字符并以换行符结束。</p>
<p>console.log 接收若干 个参数，如果只有一个参数，则输出这个参数的字符串形式。如果有多个参数，则 以类似于C 语言 printf() 命令的格式输出。</p>
<p>第一个参数是一个字符串，如果没有 参数，只打印一个换行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello world&#x27;</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;bymybj%jbymyb&#x27;</span>); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;bymybj%jbymyb&#x27;</span>, <span class="number">1991</span>);</span><br></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello world </span><br><span class="line">bymybj%jbymyb </span><br><span class="line">bymybj1991bymyb</span><br></pre></td></tr></table></figure>
<ul>
<li>console.error()：与console.log() 用法相同，只是向标准错误流输出。</li>
<li>console.trace()：向标准错误流输出当前的调用栈。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.trace();</span><br></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Trace: </span><br><span class="line">at Object. (&#x2F;home&#x2F;bymybj&#x2F;consoletrace.js:1:71) </span><br><span class="line">at Module._compile (module.js:441:26) </span><br><span class="line">at Object..js (module.js:459:10) </span><br><span class="line">at Module.load (module.js:348:31) </span><br><span class="line">at Function._load (module.js:308:12) </span><br><span class="line">at Array.0 (module.js:479:10) </span><br><span class="line">at EventEmitter._tickCallback (node.js:192:40)</span><br></pre></td></tr></table></figure>
<h3 id="实例-15"><a href="#实例-15" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.info(<span class="string">&quot;程序开始执行：&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;计数: %d&quot;</span>, counter);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">&quot;获取数据&quot;</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 执行一些代码</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">&#x27;获取数据&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">&quot;程序执行完毕。&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">程序开始执行：</span><br><span class="line">计数: 10</span><br><span class="line">获取数据: 0ms</span><br><span class="line">程序执行完毕</span><br></pre></td></tr></table></figure>
<h2 id="process"><a href="#process" class="headerlink" title="process"></a>process</h2><p>process 是一个全局变量，即 global 对象的属性。</p>
<p>它用于描述当前Node.js 进程状态的对象，提供了一个与操作系统的简单接口。通常在你写本地命令行程序的时候，少不了要 和它打交道。下面将会介绍 process 对象的一些最常用的成员方法。</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">事件 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>exit</strong> 当进程准备退出时触发。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>beforeExit</strong> 当 node 清空事件循环，并且没有其他安排时触发这个事件。通常来说，当没有进程安排时 node 退出，但是 ‘beforeExit’ 的监听器可以异步调用，这样 node 就会继续执行。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>uncaughtException</strong> 当一个异常冒泡回到事件循环，触发这个事件。如果给异常添加了监视器，默认的操作（打印堆栈跟踪信息并退出）就不会发生。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>Signal 事件</strong> 当进程接收到信号时就触发。信号列表详见标准的 POSIX 信号名，如 SIGINT、SIGUSR1 等。</td>
</tr>
</tbody></table>
<h3 id="实例-16"><a href="#实例-16" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下代码永远不会执行</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;该代码不会执行&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;退出码为:&#x27;</span>, code);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行结束&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">程序执行结束</span><br><span class="line">退出码为: 0</span><br></pre></td></tr></table></figure>
<h3 id="退出状态码"><a href="#退出状态码" class="headerlink" title="退出状态码"></a>退出状态码</h3><p>退出状态码如下所示：</p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">名称 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>Uncaught Fatal Exception</strong> 有未捕获异常，并且没有被域或 uncaughtException 处理函数处理。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>Unused</strong> 保留</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>Internal JavaScript Parse Error</strong> JavaScript的源码启动 Node 进程时引起解析错误。非常罕见，仅会在开发 Node 时才会有。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>Internal JavaScript Evaluation Failure</strong> JavaScript 的源码启动 Node 进程，评估时返回函数失败。非常罕见，仅会在开发 Node 时才会有。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>Fatal Error</strong> V8 里致命的不可恢复的错误。通常会打印到 stderr ，内容为： FATAL ERROR</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>Non-function Internal Exception Handler</strong> 未捕获异常，内部异常处理函数不知为何设置为on-function，并且不能被调用。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>Internal Exception Handler Run-Time Failure</strong> 未捕获的异常， 并且异常处理函数处理时自己抛出了异常。例如，如果 process.on(‘uncaughtException’) 或 domain.on(‘error’) 抛出了异常。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>Unused</strong> 保留</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>Invalid Argument</strong> 可能是给了未知的参数，或者给的参数没有值。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>Internal JavaScript Run-Time Failure</strong> JavaScript的源码启动 Node 进程时抛出错误，非常罕见，仅会在开发 Node 时才会有。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>Invalid Debug Argument</strong> 设置了参数–debug 和/或 –debug-brk，但是选择了错误端口。</td>
</tr>
<tr>
<td align="left">128</td>
<td align="left"><strong>Signal Exits</strong> 如果 Node 接收到致命信号，比如SIGKILL 或 SIGHUP，那么退出代码就是128 加信号代码。这是标准的 Unix 做法，退出信号代码放在高位。</td>
</tr>
</tbody></table>
<h3 id="Process-属性"><a href="#Process-属性" class="headerlink" title="Process 属性"></a>Process 属性</h3><p>Process 提供了很多有用的属性，便于我们更好的控制系统的交互：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">属性 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>stdout</strong> 标准输出流。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>stderr</strong> 标准错误流。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>stdin</strong> 标准输入流。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>argv</strong> argv 属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是node，第二个成员是脚本文件名，其余成员是脚本文件的参数。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>execPath</strong> 返回执行当前脚本的 Node 二进制文件的绝对路径。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>execArgv</strong> 返回一个数组，成员是命令行下执行脚本时，在Node可执行文件与脚本文件之间的命令行参数。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>env</strong> 返回一个对象，成员为当前 shell 的环境变量</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>exitCode</strong> 进程退出时的代码，如果进程优通过 process.exit() 退出，不需要指定退出码。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>version</strong> Node 的版本，比如v0.10.18。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>versions</strong> 一个属性，包含了 node 的版本和依赖.</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>config</strong> 一个包含用来编译当前 node 执行文件的 javascript 配置选项的对象。它与运行 ./configure 脚本生成的 “config.gypi” 文件相同。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>pid</strong> 当前进程的进程号。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>title</strong> 进程名，默认值为”node”，可以自定义该值。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>arch</strong> 当前 CPU 的架构：’arm’、’ia32′ 或者 ‘x64’。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><strong>platform</strong> 运行程序所在的平台系统 ‘darwin’, ‘freebsd’, ‘linux’, ‘sunos’ 或 ‘win32’</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><strong>mainModule</strong> require.main 的备选方法。不同点，如果主模块在运行时改变，require.main可能会继续返回老的模块。可以认为，这两者引用了同一个模块。</td>
</tr>
</tbody></table>
<h3 id="实例-17"><a href="#实例-17" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出到终端</span></span><br><span class="line">process.stdout.write(<span class="string">&quot;Hello World!&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过参数读取</span></span><br><span class="line">process.argv.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">val, index, array</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(index + <span class="string">&#x27;: &#x27;</span> + val);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取执行路径</span></span><br><span class="line"><span class="built_in">console</span>.log(process.execPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平台信息</span></span><br><span class="line"><span class="built_in">console</span>.log(process.platform);</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">Hello World!</span><br><span class="line">0: node</span><br><span class="line">1: &#x2F;web&#x2F;www&#x2F;node&#x2F;main.js</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;node&#x2F;0.10.36&#x2F;bin&#x2F;node</span><br><span class="line">darwin</span><br></pre></td></tr></table></figure>
<h3 id="方法参考手册-1"><a href="#方法参考手册-1" class="headerlink" title="方法参考手册"></a>方法参考手册</h3><p>Process 提供了很多有用的方法，便于我们更好的控制系统的交互：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>abort()</strong> 这将导致 node 触发 abort 事件。会让 node 退出并生成一个核心文件。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>chdir(directory)</strong> 改变当前工作进程的目录，如果操作失败抛出异常。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>cwd()</strong> 返回当前进程的工作目录</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>exit([code])</strong> 使用指定的 code 结束进程。如果忽略，将会使用 code 0。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>getgid()</strong> 获取进程的群组标识（参见 getgid(2)）。获取到得时群组的数字 id，而不是名字。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>setgid(id)</strong> 设置进程的群组标识（参见 setgid(2)）。可以接收数字 ID 或者群组名。如果指定了群组名，会阻塞等待解析为数字 ID 。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>getuid()</strong> 获取进程的用户标识(参见 getuid(2))。这是数字的用户 id，不是用户名。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>setuid(id)</strong> 设置进程的用户标识（参见setuid(2)）。接收数字 ID或字符串名字。果指定了群组名，会阻塞等待解析为数字 ID 。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>getgroups()</strong> 返回进程的群组 iD 数组。POSIX 系统没有保证一定有，但是 node.js 保证有。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>setgroups(groups)</strong> 设置进程的群组 ID。这是授权操作，所以你需要有 root 权限，或者有 CAP_SETGID 能力。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>initgroups(user, extra_group)</strong> 读取 /etc/group ，并初始化群组访问列表，使用成员所在的所有群组。这是授权操作，所以你需要有 root 权限，或者有 CAP_SETGID 能力。 注意：这个函数仅在 POSIX 平台上可用(例如，非Windows 和 Android)。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>kill(pid[, signal])</strong> 发送信号给进程. pid 是进程id，并且 signal 是发送的信号的字符串描述。信号名是字符串，比如 ‘SIGINT’ 或 ‘SIGHUP’。如果忽略，信号会是 ‘SIGTERM’。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>memoryUsage()</strong> 返回一个对象，描述了 Node 进程所用的内存状况，单位为字节。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>nextTick(callback)</strong> 一旦当前事件循环结束，调用回调函数。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><strong>umask([mask])</strong> 设置或读取进程文件的掩码。子进程从父进程继承掩码。如果mask 参数有效，返回旧的掩码。否则，返回当前掩码。</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><strong>uptime()</strong> 返回 Node 已经运行的秒数。</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><strong>hrtime()</strong> 返回当前进程的高分辨时间，形式为 [seconds, nanoseconds]数组。它是相对于过去的任意事件。该值与日期无关，因此不受时钟漂移的影响。主要用途是可以通过精确的时间间隔，来衡量程序的性能。 你可以将之前的结果传递给当前的 process.hrtime() ，会返回两者间的时间差，用来基准和测量时间间隔。</td>
</tr>
</tbody></table>
<h3 id="实例-18"><a href="#实例-18" class="headerlink" title="实例"></a>实例</h3><p>创建文件 main.js ，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出当前目录</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;当前目录: &#x27;</span> + process.cwd());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出当前版本</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;当前版本: &#x27;</span> + process.version);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出内存使用情况</span></span><br><span class="line"><span class="built_in">console</span>.log(process.memoryUsage());</span><br></pre></td></tr></table></figure>
<p>执行 main.js 文件，代码如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node main.js</span><br><span class="line">当前目录: &#x2F;web&#x2F;com&#x2F;mybj&#x2F;nodejs</span><br><span class="line">当前版本: v0.10.36</span><br><span class="line">&#123; rss: 12541952, heapTotal: 4083456, heapUsed: 2157056 &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-常用工具"><a href="#Node-js-常用工具" class="headerlink" title="Node.js 常用工具"></a>Node.js 常用工具</h1><p><strong>util</strong> 是一个Node.js 核心模块，提供常用函数的集合，用于弥补核心 JavaScript 的功能 过于精简的不足。</p>
<p>使用方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="util-callbackify"><a href="#util-callbackify" class="headerlink" title="util.callbackify"></a>util.callbackify</h2><p><code>util.callbackify(original)</code> 将 <code>async</code> 异步函数（或者一个返回值为 <code>Promise</code> 的函数）转换成遵循异常优先的回调风格的函数，例如将 <code>(err, value) =&gt; ...</code> 回调作为最后一个参数。 在回调函数中，第一个参数为拒绝的原因（如果 <code>Promise</code> 解决，则为 <code>null</code>），第二个参数则是解决的值。</p>
<h3 id="实例-19"><a href="#实例-19" class="headerlink" title="实例"></a>实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> callbackFunction = util.callbackify(fn);</span><br><span class="line"></span><br><span class="line">callbackFunction(<span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(ret);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>
<p>回调函数是异步执行的，并且有异常堆栈错误追踪。 如果回调函数抛出一个异常，进程会触发一个 ‘<code>uncaughtException</code>‘ 异常，如果没有被捕获，进程将会退出。</p>
<p><code>null</code> 在回调函数中作为一个参数有其特殊的意义，如果回调函数的首个参数为 <code>Promise</code> 拒绝的原因且带有返回值，且值可以转换成布尔值 <code>false</code>，这个值会被封装在 <code>Error</code> 对象里，可以通过属性 <code>reason</code> 获取。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> callbackFunction = util.callbackify(fn);</span><br><span class="line"></span><br><span class="line">callbackFunction(<span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 当 Promise 被以 `null` 拒绝时，它被包装为 Error 并且原始值存储在 `reason` 中。</span></span><br><span class="line">  err &amp;&amp; err.hasOwnProperty(<span class="string">&#x27;reason&#x27;</span>) &amp;&amp; err.reason === <span class="literal">null</span>;  <span class="comment">// true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>original</code> 为 <code>async</code> 异步函数。该函数返回传统回调函数。</p>
<h2 id="util-inherits"><a href="#util-inherits" class="headerlink" title="util.inherits"></a>util.inherits</h2><p><code>util.inherits(constructor, superConstructor)</code> 是一个实现对象间原型继承的函数。</p>
<p>JavaScript 的面向对象特性是基于原型的，与常见的基于类的不同。JavaScript 没有提供对象继承的语言级别特性，而是通过原型复制来实现的。</p>
<p>在这里我们只介绍 <code>util.inherits</code> 的用法，示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;base&#x27;</span>; </span><br><span class="line">    <span class="built_in">this</span>.base = <span class="number">1991</span>; </span><br><span class="line">    <span class="built_in">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Hello &#x27;</span> + <span class="built_in">this</span>.name); </span><br><span class="line">    &#125;; </span><br><span class="line">&#125; </span><br><span class="line">Base.prototype.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sub</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;sub&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line">util.inherits(Sub, Base); </span><br><span class="line"><span class="keyword">var</span> objBase = <span class="keyword">new</span> Base(); </span><br><span class="line">objBase.showName(); </span><br><span class="line">objBase.sayHello(); </span><br><span class="line"><span class="built_in">console</span>.log(objBase); </span><br><span class="line"><span class="keyword">var</span> objSub = <span class="keyword">new</span> Sub(); </span><br><span class="line">objSub.showName(); </span><br><span class="line"><span class="comment">//objSub.sayHello(); </span></span><br><span class="line"><span class="built_in">console</span>.log(objSub);</span><br></pre></td></tr></table></figure>
<p>我们定义了一个基础对象 Base 和一个继承自 Base 的 Sub，Base 有三个在构造函数内定义的属性和一个原型中定义的函数，通过<code>util.inherits</code> 实现继承。运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">base </span><br><span class="line">Hello base </span><br><span class="line">&#123; name: &#39;base&#39;, base: 1991, sayHello: [Function] &#125; </span><br><span class="line">sub </span><br><span class="line">&#123; name: &#39;sub&#39; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>Sub 仅仅继承了Base 在原型中定义的函数，而构造函数内部创造的 base 属 性和 sayHello 函数都没有被 Sub 继承。</p>
<p>同时，在原型中定义的属性不会被 console.log 作 为对象的属性输出。如果我们去掉 <code>objSub.sayHello();</code> 这行的注释，将会看到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node.js:201 </span><br><span class="line">throw e; &#x2F;&#x2F; process.nextTick error, or &#39;error&#39; event on first tick </span><br><span class="line">^ </span><br><span class="line">TypeError: Object #&lt;Sub&gt; has no method &#39;sayHello&#39; </span><br><span class="line">at Object.&lt;anonymous&gt; (&#x2F;home&#x2F;byvoid&#x2F;utilinherits.js:29:8) </span><br><span class="line">at Module._compile (module.js:441:26) </span><br><span class="line">at Object..js (module.js:459:10) </span><br><span class="line">at Module.load (module.js:348:31) </span><br><span class="line">at Function._load (module.js:308:12) </span><br><span class="line">at Array.0 (module.js:479:10) </span><br><span class="line">at EventEmitter._tickCallback (node.js:192:40)</span><br></pre></td></tr></table></figure>
<h2 id="util-inspect"><a href="#util-inspect" class="headerlink" title="util.inspect"></a>util.inspect</h2><p><code>util.inspect(object,[showHidden],[depth],[colors])</code> 是一个将任意对象转换 为字符串的方法，通常用于调试和错误输出。它至少接受一个参数 <code>object</code>，即要转换的对象。</p>
<p><code>showHidden</code> 是一个可选参数，如果值为 <code>true</code>，将会输出更多隐藏信息。</p>
<p><code>depth</code> 表示最大递归的层数，如果对象很复杂，你可以指定层数以控制输出信息的多 少。如果不指定<code>depth</code>，默认会递归 2 层，指定为 null 表示将不限递归层数完整遍历对象。 </p>
<p>如果 <code>colors</code> 值为 <code>true</code>，输出格式将会以 <code>ANSI</code> 颜色编码，通常用于在终端显示更漂亮 的效果。</p>
<p>特别要指出的是，<code>util.inspect</code> 并不会简单地直接把对象转换为字符串，即使该对 象定义了 <code>toString</code> 方法也不会调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;bymybj&#x27;</span>; </span><br><span class="line">    <span class="built_in">this</span>.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name; </span><br><span class="line">    &#125;; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> Person(); </span><br><span class="line"><span class="built_in">console</span>.log(util.inspect(obj)); </span><br><span class="line"><span class="built_in">console</span>.log(util.inspect(obj, <span class="literal">true</span>));</span><br></pre></td></tr></table></figure>
<p>运行结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Person &#123; name: &#39;bymybj&#39;, toString: [Function] &#125;</span><br><span class="line">Person &#123;</span><br><span class="line">  name: &#39;bymybj&#39;,</span><br><span class="line">  toString: </span><br><span class="line">   &#123; [Function]</span><br><span class="line">     [length]: 0,</span><br><span class="line">     [name]: &#39;&#39;,</span><br><span class="line">     [arguments]: null,</span><br><span class="line">     [caller]: null,</span><br><span class="line">     [prototype]: &#123; [constructor]: [Circular] &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="util-isArray-object"><a href="#util-isArray-object" class="headerlink" title="util.isArray(object)"></a>util.isArray(object)</h2><p>如果给定的参数 “object” 是一个数组返回 true，否则返回 false。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line">util.isArray([])</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">util.isArray(<span class="keyword">new</span> <span class="built_in">Array</span>)</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">util.isArray(&#123;&#125;)</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="util-isRegExp-object"><a href="#util-isRegExp-object" class="headerlink" title="util.isRegExp(object)"></a>util.isRegExp(object)</h2><p>如果给定的参数 “object” 是一个正则表达式返回true，否则返回false。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line">util.isRegExp(<span class="regexp">/some regexp/</span>)</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">util.isRegExp(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;another regexp&#x27;</span>))</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">util.isRegExp(&#123;&#125;)</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="util-isDate-object"><a href="#util-isDate-object" class="headerlink" title="util.isDate(object)"></a>util.isDate(object)</h2><p>如果给定的参数 “object” 是一个日期返回true，否则返回false。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line">util.isDate(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">util.isDate(<span class="built_in">Date</span>())</span><br><span class="line"><span class="comment">// false (without &#x27;new&#x27; returns a String)</span></span><br><span class="line">util.isDate(&#123;&#125;)</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h1 id="Node-js-文件系统"><a href="#Node-js-文件系统" class="headerlink" title="Node.js 文件系统"></a>Node.js 文件系统</h1><p>Node.js 提供一组类似 UNIX（POSIX）标准的文件操作API。 Node 导入文件系统模块(fs)语法如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="异步和同步"><a href="#异步和同步" class="headerlink" title="异步和同步"></a>异步和同步</h2><p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本，例如读取文件内容的函数有异步的 fs.readFile() 和同步的 fs.readFileSync()。</p>
<p>异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(error)。</p>
<p>建议大家使用异步方法，比起同步，异步方法性能更高，速度更快，而且没有阻塞。</p>
<h3 id="实例-20"><a href="#实例-20" class="headerlink" title="实例"></a>实例</h3><p>创建 input.txt 文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：www.mybj123.com</span><br><span class="line">文件读取实例</span><br></pre></td></tr></table></figure>
<p>创建 file.js 文件, 代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;异步读取: &quot;</span> + data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读取</span></span><br><span class="line"><span class="keyword">const</span> data = fs.readFileSync(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;同步读取: &quot;</span> + data.toString());</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;程序执行完毕。&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">同步读取: 码云笔记官网地址：www.mybj123.com</span><br><span class="line">文件读取实例</span><br><span class="line"></span><br><span class="line">程序执行完毕。</span><br><span class="line">异步读取: 码云笔记官网地址：www.mybj123.com</span><br><span class="line">文件读取实例</span><br></pre></td></tr></table></figure>
<p>接下来，让我们来具体了解下 Node.js 文件系统的方法。</p>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><h3 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h3><p>以下为在异步模式下打开文件的语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.open(path, flags[, mode], callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-6"><a href="#参数-6" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件的路径。</li>
<li><strong>flags</strong> – 文件打开的行为。具体值详见下文。</li>
<li><strong>mode</strong> – 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。</li>
<li><strong>callback</strong> – 回调函数，带有两个参数如：callback(err, fd)。</li>
</ul>
<p>flags 参数可以是以下值：</p>
<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">r</td>
<td align="left">以读取模式打开文件。如果文件不存在抛出异常。</td>
</tr>
<tr>
<td align="left">r+</td>
<td align="left">以读写模式打开文件。如果文件不存在抛出异常。</td>
</tr>
<tr>
<td align="left">rs</td>
<td align="left">以同步的方式读取文件。</td>
</tr>
<tr>
<td align="left">rs+</td>
<td align="left">以同步的方式读取和写入文件。</td>
</tr>
<tr>
<td align="left">w</td>
<td align="left">以写入模式打开文件，如果文件不存在则创建。</td>
</tr>
<tr>
<td align="left">wx</td>
<td align="left">类似 ‘w’，但是如果文件路径存在，则文件写入失败。</td>
</tr>
<tr>
<td align="left">w+</td>
<td align="left">以读写模式打开文件，如果文件不存在则创建。</td>
</tr>
<tr>
<td align="left">wx+</td>
<td align="left">类似 ‘w+’， 但是如果文件路径存在，则文件读写失败。</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">以追加模式打开文件，如果文件不存在则创建。</td>
</tr>
<tr>
<td align="left">ax</td>
<td align="left">类似 ‘a’， 但是如果文件路径存在，则文件追加失败。</td>
</tr>
<tr>
<td align="left">a+</td>
<td align="left">以读取追加模式打开文件，如果文件不存在则创建。</td>
</tr>
<tr>
<td align="left">ax+</td>
<td align="left">类似 ‘a+’， 但是如果文件路径存在，则文件读取追加失败。</td>
</tr>
</tbody></table>
<h3 id="实例-21"><a href="#实例-21" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，并打开 input.txt 文件进行读写，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步打开文件</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开文件！&quot;</span>);</span><br><span class="line">fs.open(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;文件打开成功！&quot;</span>);     </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br></pre></td></tr></table></figure>
<h2 id="获取文件信息"><a href="#获取文件信息" class="headerlink" title="获取文件信息"></a>获取文件信息</h2><h3 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h3><p>以下为通过异步模式获取文件信息的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.stat(path, callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-7"><a href="#参数-7" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件路径。</li>
<li><strong>callback</strong> – 回调函数，带有两个参数如：(err, stats), <strong>stats</strong> 是 <code>fs.Stats</code> 对象。</li>
</ul>
<p><code>fs.stat(path)</code>执行后，会将<code>stats</code>类的实例返回给其回调函数。可以通过<code>stats</code>类中的提供方法判断文件的相关属性。例如判断是否为文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.stat(<span class="string">&#x27;/Users/liuht/code/itbilu/demo/fs.js&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stats.isFile());         <span class="comment">//true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>stats类中的方法有：</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">stats.isFile()</td>
<td align="left">如果是文件返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">stats.isDirectory()</td>
<td align="left">如果是目录返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">stats.isBlockDevice()</td>
<td align="left">如果是块设备返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">stats.isCharacterDevice()</td>
<td align="left">如果是字符设备返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">stats.isSymbolicLink()</td>
<td align="left">如果是软链接返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">stats.isFIFO()</td>
<td align="left">如果是FIFO，返回true，否则返回 false。FIFO是UNIX中的一种特殊类型的命令管道。</td>
</tr>
<tr>
<td align="left">stats.isSocket()</td>
<td align="left">如果是 Socket 返回 true，否则返回 false。</td>
</tr>
</tbody></table>
<h3 id="实例-22"><a href="#实例-22" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开文件！&quot;</span>);</span><br><span class="line">fs.stat(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(stats);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;读取文件信息成功！&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 检测文件类型</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;是否为文件(isFile) ? &quot;</span> + stats.isFile());</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;是否为目录(isDirectory) ? &quot;</span> + stats.isDirectory());    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备打开文件！</span><br><span class="line">&#123; dev: 16777220,</span><br><span class="line">  mode: 33188,</span><br><span class="line">  nlink: 1,</span><br><span class="line">  uid: 501,</span><br><span class="line">  gid: 20,</span><br><span class="line">  rdev: 0,</span><br><span class="line">  blksize: 4096,</span><br><span class="line">  ino: 40333161,</span><br><span class="line">  size: 61,</span><br><span class="line">  blocks: 8,</span><br><span class="line">  atime: Mon Sep 07 2015 17:43:55 GMT+0800 (CST),</span><br><span class="line">  mtime: Mon Sep 07 2015 17:22:35 GMT+0800 (CST),</span><br><span class="line">  ctime: Mon Sep 07 2015 17:22:35 GMT+0800 (CST) &#125;</span><br><span class="line">读取文件信息成功！</span><br><span class="line">是否为文件(isFile) ? true</span><br><span class="line">是否为目录(isDirectory) ? false</span><br></pre></td></tr></table></figure>
<h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h2><h3 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h3><p>以下为异步模式下写入文件的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(file, data[, options], callback)</span><br></pre></td></tr></table></figure>
<p>writeFile 直接打开文件默认是 <code>w</code> 模式，所以如果文件存在，该方法写入的内容会覆盖旧的文件内容。</p>
<h3 id="参数-8"><a href="#参数-8" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>file</strong> – 文件名或文件描述符。</li>
<li><strong>data</strong> – 要写入文件的数据，可以是 String(字符串) 或 Buffer(缓冲) 对象。</li>
<li><strong>options</strong> – 该参数是一个对象，包含 {encoding, mode, flag}。默认编码为 utf8, 模式为 0666 ， flag 为 ‘w’</li>
<li><strong>callback</strong> – 回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回。</li>
</ul>
<h3 id="实例-23"><a href="#实例-23" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备写入文件&quot;</span>);</span><br><span class="line">fs.writeFile(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;我是通 过fs.writeFile 写入文件的内容&#x27;</span>,  <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;数据写入成功！&quot;</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;--------我是分割线-------------&quot;</span>)</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;读取写入的数据！&quot;</span>);</span><br><span class="line">   fs.readFile(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;异步读取文件数据: &quot;</span> + data.toString());</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备写入文件</span><br><span class="line">数据写入成功！</span><br><span class="line">--------我是分割线-------------</span><br><span class="line">读取写入的数据！</span><br><span class="line">异步读取文件数据: 我是通 过fs.writeFile 写入文件的内容</span><br></pre></td></tr></table></figure>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><h3 id="语法-10"><a href="#语法-10" class="headerlink" title="语法"></a>语法</h3><p>以下为异步模式下读取文件的语法格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fs</span><span class="selector-class">.read</span>(<span class="selector-tag">fd</span>, <span class="selector-tag">buffer</span>, <span class="selector-tag">offset</span>, <span class="selector-tag">length</span>, <span class="selector-tag">position</span>, <span class="selector-tag">callback</span>)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<h3 id="参数-9"><a href="#参数-9" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>fd</strong> – 通过 fs.open() 方法返回的文件描述符。</li>
<li><strong>buffer</strong> – 数据写入的缓冲区。</li>
<li><strong>offset</strong> – 缓冲区写入的写入偏移量。</li>
<li><strong>length</strong> – 要从文件中读取的字节数。</li>
<li><strong>position</strong> – 文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取。</li>
<li><strong>callback</strong> – 回调函数，有三个参数err, bytesRead, buffer，err 为错误信息， bytesRead 表示读取的字节数，buffer 为缓冲区对象。</li>
</ul>
<h3 id="实例-24"><a href="#实例-24" class="headerlink" title="实例"></a>实例</h3><p>input.txt 文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：www.mybj123.com</span><br></pre></td></tr></table></figure>
<p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> Buffer.alloc(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开已存在的文件！&quot;</span>);</span><br><span class="line">fs.open(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;文件打开成功！&quot;</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;准备读取文件：&quot;</span>);</span><br><span class="line">   fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(bytes + <span class="string">&quot;  字节被读取&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 仅输出读取的字节</span></span><br><span class="line">      <span class="keyword">if</span>(bytes &gt; <span class="number">0</span>)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备打开已存在的文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">准备读取文件：</span><br><span class="line">42  字节被读取</span><br><span class="line">码云笔记官网地址：www.mybj123.com</span><br></pre></td></tr></table></figure>
<h2 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h2><h3 id="语法-11"><a href="#语法-11" class="headerlink" title="语法"></a>语法</h3><p>以下为异步模式下关闭文件的语法格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fs</span><span class="selector-class">.close</span>(<span class="selector-tag">fd</span>, <span class="selector-tag">callback</span>)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<h3 id="参数-10"><a href="#参数-10" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>fd</strong> – 通过 fs.open() 方法返回的文件描述符。</li>
<li><strong>callback</strong> – 回调函数，没有参数。</li>
</ul>
<h3 id="实例-25"><a href="#实例-25" class="headerlink" title="实例"></a>实例</h3><p>input.txt 文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">码云笔记官网地址：www.mybj123.com</span><br></pre></td></tr></table></figure>
<p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> Buffer.alloc(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开文件！&quot;</span>);</span><br><span class="line">fs.open(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;文件打开成功！&quot;</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;准备读取文件！&quot;</span>);</span><br><span class="line">   fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 仅输出读取的字节</span></span><br><span class="line">      <span class="keyword">if</span>(bytes &gt; <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="comment">//截取转换为字符串输出，一个中文等于三个字节</span></span><br><span class="line">         <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关闭文件</span></span><br><span class="line">      fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">         &#125; </span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">&quot;文件关闭成功&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">准备读取文件！</span><br><span class="line">菜鸟教程官网地址：www.runoob.com</span><br><span class="line">文件关闭成功</span><br></pre></td></tr></table></figure>
<h2 id="截取文件"><a href="#截取文件" class="headerlink" title="截取文件"></a>截取文件</h2><h3 id="语法-12"><a href="#语法-12" class="headerlink" title="语法"></a>语法</h3><p>以下为异步模式下截取文件的语法格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fs</span><span class="selector-class">.ftruncate</span>(<span class="selector-tag">fd</span>, <span class="selector-tag">len</span>, <span class="selector-tag">callback</span>)</span><br></pre></td></tr></table></figure>
<p>该方法使用了文件描述符来读取文件。</p>
<h3 id="参数-11"><a href="#参数-11" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>fd</strong> – 通过 fs.open() 方法返回的文件描述符。</li>
<li><strong>len</strong> – 文件内容截取的长度。</li>
<li><strong>callback</strong> – 回调函数，没有参数。</li>
</ul>
<h3 id="实例-26"><a href="#实例-26" class="headerlink" title="实例"></a>实例</h3><p>input.txt 文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:www.mybj123.com</span><br></pre></td></tr></table></figure>
<p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> Buffer.alloc(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开文件！&quot;</span>);</span><br><span class="line">fs.open(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;文件打开成功！&quot;</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;截取10字节内的文件内容，超出部分将被去除。&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 截取文件</span></span><br><span class="line">   fs.ftruncate(fd, <span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;文件截取成功。&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;读取相同的文件&quot;</span>); </span><br><span class="line">      fs.read(fd, buf, <span class="number">0</span>, buf.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytes</span>)</span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 仅输出读取的字节</span></span><br><span class="line">         <span class="keyword">if</span>(bytes &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(buf.slice(<span class="number">0</span>, bytes).toString());</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 关闭文件</span></span><br><span class="line">         fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;文件关闭成功！&quot;</span>);</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备打开文件！</span><br><span class="line">文件打开成功！</span><br><span class="line">截取10字节内的文件内容，超出部分将被去除。</span><br><span class="line">文件截取成功。</span><br><span class="line">读取相同的文件</span><br><span class="line">site:www.m</span><br><span class="line">文件关闭成功</span><br></pre></td></tr></table></figure>
<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><h3 id="语法-13"><a href="#语法-13" class="headerlink" title="语法"></a>语法</h3><p>以下为删除文件的语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.unlink(path, callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-12"><a href="#参数-12" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件路径。</li>
<li><strong>callback</strong> – 回调函数，没有参数。</li>
</ul>
<h3 id="实例-27"><a href="#实例-27" class="headerlink" title="实例"></a>实例</h3><p>input.txt 文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:www.mybj123.com</span><br></pre></td></tr></table></figure>
<p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备删除文件！&quot;</span>);</span><br><span class="line">fs.unlink(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;文件删除成功！&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备删除文件！</span><br><span class="line">文件删除成功！</span><br></pre></td></tr></table></figure>
<p>再去查看 input.txt 文件，发现已经不存在了。</p>
<h2 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h2><h3 id="语法-14"><a href="#语法-14" class="headerlink" title="语法"></a>语法</h3><p>以下为创建目录的语法格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">fs</span><span class="selector-class">.mkdir</span>(<span class="selector-tag">path</span><span class="selector-attr">[, options]</span>, <span class="selector-tag">callback</span>)</span><br></pre></td></tr></table></figure>
<h3 id="参数-13"><a href="#参数-13" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件路径。</li>
<li>options 参数可以是：<ul>
<li><strong>recursive</strong> – 是否以递归的方式创建目录，默认为 false。</li>
<li><strong>mode</strong> – 设置目录权限，默认为 0777。</li>
</ul>
</li>
<li><strong>callback</strong> – 回调函数，没有参数。</li>
</ul>
<h3 id="实例-28"><a href="#实例-28" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// tmp 目录必须存在</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;创建目录 /tmp/test/&quot;</span>);</span><br><span class="line">fs.mkdir(<span class="string">&quot;/tmp/test/&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;目录创建成功。&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">创建目录 &#x2F;tmp&#x2F;test&#x2F;</span><br><span class="line">目录创建成功。</span><br></pre></td></tr></table></figure>
<p>可以添加 recursive: true 参数，不管创建的目录 /tmp 和 /tmp/a 是否存在：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(<span class="string">&#x27;/tmp/a/apple&#x27;</span>, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="读取目录"><a href="#读取目录" class="headerlink" title="读取目录"></a>读取目录</h2><h3 id="语法-15"><a href="#语法-15" class="headerlink" title="语法"></a>语法</h3><p>以下为读取目录的语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readdir(path, callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-14"><a href="#参数-14" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件路径。</li>
<li><strong>callback</strong> – 回调函数，回调函数带有两个参数err, files，err 为错误信息，files 为 目录下的文件数组列表。</li>
</ul>
<h3 id="实例-29"><a href="#实例-29" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;查看 /tmp 目录&quot;</span>);</span><br><span class="line">fs.readdir(<span class="string">&quot;/tmp/&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   files.forEach( <span class="function"><span class="keyword">function</span> (<span class="params">file</span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log( file );</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">查看 &#x2F;tmp 目录</span><br><span class="line">input.out</span><br><span class="line">output.out</span><br><span class="line">test</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure>
<h2 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h2><h3 id="语法-16"><a href="#语法-16" class="headerlink" title="语法"></a>语法</h3><p>以下为删除目录的语法格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.rmdir(path, callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-15"><a href="#参数-15" class="headerlink" title="参数"></a>参数</h3><p>参数使用说明如下：</p>
<ul>
<li><strong>path</strong> – 文件路径。</li>
<li><strong>callback</strong> – 回调函数，没有参数。</li>
</ul>
<h3 id="实例-30"><a href="#实例-30" class="headerlink" title="实例"></a>实例</h3><p>接下来我们创建 file.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 执行前创建一个空的 /tmp/test 目录</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备删除目录 /tmp/test&quot;</span>);</span><br><span class="line">fs.rmdir(<span class="string">&quot;/tmp/test&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;读取 /tmp 目录&quot;</span>);</span><br><span class="line">   fs.readdir(<span class="string">&quot;/tmp/&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">      files.forEach( <span class="function"><span class="keyword">function</span> (<span class="params">file</span>)</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log( file );</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node file.js </span><br><span class="line">准备删除目录 &#x2F;tmp&#x2F;test</span><br><span class="line">读取 &#x2F;tmp 目录</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<h2 id="文件模块方法参考手册"><a href="#文件模块方法参考手册" class="headerlink" title="文件模块方法参考手册"></a>文件模块方法参考手册</h2><p>以下为 Node.js 文件模块相同的方法列表：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>fs.rename(oldPath, newPath, callback)</strong> 异步 rename().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>fs.ftruncate(fd, len, callback)</strong> 异步 ftruncate().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>fs.ftruncateSync(fd, len)</strong> 同步 ftruncate()</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>fs.truncate(path, len, callback)</strong> 异步 truncate().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>fs.truncateSync(path, len)</strong> 同步 truncate()</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>fs.chown(path, uid, gid, callback)</strong> 异步 chown().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>fs.chownSync(path, uid, gid)</strong> 同步 chown()</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>fs.fchown(fd, uid, gid, callback)</strong> 异步 fchown().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>fs.fchownSync(fd, uid, gid)</strong> 同步 fchown()</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>fs.lchown(path, uid, gid, callback)</strong> 异步 lchown().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>fs.lchownSync(path, uid, gid)</strong> 同步 lchown()</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>fs.chmod(path, mode, callback)</strong> 异步 chmod().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>fs.chmodSync(path, mode)</strong> 同步 chmod().</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>fs.fchmod(fd, mode, callback)</strong> 异步 fchmod().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><strong>fs.fchmodSync(fd, mode)</strong> 同步 fchmod().</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><strong>fs.lchmod(path, mode, callback)</strong> 异步 lchmod().回调函数没有参数，但可能抛出异常。Only available on Mac OS X.</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><strong>fs.lchmodSync(path, mode)</strong> 同步 lchmod().</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><strong>fs.stat(path, callback)</strong> 异步 stat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><strong>fs.lstat(path, callback)</strong> 异步 lstat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><strong>fs.fstat(fd, callback)</strong> 异步 fstat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><strong>fs.statSync(path)</strong> 同步 stat(). 返回 fs.Stats 的实例。</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><strong>fs.lstatSync(path)</strong> 同步 lstat(). 返回 fs.Stats 的实例。</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><strong>fs.fstatSync(fd)</strong> 同步 fstat(). 返回 fs.Stats 的实例。</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><strong>fs.link(srcpath, dstpath, callback)</strong> 异步 link().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><strong>fs.linkSync(srcpath, dstpath)</strong> 同步 link().</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left"><strong>fs.symlink(srcpath, dstpath[, type], callback)</strong> 异步 symlink().回调函数没有参数，但可能抛出异常。 type 参数可以设置为 ‘dir’, ‘file’, 或 ‘junction’ (默认为 ‘file’) 。</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><strong>fs.symlinkSync(srcpath, dstpath[, type])</strong> 同步 symlink().</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><strong>fs.readlink(path, callback)</strong> 异步 readlink(). 回调函数有两个参数 err, linkString。</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left"><strong>fs.realpath(path[, cache], callback)</strong> 异步 realpath(). 回调函数有两个参数 err, resolvedPath。</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><strong>fs.realpathSync(path[, cache])</strong> 同步 realpath()。返回绝对路径。</td>
</tr>
<tr>
<td align="left">31</td>
<td align="left"><strong>fs.unlink(path, callback)</strong> 异步 unlink().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">32</td>
<td align="left"><strong>fs.unlinkSync(path)</strong> 同步 unlink().</td>
</tr>
<tr>
<td align="left">33</td>
<td align="left"><strong>fs.rmdir(path, callback)</strong> 异步 rmdir().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">34</td>
<td align="left"><strong>fs.rmdirSync(path)</strong> 同步 rmdir().</td>
</tr>
<tr>
<td align="left">35</td>
<td align="left"><strong>fs.mkdir(path[, mode], callback)</strong> S异步 mkdir(2).回调函数没有参数，但可能抛出异常。 访问权限默认为 0777。</td>
</tr>
<tr>
<td align="left">36</td>
<td align="left"><strong>fs.mkdirSync(path[, mode])</strong> 同步 mkdir().</td>
</tr>
<tr>
<td align="left">37</td>
<td align="left"><strong>fs.readdir(path, callback)</strong> 异步 readdir(3). 读取目录的内容。</td>
</tr>
<tr>
<td align="left">38</td>
<td align="left"><strong>fs.readdirSync(path)</strong> 同步 readdir().返回文件数组列表。</td>
</tr>
<tr>
<td align="left">39</td>
<td align="left"><strong>fs.close(fd, callback)</strong> 异步 close().回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left"><strong>fs.closeSync(fd)</strong> 同步 close().</td>
</tr>
<tr>
<td align="left">41</td>
<td align="left"><strong>fs.open(path, flags[, mode], callback)</strong> 异步打开文件。</td>
</tr>
<tr>
<td align="left">42</td>
<td align="left"><strong>fs.openSync(path, flags[, mode])</strong> 同步 version of fs.open().</td>
</tr>
<tr>
<td align="left">43</td>
<td align="left"><strong>fs.utimes(path, atime, mtime, callback)</strong></td>
</tr>
<tr>
<td align="left">44</td>
<td align="left"><strong>fs.utimesSync(path, atime, mtime)</strong> 修改文件时间戳，文件通过指定的文件路径。</td>
</tr>
<tr>
<td align="left">45</td>
<td align="left"><strong>fs.futimes(fd, atime, mtime, callback)</strong></td>
</tr>
<tr>
<td align="left">46</td>
<td align="left"><strong>fs.futimesSync(fd, atime, mtime)</strong> 修改文件时间戳，通过文件描述符指定。</td>
</tr>
<tr>
<td align="left">47</td>
<td align="left"><strong>fs.fsync(fd, callback)</strong> 异步 fsync.回调函数没有参数，但可能抛出异常。</td>
</tr>
<tr>
<td align="left">48</td>
<td align="left"><strong>fs.fsyncSync(fd)</strong> 同步 fsync.</td>
</tr>
<tr>
<td align="left">49</td>
<td align="left"><strong>fs.write(fd, buffer, offset, length[, position], callback)</strong> 将缓冲区内容写入到通过文件描述符指定的文件。</td>
</tr>
<tr>
<td align="left">50</td>
<td align="left"><strong>fs.write(fd, data[, position[, encoding]], callback)</strong> 通过文件描述符 fd 写入文件内容。</td>
</tr>
<tr>
<td align="left">51</td>
<td align="left"><strong>fs.writeSync(fd, buffer, offset, length[, position])</strong> 同步版的 fs.write()。</td>
</tr>
<tr>
<td align="left">52</td>
<td align="left"><strong>fs.writeSync(fd, data[, position[, encoding]])</strong> 同步版的 fs.write().</td>
</tr>
<tr>
<td align="left">53</td>
<td align="left"><strong>fs.read(fd, buffer, offset, length, position, callback)</strong> 通过文件描述符 fd 读取文件内容。</td>
</tr>
<tr>
<td align="left">54</td>
<td align="left"><strong>fs.readSync(fd, buffer, offset, length, position)</strong> 同步版的 fs.read.</td>
</tr>
<tr>
<td align="left">55</td>
<td align="left"><strong>fs.readFile(filename[, options], callback)</strong> 异步读取文件内容。</td>
</tr>
<tr>
<td align="left">56</td>
<td align="left"><strong>fs.readFileSync(filename[, options])</strong>&lt;br同步版的 fs.readfile.&lt;=”” td=””&gt;&lt;/br同步版的&gt;</td>
</tr>
<tr>
<td align="left">57</td>
<td align="left"><strong>fs.writeFile(filename, data[, options], callback)</strong> 异步写入文件内容。</td>
</tr>
<tr>
<td align="left">58</td>
<td align="left"><strong>fs.writeFileSync(filename, data[, options])</strong> 同步版的 fs.writeFile。</td>
</tr>
<tr>
<td align="left">59</td>
<td align="left"><strong>fs.appendFile(filename, data[, options], callback)</strong> 异步追加文件内容。</td>
</tr>
<tr>
<td align="left">60</td>
<td align="left"><strong>fs.appendFileSync(filename, data[, options])</strong> The 同步 version of fs.appendFile.</td>
</tr>
<tr>
<td align="left">61</td>
<td align="left"><strong>fs.watchFile(filename[, options], listener)</strong> 查看文件的修改。</td>
</tr>
<tr>
<td align="left">62</td>
<td align="left"><strong>fs.unwatchFile(filename[, listener])</strong> 停止查看 filename 的修改。</td>
</tr>
<tr>
<td align="left">63</td>
<td align="left"><strong>fs.watch(filename[, options][, listener])</strong> 查看 filename 的修改，filename 可以是文件或目录。返回 fs.FSWatcher 对象。</td>
</tr>
<tr>
<td align="left">64</td>
<td align="left"><strong>fs.exists(path, callback)</strong> 检测给定的路径是否存在。</td>
</tr>
<tr>
<td align="left">65</td>
<td align="left"><strong>fs.existsSync(path)</strong> 同步版的 fs.exists.</td>
</tr>
<tr>
<td align="left">66</td>
<td align="left"><strong>fs.access(path[, mode], callback)</strong> 测试指定路径用户权限。</td>
</tr>
<tr>
<td align="left">67</td>
<td align="left"><strong>fs.accessSync(path[, mode])</strong> 同步版的 fs.access。</td>
</tr>
<tr>
<td align="left">68</td>
<td align="left"><strong>fs.createReadStream(path[, options])</strong> 返回ReadStream 对象。</td>
</tr>
<tr>
<td align="left">69</td>
<td align="left"><strong>fs.createWriteStream(path[, options])</strong> 返回 WriteStream 对象。</td>
</tr>
<tr>
<td align="left">70</td>
<td align="left"><strong>fs.symlink(srcpath, dstpath[, type], callback)</strong> 异步 symlink().回调函数没有参数，但可能抛出异常。</td>
</tr>
</tbody></table>
<p>更多内容，请查看官网文件模块描述：<a target="_blank" rel="noopener" href="https://nodejs.org/api/fs.html#fs_fs_rename_oldpath_newpath_callback">File System</a>。</p>
<h1 id="Node-js-GET-POST请求"><a href="#Node-js-GET-POST请求" class="headerlink" title="Node.js GET/POST请求"></a>Node.js GET/POST请求</h1><p>在很多场景中，我们的服务器都需要跟用户的浏览器打交道，如表单提交。</p>
<p>表单提交到服务器一般都使用 GET/POST 请求。</p>
<p>本文码云笔记将为大家介绍 Node.js GET/POST请求。</p>
<h3 id="获取GET请求内容"><a href="#获取GET请求内容" class="headerlink" title="获取GET请求内容"></a>获取GET请求内容</h3><p>由于GET请求直接被嵌入在路径中，URL是完整的请求路径，包括了<code>?</code>后面的部分，因此你可以手动解析后面的内容作为GET请求的参数。</p>
<p>node.js 中 <code>url</code> 模块中的 <code>parse</code> 函数提供了这个功能。</p>
<h4 id="实例-31"><a href="#实例-31" class="headerlink" title="实例"></a>实例</h4><p>新建一个server.js文件，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>&#125;);</span><br><span class="line">	res.end(util.inspect(url.parse(req.url, <span class="literal">true</span>)));</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>使用 <strong>node</strong> 命令执行以上的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <code>http://localhost:8888/user?name=码云笔记&amp;url=www.mybj123.com</code> 然后查看返回结果:</p>
<p><img src="C:\Users\52862\AppData\Roaming\Typora\typora-user-images\image-20201216102829575.png" alt="image-20201216102829575"></p>
<h3 id="获取-URL-的参数"><a href="#获取-URL-的参数" class="headerlink" title="获取 URL 的参数"></a>获取 URL 的参数</h3><p>我们可以使用 <code>url.parse</code> 方法来解析 <code>URL</code> 中的参数，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 解析 url 参数</span></span><br><span class="line">	<span class="keyword">var</span> params = url.parse(req.url, <span class="literal">true</span>).query;</span><br><span class="line">	res.write(<span class="string">&quot;网站名：&quot;</span> + params.name);</span><br><span class="line">	res.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	res.write(<span class="string">&quot;网站 URL：&quot;</span> + params.url);</span><br><span class="line">	res.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>使用 <strong>node</strong> 命令执行以上的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <code>http://localhost:8888/user?name=码云笔记&amp;url=www.mybj123.com</code> 然后查看返回结果:</p>
<p><img src="C:\Users\52862\AppData\Roaming\Typora\typora-user-images\image-20201216103649759.png" alt="image-20201216103649759"></p>
<h2 id="获取-POST-请求内容"><a href="#获取-POST-请求内容" class="headerlink" title="获取 POST 请求内容"></a>获取 POST 请求内容</h2><p>POST 请求的内容全部的都在请求体中，<code>http.ServerRequest</code> 并没有一个属性内容为请求体，原因是等待请求体传输可能是一件耗时的工作。</p>
<p>比如上传文件，而很多时候我们可能并不需要理会请求体的内容，恶意的<code>POST</code>请求会大大消耗服务器的资源，所以 <code>node.js</code> 默认是不会解析请求体的，当你需要的时候，需要手动来做。</p>
<h4 id="基本语法结构说明"><a href="#基本语法结构说明" class="headerlink" title="基本语法结构说明"></a>基本语法结构说明</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 定义了一个post变量，用于暂存请求体的信息</span></span><br><span class="line">    <span class="keyword">const</span> post = <span class="string">&#x27;&#x27;</span>;     </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中</span></span><br><span class="line">    req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;    </span><br><span class="line">        post += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。</span></span><br><span class="line">    req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;    </span><br><span class="line">        post = querystring.parse(post);</span><br><span class="line">        res.end(util.inspect(post));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<h4 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示"></a>实例演示</h4><p>以下实例表单通过 POST 提交并输出数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> postHTML = </span><br><span class="line">  <span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;码云笔记 Node.js 实例&lt;/title&gt;&lt;/head&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;body&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;form method=&quot;post&quot;&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;网站名： &lt;input name=&quot;name&quot;&gt;&lt;br&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;网站 URL： &lt;input name=&quot;url&quot;&gt;&lt;br&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;input type=&quot;submit&quot;&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;/form&gt;&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> body = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    body += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 解析参数</span></span><br><span class="line">    body = querystring.parse(body);</span><br><span class="line">    <span class="comment">// 设置响应头部信息及编码</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf8&#x27;</span>&#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(body.name &amp;&amp; body.url) &#123; <span class="comment">// 输出提交的数据</span></span><br><span class="line">        res.write(<span class="string">&quot;网站名：&quot;</span> + body.name);</span><br><span class="line">        res.write(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        res.write(<span class="string">&quot;网站 URL：&quot;</span> + body.url);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 输出表单</span></span><br><span class="line">        res.write(postHTML);</span><br><span class="line">    &#125;</span><br><span class="line">    res.end();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>使用 <strong>node</strong> 命令执行以上的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-工具模块"><a href="#Node-js-工具模块" class="headerlink" title="Node.js 工具模块"></a>Node.js 工具模块</h1><p>在 Node.js 模块库中有很多好用的模块。接下来我们为大家介绍几种常用模块的使用。</p>
<h2 id="一、Node-js-OS-模块"><a href="#一、Node-js-OS-模块" class="headerlink" title="一、Node.js OS 模块"></a>一、Node.js OS 模块</h2><p>Node.js os 模块提供了一些基本的系统操作函数。我们可以通过以下方式引入该模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>os.tmpdir()</strong> 返回操作系统的默认临时文件夹。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>os.endianness()</strong> 返回 CPU 的字节序，可能的是 “BE” 或 “LE”。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>os.hostname()</strong> 返回操作系统的主机名。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>os.type()</strong> 返回操作系统名</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>os.platform()</strong> 返回编译时的操作系统名</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>os.arch()</strong> 返回操作系统 CPU 架构，可能的值有 “x64″、”arm” 和 “ia32″。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>os.release()</strong> 返回操作系统的发行版本。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>os.uptime()</strong> 返回操作系统运行的时间，以秒为单位。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>os.loadavg()</strong> 返回一个包含 1、5、15 分钟平均负载的数组。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>os.totalmem()</strong> 返回系统内存总量，单位为字节。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>os.freemem()</strong> 返回操作系统空闲内存量，单位是字节。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>os.cpus()</strong> 返回一个对象数组，包含所安装的每个 CPU/内核的信息：型号、速度（单位 MHz）、时间（一个包含 user、nice、sys、idle 和 irq 所使用 CPU/内核毫秒数的对象）。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>os.networkInterfaces()</strong> 获得网络接口列表。</td>
</tr>
</tbody></table>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">属性 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>os.EOL</strong> 定义了操作系统的行尾符的常量。</td>
</tr>
</tbody></table>
<h3 id="实例-32"><a href="#实例-32" class="headerlink" title="实例"></a>实例</h3><p>创建 main.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// CPU 的字节序</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;endianness : &#x27;</span> + os.endianness());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作系统名</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;type : &#x27;</span> + os.type());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作系统名</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;platform : &#x27;</span> + os.platform());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 系统内存总量</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;total memory : &#x27;</span> + os.totalmem() + <span class="string">&quot; bytes.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作系统空闲内存量</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;free memory : &#x27;</span> + os.freemem() + <span class="string">&quot; bytes.&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ node main.js </span><br><span class="line">endianness : LE</span><br><span class="line">type : Linux</span><br><span class="line">platform : linux</span><br><span class="line">total memory : 25103400960 bytes.</span><br><span class="line">free memory : 20676710400 bytes.</span><br></pre></td></tr></table></figure>
<h2 id="二、Node-js-Path-模块"><a href="#二、Node-js-Path-模块" class="headerlink" title="二、Node.js Path 模块"></a>二、Node.js Path 模块</h2><p>Node.js path 模块提供了一些用于处理文件路径的小工具，我们可以通过以下方式引入该模块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>path.normalize(p)</strong> 规范化路径，注意’..’ 和 ‘.’。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>path.join([path1][, path2][, …])</strong> 用于连接路径。该方法的主要用途在于，会正确使用当前系统的路径分隔符，Unix系统是”<code>/</code>“，Windows系统是”<code>\</code>“。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>path.resolve([from …], to)</strong> 将 <strong>to</strong> 参数解析为绝对路径，给定的路径的序列是从右往左被处理的，后面每个 <code>path</code> 被依次解析，直到构造完成一个绝对路径。 例如，给定的路径片段的序列为：<code>/foo、/bar、baz</code>，则调用 p<code>ath.resolve(&#39;/foo&#39;, &#39;/bar&#39;, &#39;baz&#39;)</code> 会返回 <code>/bar/baz</code>。<code>path.resolve(&#39;/foo/bar&#39;, &#39;./baz&#39;); // 返回: &#39;/foo/bar/baz&#39; path.resolve(&#39;/foo/bar&#39;, &#39;/tmp/file/&#39;); // 返回: &#39;/tmp/file&#39; path.resolve(&#39;wwwroot&#39;, &#39;static_files/png/&#39;, &#39;../gif/image.gif&#39;); // 如果当前工作目录为 /home/myself/node， // 则返回 &#39;/home/myself/node/wwwroot/static_files/gif/image.gif&#39;</code></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>path.isAbsolute(path)</strong> 判断参数 <code>path</code> 是否是绝对路径。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>path.relative(from, to)</strong> 用于将绝对路径转为相对路径，返回从 from 到 to 的相对路径（基于当前工作目录）。在 Linux 上：<code>path.relative(&#39;/data/orandea/test/aaa&#39;, &#39;/data/orandea/impl/bbb&#39;); // 返回: &#39;../../impl/bbb&#39;</code>在 Windows 上：<code>path.relative(&#39;C:\\orandea\\test\\aaa&#39;, &#39;C:\\orandea\\impl\\bbb&#39;); // 返回: &#39;..\\..\\impl\\bbb&#39;</code></td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>path.dirname(p)</strong> 返回路径中代表文件夹的部分，同 Unix 的<code>dirname</code> 命令类似。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>path.basename(p[, ext])</strong> 返回路径中的最后一部分。同 Unix 命令 <code>bashname</code> 类似。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>path.extname(p)</strong> 返回路径中文件的后缀名，即路径中最后一个’<code>.</code>‘之后的部分。如果一个路径中并不包含’<code>.</code>‘或该路径只包含一个’<code>.</code>‘ 且这个’<code>.</code>‘为路径的第一个字符，则此命令返回空字符串。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>path.parse(pathString)</strong> 返回路径字符串的对象。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>path.format(pathObject)</strong> 从对象中返回路径字符串，和 <code>path.parse</code> 相反。</td>
</tr>
</tbody></table>
<h3 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">属性 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>path.sep</strong> 平台的文件路径分隔符，’<code>\\</code>‘ 或 ‘<code>/</code>‘。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>path.delimiter</strong> 平台的分隔符, ; or ‘<code>:</code>‘.</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>path.posix</strong> 提供上述 path 的方法，不过总是以 posix 兼容的方式交互。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>path.win32</strong> 提供上述 path 的方法，不过总是以 win32 兼容的方式交互。</td>
</tr>
</tbody></table>
<h3 id="实例-33"><a href="#实例-33" class="headerlink" title="实例"></a>实例</h3><p>创建 main.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化路径</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;normalization : &#x27;</span> + path.normalize(<span class="string">&#x27;/test/test1//2slashes/1slash/tab/..&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接路径</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;joint path : &#x27;</span> + path.join(<span class="string">&#x27;/test&#x27;</span>, <span class="string">&#x27;test1&#x27;</span>, <span class="string">&#x27;2slashes/1slash&#x27;</span>, <span class="string">&#x27;tab&#x27;</span>, <span class="string">&#x27;..&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为绝对路径</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;resolve : &#x27;</span> + path.resolve(<span class="string">&#x27;main.js&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径中文件的后缀名</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;ext name : &#x27;</span> + path.extname(<span class="string">&#x27;main.js&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>代码执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ node main.js </span><br><span class="line">normalization : &#x2F;test&#x2F;test1&#x2F;2slashes&#x2F;1slash</span><br><span class="line">joint path : &#x2F;test&#x2F;test1&#x2F;2slashes&#x2F;1slash</span><br><span class="line">resolve : &#x2F;web&#x2F;com&#x2F;1427176256_27423&#x2F;main.js</span><br><span class="line">ext name : .js</span><br></pre></td></tr></table></figure>
<h2 id="三、Node-js-Net-模块"><a href="#三、Node-js-Net-模块" class="headerlink" title="三、Node.js Net 模块"></a>三、Node.js Net 模块</h2><p>Node.js Net 模块提供了一些用于底层的网络通信的小工具，包含了创建服务器/客户端的方法，我们可以通过以下方式引入该模块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="方法-3"><a href="#方法-3" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>net.createServer([options][, connectionListener])</strong> 创建一个 TCP 服务器。参数 connectionListener 自动给 ‘connection’ 事件创建监听器。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>net.connect(options[, connectionListener])</strong> 返回一个新的 ‘net.Socket’，并连接到指定的地址和端口。 当 socket 建立的时候，将会触发 ‘connect’ 事件。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>net.createConnection(options[, connectionListener])</strong> 创建一个到端口 port 和 主机 host的 TCP 连接。 host 默认为 ‘localhost’。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>net.connect(port[, host][, connectListener])</strong> 创建一个端口为 port 和主机为 host的 TCP 连接 。host 默认为 ‘localhost’。参数 connectListener 将会作为监听器添加到 ‘connect’ 事件。返回 ‘net.Socket’。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>net.createConnection(port[, host][, connectListener])</strong> 创建一个端口为 port 和主机为 host的 TCP 连接 。host 默认为 ‘localhost’。参数 connectListener 将会作为监听器添加到 ‘connect’ 事件。返回 ‘net.Socket’。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>net.connect(path[, connectListener])</strong> 创建连接到 path 的 unix socket 。参数 connectListener 将会作为监听器添加到 ‘connect’ 事件上。返回 ‘net.Socket’。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>net.createConnection(path[, connectListener])</strong> 创建连接到 path 的 unix socket 。参数 connectListener 将会作为监听器添加到 ‘connect’ 事件。返回 ‘net.Socket’。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>net.isIP(input)</strong> 检测输入的是否为 IP 地址。 IPV4 返回 4， IPV6 返回 6，其他情况返回 0。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>net.isIPv4(input)</strong> 如果输入的地址为 IPV4， 返回 true，否则返回 false。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>net.isIPv6(input)</strong> 如果输入的地址为 IPV6， 返回 true，否则返回 false。</td>
</tr>
</tbody></table>
<hr>
<h3 id="net-Server"><a href="#net-Server" class="headerlink" title="net.Server"></a>net.Server</h3><p>net.Server通常用于创建一个 TCP 或本地服务器。</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>server.listen(port[, host][, backlog][, callback])</strong> 监听指定端口 port 和 主机 host ac连接。 默认情况下 host 接受任何 IPv4 地址(INADDR_ANY)的直接连接。端口 port 为 0 时，则会分配一个随机端口。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>server.listen(path[, callback])</strong> 通过指定 path 的连接，启动一个本地 socket 服务器。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>server.listen(handle[, callback])</strong> 通过指定句柄连接。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>server.listen(options[, callback])</strong> options 的属性：端口 port, 主机 host, 和 backlog, 以及可选参数 callback 函数, 他们在一起调用server.listen(port, [host], [backlog], [callback])。还有，参数 path 可以用来指定 UNIX socket。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>server.close([callback])</strong> 服务器停止接收新的连接，保持现有连接。这是异步函数，当所有连接结束的时候服务器会关闭，并会触发 ‘close’ 事件。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>server.address()</strong> 操作系统返回绑定的地址，协议族名和服务器端口。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>server.unref()</strong> 如果这是事件系统中唯一一个活动的服务器，调用 unref 将允许程序退出。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>server.ref()</strong> 与 unref 相反，如果这是唯一的服务器，在之前被 unref 了的服务器上调用 ref 将不会让程序退出（默认行为）。如果服务器已经被 ref，则再次调用 ref 并不会产生影响。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>server.getConnections(callback)</strong> 异步获取服务器当前活跃连接的数量。当 socket 发送给子进程后才有效；回调函数有 2 个参数 err 和 count。</td>
</tr>
</tbody></table>
<h3 id="事件-1"><a href="#事件-1" class="headerlink" title="事件"></a>事件</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">事件 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>listening</strong> 当服务器调用 server.listen 绑定后会触发。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>connection</strong> 当新连接创建后会被触发。socket 是 net.Socket实例。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>close</strong> 服务器关闭时会触发。注意，如果存在连接，这个事件不会被触发直到所有的连接关闭。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>error</strong> 发生错误时触发。’close’ 事件将被下列事件直接调用</td>
</tr>
</tbody></table>
<h3 id="net-Socket"><a href="#net-Socket" class="headerlink" title="net.Socket"></a>net.Socket</h3><p><code>net.Socket</code> 对象是 <code>TCP</code> 或 <code>UNIX Socket</code> 的抽象。<code>net.Socket</code> 实例实现了一个双工流接口。 他们可以在用户创建客户端(使用 <code>connect()</code>)时使用, 或者由 <code>Node</code> 创建它们，并通过 <code>connection</code> 服务器事件传递给用户。</p>
<h3 id="事件-2"><a href="#事件-2" class="headerlink" title="事件"></a>事件</h3><p>net.Socket 事件有：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">事件 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>lookup</strong> 在解析域名后，但在连接前，触发这个事件。对 UNIX sokcet 不适用。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>connect</strong> 成功建立 socket 连接时触发。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>data</strong> 当接收到数据时触发。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>end</strong> 当 socket 另一端发送 FIN 包时，触发该事件。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>timeout</strong> 当 socket 空闲超时时触发，仅是表明 socket 已经空闲。用户必须手动关闭连接。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>drain</strong> 当写缓存为空得时候触发。可用来控制上传。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>error</strong> 错误发生时触发。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>close</strong> 当 socket 完全关闭时触发。参数 had_error 是布尔值，它表示是否因为传输错误导致 socket 关闭。</td>
</tr>
</tbody></table>
<h3 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h3><p>net.Socket 提供了很多有用的属性，便于控制 socket 交互：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">属性 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>socket.bufferSize</strong> 该属性显示了要写入缓冲区的字节数。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>socket.remoteAddress</strong> 远程的 IP 地址字符串，例如：’74.125.127.100′ or ‘2001:4860:a005::68’。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>socket.remoteFamily</strong> 远程IP协议族字符串，比如 ‘IPv4’ or ‘IPv6’。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>socket.remotePort</strong> 远程端口，数字表示，例如：80 or 21。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>socket.localAddress</strong> 网络连接绑定的本地接口 远程客户端正在连接的本地 IP 地址，字符串表示。例如，如果你在监听’0.0.0.0’而客户端连接在’192.168.1.1’，这个值就会是 ‘192.168.1.1’。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>socket.localPort</strong> 本地端口地址，数字表示。例如：80 or 21。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>socket.bytesRead</strong> 接收到得字节数。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>socket.bytesWritten</strong> 发送的字节数。</td>
</tr>
</tbody></table>
<h3 id="方法-4"><a href="#方法-4" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>new net.Socket([options])</strong> 构造一个新的 socket 对象。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>socket.connect(port[, host][, connectListener])</strong> 指定端口 port 和 主机 host，创建 socket 连接 。参数 host 默认为 localhost。通常情况不需要使用 net.createConnection 打开 socket。只有你实现了自己的 socket 时才会用到。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>socket.connect(path[, connectListener])</strong> 打开指定路径的 unix socket。通常情况不需要使用 net.createConnection 打开 socket。只有你实现了自己的 socket 时才会用到。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>socket.setEncoding([encoding])</strong> 设置编码</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>socket.write(data[, encoding][, callback])</strong> 在 socket 上发送数据。第二个参数指定了字符串的编码，默认是 UTF8 编码。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>socket.end([data][, encoding])</strong> 半关闭 socket。例如，它发送一个 FIN 包。可能服务器仍在发送数据。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>socket.destroy()</strong> 确保没有 I/O 活动在这个套接字上。只有在错误发生情况下才需要。（处理错误等等）。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>socket.pause()</strong> 暂停读取数据。就是说，不会再触发 data 事件。对于控制上传非常有用。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>socket.resume()</strong> 调用 pause() 后想恢复读取数据。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>socket.setTimeout(timeout[, callback])</strong> socket 闲置时间超过 timeout 毫秒后 ，将 socket 设置为超时。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>socket.setNoDelay([noDelay])</strong> 禁用纳格（Nagle）算法。默认情况下 TCP 连接使用纳格算法，在发送前他们会缓冲数据。将 noDelay 设置为 true 将会在调用 socket.write() 时立即发送数据。noDelay 默认值为 true。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>socket.setKeepAlive([enable][, initialDelay])</strong> 禁用/启用长连接功能，并在发送第一个在闲置 socket 上的长连接 probe 之前，可选地设定初始延时。默认为 false。 设定 initialDelay （毫秒），来设定收到的最后一个数据包和第一个长连接probe之间的延时。将 initialDelay 设为0，将会保留默认（或者之前）的值。默认值为0.</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>socket.address()</strong> 操作系统返回绑定的地址，协议族名和服务器端口。返回的对象有 3 个属性，比如{ port: 12346, family: ‘IPv4’, address: ‘127.0.0.1’ }。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>socket.unref()</strong> 如果这是事件系统中唯一一个活动的服务器，调用 unref 将允许程序退出。如果服务器已被 unref，则再次调用 unref 并不会产生影响。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><strong>socket.ref()</strong> 与 unref 相反，如果这是唯一的服务器，在之前被 unref 了的服务器上调用 ref 将不会让程序退出（默认行为）。如果服务器已经被 ref，则再次调用 ref 并不会产生影响。</td>
</tr>
</tbody></table>
<h3 id="实例-34"><a href="#实例-34" class="headerlink" title="实例"></a>实例</h3><p>创建 server.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">connection</span>) </span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;client connected&#x27;</span>);</span><br><span class="line">   connection.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;客户端关闭连接&#x27;</span>);</span><br><span class="line">   &#125;);</span><br><span class="line">   connection.write(<span class="string">&#x27;Hello World!\r\n&#x27;</span>);</span><br><span class="line">   connection.pipe(connection);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8080</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server is listening&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以上服务端代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js</span><br><span class="line">server is listening   # 服务已创建并监听 8080 端口</span><br></pre></td></tr></table></figure>
<p>新开一个窗口，创建 client.js 文件，代码如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> client = net.connect(&#123;<span class="attr">port</span>: <span class="number">8080</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;连接到服务器！&#x27;</span>);  </span><br><span class="line">&#125;);</span><br><span class="line">client.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">   client.end();</span><br><span class="line">&#125;);</span><br><span class="line">client.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;断开与服务器的连接&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以上客户端的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">连接到服务器！</span><br><span class="line">Hello World!</span><br><span class="line"></span><br><span class="line">断开与服务器的连接</span><br></pre></td></tr></table></figure>
<h2 id="四、Node-js-DNS-模块"><a href="#四、Node-js-DNS-模块" class="headerlink" title="四、Node.js DNS 模块"></a>四、Node.js DNS 模块</h2><p>Node.js <strong>DNS</strong> 模块用于解析域名。引入 DNS 模块语法格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dns = <span class="built_in">require</span>(<span class="string">&quot;dns&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="方法-5"><a href="#方法-5" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>dns.lookup(hostname[, options], callback)</strong> 将域名（比如 ‘runoob.com’）解析为第一条找到的记录 A （IPV4）或 AAAA(IPV6)。参数 options可以是一个对象或整数。如果没有提供 options，IP v4 和 v6 地址都可以。如果 options 是整数，则必须是 4 或 6。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>dns.lookupService(address, port, callback)</strong> 使用 getnameinfo 解析传入的地址和端口为域名和服务。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>dns.resolve(hostname[, rrtype], callback)</strong> 将一个域名（如 ‘runoob.com’）解析为一个 rrtype 指定记录类型的数组。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>dns.resolve4(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能查询 IPv4 (A 记录）。 addresses IPv4 地址数组 (比如，[‘74.125.79.104’, ‘74.125.79.105’, ‘74.125.79.106’]）。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>dns.resolve6(hostname, callback)</strong> 和 dns.resolve4() 类似， 仅能查询 IPv6( AAAA 查询）</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>dns.resolveMx(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能查询邮件交换(MX 记录)。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>dns.resolveTxt(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能进行文本查询 (TXT 记录）。 addresses 是 2-d 文本记录数组。(比如，[ [‘v=spf1 ip4:0.0.0.0 ‘, ‘~all’ ] ]）。 每个子数组包含一条记录的 TXT 块。根据使用情况可以连接在一起，也可单独使用。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>dns.resolveSrv(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能进行服务记录查询 (SRV 记录）。 addresses 是 hostname可用的 SRV 记录数组。 SRV 记录属性有优先级（priority），权重（weight）, 端口（port）, 和名字（name） (比如，[{‘priority’: 10, ‘weight’: 5, ‘port’: 21223, ‘name’: ‘service.example.com’}, …]）。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>dns.resolveSoa(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能查询权威记录(SOA 记录）。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>dns.resolveNs(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能进行域名服务器记录查询(NS 记录）。 addresses 是域名服务器记录数组（hostname 可以使用） (比如, [‘ns1.example.com’, ‘ns2.example.com’]）。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>dns.resolveCname(hostname, callback)</strong> 和 dns.resolve() 类似, 仅能进行别名记录查询 (CNAME记录)。addresses 是对 hostname 可用的别名记录数组 (比如，, [‘bar.example.com’]）。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>dns.reverse(ip, callback)</strong> 反向解析 IP 地址，指向该 IP 地址的域名数组。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>dns.getServers()</strong> 返回一个用于当前解析的 IP 地址数组的字符串。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>dns.setServers(servers)</strong> 指定一组 IP 地址作为解析服务器。</td>
</tr>
</tbody></table>
<h3 id="rrtypes"><a href="#rrtypes" class="headerlink" title="rrtypes"></a>rrtypes</h3><p>以下列出了 <code>dns.resolve()</code> 方法中有效的 <code>rrtypes</code>值:</p>
<ul>
<li><code>&#39;A&#39;</code> IPV4 地址, 默认</li>
<li><code>&#39;AAAA&#39;</code> IPV6 地址</li>
<li><code>&#39;MX&#39;</code> 邮件交换记录</li>
<li><code>&#39;TXT&#39;</code> text 记录</li>
<li><code>&#39;SRV&#39;</code> SRV 记录</li>
<li><code>&#39;PTR&#39;</code> 用来反向 IP 查找</li>
<li><code>&#39;NS&#39;</code> 域名服务器记录</li>
<li><code>&#39;CNAME&#39;</code> 别名记录</li>
<li><code>&#39;SOA&#39;</code> 授权记录的初始值</li>
</ul>
<h3 id="错误码"><a href="#错误码" class="headerlink" title="错误码"></a>错误码</h3><p>每次 DNS 查询都可能返回以下错误码：</p>
<ul>
<li><code>dns.NODATA</code>: 无数据响应。</li>
<li><code>dns.FORMERR</code>: 查询格式错误。</li>
<li><code>dns.SERVFAIL</code>: 常规失败。</li>
<li><code>dns.NOTFOUND</code>: 没有找到域名。</li>
<li><code>dns.NOTIMP</code>: 未实现请求的操作。</li>
<li><code>dns.REFUSED</code>: 拒绝查询。</li>
<li><code>dns.BADQUERY</code>: 查询格式错误。</li>
<li><code>dns.BADNAME</code>: 域名格式错误。</li>
<li><code>dns.BADFAMILY</code>: 地址协议不支持。</li>
<li><code>dns.BADRESP</code>: 回复格式错误。</li>
<li><code>dns.CONNREFUSED</code>: 无法连接到 DNS 服务器。</li>
<li><code>dns.TIMEOUT</code>: 连接 DNS 服务器超时。</li>
<li><code>dns.EOF</code>: 文件末端。</li>
<li><code>dns.FILE</code>: 读文件错误。</li>
<li><code>dns.NOMEM</code>: 内存溢出。</li>
<li><code>dns.DESTRUCTION</code>: 通道被摧毁。</li>
<li><code>dns.BADSTR</code>: 字符串格式错误。</li>
<li><code>dns.BADFLAGS</code>: 非法标识符。</li>
<li><code>dns.NONAME</code>: 所给主机不是数字。</li>
<li><code>dns.BADHINTS</code>: 非法HINTS标识符。</li>
<li><code>dns.NOTINITIALIZED</code>: c c-ares 库尚未初始化。</li>
<li><code>dns.LOADIPHLPAPI</code>: 加载 iphlpapi.dll 出错。</li>
<li><code>dns.ADDRGETNETWORKPARAMS</code>: 无法找到 GetNetworkParams 函数。</li>
<li><code>dns.CANCELLED</code>: 取消 DNS 查询。</li>
</ul>
<h3 id="实例-35"><a href="#实例-35" class="headerlink" title="实例"></a>实例</h3><p>创建 main.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dns = <span class="built_in">require</span>(<span class="string">&#x27;dns&#x27;</span>);</span><br><span class="line"></span><br><span class="line">dns.lookup(<span class="string">&#x27;www.github.com&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">onLookup</span>(<span class="params">err, address, family</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;ip 地址:&#x27;</span>, address);</span><br><span class="line">   dns.reverse(address, <span class="function"><span class="keyword">function</span> (<span class="params">err, hostnames</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err.stack);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;反向解析 &#x27;</span> + address + <span class="string">&#x27;: &#x27;</span> + <span class="built_in">JSON</span>.stringify(hostnames));</span><br><span class="line">&#125;);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以上代码，结果如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">address: 192.30.252.130</span><br><span class="line">reverse for 192.30.252.130: [&quot;github.com&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="五、Node-js-Domain-模块"><a href="#五、Node-js-Domain-模块" class="headerlink" title="五、Node.js Domain 模块"></a>五、Node.js Domain 模块</h2><p>Node.js <strong>Domain(域)</strong> 简化异步代码的异常处理，可以捕捉处理<code>try...catch</code>无法捕捉的异常。引入 <code>Domain</code> 模块 语法格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domain = <span class="built_in">require</span>(<span class="string">&quot;domain&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><code>domain</code>模块，把处理多个不同的<code>IO</code>的操作作为一个组。注册事件和回调到<code>domain</code>，当发生一个错误事件或抛出一个错误时，<code>domain</code>对象会被通知，不会丢失上下文环境，也不导致程序错误立即退出，与<code>process.on(&#39;uncaughtException&#39;)</code>不同。</p>
<p>Domain 模块可分为隐式绑定和显式绑定：</p>
<ul>
<li>隐式绑定: 把在<code>domain</code>上下文中定义的变量，自动绑定到<code>domain</code>对象</li>
<li>显式绑定: 把不是在<code>domain</code>上下文中定义的变量，以代码的方式绑定到<code>domain</code>对象</li>
</ul>
<h3 id="方法-6"><a href="#方法-6" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>domain.run(function)</strong> 在域的上下文运行提供的函数，隐式的绑定了所有的事件分发器，计时器和底层请求。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>domain.add(emitter)</strong> 显式的增加事件</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>domain.remove(emitter)</strong> 删除事件。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>domain.bind(callback)</strong> 返回的函数是一个对于所提供的回调函数的包装函数。当调用这个返回的函数时，所有被抛出的错误都会被导向到这个域的 error 事件。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>domain.intercept(callback)</strong> 和 domain.bind(callback) 类似。除了捕捉被抛出的错误外，它还会拦截 Error 对象作为参数传递到这个函数。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>domain.enter()</strong> 进入一个异步调用的上下文，绑定到domain。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>domain.exit()</strong> 退出当前的domain，切换到不同的链的异步调用的上下文中。对应domain.enter()。</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>domain.dispose()</strong> 释放一个domain对象，让node进程回收这部分资源。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>domain.create()</strong> 返回一个domain对象。</td>
</tr>
</tbody></table>
<hr>
<h3 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">属性 &amp; 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>domain.members</strong> 已加入domain对象的域定时器和事件发射器的数组。</td>
</tr>
</tbody></table>
<h3 id="实例-36"><a href="#实例-36" class="headerlink" title="实例"></a>实例</h3><p>创建 main.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&quot;events&quot;</span>).EventEmitter;</span><br><span class="line"><span class="keyword">const</span> domain = <span class="built_in">require</span>(<span class="string">&quot;domain&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter1 = <span class="keyword">new</span> EventEmitter();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建域</span></span><br><span class="line"><span class="keyword">const</span> domain1 = domain.create();</span><br><span class="line"></span><br><span class="line">domain1.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;domain1 处理这个错误 (&quot;</span>+err.message+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显式绑定</span></span><br><span class="line">domain1.add(emitter1);</span><br><span class="line"></span><br><span class="line">emitter1.on(<span class="string">&#x27;error&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;监听器处理此错误 (&quot;</span>+err.message+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">emitter1.emit(<span class="string">&#x27;error&#x27;</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;通过监听器来处理&#x27;</span>));</span><br><span class="line"></span><br><span class="line">emitter1.removeAllListeners(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">emitter1.emit(<span class="string">&#x27;error&#x27;</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;通过 domain1 处理&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> domain2 = domain.create();</span><br><span class="line"></span><br><span class="line">domain2.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;domain2 处理这个错误 (&quot;</span>+err.message+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐式绑定</span></span><br><span class="line">domain2.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> emitter2 = <span class="keyword">new</span> EventEmitter();</span><br><span class="line">   emitter2.emit(<span class="string">&#x27;error&#x27;</span>,<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;通过 domain2 处理&#x27;</span>));   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">domain1.remove(emitter1);</span><br><span class="line">emitter1.emit(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;转换为异常，系统将崩溃!&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>执行以上代码，结果如下所示:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">监听器处理此错误 (通过监听器来处理)</span><br><span class="line"><span class="selector-tag">domain1</span> 处理这个错误 (通过 <span class="selector-tag">domain1</span> 处理)</span><br><span class="line"><span class="selector-tag">domain2</span> 处理这个错误 (通过 <span class="selector-tag">domain2</span> 处理)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">events</span><span class="selector-class">.js</span><span class="selector-pseudo">:72</span></span><br><span class="line">        throw er; // Unhandled &#x27;error&#x27; event</span><br><span class="line">              ^</span><br><span class="line"><span class="selector-tag">Error</span>: 转换为异常，系统将崩溃!</span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Object</span>. (/<span class="selector-tag">www</span>/<span class="selector-tag">node</span>/<span class="selector-tag">main</span><span class="selector-class">.js</span><span class="selector-pseudo">:40</span><span class="selector-pseudo">:24)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Module</span>._<span class="selector-tag">compile</span> (<span class="selector-tag">module</span><span class="selector-class">.js</span><span class="selector-pseudo">:456</span><span class="selector-pseudo">:26)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Object</span><span class="selector-class">.Module</span>._<span class="selector-tag">extensions</span>.<span class="selector-class">.js</span> (<span class="selector-tag">module</span><span class="selector-class">.js</span><span class="selector-pseudo">:474</span><span class="selector-pseudo">:10)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Module</span><span class="selector-class">.load</span> (<span class="selector-tag">module</span><span class="selector-class">.js</span><span class="selector-pseudo">:356</span><span class="selector-pseudo">:32)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Function</span><span class="selector-class">.Module</span>._<span class="selector-tag">load</span> (<span class="selector-tag">module</span><span class="selector-class">.js</span><span class="selector-pseudo">:312</span><span class="selector-pseudo">:12)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">Function</span><span class="selector-class">.Module</span><span class="selector-class">.runMain</span> (<span class="selector-tag">module</span><span class="selector-class">.js</span><span class="selector-pseudo">:497</span><span class="selector-pseudo">:10)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">startup</span> (<span class="selector-tag">node</span><span class="selector-class">.js</span><span class="selector-pseudo">:119</span><span class="selector-pseudo">:16)</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">node</span><span class="selector-class">.js</span><span class="selector-pseudo">:929</span><span class="selector-pseudo">:3</span></span><br></pre></td></tr></table></figure>
<h1 id="Node-js-Web-模块"><a href="#Node-js-Web-模块" class="headerlink" title="Node.js Web 模块"></a>Node.js Web 模块</h1><h2 id="什么是-Web-服务器？"><a href="#什么是-Web-服务器？" class="headerlink" title="什么是 Web 服务器？"></a>什么是 Web 服务器？</h2><p>Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，Web服务器的基本功能就是提供Web信息浏览服务。它只需支持HTTP协议、HTML文档格式及URL，与客户端的网络浏览器配合。</p>
<p>大多数 web 服务器都支持服务端的脚本语言（php、python、ruby）等，并通过脚本语言从数据库获取数据，将结果返回给客户端浏览器。</p>
<p>目前最主流的三个Web服务器是Apache、Nginx、IIS。</p>
<h2 id="Web-应用架构"><a href="#Web-应用架构" class="headerlink" title="Web 应用架构"></a>Web 应用架构</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Web 应用架构"></p>
<ul>
<li><strong>Client</strong> – 客户端，一般指浏览器，浏览器可以通过 HTTP 协议向服务器请求数据。</li>
<li><strong>Server</strong> – 服务端，一般指 Web 服务器，可以接收客户端请求，并向客户端发送响应数据。</li>
<li><strong>Business</strong> – 业务层， 通过 Web 服务器处理应用程序，如与数据库交互，逻辑运算，调用外部程序等。</li>
<li><strong>Data</strong> – 数据层，一般由数据库组成。</li>
</ul>
<h2 id="使用-Node-创建-Web-服务器"><a href="#使用-Node-创建-Web-服务器" class="headerlink" title="使用 Node 创建 Web 服务器"></a>使用 Node 创建 Web 服务器</h2><p>Node.js 提供了 http 模块，http 模块主要用于搭建 HTTP 服务端和客户端，使用 HTTP 服务器或客户端功能必须调用 http 模块，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>以下是演示一个最基本的 HTTP 服务器架构(使用 8080 端口)，创建 server.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line">http.createServer( <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;  </span><br><span class="line">   <span class="comment">// 解析请求，包括文件名</span></span><br><span class="line">   <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 输出请求的文件名</span></span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;Request for &quot;</span> + pathname + <span class="string">&quot; received.&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 从文件系统中读取请求的文件内容</span></span><br><span class="line">   fs.readFile(pathname.substr(<span class="number">1</span>), <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(err);</span><br><span class="line">         <span class="comment">// HTTP 状态码: 404 : NOT FOUND</span></span><br><span class="line">         <span class="comment">// Content Type: text/html</span></span><br><span class="line">         response.writeHead(<span class="number">404</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;             </span><br><span class="line">         <span class="comment">// HTTP 状态码: 200 : OK</span></span><br><span class="line">         <span class="comment">// Content Type: text/html</span></span><br><span class="line">         response.writeHead(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);    </span><br><span class="line">         </span><br><span class="line">         <span class="comment">// 响应文件内容</span></span><br><span class="line">         response.write(data.toString());        </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  发送响应数据</span></span><br><span class="line">      response.end();</span><br><span class="line">   &#125;);   </span><br><span class="line">&#125;).listen(<span class="number">8080</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 控制台会输出以下信息</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Server running at http://127.0.0.1:8080/&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>接下来我们在该目录下创建一个 index.html 文件，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>码云笔记(mybj123.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行 server.js 文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">server</span><span class="selector-class">.js</span></span><br><span class="line"><span class="selector-tag">Server</span> <span class="selector-tag">running</span> <span class="selector-tag">at</span> <span class="selector-tag">http</span>://127.0.0.1<span class="selector-pseudo">:8080</span>/</span><br></pre></td></tr></table></figure>
<p>接着我们在浏览器中打开地址：<strong><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/index.html">http://127.0.0.1:8080/index.html</a></strong>，显示如下图所示:</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器中显示内容"></p>
<p>执行 server.js 的控制台输出信息如下：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="执行 server.js 的控制台输出信息"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Server</span> <span class="selector-tag">running</span> <span class="selector-tag">at</span> <span class="selector-tag">http</span>://127.0.0.1<span class="selector-pseudo">:8080</span>/</span><br><span class="line"><span class="selector-tag">Request</span> <span class="selector-tag">for</span> /<span class="selector-tag">index</span><span class="selector-class">.html</span> <span class="selector-tag">received</span>.     #  客户端请求信息</span><br></pre></td></tr></table></figure>
<h2 id="使用-Node-创建-Web-客户端"><a href="#使用-Node-创建-Web-客户端" class="headerlink" title="使用 Node 创建 Web 客户端"></a>使用 Node 创建 Web 客户端</h2><p>Node 创建 Web 客户端需要引入 http 模块，创建 client.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 用于请求的选项</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">   port: <span class="string">&#x27;8080&#x27;</span>,</span><br><span class="line">   path: <span class="string">&#x27;/index.html&#x27;</span>  </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 处理响应的回调函数</span></span><br><span class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">   <span class="comment">// 不断更新数据</span></span><br><span class="line">   <span class="keyword">var</span> body = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   response.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      body += data;</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   response.on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 数据接收完成</span></span><br><span class="line">      <span class="built_in">console</span>.log(body);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 向服务端发送请求</span></span><br><span class="line"><span class="keyword">var</span> req = http.request(options, callback);</span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure>
<p><strong>新开一个终端</strong>，执行 client.js 文件，输出结果如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">node  client.js </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>码云笔记(mybj123.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行 server.js 的控制台输出信息如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Server</span> <span class="selector-tag">running</span> <span class="selector-tag">at</span> <span class="selector-tag">http</span>://127.0.0.1<span class="selector-pseudo">:8080</span>/</span><br><span class="line"><span class="selector-tag">Request</span> <span class="selector-tag">for</span> /<span class="selector-tag">index</span><span class="selector-class">.html</span> <span class="selector-tag">received</span>.   # 客户端请求信息</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-Express-框架"><a href="#Node-js-Express-框架" class="headerlink" title="Node.js Express 框架"></a>Node.js Express 框架</h1><h2 id="Express-简介"><a href="#Express-简介" class="headerlink" title="Express 简介"></a>Express 简介</h2><p><code>Express</code> 是一个简洁而灵活的 <code>node.js</code> Web应用框架, 提供了一系列强大特性帮助你创建各种 <code>Web</code> 应用，和丰富的 <code>HTTP</code> 工具。</p>
<p>使用 <code>Express</code> 可以快速地搭建一个完整功能的网站。</p>
<p>Express 框架核心特性：</p>
<ul>
<li>可以设置中间件来响应 <code>HTTP</code> 请求。</li>
<li>定义了路由表用于执行不同的 <code>HTTP</code> 请求动作。</li>
<li>可以通过向模板传递参数来动态渲染 HTML 页面。</li>
</ul>
<h2 id="安装-Express"><a href="#安装-Express" class="headerlink" title="安装 Express"></a>安装 Express</h2><p>安装 <code>Express</code> 并将其保存到依赖列表中：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">install</span> <span class="selector-tag">express</span> <span class="selector-tag">--save</span></span><br></pre></td></tr></table></figure>
<p>以上命令会将 Express 框架安装在当前目录的 <strong>node_modules</strong> 目录中， <strong>node_modules</strong> 目录下会自动创建 express 目录。以下几个重要的模块是需要与 express 框架一起安装的：</p>
<ul>
<li><strong>body-parser</strong> – node.js 中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。</li>
<li><strong>cookie-parser</strong> – 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。</li>
<li><strong>multer</strong> – node.js 中间件，用于处理 enctype=”multipart/form-data”（设置表单的MIME编码）的表单数据。</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">install</span> <span class="selector-tag">body-parser</span> <span class="selector-tag">--save</span></span><br><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">install</span> <span class="selector-tag">cookie-parser</span> <span class="selector-tag">--save</span></span><br><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">install</span> <span class="selector-tag">multer</span> <span class="selector-tag">--save</span></span><br></pre></td></tr></table></figure>
<p>安装完后，我们可以查看下 express 使用的版本号：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">cnpm</span> <span class="selector-tag">list</span> <span class="selector-tag">express</span></span><br><span class="line">/<span class="selector-tag">data</span>/<span class="selector-tag">www</span>/<span class="selector-tag">node</span></span><br><span class="line">└── <span class="selector-tag">express</span><span class="keyword">@4</span>.15.2  -&gt; /Users/tianqixin/www/node/node_modules/.<span class="number">4.15</span>.<span class="number">2</span>@express</span><br></pre></td></tr></table></figure>
<h2 id="第一个-Express-框架实例"><a href="#第一个-Express-框架实例" class="headerlink" title="第一个 Express 框架实例"></a>第一个 Express 框架实例</h2><p>接下来我们使用 Express 框架来输出 “Hello World”。</p>
<p>以下实例中我们引入了 express 模块，并在客户端发起请求后，响应 “Hello World” 字符串。</p>
<p>创建 express_demo.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//express_demo.js 文件</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node express_demo.js </span><br><span class="line">应用实例，访问地址为 http:&#x2F;&#x2F;0.0.0.0:8081</span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <a href="http://127.0.0.1:8081，结果如下图所示：">http://127.0.0.1:8081，结果如下图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器中访问"></p>
<h2 id="请求和响应"><a href="#请求和响应" class="headerlink" title="请求和响应"></a>请求和响应</h2><p>Express 应用使用回调函数的参数： <strong>request</strong> 和 <strong>response</strong> 对象来处理请求和响应的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="comment">// --</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>request</strong> 和 <strong>response</strong> 对象的具体介绍：</p>
<p><strong>Request 对象</strong> – <code>request</code> 对象表示 <code>HTTP</code> 请求，包含了请求查询字符串，参数，内容，<code>HTTP</code> 头部等属性。常见属性有：</p>
<ol>
<li><code>req.app</code>：当<code>callback</code>为外部文件时，用<code>req.app</code>访问express的实例</li>
<li><code>req.baseUrl</code>：获取路由当前安装的URL路径</li>
<li><code>req.body / req.cookies</code>：获得「请求主体」/ Cookies</li>
<li><code>req.fresh / req.stale</code>：判断请求是否还「新鲜」</li>
<li><code>req.hostname / req.ip</code>：获取主机名和IP地址</li>
<li><code>req.originalUrl</code>：获取原始请求URL</li>
<li><code>req.params</code>：获取路由的parameters</li>
<li><code>req.path</code>：获取请求路径</li>
<li><code>req.protocol</code>：获取协议类型</li>
<li><code>req.query</code>：获取<code>URL</code>的查询参数串</li>
<li><code>req.route</code>：获取当前匹配的路由</li>
<li><code>req.subdomains</code>：获取子域名</li>
<li><code>req.accepts()</code>：检查可接受的请求的文档类型</li>
<li><code>req.acceptsCharsets / req.acceptsEncodings / req.acceptsLanguages</code>：返回指定字符集的第一个可接受字符编码</li>
<li><code>req.get()</code>：获取指定的<code>HTTP</code>请求头</li>
<li><code>req.is()</code>：判断请求头<code>Content-Type</code>的<code>MIME</code>类型</li>
</ol>
<p><strong>Response 对象</strong> – <code>response</code> 对象表示 <code>HTTP</code> 响应，即在接收到请求时向客户端发送的 <code>HTTP</code> 响应数据。常见属性有：</p>
<ol>
<li><code>res.app</code>：同<code>req.app</code>一样</li>
<li><code>res.append()</code>：追加指定<code>HTTP</code>头</li>
<li><code>res.set()</code>在<code>res.append()</code>后将重置之前设置的头</li>
<li><code>res.cookie(name，value [，option])</code>：设置<code>Cookie</code></li>
<li><code>opition</code>: domain / expires / httpOnly / maxAge / path / secure / signed</li>
<li><code>res.clearCookie()</code>：清除Cookie</li>
<li><code>res.download()</code>：传送指定路径的文件</li>
<li><code>res.get()</code>：返回指定的HTTP头</li>
<li><code>res.json()</code>：传送JSON响应</li>
<li><code>res.jsonp()</code>：传送JSONP响应</li>
<li><code>res.location()</code>：只设置响应的<code>Location HTTP</code>头，不设置状态码或者<code>close response</code></li>
<li><code>res.redirect()</code>：设置响应的<code>Location HTTP</code>头，并且设置状态码<code>302</code></li>
<li><code>res.render(view,[locals],callback)</code>：渲染一个<code>view</code>，同时向<code>callback</code>传递渲染后的字符串，如果在渲染过程中有错误发生<code>next(err)</code>将会被自动调用。<code>callback</code>将会被传入一个可能发生的错误以及渲染后的页面，这样就不会自动输出了。</li>
<li><code>res.send()</code>：传送HTTP响应</li>
<li><code>res.sendFile(path [，options] [，fn])</code>：传送指定路径的文件 -会自动根据文件<code>extension</code>设定<code>Content-Type</code></li>
<li><code>res.set()</code>：设置<code>HTTP</code>头，传入<code>object</code>可以一次设置多个头</li>
<li><code>res.status()</code>：设置<code>HTTP</code>状态码</li>
<li><code>res.type()</code>：设置<code>Content-Type</code>的<code>MIME</code>类型</li>
</ol>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>我们已经了解了 HTTP 请求的基本应用，而路由决定了由谁(指定脚本)去响应客户端请求。</p>
<p>在HTTP请求中，我们可以通过路由提取出请求的URL以及<code>GET/POST</code>参数。</p>
<p>接下来我们扩展 Hello World，添加一些功能来处理更多类型的 HTTP 请求。</p>
<p>创建 express_demo2.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  主页输出 &quot;Hello World&quot;</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;主页 GET 请求&quot;</span>);</span><br><span class="line">   res.send(<span class="string">&#x27;Hello GET&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//  POST 请求</span></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;主页 POST 请求&quot;</span>);</span><br><span class="line">   res.send(<span class="string">&#x27;Hello POST&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  /del_user 页面响应</span></span><br><span class="line">app.get(<span class="string">&#x27;/del_user&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;/del_user 响应 DELETE 请求&quot;</span>);</span><br><span class="line">   res.send(<span class="string">&#x27;删除页面&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  /list_user 页面 GET 请求</span></span><br><span class="line">app.get(<span class="string">&#x27;/list_user&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;/list_user GET 请求&quot;</span>);</span><br><span class="line">   res.send(<span class="string">&#x27;用户列表页面&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 对页面 abcd, abxcd, ab123cd, 等响应 GET 请求</span></span><br><span class="line">app.get(<span class="string">&#x27;/ab*cd&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;   </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&quot;/ab*cd GET 请求&quot;</span>);</span><br><span class="line">   res.send(<span class="string">&#x27;正则匹配&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node express_demo2.js </span><br><span class="line">应用实例，访问地址为 http:&#x2F;&#x2F;0.0.0.0:8081</span><br></pre></td></tr></table></figure>
<p>接下来你可以尝试访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/">http://127.0.0.1:8081</a> 不同的地址，查看效果。</p>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/list_user%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/list_user，结果如下图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器中访问 http://127.0.0.1:8081/list_user"></p>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/abcd%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/abcd，结果如下图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器中访问 http://127.0.0.1:8081/abcd"></p>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/abcdefg%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/abcdefg，结果如下图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="在浏览器中访问 http://127.0.0.1:8081/abcdefg，结果如下图所示："></p>
<h2 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h2><p>Express 提供了内置的中间件 <strong>express.static</strong> 来设置静态文件如：图片， CSS, JavaScript 等。</p>
<p>你可以使用 <strong>express.static</strong> 中间件来设置静态文件路径。例如，如果你将图片， CSS, JavaScript 文件放在 public 目录下，你可以这么写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&#x27;/public&#x27;</span>, express.static(<span class="string">&#x27;public&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>我们可以到 public/images 目录下放些图片,如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">server.js</span><br><span class="line">public&#x2F;</span><br><span class="line">public&#x2F;images</span><br><span class="line">public&#x2F;images&#x2F;logo.png</span><br></pre></td></tr></table></figure>
<p>让我们再修改下 “Hello World” 应用添加处理静态文件的功能。</p>
<p>创建 express_demo3.js 文件，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.use(<span class="string">&#x27;/public&#x27;</span>, express.static(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.send(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">express_demo3</span><span class="selector-class">.js</span> </span><br><span class="line">应用实例，访问地址为 <span class="selector-tag">http</span>://0.0.0.0<span class="selector-pseudo">:8081</span></span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/public/images/logo.png%EF%BC%88%E6%9C%AC%E5%AE%9E%E4%BE%8B%E9%87%87%E7%94%A8%E4%BA%86%E7%A0%81%E4%BA%91%E7%AC%94%E8%AE%B0%E7%9A%84">http://127.0.0.1:8081/public/images/logo.png（本实例采用了码云笔记的</a> logo），结果如下图所示：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="码云笔记logo"></p>
<h2 id="GET-方法"><a href="#GET-方法" class="headerlink" title="GET 方法"></a>GET 方法</h2><p>以下实例演示了在表单中通过 GET 方法提交两个参数，我们可以使用 server.js 文件内的 <strong>process_get</strong> 路由器来处理输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8081/process_get&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_name&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;last_name&quot;</span>&gt;</span>const</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>server.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"> </span><br><span class="line">app.use(<span class="string">&#x27;/public&#x27;</span>, express.static(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/index.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/process_get&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.query.first_name,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.query.last_name</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="built_in">console</span>.log(response);</span><br><span class="line">   res.end(<span class="built_in">JSON</span>.stringify(response));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">node</span> <span class="selector-tag">server</span><span class="selector-class">.js</span> </span><br><span class="line">应用实例，访问地址为 <span class="selector-tag">http</span>://0.0.0.0<span class="selector-pseudo">:8081</span></span><br></pre></td></tr></table></figure>
<p>浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/index.html%EF%BC%8C%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/index.html，如图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器访问 http://127.0.0.1:8081/index.html，如图所示："></p>
<p>现在你可以向表单输入数据，并提交。</p>
<h2 id="POST-方法"><a href="#POST-方法" class="headerlink" title="POST 方法"></a>POST 方法</h2><p>以下实例演示了在表单中通过 POST 方法提交两个参数，我们可以使用 server.js 文件内的 <strong>process_post</strong> 路由器来处理输入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8081/process_post&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_name&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;last_name&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>server.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建 application/x-www-form-urlencoded 编码解析</span></span><br><span class="line"><span class="keyword">var</span> urlencodedParser = bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)</span><br><span class="line"> </span><br><span class="line">app.use(<span class="string">&#x27;/public&#x27;</span>, express.static(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/index.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.post(<span class="string">&#x27;/process_post&#x27;</span>, urlencodedParser, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.body.first_name,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.body.last_name</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="built_in">console</span>.log(response);</span><br><span class="line">   res.end(<span class="built_in">JSON</span>.stringify(response));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br><span class="line">应用实例，访问地址为 http:&#x2F;&#x2F;0.0.0.0:8081</span><br></pre></td></tr></table></figure>
<p>浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/index.html%EF%BC%8C%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/index.html，如图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="浏览器访问 http://127.0.0.1:8081/index.html，如图所示："></p>
<p>现在你可以向表单输入数据，并提交，如下演示：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="向表单输入数据，并提交"></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>以下我们创建一个用于上传文件的表单，使用 POST 方法，表单 enctype 属性设置为 multipart/form-data。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>文件上传：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">选择一个文件上传: <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/file_upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> <span class="attr">size</span>=<span class="string">&quot;50&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>server.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> multer  = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">app.use(<span class="string">&#x27;/public&#x27;</span>, express.static(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(multer(&#123; <span class="attr">dest</span>: <span class="string">&#x27;/tmp/&#x27;</span>&#125;).array(<span class="string">&#x27;image&#x27;</span>));</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/index.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.post(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="built_in">console</span>.log(req.files[<span class="number">0</span>]);  <span class="comment">// 上传的文件信息</span></span><br><span class="line"> </span><br><span class="line">   <span class="keyword">var</span> des_file = __dirname + <span class="string">&quot;/&quot;</span> + req.files[<span class="number">0</span>].originalname;</span><br><span class="line">   fs.readFile( req.files[<span class="number">0</span>].path, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        fs.writeFile(des_file, data, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">         <span class="keyword">if</span>( err )&#123;</span><br><span class="line">              <span class="built_in">console</span>.log( err );</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               response = &#123;</span><br><span class="line">                   message:<span class="string">&#x27;File uploaded successfully&#x27;</span>, </span><br><span class="line">                   filename:req.files[<span class="number">0</span>].originalname</span><br><span class="line">              &#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">console</span>.log( response );</span><br><span class="line">          res.end( <span class="built_in">JSON</span>.stringify( response ) );</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node server.js </span><br><span class="line">应用实例，访问地址为 http:&#x2F;&#x2F;0.0.0.0:8081</span><br></pre></td></tr></table></figure>
<p>浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/index.html%EF%BC%8C%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/index.html，如图所示：</a></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="文件上传页面"></p>
<p>现在你可以向表单输入数据，并提交，如下演示：</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="向表单输入数据，并提交"></p>
<h2 id="Cookie-管理"><a href="#Cookie-管理" class="headerlink" title="Cookie 管理"></a>Cookie 管理</h2><p>我们可以使用中间件向 Node.js 服务器发送 cookie 信息，以下代码输出了客户端发送的 cookie 信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express_cookie.js 文件</span></span><br><span class="line"><span class="keyword">var</span> express      = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line">app.use(cookieParser())</span><br><span class="line"> </span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Cookies: &quot;</span> + util.inspect(req.cookies));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.listen(<span class="number">8081</span>)</span><br></pre></td></tr></table></figure>
<p>执行以上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node express_cookie.js</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-RESTful-API"><a href="#Node-js-RESTful-API" class="headerlink" title="Node.js RESTful API"></a>Node.js RESTful API</h1><h2 id="什么是-REST？"><a href="#什么是-REST？" class="headerlink" title="什么是 REST？"></a>什么是 REST？</h2><p><code>REST</code>即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。</p>
<p>表述性状态转移是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是RESTful。需要注意的是，REST是设计风格而不是标准。REST通常基于使用<code>HTTP</code>，<code>URI</code>，和<code>XML</code>（标准通用标记语言下的一个子集）以及<code>HTML</code>（标准通用标记语言下的一个应用）这些现有的广泛流行的协议和标准。REST 通常使用 <code>JSON</code> 数据格式。</p>
<h3 id="HTTP-方法"><a href="#HTTP-方法" class="headerlink" title="HTTP 方法"></a>HTTP 方法</h3><p>以下为 REST 基本架构的四个方法：</p>
<ul>
<li><code>GET</code> – 用于获取数据。</li>
<li><code>PUT</code> – 用于更新或添加数据。</li>
<li><code>DELETE</code> – 用于删除数据。</li>
<li><code>POST</code> – 用于添加数据。</li>
</ul>
<h2 id="RESTful-Web-Services"><a href="#RESTful-Web-Services" class="headerlink" title="RESTful Web Services"></a>RESTful Web Services</h2><p>Web service是一个平台独立的，低耦合的，自包含的、基于可编程的web的应用程序，可使用开放的XML（标准通用标记语言下的一个子集）标准来描述、发布、发现、协调和配置这些应用程序，用于开发分布式的互操作的应用程序。</p>
<p>基于 REST 架构的 Web Services 即是 RESTful。</p>
<p>由于轻量级以及通过 HTTP 直接传输数据的特性，Web 服务的 RESTful 方法已经成为最常见的替代方法。可以使用各种语言（比如 Java 程序、Perl、Ruby、Python、PHP 和 Javascript[包括 Ajax]）实现客户端。</p>
<p>RESTful Web 服务通常可以通过自动客户端或代表用户的应用程序访问。但是，这种服务的简便性让用户能够与之直接交互，使用它们的 Web 浏览器构建一个 GET URL 并读取返回的内容。</p>
<h2 id="创建-RESTful"><a href="#创建-RESTful" class="headerlink" title="创建 RESTful"></a>创建 RESTful</h2><p>首先，创建一个 json 数据资源文件 users.json，内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;user1&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;mahesh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;user2&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;suresh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password2&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;librarian&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">2</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;user3&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;ramesh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password3&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;clerk&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">3</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于以上数据，我们创建以下 RESTful API：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">URI</th>
<th align="left">HTTP 方法</th>
<th align="left">发送内容</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">listUsers</td>
<td align="left">GET</td>
<td align="left">空</td>
<td align="left">显示所有用户列表</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">addUser</td>
<td align="left">POST</td>
<td align="left">JSON 字符串</td>
<td align="left">添加新用户</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">deleteUser</td>
<td align="left">DELETE</td>
<td align="left">JSON 字符串</td>
<td align="left">删除用户</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">:id</td>
<td align="left">GET</td>
<td align="left">空</td>
<td align="left">显示用户详细信息</td>
</tr>
</tbody></table>
<h3 id="获取用户列表："><a href="#获取用户列表：" class="headerlink" title="获取用户列表："></a>获取用户列表：</h3><p>以下代码，我们创建了 RESTful API <strong>listUsers</strong>，用于读取用户的信息列表， server.js 文件代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/listUsers&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   fs.readFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;users.json&quot;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log( data );</span><br><span class="line">       res.end( data );</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来执行以下命令：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js </span><br><span class="line">应用实例，访问地址为 <span class="selector-tag">http</span>://0.0.0.0<span class="selector-pseudo">:8081</span></span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/listUsers%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/listUsers，结果如下所示：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;user1&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;mahesh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;user2&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;suresh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password2&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;librarian&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">2</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;user3&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;ramesh&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span> : <span class="string">&quot;password3&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;profession&quot;</span> : <span class="string">&quot;clerk&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">3</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>以下代码，我们创建了 RESTful API <strong>addUser</strong>， 用于添加新的用户数据，server.js 文件代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加的新用户数据</span></span><br><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">   <span class="string">&quot;user4&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span> : <span class="string">&quot;mohit&quot;</span>,</span><br><span class="line">      <span class="string">&quot;password&quot;</span> : <span class="string">&quot;password4&quot;</span>,</span><br><span class="line">      <span class="string">&quot;profession&quot;</span> : <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="number">4</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/addUser&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 读取已存在的数据</span></span><br><span class="line">   fs.readFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;users.json&quot;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">       data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">       data[<span class="string">&quot;user4&quot;</span>] = user[<span class="string">&quot;user4&quot;</span>];</span><br><span class="line">       <span class="built_in">console</span>.log( data );</span><br><span class="line">       res.end( <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js </span><br><span class="line">应用实例，访问地址为 http:&#x2F;&#x2F;0.0.0.0:8081</span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/addUser%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/addUser，结果如下所示：</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123; user1:</span><br><span class="line">   &#123; name: &#x27;mahesh&#x27;,</span><br><span class="line">     password: &#x27;password1&#x27;,</span><br><span class="line">     profession: &#x27;teacher&#x27;,</span><br><span class="line">     id: 1 &#125;,</span><br><span class="line">  user2:</span><br><span class="line">   &#123; name: &#x27;suresh&#x27;,</span><br><span class="line">     password: &#x27;password2&#x27;,</span><br><span class="line">     profession: &#x27;librarian&#x27;,</span><br><span class="line">     id: 2 &#125;,</span><br><span class="line">  user3:</span><br><span class="line">   &#123; name: &#x27;ramesh&#x27;,</span><br><span class="line">     password: &#x27;password3&#x27;,</span><br><span class="line">     profession: &#x27;clerk&#x27;,</span><br><span class="line">     id: 3 &#125;,</span><br><span class="line">  user4:</span><br><span class="line">   &#123; name: &#x27;mohit&#x27;,</span><br><span class="line">     password: &#x27;password4&#x27;,</span><br><span class="line">     profession: &#x27;teacher&#x27;,</span><br><span class="line">     id: 4 &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="显示用户详情"><a href="#显示用户详情" class="headerlink" title="显示用户详情"></a>显示用户详情</h3><p>以下代码，我们创建了 RESTful API <strong>:id（用户id）</strong>， 用于读取指定用户的详细信息，server.js 文件代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/:id&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 首先我们读取已存在的用户</span></span><br><span class="line">   fs.readFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;users.json&quot;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">       data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">       <span class="keyword">var</span> user = data[<span class="string">&quot;user&quot;</span> + req.params.id] </span><br><span class="line">       <span class="built_in">console</span>.log( user );</span><br><span class="line">       res.end( <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来执行以下命令：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js </span><br><span class="line">应用实例，访问地址为 <span class="selector-tag">http</span>://0.0.0.0<span class="selector-pseudo">:8081</span></span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/2%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/2，结果如下所示：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;suresh&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;password&quot;</span>:<span class="string">&quot;password2&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;profession&quot;</span>:<span class="string">&quot;librarian&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;id&quot;</span>:<span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>以下代码，我们创建了 RESTful API <strong>deleteUser</strong>， 用于删除指定用户的详细信息，以下实例中，用户 id 为 2，server.js 文件代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/deleteUser&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// First read existing users.</span></span><br><span class="line">   fs.readFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;users.json&quot;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">       data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">       <span class="keyword">delete</span> data[<span class="string">&quot;user&quot;</span> + id];</span><br><span class="line">       </span><br><span class="line">       <span class="built_in">console</span>.log( data );</span><br><span class="line">       res.end( <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> host = server.address().address</span><br><span class="line">  <span class="keyword">var</span> port = server.address().port</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来执行以下命令：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js </span><br><span class="line">应用实例，访问地址为 <span class="selector-tag">http</span>://0.0.0.0<span class="selector-pseudo">:8081</span></span><br></pre></td></tr></table></figure>
<p>在浏览器中访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/deleteUser%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E6%89%80%E7%A4%BA%EF%BC%9A">http://127.0.0.1:8081/deleteUser，结果如下所示：</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123; user1:</span><br><span class="line">   &#123; name: &#x27;mahesh&#x27;,</span><br><span class="line">     password: &#x27;password1&#x27;,</span><br><span class="line">     profession: &#x27;teacher&#x27;,</span><br><span class="line">     id: 1 &#125;,</span><br><span class="line">  user3:</span><br><span class="line">   &#123; name: &#x27;ramesh&#x27;,</span><br><span class="line">     password: &#x27;password3&#x27;,</span><br><span class="line">     profession: &#x27;clerk&#x27;,</span><br><span class="line">     id: 3 &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-多进程"><a href="#Node-js-多进程" class="headerlink" title="Node.js 多进程"></a>Node.js 多进程</h1><p>我们都知道 Node.js 是以单线程的模式运行的，但它使用的是事件驱动来处理并发，这样有助于我们在多核 <code>cpu</code> 的系统上创建多个子进程，从而提高性能。</p>
<p>每个子进程总是带有三个流对象：<code>child.stdin</code>, <code>child.stdout</code> 和<code>child.stderr</code>。他们可能会共享父进程的 <code>stdio</code> 流，或者也可以是独立的被导流的流对象。</p>
<p><code>Node</code> 提供了 <code>child_process</code> 模块来创建子进程，方法有：</p>
<ul>
<li><strong>exec</strong> – <code>child_process.exec</code> 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</li>
<li><strong>spawn</strong> – <code>child_process.spawn</code> 使用指定的命令行参数创建新进程。</li>
<li><strong>fork</strong> – <code>child_process.fork</code> 是 <code>spawn()</code>的特殊形式，用于在子进程中运行的模块，如 <code>fork(&#39;./son.js&#39;)</code> 相当于 <code>spawn(&#39;node&#39;, [&#39;./son.js&#39;])</code> 。与<code>spawn</code>方法不同的是，<code>fork</code>会在父进程与子进程之间，建立一个通信管道，用于进程之间的通信。</li>
</ul>
<h2 id="exec-方法"><a href="#exec-方法" class="headerlink" title="exec() 方法"></a>exec() 方法</h2><p><code>child_process.exec</code> 使用子进程执行命令，缓存子进程的输出，并将子进程的输出以回调函数参数的形式返回。</p>
<p>语法如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child_process.exec(command[, options], callback)</span><br></pre></td></tr></table></figure>
<h3 id="参数-16"><a href="#参数-16" class="headerlink" title="参数"></a>参数</h3><p>参数说明如下：</p>
<p><strong>command：</strong> 字符串， 将要运行的命令，参数使用空格隔开</p>
<p><strong>options ：对象，可以是：</strong></p>
<ul>
<li>cwd ，字符串，子进程的当前工作目录</li>
<li>env，对象 环境变量键值对</li>
<li>encoding ，字符串，字符编码（默认： ‘utf8’）</li>
<li>shell ，字符串，将要执行命令的 Shell（默认: 在 UNIX 中为<code>/bin/sh</code>， 在 Windows 中为<code>cmd.exe</code>， Shell 应当能识别 <code>-c</code>开关在 UNIX 中，或 <code>/s /c</code> 在 Windows 中。 在Windows 中，命令行解析应当能兼容<code>cmd.exe</code>）</li>
<li>timeout，数字，超时时间（默认： 0）</li>
<li>maxBuffer，数字， 在 stdout 或 stderr 中允许存在的最大缓冲（二进制），如果超出那么子进程将会被杀死 （默认: 200*1024）</li>
<li>killSignal ，字符串，结束信号（默认：’SIGTERM’）</li>
<li>uid，数字，设置用户进程的 ID</li>
<li>gid，数字，设置进程组的 ID</li>
</ul>
<p><strong>callback ：</strong>回调函数，包含三个参数<code>error</code>, <code>stdout</code> 和 <code>stderr</code>。</p>
<p><code>exec()</code> 方法返回最大的缓冲区，并等待进程结束，一次性返回缓冲区的内容。</p>
<h3 id="实例-37"><a href="#实例-37" class="headerlink" title="实例"></a>实例</h3><p>让我们创建两个 js 文件 support.js 和 master.js。</p>
<p>support.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br></pre></td></tr></table></figure>
<p>master.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> workerProcess = child_process.exec(<span class="string">&#x27;node support.js &#x27;</span>+i, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error.stack);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Error code: &#x27;</span>+error.code);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Signal received: &#x27;</span>+error.signal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;stdout: &#x27;</span> + stdout);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;stderr: &#x27;</span> + stderr);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    workerProcess.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span>+code);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line"><span class="selector-tag">stdout</span>: 进程 1 执行。</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">stderr</span>: </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line"><span class="selector-tag">stdout</span>: 进程 0 执行。</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">stderr</span>: </span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line"><span class="selector-tag">stdout</span>: 进程 2 执行。</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">stderr</span>:</span><br></pre></td></tr></table></figure>
<h2 id="spawn-方法"><a href="#spawn-方法" class="headerlink" title="spawn() 方法"></a>spawn() 方法</h2><p><code>child_process.spawn</code> 使用指定的命令行参数创建新进程，语法格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">child_process</span><span class="selector-class">.spawn</span>(<span class="selector-tag">command</span><span class="selector-attr">[, args]</span><span class="selector-attr">[, options]</span>)</span><br></pre></td></tr></table></figure>
<h3 id="参数-17"><a href="#参数-17" class="headerlink" title="参数"></a>参数</h3><p>参数说明如下：</p>
<p><strong>command：</strong> 将要运行的命令</p>
<p><strong>args：</strong> Array 字符串参数数组</p>
<p><strong>options Object</strong></p>
<ul>
<li>cwd String 子进程的当前工作目录</li>
<li>env Object 环境变量键值对</li>
<li>stdio Array|String 子进程的 <code>stdio</code> 配置</li>
<li>detached Boolean 这个子进程将会变成进程组的领导</li>
<li>uid Number 设置用户进程的 ID</li>
<li>gid Number 设置进程组的 ID</li>
</ul>
<p>spawn() 方法返回流 (stdout &amp; stderr)，在进程返回大量数据时使用。进程一旦开始执行时 spawn() 就开始接收响应。</p>
<h3 id="实例-38"><a href="#实例-38" class="headerlink" title="实例"></a>实例</h3><p>让我们创建两个 js 文件 support.js 和 master.js。</p>
<p>support.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br></pre></td></tr></table></figure>
<p>master.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">   <span class="keyword">var</span> workerProcess = child_process.spawn(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;support.js&#x27;</span>, i]);</span><br><span class="line"> </span><br><span class="line">   workerProcess.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;stdout: &#x27;</span> + data);</span><br><span class="line">   &#125;);</span><br><span class="line"> </span><br><span class="line">   workerProcess.stderr.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;stderr: &#x27;</span> + data);</span><br><span class="line">   &#125;);</span><br><span class="line"> </span><br><span class="line">   workerProcess.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span>+code);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js stdout: 进程 0 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line"><span class="selector-tag">stdout</span>: 进程 1 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line"><span class="selector-tag">stdout</span>: 进程 2 执行。</span><br><span class="line"></span><br><span class="line">子进程已退出，退出码 0</span><br></pre></td></tr></table></figure>
<h2 id="fork-方法"><a href="#fork-方法" class="headerlink" title="fork() 方法"></a>fork() 方法</h2><p><code>child_process.fork</code> 是 <code>spawn()</code> 方法的特殊形式，用于创建进程，语法格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">child_process</span><span class="selector-class">.fork</span>(<span class="selector-tag">modulePath</span><span class="selector-attr">[, args]</span><span class="selector-attr">[, options]</span>)</span><br></pre></td></tr></table></figure>
<h3 id="参数-18"><a href="#参数-18" class="headerlink" title="参数"></a>参数</h3><p>参数说明如下：</p>
<p><strong>modulePath</strong>： String，将要在子进程中运行的模块</p>
<p><strong>args</strong>： Array 字符串参数数组</p>
<p><strong>options</strong>：Object</p>
<ul>
<li>cwd String 子进程的当前工作目录</li>
<li>env Object 环境变量键值对</li>
<li>execPath String 创建子进程的可执行文件</li>
<li>execArgv Array 子进程的可执行文件的字符串参数数组（默认： process.execArgv）</li>
<li>silent Boolean 如果为<code>true</code>，子进程的<code>stdin</code>，<code>stdout</code>和<code>stderr</code>将会被关联至父进程，否则，它们将会从父进程中继承。（默认为：<code>false</code>）</li>
<li>uid Number 设置用户进程的 ID</li>
<li>gid Number 设置进程组的 ID</li>
</ul>
<p>返回的对象除了拥有ChildProcess实例的所有方法，还有一个内建的通信信道。</p>
<h3 id="实例-39"><a href="#实例-39" class="headerlink" title="实例"></a>实例</h3><p>让我们创建两个 js 文件 support.js 和 master.js。</p>
<p>support.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;进程 &quot;</span> + process.argv[<span class="number">2</span>] + <span class="string">&quot; 执行。&quot;</span> );</span><br></pre></td></tr></table></figure>
<p>master.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">   <span class="keyword">var</span> worker_process = child_process.fork(<span class="string">&quot;support.js&quot;</span>, [i]);    </span><br><span class="line"> </span><br><span class="line">   worker_process.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;子进程已退出，退出码 &#x27;</span> + code);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ node master.js </span><br><span class="line">进程 0 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">进程 1 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br><span class="line">进程 2 执行。</span><br><span class="line">子进程已退出，退出码 0</span><br></pre></td></tr></table></figure>
<h1 id="Node-js-连接-MySQL"><a href="#Node-js-连接-MySQL" class="headerlink" title="Node.js 连接 MySQL"></a>Node.js 连接 MySQL</h1><p>本章节我们将为大家介绍如何使用 Node.js 来连接 MySQL，并对数据库进行操作。</p>
<p>本教程使用到的 Websites 表 SQL 文件：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1MYs4e8M6NNG30CGHpUwFZQ">websites.sql</a>  提取码：2fc4。</p>
<h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2><p>本教程使用了淘宝定制的cnpm命令进行安装：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install mysql</span><br></pre></td></tr></table></figure>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>在以下实例中根据你的实际配置修改数据库用户名、及密码及数据库名：</p>
<p>test.js 文件代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql      = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  user     : <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  password : <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">  database : <span class="string">&#x27;test&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">connection.connect();</span><br><span class="line"> </span><br><span class="line">connection.query(<span class="string">&#x27;SELECT 1 + 1 AS solution&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;The solution is: &#x27;</span>, results[<span class="number">0</span>].solution);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node test.js</span><br><span class="line"><span class="selector-tag">The</span> <span class="selector-tag">solution</span> <span class="selector-tag">is</span>: 2</span><br></pre></td></tr></table></figure>
<h3 id="数据库连接参数说明："><a href="#数据库连接参数说明：" class="headerlink" title="数据库连接参数说明："></a>数据库连接参数说明：</h3><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">host</td>
<td align="left">主机地址 （默认：localhost）</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">用户名</td>
</tr>
<tr>
<td align="left">password</td>
<td align="left">密码</td>
</tr>
<tr>
<td align="left">port</td>
<td align="left">端口号 （默认：3306）</td>
</tr>
<tr>
<td align="left">database</td>
<td align="left">数据库名</td>
</tr>
<tr>
<td align="left">charset</td>
<td align="left">连接字符集（默认：’UTF8_GENERAL_CI’，注意字符集的字母都要大写）</td>
</tr>
<tr>
<td align="left">localAddress</td>
<td align="left">此IP用于TCP连接（可选）</td>
</tr>
<tr>
<td align="left">socketPath</td>
<td align="left">连接到unix域路径，当使用 host 和 port 时会被忽略</td>
</tr>
<tr>
<td align="left">timezone</td>
<td align="left">时区（默认：’local’）</td>
</tr>
<tr>
<td align="left">connectTimeout</td>
<td align="left">连接超时（默认：不限制；单位：毫秒）</td>
</tr>
<tr>
<td align="left">stringifyObjects</td>
<td align="left">是否序列化对象</td>
</tr>
<tr>
<td align="left">typeCast</td>
<td align="left">是否将列值转化为本地JavaScript类型值 （默认：true）</td>
</tr>
<tr>
<td align="left">queryFormat</td>
<td align="left">自定义query语句格式化方法</td>
</tr>
<tr>
<td align="left">supportBigNumbers</td>
<td align="left">数据库支持bigint或decimal类型列时，需要设此option为true （默认：false）</td>
</tr>
<tr>
<td align="left">bigNumberStrings</td>
<td align="left">supportBigNumbers和bigNumberStrings启用 强制bigint或decimal列以JavaScript字符串类型返回（默认：false）</td>
</tr>
<tr>
<td align="left">dateStrings</td>
<td align="left">强制timestamp,datetime,data类型以字符串类型返回，而不是JavaScript Date类型（默认：false）</td>
</tr>
<tr>
<td align="left">debug</td>
<td align="left">开启调试（默认：false）</td>
</tr>
<tr>
<td align="left">multipleStatements</td>
<td align="left">是否许一个query中有多个MySQL语句 （默认：false）</td>
</tr>
<tr>
<td align="left">flags</td>
<td align="left">用于修改连接标志</td>
</tr>
<tr>
<td align="left">ssl</td>
<td align="left">使用ssl参数（与crypto.createCredenitals参数格式一至）或一个包含ssl配置文件名称的字符串，目前只捆绑Amazon RDS的配置文件</td>
</tr>
</tbody></table>
<p>更多说明可参见<a target="_blank" rel="noopener" href="https://github.com/mysqljs/mysql">这里</a></p>
<h2 id="数据库操作-CURD"><a href="#数据库操作-CURD" class="headerlink" title="数据库操作( CURD )"></a>数据库操作( CURD )</h2><p>在进行数据库操作前，你需要将本站提供的 Websites 表 SQL 文件websites.sql 导入到你的 MySQL 数据库中。</p>
<p>本教程测试的 MySQL 用户名为 root，密码为 123456，数据库为 test，你需要根据自己配置情况修改。</p>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>将上面我们提供的 SQL 文件导入数据库后，执行以下代码即可查询出数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql  = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;     </span><br><span class="line">  host     : <span class="string">&#x27;localhost&#x27;</span>,       </span><br><span class="line">  user     : <span class="string">&#x27;root&#x27;</span>,              </span><br><span class="line">  password : <span class="string">&#x27;123456&#x27;</span>,       </span><br><span class="line">  port: <span class="string">&#x27;3306&#x27;</span>,                   </span><br><span class="line">  database: <span class="string">&#x27;test&#x27;</span> </span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line">connection.connect();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  sql = <span class="string">&#x27;SELECT * FROM websites&#x27;</span>;</span><br><span class="line"><span class="comment">//查</span></span><br><span class="line">connection.query(sql,<span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;[SELECT ERROR] - &#x27;</span>,err.message);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------SELECT----------------------------&#x27;</span>);</span><br><span class="line">       <span class="built_in">console</span>.log(result);</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;------------------------------------------------------------\n\n&#x27;</span>);  </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ node test.js</span><br><span class="line"><span class="selector-tag">--------------------------SELECT----------------------------</span></span><br><span class="line">[ RowDataPacket &#123;</span><br><span class="line">    <span class="selector-tag">id</span>: 1,</span><br><span class="line">    name: &#x27;node.js教程&#x27;,</span><br><span class="line">    url: &#x27;https://www.mybj123.com/qdkfnote/jsnote/nodejs/&#x27;,</span><br><span class="line">    <span class="selector-tag">alexa</span>: 1,</span><br><span class="line">    country: &#x27;USA&#x27; &#125;,</span><br><span class="line">  <span class="selector-tag">RowDataPacket</span> &#123;</span><br><span class="line">    <span class="attribute">id</span>: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">&#x27;前端&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;https://www.mybj123.com/qdkfnote/&#x27;</span>,</span><br><span class="line">    alexa: <span class="number">13</span>,</span><br><span class="line">    country: <span class="string">&#x27;CN&#x27;</span> &#125;,</span><br><span class="line">  <span class="selector-tag">RowDataPacket</span> &#123;</span><br><span class="line">    <span class="attribute">id</span>: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">&#x27;码云笔记&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;https://www.mybj123.com/&#x27;</span>,</span><br><span class="line">    alexa: <span class="number">4689</span>,</span><br><span class="line">    country: <span class="string">&#x27;CN&#x27;</span> &#125;,</span><br><span class="line">  <span class="selector-tag">RowDataPacket</span> &#123;</span><br><span class="line">    <span class="attribute">id</span>: <span class="number">4</span>,</span><br><span class="line">    name: <span class="string">&#x27;源码&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;https://www.mybj123.com/yuancode/&#x27;</span>,</span><br><span class="line">    alexa: <span class="number">20</span>,</span><br><span class="line">    country: <span class="string">&#x27;CN&#x27;</span> &#125;,</span><br><span class="line">  <span class="selector-tag">RowDataPacket</span> &#123;</span><br><span class="line">    <span class="attribute">id</span>: <span class="number">5</span>,</span><br><span class="line">    name: <span class="string">&#x27;面试题&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;https://www.mybj123.com/question/&#x27;</span>,</span><br><span class="line">    alexa: <span class="number">3</span>,</span><br><span class="line">    country: <span class="string">&#x27;USA&#x27;</span> &#125; ]</span><br><span class="line"><span class="selector-tag">------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>我们可以向数据表 websties 插入数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql  = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;     </span><br><span class="line">  host     : <span class="string">&#x27;localhost&#x27;</span>,       </span><br><span class="line">  user     : <span class="string">&#x27;root&#x27;</span>,              </span><br><span class="line">  password : <span class="string">&#x27;123456&#x27;</span>,       </span><br><span class="line">  port: <span class="string">&#x27;3306&#x27;</span>,                   </span><br><span class="line">  database: <span class="string">&#x27;test&#x27;</span> </span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line">connection.connect();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span>  addSql = <span class="string">&#x27;INSERT INTO websites(Id,name,url,alexa,country) VALUES(0,?,?,?,?)&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span>  addSqlParams = [<span class="string">&#x27;typescript&#x27;</span>, <span class="string">&#x27;https://www.mybj123.com/qdkfnote/typescript/&#x27;</span>,<span class="string">&#x27;23453&#x27;</span>, <span class="string">&#x27;CN&#x27;</span>];</span><br><span class="line"><span class="comment">//增</span></span><br><span class="line">connection.query(addSql,addSqlParams,<span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">&#x27;[INSERT ERROR] - &#x27;</span>,err.message);</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">        &#125;        </span><br><span class="line"> </span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------INSERT----------------------------&#x27;</span>);</span><br><span class="line">       <span class="comment">//console.log(&#x27;INSERT ID:&#x27;,result.insertId);        </span></span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;INSERT ID:&#x27;</span>,result);        </span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;-----------------------------------------------------------------\n\n&#x27;</span>);  </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ node test.js</span><br><span class="line"><span class="selector-tag">--------------------------INSERT----------------------------</span></span><br><span class="line"><span class="selector-tag">INSERT</span> <span class="selector-tag">ID</span>: <span class="selector-tag">OkPacket</span> &#123;</span><br><span class="line">  <span class="attribute">fieldCount</span>: <span class="number">0</span>,</span><br><span class="line">  affectedRows: <span class="number">1</span>,</span><br><span class="line">  insertId: <span class="number">6</span>,</span><br><span class="line">  serverStatus: <span class="number">2</span>,</span><br><span class="line">  warningCount: <span class="number">0</span>,</span><br><span class="line">  message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  protocol41: true,</span><br><span class="line">  changedRows: <span class="number">0</span> &#125;</span><br><span class="line"><span class="selector-tag">-----------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>执行成功后，查看数据表，即可以看到添加的数据。</p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>我们也可以对数据库的数据进行修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var mysql  &#x3D; require(&#39;mysql&#39;);  </span><br><span class="line"> </span><br><span class="line">var connection &#x3D; mysql.createConnection(&#123;     </span><br><span class="line">  host     : &#39;localhost&#39;,       </span><br><span class="line">  user     : &#39;root&#39;,              </span><br><span class="line">  password : &#39;123456&#39;,       </span><br><span class="line">  port: &#39;3306&#39;,                   </span><br><span class="line">  database: &#39;test&#39; </span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line">connection.connect();</span><br><span class="line"> </span><br><span class="line">var modSql &#x3D; &#39;UPDATE websites SET name &#x3D; ?,url &#x3D; ? WHERE Id &#x3D; ?&#39;;</span><br><span class="line">var modSqlParams &#x3D; [&#39;前端问答&#39;, &#39;https:&#x2F;&#x2F;www.mybj123.com&#x2F;qa&#x2F;&#39;,6];</span><br><span class="line">&#x2F;&#x2F;改</span><br><span class="line">connection.query(modSql,modSqlParams,function (err, result) &#123;</span><br><span class="line">   if(err)&#123;</span><br><span class="line">         console.log(&#39;[UPDATE ERROR] - &#39;,err.message);</span><br><span class="line">         return;</span><br><span class="line">   &#125;        </span><br><span class="line">  console.log(&#39;--------------------------UPDATE----------------------------&#39;);</span><br><span class="line">  console.log(&#39;UPDATE affectedRows&#39;,result.affectedRows);</span><br><span class="line">  console.log(&#39;-----------------------------------------------------------------\n\n&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------------------UPDATE----------------------------</span><br><span class="line">UPDATE affectedRows 1</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>执行成功后，查看数据表，即可以看到更新的数据</p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>我们可以使用以下代码来删除 id 为 6 的数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var mysql  &#x3D; require(&#39;mysql&#39;);  </span><br><span class="line"> </span><br><span class="line">var connection &#x3D; mysql.createConnection(&#123;     </span><br><span class="line">  host     : &#39;localhost&#39;,       </span><br><span class="line">  user     : &#39;root&#39;,              </span><br><span class="line">  password : &#39;123456&#39;,       </span><br><span class="line">  port: &#39;3306&#39;,                   </span><br><span class="line">  database: &#39;test&#39; </span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line">connection.connect();</span><br><span class="line"> </span><br><span class="line">var delSql &#x3D; &#39;DELETE FROM websites where id&#x3D;6&#39;;</span><br><span class="line">&#x2F;&#x2F;删</span><br><span class="line">connection.query(delSql,function (err, result) &#123;</span><br><span class="line">        if(err)&#123;</span><br><span class="line">          console.log(&#39;[DELETE ERROR] - &#39;,err.message);</span><br><span class="line">          return;</span><br><span class="line">        &#125;        </span><br><span class="line"> </span><br><span class="line">       console.log(&#39;--------------------------DELETE----------------------------&#39;);</span><br><span class="line">       console.log(&#39;DELETE affectedRows&#39;,result.affectedRows);</span><br><span class="line">       console.log(&#39;-----------------------------------------------------------------\n\n&#39;);  </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------------------DELETE----------------------------</span><br><span class="line">DELETE affectedRows 1</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>执行成功后，查看数据表，即可以看到 id=6 的数据已被删除。</p>
<h1 id="Node-js-连接-MongoDB"><a href="#Node-js-连接-MongoDB" class="headerlink" title="Node.js 连接 MongoDB"></a>Node.js 连接 MongoDB</h1><p><code>MongoDB</code>是一种文档导向数据库管理系统，由C++撰写而成。</p>
<p>本章节我们将为大家介绍如何使用 <code>Node.js</code> 来连接 <code>MongoDB</code>，并对数据库进行操作。</p>
<h2 id="安装驱动-1"><a href="#安装驱动-1" class="headerlink" title="安装驱动"></a>安装驱动</h2><p>本教程使用了淘宝定制的<code>cnpm</code>命令进行安装：</p>
<blockquote>
<p>使用淘宝 NPM 镜像</p>
<p>大家都知道国内直接使用 <code>npm</code> 的官方镜像是非常慢的，这里推荐使用淘宝 NPM 镜像。</p>
<p>淘宝 NPM 镜像是一个完整 <code>npmjs.org</code> 镜像，你可以用此代替官方版本(只读)，同步频率目前为 10分钟 一次以保证尽量与官方服务同步。</p>
<p>你可以使用淘宝定制的 <code>cnpm</code> (gzip 压缩支持) 命令行工具代替默认的 <code>npm</code>:</p>
<p>$ npm install -g cnpm –registry=<a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a></p>
<p>这样就可以使用 <code>cnpm</code> 命令来安装模块了：</p>
<p>$ cnpm install [name]</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install mongodb</span><br></pre></td></tr></table></figure>
<p>接下来我们来实现增删改查功能。</p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>要在 <code>MongoDB</code> 中创建一个数据库，首先我们需要创建一个 <code>MongoClient</code> 对象，然后配置好指定的 <code>URL</code> 和 端口号。</p>
<p>如果数据库不存在，<code>MongoDB</code> 将创建数据库并建立连接。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MongoClient = <span class="built_in">require</span>(<span class="string">&#x27;mongodb&#x27;</span>).MongoClient;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;mongodb://localhost:27017/mybj&quot;</span>;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, db</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;数据库已创建!&quot;</span>);</span><br><span class="line">  db.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h2><p>我们可以使用 <code>createCollection()</code> 方法来创建集合：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MongoClient = <span class="built_in">require</span>(<span class="string">&#x27;mongodb&#x27;</span>).MongoClient;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;mongodb://localhost:27017/mybj&#x27;</span>;</span><br><span class="line">MongoClient.connect(url, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, db</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库已创建&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> dbase = db.db(<span class="string">&quot;mybj&quot;</span>);</span><br><span class="line">    dbase.createCollection(<span class="string">&#x27;site&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;创建集合!&quot;</span>);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="数据库操作-CURD-1"><a href="#数据库操作-CURD-1" class="headerlink" title="数据库操作( CURD )"></a>数据库操作( CURD )</h2><p>与 <code>MySQL</code> 不同的是 <code>MongoDB</code> 会自动创建数据库和集合，所以使用前我们不需要手动去创建。</p>
<h3 id="插入数据-1"><a href="#插入数据-1" class="headerlink" title="插入数据"></a>插入数据</h3><p>以下实例我们连接数据库 <code>runoob</code> 的 <code>site</code> 表，并插入一条数据条数据，使用 <code>insertOne()</code>插入一条数据:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MongoClient = <span class="built_in">require</span>(<span class="string">&#x27;mongodb&#x27;</span>).MongoClient;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;mongodb://localhost:27017/&quot;</span>;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, db</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="keyword">var</span> dbo = db.db(<span class="string">&quot;mybj&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> myobj = &#123; <span class="attr">name</span>: <span class="string">&quot;码云笔记&quot;</span>, <span class="attr">url</span>: <span class="string">&quot;www.mybj123&quot;</span> &#125;;</span><br><span class="line">    dbo.collection(<span class="string">&quot;site&quot;</span>).insertOne(myobj, <span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;文档插入成功&quot;</span>);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node test.js</span><br><span class="line">文档插入成功</span><br></pre></td></tr></table></figure>
<p>从输出结果来看，数据已插入成功。</p>
<p>我们也可以打开 <code>MongoDB</code> 的客户端查看数据，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; show dbs</span><br><span class="line">mybj  0.000GB          # 自动创建了 mybj 数据库</span><br><span class="line">&gt; show tables</span><br><span class="line">site                     # 自动创建了 site 集合（数据表）</span><br><span class="line">&gt; db.site.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5a794e36763eb821b24db854&quot;), &quot;name&quot; : &quot;码云笔记&quot;, &quot;url&quot; : &quot;www.mybj123&quot; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>如果要插入多条数据可以使用 <code>insertMany()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    var myobj &#x3D;  [</span><br><span class="line">        &#123; name: &#39;node.js教程&#39;, url: &#39;https:&#x2F;&#x2F;www.mybj123.com&#x2F;qdkfnote&#x2F;jsnote&#x2F;nodejs&#x2F;&#39;, type: &#39;cn&#39;&#125;,</span><br><span class="line">        &#123; name: &#39;前端&#39;, url: &#39;https:&#x2F;&#x2F;www.mybj123.com&#x2F;qdkfnote&#x2F;&#39;, type: &#39;en&#39;&#125;,</span><br><span class="line">        &#123; name: &#39;javascript&#39;, url: &#39;https:&#x2F;&#x2F;www.mybj123.com&#x2F;qdkfnote&#x2F;jsnote&#x2F;&#39;, type: &#39;en&#39;&#125;</span><br><span class="line">       ];</span><br><span class="line">    dbo.collection(&quot;site&quot;).insertMany(myobj, function(err, res) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(&quot;插入的文档数量为: &quot; + res.insertedCount);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>res.insertedCount</code> 为插入的条数。</p>
<h3 id="查询数据-1"><a href="#查询数据-1" class="headerlink" title="查询数据"></a>查询数据</h3><p>可以使用 <code>find()</code> 来查找数据, <code>find()</code> 可以返回匹配条件的所有数据。 如果未指定条件，<code>find()</code> 返回集合中的所有数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    dbo.collection(&quot;site&quot;). find(&#123;&#125;).toArray(function(err, result) &#123; &#x2F;&#x2F; 返回集合中所有数据</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(result);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以下实例检索 <code>name</code> 为 “码云笔记” 的实例：</p>
<p>查询指定条件的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">     var whereStr &#x3D; &#123;&quot;name&quot;:&#39;码云笔记&#39;&#125;;  &#x2F;&#x2F; 查询条件</span><br><span class="line">    dbo.collection(&quot;site&quot;).find(whereStr).toArray(function(err, result) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(result);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行以下命令输出就结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ &#123; _id: 5a794e36763eb821b24db854,</span><br><span class="line">    name: &#39;码云笔记&#39;,</span><br><span class="line">    url: &#39;www.mybj123&#39; &#125; ]</span><br></pre></td></tr></table></figure>
<h3 id="更新数据-1"><a href="#更新数据-1" class="headerlink" title="更新数据"></a>更新数据</h3><p>我们也可以对数据库的数据进行修改，以下实例将 <code>name</code> 为 “码云笔记” 的 url 改为 <a target="_blank" rel="noopener" href="https://www.mybj123.com./">https://www.mybj123.com。</a></p>
<p>更新一条数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;runoob&quot;);</span><br><span class="line">    var whereStr &#x3D; &#123;&quot;name&quot;:&#39;码云笔记&#39;&#125;;  &#x2F;&#x2F; 查询条件</span><br><span class="line">    var updateStr &#x3D; &#123;$set: &#123; &quot;url&quot; : &quot;https:&#x2F;&#x2F;www.mybj123.com&quot; &#125;&#125;;</span><br><span class="line">    dbo.collection(&quot;site&quot;).updateOne(whereStr, updateStr, function(err, res) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(&quot;文档更新成功&quot;);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行成功后，进入 mongo 管理工具查看数据已修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.site.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_id&quot; : ObjectId(&quot;5a794e36763eb821b24db854&quot;),</span><br><span class="line">    &quot;name&quot; : &quot;码云笔记&quot;,</span><br><span class="line">    &quot;url&quot; : &quot;https:&#x2F;&#x2F;www.mybj123.com&quot;     &#x2F;&#x2F; 已修改为 https</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要更新所有符合条的文档数据可以使用 <code>updateMany()</code>：</p>
<p>更新多条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    var whereStr &#x3D; &#123;&quot;type&quot;:&#39;en&#39;&#125;;  &#x2F;&#x2F; 查询条件</span><br><span class="line">    var updateStr &#x3D; &#123;$set: &#123; &quot;url&quot; : &quot;https:&#x2F;&#x2F;www.mybj123.com&quot; &#125;&#125;;</span><br><span class="line">    dbo.collection(&quot;site&quot;).updateMany(whereStr, updateStr, function(err, res) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">         console.log(res.result.nModified + &quot; 条文档被更新&quot;);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>result.nModified</code> 为更新的条数。</p>
<h3 id="删除数据-1"><a href="#删除数据-1" class="headerlink" title="删除数据"></a>删除数据</h3><p>以下实例将 <code>name</code> 为 “码云笔记” 的数据删除 :</p>
<p>删除一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    var whereStr &#x3D; &#123;&quot;name&quot;:&#39;码云笔记&#39;&#125;;  &#x2F;&#x2F; 查询条件</span><br><span class="line">    dbo.collection(&quot;site&quot;).deleteOne(whereStr, function(err, obj) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(&quot;文档删除成功&quot;);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行成功后，进入 mongo 管理工具查看数据已删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.site.find()</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>如果要删除多条语句可以使用 <code>deleteMany()</code> 方法</p>
<p>以下实例将 <code>type</code> 为 <code>en</code> 的所有数据删除 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    var whereStr &#x3D; &#123; type: &quot;en&quot; &#125;;  &#x2F;&#x2F; 查询条件</span><br><span class="line">    dbo.collection(&quot;site&quot;).deleteMany(whereStr, function(err, obj) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(obj.result.n + &quot; 条文档被删除&quot;);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>obj.result.n</code> 删除的条数。</p>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>排序 使用 <code>sort()</code> 方法，该方法接受一个参数，规定是升序(1)还是降序(-1)。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; type: 1 &#125;  &#x2F;&#x2F; 按 type 字段升序</span><br><span class="line">&#123; type: -1 &#125; &#x2F;&#x2F; 按 type 字段降序</span><br></pre></td></tr></table></figure>
<p>按 type 升序排列:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    var mysort &#x3D; &#123; type: 1 &#125;;</span><br><span class="line">    dbo.collection(&quot;site&quot;).find().sort(mysort).toArray(function(err, result) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(result);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="查询分页"><a href="#查询分页" class="headerlink" title="查询分页"></a>查询分页</h3><p>如果要设置指定的返回条数可以使用 <code>limit()</code> 方法，该方法只接受一个参数，指定了返回的条数。</p>
<p><code>limit()</code>：读取两条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    dbo.collection(&quot;site&quot;).find().limit(2).toArray(function(err, result) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(result);</span><br><span class="line">        db.close();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果要指定跳过的条数，可以使用 <code>skip()</code> 方法。</p>
<p><code>skip()</code>: 跳过前面两条数据，读取两条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    dbo.collection(&quot;site&quot;).find().skip(2).limit(2).toArray(function(err, result) &#123;</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        console.log(result);</span><br><span class="line">        db.close();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="连接操作"><a href="#连接操作" class="headerlink" title="连接操作"></a>连接操作</h3><p>mongoDB 不是一个关系型数据库，但我们可以使用 <code>$lookup</code> 来实现左连接。</p>
<p>例如我们有两个集合数据分别为：</p>
<p>集合1：orders</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; _id: 1, product_id: 154, status: 1 &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>集合2：products</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; _id: 154, name: &#39;笔记本电脑&#39; &#125;,</span><br><span class="line">  &#123; _id: 155, name: &#39;耳机&#39; &#125;,</span><br><span class="line">  &#123; _id: 156, name: &#39;台式电脑&#39; &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>$lookup</code> 实现左连接:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;127.0.0.1:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">  if (err) throw err;</span><br><span class="line">  var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">  dbo.collection(&#39;orders&#39;).aggregate([</span><br><span class="line">    &#123; $lookup:</span><br><span class="line">       &#123;</span><br><span class="line">         from: &#39;products&#39;,            &#x2F;&#x2F; 右集合</span><br><span class="line">         localField: &#39;product_id&#39;,    &#x2F;&#x2F; 左集合 join 字段</span><br><span class="line">         foreignField: &#39;_id&#39;,         &#x2F;&#x2F; 右集合 join 字段</span><br><span class="line">         as: &#39;orderdetails&#39;           &#x2F;&#x2F; 新生成字段（类型array）</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    ]).toArray(function(err, res) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    console.log(JSON.stringify(res));</span><br><span class="line">    db.close();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><p>我们可以使用 <code>drop()</code> 方法来删除集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var MongoClient &#x3D; require(&#39;mongodb&#39;).MongoClient;</span><br><span class="line">var url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;, function(err, db) &#123;</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    var dbo &#x3D; db.db(&quot;mybj&quot;);</span><br><span class="line">    &#x2F;&#x2F; 删除 test 集合</span><br><span class="line">    dbo.collection(&quot;test&quot;).drop(function(err, delOK) &#123;  &#x2F;&#x2F; 执行成功 delOK 返回 true，否则返回 false</span><br><span class="line">        if (err) throw err;</span><br><span class="line">        if (delOK) console.log(&quot;集合已删除&quot;);</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="使用-Promise"><a href="#使用-Promise" class="headerlink" title="使用 Promise"></a>使用 Promise</h2><p><code>Promise</code> 是一个 ECMAScript 6 提供的类，目的是更加优雅地书写复杂的异步任务。</p>
<p>以下实例使用 <code>Promise</code> 创建集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const MongoClient &#x3D; require(&quot;mongodb&quot;).MongoClient;</span><br><span class="line">const url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost&#x2F;mybj&quot;;</span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;).then((conn) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&quot;数据库已连接&quot;);</span><br><span class="line">    var dbase &#x3D; conn.db(&quot;mybj&quot;);</span><br><span class="line">    dbase.createCollection(&quot;site&quot;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&quot;已创建集合&quot;);</span><br><span class="line">    &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&quot;数据库操作错误&quot;);</span><br><span class="line">    &#125;).finally(() &#x3D;&gt; &#123;</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&quot;数据库连接失败&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Promise-数据操作"><a href="#Promise-数据操作" class="headerlink" title="Promise 数据操作"></a>Promise 数据操作</h3><p>现在我们在一个程序中实现四个连续操作：增加 、查询 、更改 、删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">const MongoClient &#x3D; require(&quot;mongodb&quot;).MongoClient;</span><br><span class="line">const url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost&#x2F;&quot;;</span><br><span class="line">MongoClient.connect(url, &#123; useNewUrlParser: true &#125;).then((conn) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&quot;数据库已连接&quot;);</span><br><span class="line">    const test &#x3D; conn.db(&quot;testdb&quot;).collection(&quot;test&quot;);</span><br><span class="line">    &#x2F;&#x2F; 增加</span><br><span class="line">    test.insertOne(&#123; &quot;site&quot;: &quot;mybj123.com&quot; &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        return test.find().toArray().then((arr) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(arr);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 更改</span><br><span class="line">        return test.updateMany(&#123; &quot;site&quot;: &quot;mybj123.com&quot; &#125;,</span><br><span class="line">            &#123; $set: &#123; &quot;site&quot;: &quot;example.com&quot; &#125; &#125;);</span><br><span class="line">    &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        return test.find().toArray().then((arr) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(arr);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 删除</span><br><span class="line">        return test.deleteMany(&#123; &quot;site&quot;: &quot;example.com&quot; &#125;);</span><br><span class="line">    &#125;).then((res) &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        return test.find().toArray().then((arr) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(arr);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&quot;数据操作失败&quot; + err.message);</span><br><span class="line">    &#125;).finally(() &#x3D;&gt; &#123;</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).catch((err) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&quot;数据库连接失败&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据库已连接</span><br><span class="line">[ &#123; _id: 5f1664966833e531d83d3ac6, site: &#39;mybj123.com&#39; &#125; ]</span><br><span class="line">[ &#123; _id: 5f1664966833e531d83d3ac6, site: &#39;example.com&#39; &#125; ]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<h3 id="用异步函数实现相同的数据操作"><a href="#用异步函数实现相同的数据操作" class="headerlink" title="用异步函数实现相同的数据操作"></a>用异步函数实现相同的数据操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">const MongoClient &#x3D; require(&quot;mongodb&quot;).MongoClient;</span><br><span class="line">const url &#x3D; &quot;mongodb:&#x2F;&#x2F;localhost&#x2F;&quot;;</span><br><span class="line"> </span><br><span class="line">async function dataOperate() &#123;</span><br><span class="line">    var conn &#x3D; null;</span><br><span class="line">    try &#123;</span><br><span class="line">        conn &#x3D; await MongoClient.connect(url);</span><br><span class="line">        console.log(&quot;数据库已连接&quot;);</span><br><span class="line">        const test &#x3D; conn.db(&quot;testdb&quot;).collection(&quot;test&quot;);</span><br><span class="line">        &#x2F;&#x2F; 增加</span><br><span class="line">        await test.insertOne(&#123; &quot;site&quot;: &quot;mybj123.com&quot; &#125;);</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        var arr &#x3D; await test.find().toArray();</span><br><span class="line">        console.log(arr);</span><br><span class="line">        &#x2F;&#x2F; 更改</span><br><span class="line">        await test.updateMany(&#123; &quot;site&quot;: &quot;mybj123.com&quot; &#125;,</span><br><span class="line">            &#123; $set: &#123; &quot;site&quot;: &quot;example.com&quot; &#125; &#125;);</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        arr &#x3D; await test.find().toArray();</span><br><span class="line">        console.log(arr);</span><br><span class="line">        &#x2F;&#x2F; 删除</span><br><span class="line">        await test.deleteMany(&#123; &quot;site&quot;: &quot;example.com&quot; &#125;);</span><br><span class="line">        &#x2F;&#x2F; 查询</span><br><span class="line">        arr &#x3D; await test.find().toArray();</span><br><span class="line">        console.log(arr);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        console.log(&quot;错误：&quot; + err.message);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        if (conn !&#x3D; null) conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">dataOperate();</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据库已连接</span><br><span class="line">[ &#123; _id: 5f169006a2780f0cd4ea640b, site: &#39;mybj123.com&#39; &#125; ]</span><br><span class="line">[ &#123; _id: 5f169006a2780f0cd4ea640b, site: &#39;example.com&#39; &#125; ]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>运行结果完全一样。</p>
<p>很显然，异步函数是一种非常良好的编程风格，在多次使用异步操作的时候非常实用。</p>
<p>但是请勿在低于 7.6.0 版本的 node.js 上使用异步函数。</p>

        </div>

        
            <section class="post-copyright">
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="#">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/taiaiac.gitee.io/tags/NodeJS/"># NodeJS</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/taiaiac.gitee.io/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/taiaiac.gitee.io/2020/12/30/vue/vue-router/">vue-router</a>
            
            
            <a class="next" rel="next" href="/taiaiac.gitee.io/2020/01/14/vue/vue%E5%AD%A6%E4%B9%A0/">vue学习</a>
            
        </section>


    </article>
</div>
</div>
      <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Z.A.M. | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
    <script
      type="text/javascript"
      color="96,98,102"
      opacity="0.7"
      zIndex="-2"
      count="99"
      src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"
    ></script>
  <script src="/taiaiac.gitee.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/taiaiac.gitee.io/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":200,"height":434},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
